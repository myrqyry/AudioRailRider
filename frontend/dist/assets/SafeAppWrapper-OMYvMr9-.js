const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ThreeCanvas-CIejxQTT.js","assets/index-B3dOLY_1.js","assets/index-Bpo9rWzO.css","assets/ToastProvider-BgtHwpgo.js"])))=>i.map(i=>d[i]);
var wy=Object.defineProperty;var Sy=(r,t,e)=>t in r?wy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Br=(r,t,e)=>Sy(r,typeof t!="symbol"?t+"":t,e);import{j as S,r as Rt,e as Zn,g as My,_ as Cy}from"./index-B3dOLY_1.js";import{useToast as Iy}from"./ToastProvider-BgtHwpgo.js";const vd=({error:r,onRetry:t,canRetry:e})=>S.jsxs("div",{role:"alert",className:"p-4 bg-red-900/50 border border-red-700 text-white rounded-lg text-center",children:[S.jsx("h2",{className:"text-xl font-bold",children:"Something went wrong."}),S.jsx("p",{className:"mt-2 text-red-200",children:(r==null?void 0:r.message)||"An unexpected error occurred."}),e&&t&&S.jsx("button",{onClick:t,className:"mt-4 px-4 py-2 bg-red-700 hover:bg-red-600 rounded-md transition-colors",children:"Try Again"})]}),Qu=3;class Ic extends Rt.Component{constructor(){super(...arguments);Br(this,"state",{hasError:!1,error:null,errorInfo:null,retryCount:0});Br(this,"handleRetry",()=>{this.state.retryCount<Qu&&this.setState(e=>({hasError:!1,error:null,errorInfo:null,retryCount:e.retryCount+1}))})}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("ErrorBoundary caught an error:",e,n),typeof window<"u"&&"gtag"in window&&window.gtag("event","exception",{description:e.message,fatal:!1}),this.setState({errorInfo:n})}render(){if(this.state.hasError){const e=this.props.fallback||vd;return S.jsx(e,{error:this.state.error,onRetry:this.handleRetry,canRetry:this.state.retryCount<Qu})}return this.props.children}}const th=r=>{let t;const e=new Set,n=(l,h)=>{const f=typeof l=="function"?l(t):l;if(!Object.is(f,t)){const d=t;t=h??(typeof f!="object"||f===null)?f:Object.assign({},t,f),e.forEach(m=>m(t,d))}},i=()=>t,o={setState:n,getState:i,getInitialState:()=>c,subscribe:l=>(e.add(l),()=>e.delete(l))},c=t=r(n,i,o);return o},Ry=(r=>r?th(r):th),Oy=r=>r;function Ny(r,t=Oy){const e=Zn.useSyncExternalStore(r.subscribe,Zn.useCallback(()=>t(r.getState()),[r,t]),Zn.useCallback(()=>t(r.getInitialState()),[r,t]));return Zn.useDebugValue(e),e}const eh=r=>{const t=Ry(r),e=n=>Ny(t,n);return Object.assign(e,t),e},Ly=(r=>r?eh(r):eh);var ue=(r=>(r.Idle="idle",r.Analyzing="analyzing",r.Generating="generating",r.Ready="ready",r.Riding="riding",r.Finished="finished",r.Error="error",r))(ue||{});const ka=r=>r,ky=r=>r,me=Ly((r,t)=>({_operationId:crypto.randomUUID(),status:ue.Idle,error:null,statusMessage:"",audioFile:null,audioSource:null,blueprint:null,audioFeatures:null,trackData:null,workflowProgress:0,generationProgress:0,skyboxUrl:null,generationOptions:null,breathingIntensity:1,actions:{setGenerationOptions:e=>r({generationOptions:e}),setBreathingIntensity:e=>r({breathingIntensity:e}),setStatus:(e,n)=>r({status:e,statusMessage:n||"",error:null}),setBlueprint:e=>r({blueprint:e}),setAudioFeatures:e=>r({audioFeatures:e}),setTrackData:e=>{r(n=>{const i=n.status;return e===null&&(i===ue.Riding||i===ue.Ready)?{...n,trackData:null,status:ue.Idle,statusMessage:"Track data was cleared, returning to start."}:{...n,trackData:e}})},setError:e=>r({error:e,status:e?ue.Error:t().status}),setAudioSource:e=>{r({audioSource:e,audioFile:null,status:ue.Idle,error:null,workflowProgress:0,skyboxUrl:null})},setWorkflowProgress:e=>r({workflowProgress:e}),setGenerationProgress:e=>r({generationProgress:e}),setSkyboxUrl:e=>r({skyboxUrl:e}),startRide:()=>{const e=t();e.status===ue.Ready&&e.trackData&&(e.audioFile||e.audioSource)&&r({status:ue.Riding})},resetApp:()=>{r({status:ue.Idle,error:null,statusMessage:"",audioFile:null,blueprint:null,audioFeatures:null,trackData:null,workflowProgress:0,skyboxUrl:null,generationOptions:null,breathingIntensity:1})},handleRideFinish:()=>{t().status===ue.Riding&&r({status:ue.Finished,statusMessage:"Your journey is complete."})},startRideAgain:()=>{t().status===ue.Finished&&t().trackData&&t().audioFile&&r({status:ue.Riding})},setAudioFileAsync:async e=>{const n=crypto.randomUUID();r(i=>({...i,audioFile:e,audioSource:null,status:ue.Loading,error:null,workflowProgress:0,skyboxUrl:null,_operationId:n}));try{r(i=>i._operationId!==n?i:{...i,status:ue.Idle,statusMessage:e?"Audio file loaded":"Audio file cleared"})}catch(i){r(s=>{if(s._operationId!==n)return s;const a=i instanceof Error?i.message:String(i);return{...s,status:ue.Error,error:{title:"Audio File Error",message:a}}})}}}}));function st(r,t,e){function n(o,c){var l;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(l=o._zod).traits??(l.traits=new Set),o._zod.traits.add(r),t(o,c);for(const h in a.prototype)h in o||Object.defineProperty(o,h,{value:a.prototype[h].bind(o)});o._zod.constr=a,o._zod.def=c}const i=(e==null?void 0:e.Parent)??Object;class s extends i{}Object.defineProperty(s,"name",{value:r});function a(o){var c;const l=e!=null&&e.Parent?new s:this;n(l,o),(c=l._zod).deferred??(c.deferred=[]);for(const h of l._zod.deferred)h();return l}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>{var c,l;return e!=null&&e.Parent&&o instanceof e.Parent?!0:(l=(c=o==null?void 0:o._zod)==null?void 0:c.traits)==null?void 0:l.has(r)}}),Object.defineProperty(a,"name",{value:r}),a}class Gi extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Ed extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Ad={};function Hn(r){return Ad}function Dy(r){const t=Object.values(r).filter(n=>typeof n=="number");return Object.entries(r).filter(([n,i])=>t.indexOf(+n)===-1).map(([n,i])=>i)}function Rc(r,t){return typeof t=="bigint"?t.toString():t}function Pc(r){return{get value(){{const t=r();return Object.defineProperty(this,"value",{value:t}),t}}}}function zc(r){return r==null}function Bc(r){const t=r.startsWith("^")?1:0,e=r.endsWith("$")?r.length-1:r.length;return r.slice(t,e)}function Fy(r,t){const e=(r.toString().split(".")[1]||"").length,n=t.toString();let i=(n.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(n)){const c=n.match(/\d?e-(\d?)/);c!=null&&c[1]&&(i=Number.parseInt(c[1]))}const s=e>i?e:i,a=Number.parseInt(r.toFixed(s).replace(".","")),o=Number.parseInt(t.toFixed(s).replace(".",""));return a%o/10**s}const rh=Symbol("evaluating");function Ee(r,t,e){let n;Object.defineProperty(r,t,{get(){if(n!==rh)return n===void 0&&(n=rh,n=e()),n},set(i){Object.defineProperty(r,t,{value:i})},configurable:!0})}function Xn(r,t,e){Object.defineProperty(r,t,{value:e,writable:!0,enumerable:!0,configurable:!0})}function Jn(...r){const t={};for(const e of r){const n=Object.getOwnPropertyDescriptors(e);Object.assign(t,n)}return Object.defineProperties({},t)}function nh(r){return JSON.stringify(r)}const Td="captureStackTrace"in Error?Error.captureStackTrace:(...r)=>{};function Da(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}const Py=Pc(()=>{var r;if(typeof navigator<"u"&&((r=navigator==null?void 0:navigator.userAgent)!=null&&r.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function vs(r){if(Da(r)===!1)return!1;const t=r.constructor;if(t===void 0)return!0;const e=t.prototype;return!(Da(e)===!1||Object.prototype.hasOwnProperty.call(e,"isPrototypeOf")===!1)}function wd(r){return vs(r)?{...r}:Array.isArray(r)?[...r]:r}const zy=new Set(["string","number","symbol"]);function Za(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function wn(r,t,e){const n=new r._zod.constr(t??r._zod.def);return(!t||e!=null&&e.parent)&&(n._zod.parent=r),n}function Yt(r){const t=r;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function By(r){return Object.keys(r).filter(t=>r[t]._zod.optin==="optional"&&r[t]._zod.optout==="optional")}const Uy={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Gy(r,t){const e=r._zod.def,n=Jn(r._zod.def,{get shape(){const i={};for(const s in t){if(!(s in e.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(i[s]=e.shape[s])}return Xn(this,"shape",i),i},checks:[]});return wn(r,n)}function jy(r,t){const e=r._zod.def,n=Jn(r._zod.def,{get shape(){const i={...r._zod.def.shape};for(const s in t){if(!(s in e.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&delete i[s]}return Xn(this,"shape",i),i},checks:[]});return wn(r,n)}function Vy(r,t){if(!vs(t))throw new Error("Invalid input to extend: expected a plain object");const e=r._zod.def.checks;if(e&&e.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const i=Jn(r._zod.def,{get shape(){const s={...r._zod.def.shape,...t};return Xn(this,"shape",s),s},checks:[]});return wn(r,i)}function $y(r,t){if(!vs(t))throw new Error("Invalid input to safeExtend: expected a plain object");const e={...r._zod.def,get shape(){const n={...r._zod.def.shape,...t};return Xn(this,"shape",n),n},checks:r._zod.def.checks};return wn(r,e)}function Zy(r,t){const e=Jn(r._zod.def,{get shape(){const n={...r._zod.def.shape,...t._zod.def.shape};return Xn(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return wn(r,e)}function Wy(r,t,e){const n=Jn(t._zod.def,{get shape(){const i=t._zod.def.shape,s={...i};if(e)for(const a in e){if(!(a in i))throw new Error(`Unrecognized key: "${a}"`);e[a]&&(s[a]=r?new r({type:"optional",innerType:i[a]}):i[a])}else for(const a in i)s[a]=r?new r({type:"optional",innerType:i[a]}):i[a];return Xn(this,"shape",s),s},checks:[]});return wn(t,n)}function Hy(r,t,e){const n=Jn(t._zod.def,{get shape(){const i=t._zod.def.shape,s={...i};if(e)for(const a in e){if(!(a in s))throw new Error(`Unrecognized key: "${a}"`);e[a]&&(s[a]=new r({type:"nonoptional",innerType:i[a]}))}else for(const a in i)s[a]=new r({type:"nonoptional",innerType:i[a]});return Xn(this,"shape",s),s},checks:[]});return wn(t,n)}function Fi(r,t=0){var e;if(r.aborted===!0)return!0;for(let n=t;n<r.issues.length;n++)if(((e=r.issues[n])==null?void 0:e.continue)!==!0)return!0;return!1}function Sd(r,t){return t.map(e=>{var n;return(n=e).path??(n.path=[]),e.path.unshift(r),e})}function ra(r){return typeof r=="string"?r:r==null?void 0:r.message}function Yn(r,t,e){var i,s,a,o,c,l;const n={...r,path:r.path??[]};if(!r.message){const h=ra((a=(s=(i=r.inst)==null?void 0:i._zod.def)==null?void 0:s.error)==null?void 0:a.call(s,r))??ra((o=t==null?void 0:t.error)==null?void 0:o.call(t,r))??ra((c=e.customError)==null?void 0:c.call(e,r))??ra((l=e.localeError)==null?void 0:l.call(e,r))??"Invalid input";n.message=h}return delete n.inst,delete n.continue,t!=null&&t.reportInput||delete n.input,n}function Uc(r){return Array.isArray(r)?"array":typeof r=="string"?"string":"unknown"}function Es(...r){const[t,e,n]=r;return typeof t=="string"?{message:t,code:"custom",input:e,inst:n}:{...t}}const Md=(r,t)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:t,enumerable:!1}),r.message=JSON.stringify(t,Rc,2),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},Cd=st("$ZodError",Md),Id=st("$ZodError",Md,{Parent:Error});function Yy(r,t=e=>e.message){const e={},n=[];for(const i of r.issues)i.path.length>0?(e[i.path[0]]=e[i.path[0]]||[],e[i.path[0]].push(t(i))):n.push(t(i));return{formErrors:n,fieldErrors:e}}function Xy(r,t=e=>e.message){const e={_errors:[]},n=i=>{for(const s of i.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(a=>n({issues:a}));else if(s.code==="invalid_key")n({issues:s.issues});else if(s.code==="invalid_element")n({issues:s.issues});else if(s.path.length===0)e._errors.push(t(s));else{let a=e,o=0;for(;o<s.path.length;){const c=s.path[o];o===s.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(t(s))):a[c]=a[c]||{_errors:[]},a=a[c],o++}}};return n(r),e}const Gc=r=>(t,e,n,i)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},a=t._zod.run({value:e,issues:[]},s);if(a instanceof Promise)throw new Gi;if(a.issues.length){const o=new((i==null?void 0:i.Err)??r)(a.issues.map(c=>Yn(c,s,Hn())));throw Td(o,i==null?void 0:i.callee),o}return a.value},jc=r=>async(t,e,n,i)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let a=t._zod.run({value:e,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){const o=new((i==null?void 0:i.Err)??r)(a.issues.map(c=>Yn(c,s,Hn())));throw Td(o,i==null?void 0:i.callee),o}return a.value},Wa=r=>(t,e,n)=>{const i=n?{...n,async:!1}:{async:!1},s=t._zod.run({value:e,issues:[]},i);if(s instanceof Promise)throw new Gi;return s.issues.length?{success:!1,error:new(r??Cd)(s.issues.map(a=>Yn(a,i,Hn())))}:{success:!0,data:s.value}},Jy=Wa(Id),Ha=r=>async(t,e,n)=>{const i=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:e,issues:[]},i);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new r(s.issues.map(a=>Yn(a,i,Hn())))}:{success:!0,data:s.value}},qy=Ha(Id),Ky=r=>(t,e,n)=>{const i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Gc(r)(t,e,i)},Qy=r=>(t,e,n)=>Gc(r)(t,e,n),tg=r=>async(t,e,n)=>{const i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return jc(r)(t,e,i)},eg=r=>async(t,e,n)=>jc(r)(t,e,n),rg=r=>(t,e,n)=>{const i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Wa(r)(t,e,i)},ng=r=>(t,e,n)=>Wa(r)(t,e,n),ig=r=>async(t,e,n)=>{const i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Ha(r)(t,e,i)},sg=r=>async(t,e,n)=>Ha(r)(t,e,n),ag=/^[cC][^\s-]{8,}$/,og=/^[0-9a-z]+$/,cg=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,lg=/^[0-9a-vA-V]{20}$/,ug=/^[A-Za-z0-9]{27}$/,hg=/^[a-zA-Z0-9_-]{21}$/,fg=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,dg=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ih=r=>r?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${r}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,pg=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,mg="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function yg(){return new RegExp(mg,"u")}const gg=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_g=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,xg=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,bg=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,vg=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Rd=/^[A-Za-z0-9_-]*$/,Eg=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,Ag=/^\+(?:[0-9]){6,14}[0-9]$/,Od="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Tg=new RegExp(`^${Od}$`);function Nd(r){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof r.precision=="number"?r.precision===-1?`${t}`:r.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${r.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function wg(r){return new RegExp(`^${Nd(r)}$`)}function Sg(r){const t=Nd({precision:r.precision}),e=["Z"];r.local&&e.push(""),r.offset&&e.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${e.join("|")})`;return new RegExp(`^${Od}T(?:${n})$`)}const Mg=r=>{const t=r?`[\\s\\S]{${(r==null?void 0:r.minimum)??0},${(r==null?void 0:r.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Cg=/^-?\d+$/,Ig=/^-?\d+(?:\.\d+)?/,Rg=/^[^A-Z]*$/,Og=/^[^a-z]*$/,pr=st("$ZodCheck",(r,t)=>{var e;r._zod??(r._zod={}),r._zod.def=t,(e=r._zod).onattach??(e.onattach=[])}),Ld={number:"number",bigint:"bigint",object:"date"},kd=st("$ZodCheckLessThan",(r,t)=>{pr.init(r,t);const e=Ld[typeof t.value];r._zod.onattach.push(n=>{const i=n._zod.bag,s=(t.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?i.maximum=t.value:i.exclusiveMaximum=t.value)}),r._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:e,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:r,continue:!t.abort})}}),Dd=st("$ZodCheckGreaterThan",(r,t)=>{pr.init(r,t);const e=Ld[typeof t.value];r._zod.onattach.push(n=>{const i=n._zod.bag,s=(t.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?i.minimum=t.value:i.exclusiveMinimum=t.value)}),r._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:e,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:r,continue:!t.abort})}}),Ng=st("$ZodCheckMultipleOf",(r,t)=>{pr.init(r,t),r._zod.onattach.push(e=>{var n;(n=e._zod.bag).multipleOf??(n.multipleOf=t.value)}),r._zod.check=e=>{if(typeof e.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof e.value=="bigint"?e.value%t.value===BigInt(0):Fy(e.value,t.value)===0)||e.issues.push({origin:typeof e.value,code:"not_multiple_of",divisor:t.value,input:e.value,inst:r,continue:!t.abort})}}),Lg=st("$ZodCheckNumberFormat",(r,t)=>{var a;pr.init(r,t),t.format=t.format||"float64";const e=(a=t.format)==null?void 0:a.includes("int"),n=e?"int":"number",[i,s]=Uy[t.format];r._zod.onattach.push(o=>{const c=o._zod.bag;c.format=t.format,c.minimum=i,c.maximum=s,e&&(c.pattern=Cg)}),r._zod.check=o=>{const c=o.value;if(e){if(!Number.isInteger(c)){o.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:c,inst:r});return}if(!Number.isSafeInteger(c)){c>0?o.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:r,origin:n,continue:!t.abort}):o.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:r,origin:n,continue:!t.abort});return}}c<i&&o.issues.push({origin:"number",input:c,code:"too_small",minimum:i,inclusive:!0,inst:r,continue:!t.abort}),c>s&&o.issues.push({origin:"number",input:c,code:"too_big",maximum:s,inst:r})}}),kg=st("$ZodCheckMaxLength",(r,t)=>{var e;pr.init(r,t),(e=r._zod.def).when??(e.when=n=>{const i=n.value;return!zc(i)&&i.length!==void 0}),r._zod.onattach.push(n=>{const i=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<i&&(n._zod.bag.maximum=t.maximum)}),r._zod.check=n=>{const i=n.value;if(i.length<=t.maximum)return;const a=Uc(i);n.issues.push({origin:a,code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:r,continue:!t.abort})}}),Dg=st("$ZodCheckMinLength",(r,t)=>{var e;pr.init(r,t),(e=r._zod.def).when??(e.when=n=>{const i=n.value;return!zc(i)&&i.length!==void 0}),r._zod.onattach.push(n=>{const i=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>i&&(n._zod.bag.minimum=t.minimum)}),r._zod.check=n=>{const i=n.value;if(i.length>=t.minimum)return;const a=Uc(i);n.issues.push({origin:a,code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:r,continue:!t.abort})}}),Fg=st("$ZodCheckLengthEquals",(r,t)=>{var e;pr.init(r,t),(e=r._zod.def).when??(e.when=n=>{const i=n.value;return!zc(i)&&i.length!==void 0}),r._zod.onattach.push(n=>{const i=n._zod.bag;i.minimum=t.length,i.maximum=t.length,i.length=t.length}),r._zod.check=n=>{const i=n.value,s=i.length;if(s===t.length)return;const a=Uc(i),o=s>t.length;n.issues.push({origin:a,...o?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:r,continue:!t.abort})}}),Ya=st("$ZodCheckStringFormat",(r,t)=>{var e,n;pr.init(r,t),r._zod.onattach.push(i=>{const s=i._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(e=r._zod).check??(e.check=i=>{t.pattern.lastIndex=0,!t.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:t.format,input:i.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:r,continue:!t.abort})}):(n=r._zod).check??(n.check=()=>{})}),Pg=st("$ZodCheckRegex",(r,t)=>{Ya.init(r,t),r._zod.check=e=>{t.pattern.lastIndex=0,!t.pattern.test(e.value)&&e.issues.push({origin:"string",code:"invalid_format",format:"regex",input:e.value,pattern:t.pattern.toString(),inst:r,continue:!t.abort})}}),zg=st("$ZodCheckLowerCase",(r,t)=>{t.pattern??(t.pattern=Rg),Ya.init(r,t)}),Bg=st("$ZodCheckUpperCase",(r,t)=>{t.pattern??(t.pattern=Og),Ya.init(r,t)}),Ug=st("$ZodCheckIncludes",(r,t)=>{pr.init(r,t);const e=Za(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${e}`:e);t.pattern=n,r._zod.onattach.push(i=>{const s=i._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),r._zod.check=i=>{i.value.includes(t.includes,t.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:i.value,inst:r,continue:!t.abort})}}),Gg=st("$ZodCheckStartsWith",(r,t)=>{pr.init(r,t);const e=new RegExp(`^${Za(t.prefix)}.*`);t.pattern??(t.pattern=e),r._zod.onattach.push(n=>{const i=n._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(e)}),r._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:r,continue:!t.abort})}}),jg=st("$ZodCheckEndsWith",(r,t)=>{pr.init(r,t);const e=new RegExp(`.*${Za(t.suffix)}$`);t.pattern??(t.pattern=e),r._zod.onattach.push(n=>{const i=n._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(e)}),r._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:r,continue:!t.abort})}}),Vg=st("$ZodCheckOverwrite",(r,t)=>{pr.init(r,t),r._zod.check=e=>{e.value=t.tx(e.value)}});class $g{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(a=>a),i=Math.min(...n.map(a=>a.length-a.trimStart().length)),s=n.map(a=>a.slice(i)).map(a=>" ".repeat(this.indent*2)+a);for(const a of s)this.content.push(a)}compile(){const t=Function,e=this==null?void 0:this.args,i=[...((this==null?void 0:this.content)??[""]).map(s=>`  ${s}`)];return new t(...e,i.join(`
`))}}const Zg={major:4,minor:1,patch:12},je=st("$ZodType",(r,t)=>{var i;var e;r??(r={}),r._zod.def=t,r._zod.bag=r._zod.bag||{},r._zod.version=Zg;const n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(const s of n)for(const a of s._zod.onattach)a(r);if(n.length===0)(e=r._zod).deferred??(e.deferred=[]),(i=r._zod.deferred)==null||i.push(()=>{r._zod.run=r._zod.parse});else{const s=(o,c,l)=>{let h=Fi(o),f;for(const d of c){if(d._zod.def.when){if(!d._zod.def.when(o))continue}else if(h)continue;const m=o.issues.length,b=d._zod.check(o);if(b instanceof Promise&&(l==null?void 0:l.async)===!1)throw new Gi;if(f||b instanceof Promise)f=(f??Promise.resolve()).then(async()=>{await b,o.issues.length!==m&&(h||(h=Fi(o,m)))});else{if(o.issues.length===m)continue;h||(h=Fi(o,m))}}return f?f.then(()=>o):o},a=(o,c,l)=>{if(Fi(o))return o.aborted=!0,o;const h=s(c,n,l);if(h instanceof Promise){if(l.async===!1)throw new Gi;return h.then(f=>r._zod.parse(f,l))}return r._zod.parse(h,l)};r._zod.run=(o,c)=>{if(c.skipChecks)return r._zod.parse(o,c);if(c.direction==="backward"){const h=r._zod.parse({value:o.value,issues:[]},{...c,skipChecks:!0});return h instanceof Promise?h.then(f=>a(f,o,c)):a(h,o,c)}const l=r._zod.parse(o,c);if(l instanceof Promise){if(c.async===!1)throw new Gi;return l.then(h=>s(h,n,c))}return s(l,n,c)}}r["~standard"]={validate:s=>{var a;try{const o=Jy(r,s);return o.success?{value:o.data}:{issues:(a=o.error)==null?void 0:a.issues}}catch{return qy(r,s).then(c=>{var l;return c.success?{value:c.data}:{issues:(l=c.error)==null?void 0:l.issues}})}},vendor:"zod",version:1}}),Vc=st("$ZodString",(r,t)=>{var e;je.init(r,t),r._zod.pattern=[...((e=r==null?void 0:r._zod.bag)==null?void 0:e.patterns)??[]].pop()??Mg(r._zod.bag),r._zod.parse=(n,i)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:r}),n}}),we=st("$ZodStringFormat",(r,t)=>{Ya.init(r,t),Vc.init(r,t)}),Wg=st("$ZodGUID",(r,t)=>{t.pattern??(t.pattern=dg),we.init(r,t)}),Hg=st("$ZodUUID",(r,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=ih(n))}else t.pattern??(t.pattern=ih());we.init(r,t)}),Yg=st("$ZodEmail",(r,t)=>{t.pattern??(t.pattern=pg),we.init(r,t)}),Xg=st("$ZodURL",(r,t)=>{we.init(r,t),r._zod.check=e=>{try{const n=e.value.trim(),i=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||e.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Eg.source,input:e.value,inst:r,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||e.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:e.value,inst:r,continue:!t.abort})),t.normalize?e.value=i.href:e.value=n;return}catch{e.issues.push({code:"invalid_format",format:"url",input:e.value,inst:r,continue:!t.abort})}}}),Jg=st("$ZodEmoji",(r,t)=>{t.pattern??(t.pattern=yg()),we.init(r,t)}),qg=st("$ZodNanoID",(r,t)=>{t.pattern??(t.pattern=hg),we.init(r,t)}),Kg=st("$ZodCUID",(r,t)=>{t.pattern??(t.pattern=ag),we.init(r,t)}),Qg=st("$ZodCUID2",(r,t)=>{t.pattern??(t.pattern=og),we.init(r,t)}),t_=st("$ZodULID",(r,t)=>{t.pattern??(t.pattern=cg),we.init(r,t)}),e_=st("$ZodXID",(r,t)=>{t.pattern??(t.pattern=lg),we.init(r,t)}),r_=st("$ZodKSUID",(r,t)=>{t.pattern??(t.pattern=ug),we.init(r,t)}),n_=st("$ZodISODateTime",(r,t)=>{t.pattern??(t.pattern=Sg(t)),we.init(r,t)}),i_=st("$ZodISODate",(r,t)=>{t.pattern??(t.pattern=Tg),we.init(r,t)}),s_=st("$ZodISOTime",(r,t)=>{t.pattern??(t.pattern=wg(t)),we.init(r,t)}),a_=st("$ZodISODuration",(r,t)=>{t.pattern??(t.pattern=fg),we.init(r,t)}),o_=st("$ZodIPv4",(r,t)=>{t.pattern??(t.pattern=gg),we.init(r,t),r._zod.onattach.push(e=>{const n=e._zod.bag;n.format="ipv4"})}),c_=st("$ZodIPv6",(r,t)=>{t.pattern??(t.pattern=_g),we.init(r,t),r._zod.onattach.push(e=>{const n=e._zod.bag;n.format="ipv6"}),r._zod.check=e=>{try{new URL(`http://[${e.value}]`)}catch{e.issues.push({code:"invalid_format",format:"ipv6",input:e.value,inst:r,continue:!t.abort})}}}),l_=st("$ZodCIDRv4",(r,t)=>{t.pattern??(t.pattern=xg),we.init(r,t)}),u_=st("$ZodCIDRv6",(r,t)=>{t.pattern??(t.pattern=bg),we.init(r,t),r._zod.check=e=>{const n=e.value.split("/");try{if(n.length!==2)throw new Error;const[i,s]=n;if(!s)throw new Error;const a=Number(s);if(`${a}`!==s)throw new Error;if(a<0||a>128)throw new Error;new URL(`http://[${i}]`)}catch{e.issues.push({code:"invalid_format",format:"cidrv6",input:e.value,inst:r,continue:!t.abort})}}});function Fd(r){if(r==="")return!0;if(r.length%4!==0)return!1;try{return atob(r),!0}catch{return!1}}const h_=st("$ZodBase64",(r,t)=>{t.pattern??(t.pattern=vg),we.init(r,t),r._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),r._zod.check=e=>{Fd(e.value)||e.issues.push({code:"invalid_format",format:"base64",input:e.value,inst:r,continue:!t.abort})}});function f_(r){if(!Rd.test(r))return!1;const t=r.replace(/[-_]/g,n=>n==="-"?"+":"/"),e=t.padEnd(Math.ceil(t.length/4)*4,"=");return Fd(e)}const d_=st("$ZodBase64URL",(r,t)=>{t.pattern??(t.pattern=Rd),we.init(r,t),r._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),r._zod.check=e=>{f_(e.value)||e.issues.push({code:"invalid_format",format:"base64url",input:e.value,inst:r,continue:!t.abort})}}),p_=st("$ZodE164",(r,t)=>{t.pattern??(t.pattern=Ag),we.init(r,t)});function m_(r,t=null){try{const e=r.split(".");if(e.length!==3)return!1;const[n]=e;if(!n)return!1;const i=JSON.parse(atob(n));return!("typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||t&&(!("alg"in i)||i.alg!==t))}catch{return!1}}const y_=st("$ZodJWT",(r,t)=>{we.init(r,t),r._zod.check=e=>{m_(e.value,t.alg)||e.issues.push({code:"invalid_format",format:"jwt",input:e.value,inst:r,continue:!t.abort})}}),Pd=st("$ZodNumber",(r,t)=>{je.init(r,t),r._zod.pattern=r._zod.bag.pattern??Ig,r._zod.parse=(e,n)=>{if(t.coerce)try{e.value=Number(e.value)}catch{}const i=e.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return e;const s=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return e.issues.push({expected:"number",code:"invalid_type",input:i,inst:r,...s?{received:s}:{}}),e}}),g_=st("$ZodNumber",(r,t)=>{Lg.init(r,t),Pd.init(r,t)}),__=st("$ZodUnknown",(r,t)=>{je.init(r,t),r._zod.parse=e=>e}),x_=st("$ZodNever",(r,t)=>{je.init(r,t),r._zod.parse=(e,n)=>(e.issues.push({expected:"never",code:"invalid_type",input:e.value,inst:r}),e)});function sh(r,t,e){r.issues.length&&t.issues.push(...Sd(e,r.issues)),t.value[e]=r.value}const b_=st("$ZodArray",(r,t)=>{je.init(r,t),r._zod.parse=(e,n)=>{const i=e.value;if(!Array.isArray(i))return e.issues.push({expected:"array",code:"invalid_type",input:i,inst:r}),e;e.value=Array(i.length);const s=[];for(let a=0;a<i.length;a++){const o=i[a],c=t.element._zod.run({value:o,issues:[]},n);c instanceof Promise?s.push(c.then(l=>sh(l,e,a))):sh(c,e,a)}return s.length?Promise.all(s).then(()=>e):e}});function Fa(r,t,e,n){r.issues.length&&t.issues.push(...Sd(e,r.issues)),r.value===void 0?e in n&&(t.value[e]=void 0):t.value[e]=r.value}function zd(r){var n,i,s,a;const t=Object.keys(r.shape);for(const o of t)if(!((a=(s=(i=(n=r.shape)==null?void 0:n[o])==null?void 0:i._zod)==null?void 0:s.traits)!=null&&a.has("$ZodType")))throw new Error(`Invalid element at key "${o}": expected a Zod schema`);const e=By(r.shape);return{...r,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(e)}}function Bd(r,t,e,n,i,s){const a=[],o=i.keySet,c=i.catchall._zod,l=c.def.type;for(const h of Object.keys(t)){if(o.has(h))continue;if(l==="never"){a.push(h);continue}const f=c.run({value:t[h],issues:[]},n);f instanceof Promise?r.push(f.then(d=>Fa(d,e,h,t))):Fa(f,e,h,t)}return a.length&&e.issues.push({code:"unrecognized_keys",keys:a,input:t,inst:s}),r.length?Promise.all(r).then(()=>e):e}const v_=st("$ZodObject",(r,t)=>{je.init(r,t);const e=Object.getOwnPropertyDescriptor(t,"shape");if(!(e!=null&&e.get)){const o=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...o};return Object.defineProperty(t,"shape",{value:c}),c}})}const n=Pc(()=>zd(t));Ee(r._zod,"propValues",()=>{const o=t.shape,c={};for(const l in o){const h=o[l]._zod;if(h.values){c[l]??(c[l]=new Set);for(const f of h.values)c[l].add(f)}}return c});const i=Da,s=t.catchall;let a;r._zod.parse=(o,c)=>{a??(a=n.value);const l=o.value;if(!i(l))return o.issues.push({expected:"object",code:"invalid_type",input:l,inst:r}),o;o.value={};const h=[],f=a.shape;for(const d of a.keys){const b=f[d]._zod.run({value:l[d],issues:[]},c);b instanceof Promise?h.push(b.then(I=>Fa(I,o,d,l))):Fa(b,o,d,l)}return s?Bd(h,l,o,c,n.value,r):h.length?Promise.all(h).then(()=>o):o}}),E_=st("$ZodObjectJIT",(r,t)=>{v_.init(r,t);const e=r._zod.parse,n=Pc(()=>zd(t)),i=d=>{const m=new $g(["shape","payload","ctx"]),b=n.value,I=X=>{const et=nh(X);return`shape[${et}]._zod.run({ value: input[${et}], issues: [] }, ctx)`};m.write("const input = payload.value;");const B=Object.create(null);let O=0;for(const X of b.keys)B[X]=`key_${O++}`;m.write("const newResult = {};");for(const X of b.keys){const et=B[X],q=nh(X);m.write(`const ${et} = ${I(X)};`),m.write(`
        if (${et}.issues.length) {
          payload.issues = payload.issues.concat(${et}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${q}, ...iss.path] : [${q}]
          })));
        }
        
        
        if (${et}.value === undefined) {
          if (${q} in input) {
            newResult[${q}] = undefined;
          }
        } else {
          newResult[${q}] = ${et}.value;
        }
        
      `)}m.write("payload.value = newResult;"),m.write("return payload;");const ut=m.compile();return(X,et)=>ut(d,X,et)};let s;const a=Da,o=!Ad.jitless,l=o&&Py.value,h=t.catchall;let f;r._zod.parse=(d,m)=>{f??(f=n.value);const b=d.value;return a(b)?o&&l&&(m==null?void 0:m.async)===!1&&m.jitless!==!0?(s||(s=i(t.shape)),d=s(d,m),h?Bd([],b,d,m,f,r):d):e(d,m):(d.issues.push({expected:"object",code:"invalid_type",input:b,inst:r}),d)}});function ah(r,t,e,n){for(const s of r)if(s.issues.length===0)return t.value=s.value,t;const i=r.filter(s=>!Fi(s));return i.length===1?(t.value=i[0].value,i[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:e,errors:r.map(s=>s.issues.map(a=>Yn(a,n,Hn())))}),t)}const A_=st("$ZodUnion",(r,t)=>{je.init(r,t),Ee(r._zod,"optin",()=>t.options.some(i=>i._zod.optin==="optional")?"optional":void 0),Ee(r._zod,"optout",()=>t.options.some(i=>i._zod.optout==="optional")?"optional":void 0),Ee(r._zod,"values",()=>{if(t.options.every(i=>i._zod.values))return new Set(t.options.flatMap(i=>Array.from(i._zod.values)))}),Ee(r._zod,"pattern",()=>{if(t.options.every(i=>i._zod.pattern)){const i=t.options.map(s=>s._zod.pattern);return new RegExp(`^(${i.map(s=>Bc(s.source)).join("|")})$`)}});const e=t.options.length===1,n=t.options[0]._zod.run;r._zod.parse=(i,s)=>{if(e)return n(i,s);let a=!1;const o=[];for(const c of t.options){const l=c._zod.run({value:i.value,issues:[]},s);if(l instanceof Promise)o.push(l),a=!0;else{if(l.issues.length===0)return l;o.push(l)}}return a?Promise.all(o).then(c=>ah(c,i,r,s)):ah(o,i,r,s)}}),T_=st("$ZodIntersection",(r,t)=>{je.init(r,t),r._zod.parse=(e,n)=>{const i=e.value,s=t.left._zod.run({value:i,issues:[]},n),a=t.right._zod.run({value:i,issues:[]},n);return s instanceof Promise||a instanceof Promise?Promise.all([s,a]).then(([c,l])=>oh(e,c,l)):oh(e,s,a)}});function Oc(r,t){if(r===t)return{valid:!0,data:r};if(r instanceof Date&&t instanceof Date&&+r==+t)return{valid:!0,data:r};if(vs(r)&&vs(t)){const e=Object.keys(t),n=Object.keys(r).filter(s=>e.indexOf(s)!==-1),i={...r,...t};for(const s of n){const a=Oc(r[s],t[s]);if(!a.valid)return{valid:!1,mergeErrorPath:[s,...a.mergeErrorPath]};i[s]=a.data}return{valid:!0,data:i}}if(Array.isArray(r)&&Array.isArray(t)){if(r.length!==t.length)return{valid:!1,mergeErrorPath:[]};const e=[];for(let n=0;n<r.length;n++){const i=r[n],s=t[n],a=Oc(i,s);if(!a.valid)return{valid:!1,mergeErrorPath:[n,...a.mergeErrorPath]};e.push(a.data)}return{valid:!0,data:e}}return{valid:!1,mergeErrorPath:[]}}function oh(r,t,e){if(t.issues.length&&r.issues.push(...t.issues),e.issues.length&&r.issues.push(...e.issues),Fi(r))return r;const n=Oc(t.value,e.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return r.value=n.data,r}const w_=st("$ZodEnum",(r,t)=>{je.init(r,t);const e=Dy(t.entries),n=new Set(e);r._zod.values=n,r._zod.pattern=new RegExp(`^(${e.filter(i=>zy.has(typeof i)).map(i=>typeof i=="string"?Za(i):i.toString()).join("|")})$`),r._zod.parse=(i,s)=>{const a=i.value;return n.has(a)||i.issues.push({code:"invalid_value",values:e,input:a,inst:r}),i}}),S_=st("$ZodTransform",(r,t)=>{je.init(r,t),r._zod.parse=(e,n)=>{if(n.direction==="backward")throw new Ed(r.constructor.name);const i=t.transform(e.value,e);if(n.async)return(i instanceof Promise?i:Promise.resolve(i)).then(a=>(e.value=a,e));if(i instanceof Promise)throw new Gi;return e.value=i,e}});function ch(r,t){return r.issues.length&&t===void 0?{issues:[],value:void 0}:r}const M_=st("$ZodOptional",(r,t)=>{je.init(r,t),r._zod.optin="optional",r._zod.optout="optional",Ee(r._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),Ee(r._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${Bc(e.source)})?$`):void 0}),r._zod.parse=(e,n)=>{if(t.innerType._zod.optin==="optional"){const i=t.innerType._zod.run(e,n);return i instanceof Promise?i.then(s=>ch(s,e.value)):ch(i,e.value)}return e.value===void 0?e:t.innerType._zod.run(e,n)}}),C_=st("$ZodNullable",(r,t)=>{je.init(r,t),Ee(r._zod,"optin",()=>t.innerType._zod.optin),Ee(r._zod,"optout",()=>t.innerType._zod.optout),Ee(r._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${Bc(e.source)}|null)$`):void 0}),Ee(r._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),r._zod.parse=(e,n)=>e.value===null?e:t.innerType._zod.run(e,n)}),I_=st("$ZodDefault",(r,t)=>{je.init(r,t),r._zod.optin="optional",Ee(r._zod,"values",()=>t.innerType._zod.values),r._zod.parse=(e,n)=>{if(n.direction==="backward")return t.innerType._zod.run(e,n);if(e.value===void 0)return e.value=t.defaultValue,e;const i=t.innerType._zod.run(e,n);return i instanceof Promise?i.then(s=>lh(s,t)):lh(i,t)}});function lh(r,t){return r.value===void 0&&(r.value=t.defaultValue),r}const R_=st("$ZodPrefault",(r,t)=>{je.init(r,t),r._zod.optin="optional",Ee(r._zod,"values",()=>t.innerType._zod.values),r._zod.parse=(e,n)=>(n.direction==="backward"||e.value===void 0&&(e.value=t.defaultValue),t.innerType._zod.run(e,n))}),O_=st("$ZodNonOptional",(r,t)=>{je.init(r,t),Ee(r._zod,"values",()=>{const e=t.innerType._zod.values;return e?new Set([...e].filter(n=>n!==void 0)):void 0}),r._zod.parse=(e,n)=>{const i=t.innerType._zod.run(e,n);return i instanceof Promise?i.then(s=>uh(s,r)):uh(i,r)}});function uh(r,t){return!r.issues.length&&r.value===void 0&&r.issues.push({code:"invalid_type",expected:"nonoptional",input:r.value,inst:t}),r}const N_=st("$ZodCatch",(r,t)=>{je.init(r,t),Ee(r._zod,"optin",()=>t.innerType._zod.optin),Ee(r._zod,"optout",()=>t.innerType._zod.optout),Ee(r._zod,"values",()=>t.innerType._zod.values),r._zod.parse=(e,n)=>{if(n.direction==="backward")return t.innerType._zod.run(e,n);const i=t.innerType._zod.run(e,n);return i instanceof Promise?i.then(s=>(e.value=s.value,s.issues.length&&(e.value=t.catchValue({...e,error:{issues:s.issues.map(a=>Yn(a,n,Hn()))},input:e.value}),e.issues=[]),e)):(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(s=>Yn(s,n,Hn()))},input:e.value}),e.issues=[]),e)}}),L_=st("$ZodPipe",(r,t)=>{je.init(r,t),Ee(r._zod,"values",()=>t.in._zod.values),Ee(r._zod,"optin",()=>t.in._zod.optin),Ee(r._zod,"optout",()=>t.out._zod.optout),Ee(r._zod,"propValues",()=>t.in._zod.propValues),r._zod.parse=(e,n)=>{if(n.direction==="backward"){const s=t.out._zod.run(e,n);return s instanceof Promise?s.then(a=>na(a,t.in,n)):na(s,t.in,n)}const i=t.in._zod.run(e,n);return i instanceof Promise?i.then(s=>na(s,t.out,n)):na(i,t.out,n)}});function na(r,t,e){return r.issues.length?(r.aborted=!0,r):t._zod.run({value:r.value,issues:r.issues},e)}const k_=st("$ZodReadonly",(r,t)=>{je.init(r,t),Ee(r._zod,"propValues",()=>t.innerType._zod.propValues),Ee(r._zod,"values",()=>t.innerType._zod.values),Ee(r._zod,"optin",()=>t.innerType._zod.optin),Ee(r._zod,"optout",()=>t.innerType._zod.optout),r._zod.parse=(e,n)=>{if(n.direction==="backward")return t.innerType._zod.run(e,n);const i=t.innerType._zod.run(e,n);return i instanceof Promise?i.then(hh):hh(i)}});function hh(r){return r.value=Object.freeze(r.value),r}const D_=st("$ZodCustom",(r,t)=>{pr.init(r,t),je.init(r,t),r._zod.parse=(e,n)=>e,r._zod.check=e=>{const n=e.value,i=t.fn(n);if(i instanceof Promise)return i.then(s=>fh(s,e,n,r));fh(i,e,n,r)}});function fh(r,t,e,n){if(!r){const i={code:"custom",input:e,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(i.params=n._zod.def.params),t.issues.push(Es(i))}}class F_{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...e){const n=e[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const e=this._map.get(t);return e&&typeof e=="object"&&"id"in e&&this._idmap.delete(e.id),this._map.delete(t),this}get(t){const e=t._zod.parent;if(e){const n={...this.get(e)??{}};delete n.id;const i={...n,...this._map.get(t)};return Object.keys(i).length?i:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function P_(){return new F_}const ia=P_();function z_(r,t){return new r({type:"string",...Yt(t)})}function B_(r,t){return new r({type:"string",format:"email",check:"string_format",abort:!1,...Yt(t)})}function dh(r,t){return new r({type:"string",format:"guid",check:"string_format",abort:!1,...Yt(t)})}function U_(r,t){return new r({type:"string",format:"uuid",check:"string_format",abort:!1,...Yt(t)})}function G_(r,t){return new r({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Yt(t)})}function j_(r,t){return new r({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Yt(t)})}function V_(r,t){return new r({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Yt(t)})}function $_(r,t){return new r({type:"string",format:"url",check:"string_format",abort:!1,...Yt(t)})}function Z_(r,t){return new r({type:"string",format:"emoji",check:"string_format",abort:!1,...Yt(t)})}function W_(r,t){return new r({type:"string",format:"nanoid",check:"string_format",abort:!1,...Yt(t)})}function H_(r,t){return new r({type:"string",format:"cuid",check:"string_format",abort:!1,...Yt(t)})}function Y_(r,t){return new r({type:"string",format:"cuid2",check:"string_format",abort:!1,...Yt(t)})}function X_(r,t){return new r({type:"string",format:"ulid",check:"string_format",abort:!1,...Yt(t)})}function J_(r,t){return new r({type:"string",format:"xid",check:"string_format",abort:!1,...Yt(t)})}function q_(r,t){return new r({type:"string",format:"ksuid",check:"string_format",abort:!1,...Yt(t)})}function K_(r,t){return new r({type:"string",format:"ipv4",check:"string_format",abort:!1,...Yt(t)})}function Q_(r,t){return new r({type:"string",format:"ipv6",check:"string_format",abort:!1,...Yt(t)})}function tx(r,t){return new r({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Yt(t)})}function ex(r,t){return new r({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Yt(t)})}function rx(r,t){return new r({type:"string",format:"base64",check:"string_format",abort:!1,...Yt(t)})}function nx(r,t){return new r({type:"string",format:"base64url",check:"string_format",abort:!1,...Yt(t)})}function ix(r,t){return new r({type:"string",format:"e164",check:"string_format",abort:!1,...Yt(t)})}function sx(r,t){return new r({type:"string",format:"jwt",check:"string_format",abort:!1,...Yt(t)})}function ax(r,t){return new r({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Yt(t)})}function ox(r,t){return new r({type:"string",format:"date",check:"string_format",...Yt(t)})}function cx(r,t){return new r({type:"string",format:"time",check:"string_format",precision:null,...Yt(t)})}function lx(r,t){return new r({type:"string",format:"duration",check:"string_format",...Yt(t)})}function ux(r,t){return new r({type:"number",checks:[],...Yt(t)})}function hx(r,t){return new r({type:"number",check:"number_format",abort:!1,format:"safeint",...Yt(t)})}function fx(r){return new r({type:"unknown"})}function dx(r,t){return new r({type:"never",...Yt(t)})}function ph(r,t){return new kd({check:"less_than",...Yt(t),value:r,inclusive:!1})}function Yo(r,t){return new kd({check:"less_than",...Yt(t),value:r,inclusive:!0})}function mh(r,t){return new Dd({check:"greater_than",...Yt(t),value:r,inclusive:!1})}function Xo(r,t){return new Dd({check:"greater_than",...Yt(t),value:r,inclusive:!0})}function yh(r,t){return new Ng({check:"multiple_of",...Yt(t),value:r})}function Ud(r,t){return new kg({check:"max_length",...Yt(t),maximum:r})}function Pa(r,t){return new Dg({check:"min_length",...Yt(t),minimum:r})}function Gd(r,t){return new Fg({check:"length_equals",...Yt(t),length:r})}function px(r,t){return new Pg({check:"string_format",format:"regex",...Yt(t),pattern:r})}function mx(r){return new zg({check:"string_format",format:"lowercase",...Yt(r)})}function yx(r){return new Bg({check:"string_format",format:"uppercase",...Yt(r)})}function gx(r,t){return new Ug({check:"string_format",format:"includes",...Yt(t),includes:r})}function _x(r,t){return new Gg({check:"string_format",format:"starts_with",...Yt(t),prefix:r})}function xx(r,t){return new jg({check:"string_format",format:"ends_with",...Yt(t),suffix:r})}function As(r){return new Vg({check:"overwrite",tx:r})}function bx(r){return As(t=>t.normalize(r))}function vx(){return As(r=>r.trim())}function Ex(){return As(r=>r.toLowerCase())}function Ax(){return As(r=>r.toUpperCase())}function Tx(r,t,e){return new r({type:"array",element:t,...Yt(e)})}function wx(r,t,e){return new r({type:"custom",check:"custom",fn:t,...Yt(e)})}function Sx(r){const t=Mx(e=>(e.addIssue=n=>{if(typeof n=="string")e.issues.push(Es(n,e.value,t._zod.def));else{const i=n;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=e.value),i.inst??(i.inst=t),i.continue??(i.continue=!t._zod.def.abort),e.issues.push(Es(i))}},r(e.value,e)));return t}function Mx(r,t){const e=new pr({check:"custom",...Yt(t)});return e._zod.check=r,e}const Cx=st("ZodISODateTime",(r,t)=>{n_.init(r,t),Re.init(r,t)});function Ix(r){return ax(Cx,r)}const Rx=st("ZodISODate",(r,t)=>{i_.init(r,t),Re.init(r,t)});function Ox(r){return ox(Rx,r)}const Nx=st("ZodISOTime",(r,t)=>{s_.init(r,t),Re.init(r,t)});function Lx(r){return cx(Nx,r)}const kx=st("ZodISODuration",(r,t)=>{a_.init(r,t),Re.init(r,t)});function Dx(r){return lx(kx,r)}const Fx=(r,t)=>{Cd.init(r,t),r.name="ZodError",Object.defineProperties(r,{format:{value:e=>Xy(r,e)},flatten:{value:e=>Yy(r,e)},addIssue:{value:e=>{r.issues.push(e),r.message=JSON.stringify(r.issues,Rc,2)}},addIssues:{value:e=>{r.issues.push(...e),r.message=JSON.stringify(r.issues,Rc,2)}},isEmpty:{get(){return r.issues.length===0}}})},wr=st("ZodError",Fx,{Parent:Error}),Px=Gc(wr),zx=jc(wr),Bx=Wa(wr),Ux=Ha(wr),Gx=Ky(wr),jx=Qy(wr),Vx=tg(wr),$x=eg(wr),Zx=rg(wr),Wx=ng(wr),Hx=ig(wr),Yx=sg(wr),We=st("ZodType",(r,t)=>(je.init(r,t),r.def=t,r.type=t.type,Object.defineProperty(r,"_def",{value:t}),r.check=(...e)=>r.clone(Jn(t,{checks:[...t.checks??[],...e.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),r.clone=(e,n)=>wn(r,e,n),r.brand=()=>r,r.register=((e,n)=>(e.add(r,n),r)),r.parse=(e,n)=>Px(r,e,n,{callee:r.parse}),r.safeParse=(e,n)=>Bx(r,e,n),r.parseAsync=async(e,n)=>zx(r,e,n,{callee:r.parseAsync}),r.safeParseAsync=async(e,n)=>Ux(r,e,n),r.spa=r.safeParseAsync,r.encode=(e,n)=>Gx(r,e,n),r.decode=(e,n)=>jx(r,e,n),r.encodeAsync=async(e,n)=>Vx(r,e,n),r.decodeAsync=async(e,n)=>$x(r,e,n),r.safeEncode=(e,n)=>Zx(r,e,n),r.safeDecode=(e,n)=>Wx(r,e,n),r.safeEncodeAsync=async(e,n)=>Hx(r,e,n),r.safeDecodeAsync=async(e,n)=>Yx(r,e,n),r.refine=(e,n)=>r.check(zb(e,n)),r.superRefine=e=>r.check(Bb(e)),r.overwrite=e=>r.check(As(e)),r.optional=()=>vh(r),r.nullable=()=>Eh(r),r.nullish=()=>vh(Eh(r)),r.nonoptional=e=>Ob(r,e),r.array=()=>$d(r),r.or=e=>bb([r,e]),r.and=e=>Eb(r,e),r.transform=e=>Ah(r,wb(e)),r.default=e=>Cb(r,e),r.prefault=e=>Rb(r,e),r.catch=e=>Lb(r,e),r.pipe=e=>Ah(r,e),r.readonly=()=>Fb(r),r.describe=e=>{const n=r.clone();return ia.add(n,{description:e}),n},Object.defineProperty(r,"description",{get(){var e;return(e=ia.get(r))==null?void 0:e.description},configurable:!0}),r.meta=(...e)=>{if(e.length===0)return ia.get(r);const n=r.clone();return ia.add(n,e[0]),n},r.isOptional=()=>r.safeParse(void 0).success,r.isNullable=()=>r.safeParse(null).success,r)),jd=st("_ZodString",(r,t)=>{Vc.init(r,t),We.init(r,t);const e=r._zod.bag;r.format=e.format??null,r.minLength=e.minimum??null,r.maxLength=e.maximum??null,r.regex=(...n)=>r.check(px(...n)),r.includes=(...n)=>r.check(gx(...n)),r.startsWith=(...n)=>r.check(_x(...n)),r.endsWith=(...n)=>r.check(xx(...n)),r.min=(...n)=>r.check(Pa(...n)),r.max=(...n)=>r.check(Ud(...n)),r.length=(...n)=>r.check(Gd(...n)),r.nonempty=(...n)=>r.check(Pa(1,...n)),r.lowercase=n=>r.check(mx(n)),r.uppercase=n=>r.check(yx(n)),r.trim=()=>r.check(vx()),r.normalize=(...n)=>r.check(bx(...n)),r.toLowerCase=()=>r.check(Ex()),r.toUpperCase=()=>r.check(Ax())}),Xx=st("ZodString",(r,t)=>{Vc.init(r,t),jd.init(r,t),r.email=e=>r.check(B_(Jx,e)),r.url=e=>r.check($_(qx,e)),r.jwt=e=>r.check(sx(fb,e)),r.emoji=e=>r.check(Z_(Kx,e)),r.guid=e=>r.check(dh(_h,e)),r.uuid=e=>r.check(U_(sa,e)),r.uuidv4=e=>r.check(G_(sa,e)),r.uuidv6=e=>r.check(j_(sa,e)),r.uuidv7=e=>r.check(V_(sa,e)),r.nanoid=e=>r.check(W_(Qx,e)),r.guid=e=>r.check(dh(_h,e)),r.cuid=e=>r.check(H_(tb,e)),r.cuid2=e=>r.check(Y_(eb,e)),r.ulid=e=>r.check(X_(rb,e)),r.base64=e=>r.check(rx(lb,e)),r.base64url=e=>r.check(nx(ub,e)),r.xid=e=>r.check(J_(nb,e)),r.ksuid=e=>r.check(q_(ib,e)),r.ipv4=e=>r.check(K_(sb,e)),r.ipv6=e=>r.check(Q_(ab,e)),r.cidrv4=e=>r.check(tx(ob,e)),r.cidrv6=e=>r.check(ex(cb,e)),r.e164=e=>r.check(ix(hb,e)),r.datetime=e=>r.check(Ix(e)),r.date=e=>r.check(Ox(e)),r.time=e=>r.check(Lx(e)),r.duration=e=>r.check(Dx(e))});function gh(r){return z_(Xx,r)}const Re=st("ZodStringFormat",(r,t)=>{we.init(r,t),jd.init(r,t)}),Jx=st("ZodEmail",(r,t)=>{Yg.init(r,t),Re.init(r,t)}),_h=st("ZodGUID",(r,t)=>{Wg.init(r,t),Re.init(r,t)}),sa=st("ZodUUID",(r,t)=>{Hg.init(r,t),Re.init(r,t)}),qx=st("ZodURL",(r,t)=>{Xg.init(r,t),Re.init(r,t)}),Kx=st("ZodEmoji",(r,t)=>{Jg.init(r,t),Re.init(r,t)}),Qx=st("ZodNanoID",(r,t)=>{qg.init(r,t),Re.init(r,t)}),tb=st("ZodCUID",(r,t)=>{Kg.init(r,t),Re.init(r,t)}),eb=st("ZodCUID2",(r,t)=>{Qg.init(r,t),Re.init(r,t)}),rb=st("ZodULID",(r,t)=>{t_.init(r,t),Re.init(r,t)}),nb=st("ZodXID",(r,t)=>{e_.init(r,t),Re.init(r,t)}),ib=st("ZodKSUID",(r,t)=>{r_.init(r,t),Re.init(r,t)}),sb=st("ZodIPv4",(r,t)=>{o_.init(r,t),Re.init(r,t)}),ab=st("ZodIPv6",(r,t)=>{c_.init(r,t),Re.init(r,t)}),ob=st("ZodCIDRv4",(r,t)=>{l_.init(r,t),Re.init(r,t)}),cb=st("ZodCIDRv6",(r,t)=>{u_.init(r,t),Re.init(r,t)}),lb=st("ZodBase64",(r,t)=>{h_.init(r,t),Re.init(r,t)}),ub=st("ZodBase64URL",(r,t)=>{d_.init(r,t),Re.init(r,t)}),hb=st("ZodE164",(r,t)=>{p_.init(r,t),Re.init(r,t)}),fb=st("ZodJWT",(r,t)=>{y_.init(r,t),Re.init(r,t)}),Vd=st("ZodNumber",(r,t)=>{Pd.init(r,t),We.init(r,t),r.gt=(n,i)=>r.check(mh(n,i)),r.gte=(n,i)=>r.check(Xo(n,i)),r.min=(n,i)=>r.check(Xo(n,i)),r.lt=(n,i)=>r.check(ph(n,i)),r.lte=(n,i)=>r.check(Yo(n,i)),r.max=(n,i)=>r.check(Yo(n,i)),r.int=n=>r.check(xh(n)),r.safe=n=>r.check(xh(n)),r.positive=n=>r.check(mh(0,n)),r.nonnegative=n=>r.check(Xo(0,n)),r.negative=n=>r.check(ph(0,n)),r.nonpositive=n=>r.check(Yo(0,n)),r.multipleOf=(n,i)=>r.check(yh(n,i)),r.step=(n,i)=>r.check(yh(n,i)),r.finite=()=>r;const e=r._zod.bag;r.minValue=Math.max(e.minimum??Number.NEGATIVE_INFINITY,e.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,r.maxValue=Math.min(e.maximum??Number.POSITIVE_INFINITY,e.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,r.isInt=(e.format??"").includes("int")||Number.isSafeInteger(e.multipleOf??.5),r.isFinite=!0,r.format=e.format??null});function dr(r){return ux(Vd,r)}const db=st("ZodNumberFormat",(r,t)=>{g_.init(r,t),Vd.init(r,t)});function xh(r){return hx(db,r)}const pb=st("ZodUnknown",(r,t)=>{__.init(r,t),We.init(r,t)});function bh(){return fx(pb)}const mb=st("ZodNever",(r,t)=>{x_.init(r,t),We.init(r,t)});function yb(r){return dx(mb,r)}const gb=st("ZodArray",(r,t)=>{b_.init(r,t),We.init(r,t),r.element=t.element,r.min=(e,n)=>r.check(Pa(e,n)),r.nonempty=e=>r.check(Pa(1,e)),r.max=(e,n)=>r.check(Ud(e,n)),r.length=(e,n)=>r.check(Gd(e,n)),r.unwrap=()=>r.element});function $d(r,t){return Tx(gb,r,t)}const _b=st("ZodObject",(r,t)=>{E_.init(r,t),We.init(r,t),Ee(r,"shape",()=>t.shape),r.keyof=()=>Ab(Object.keys(r._zod.def.shape)),r.catchall=e=>r.clone({...r._zod.def,catchall:e}),r.passthrough=()=>r.clone({...r._zod.def,catchall:bh()}),r.loose=()=>r.clone({...r._zod.def,catchall:bh()}),r.strict=()=>r.clone({...r._zod.def,catchall:yb()}),r.strip=()=>r.clone({...r._zod.def,catchall:void 0}),r.extend=e=>Vy(r,e),r.safeExtend=e=>$y(r,e),r.merge=e=>Zy(r,e),r.pick=e=>Gy(r,e),r.omit=e=>jy(r,e),r.partial=(...e)=>Wy(Zd,r,e[0]),r.required=(...e)=>Hy(Wd,r,e[0])});function Nc(r,t){const e={type:"object",shape:r??{},...Yt(t)};return new _b(e)}const xb=st("ZodUnion",(r,t)=>{A_.init(r,t),We.init(r,t),r.options=t.options});function bb(r,t){return new xb({type:"union",options:r,...Yt(t)})}const vb=st("ZodIntersection",(r,t)=>{T_.init(r,t),We.init(r,t)});function Eb(r,t){return new vb({type:"intersection",left:r,right:t})}const Lc=st("ZodEnum",(r,t)=>{w_.init(r,t),We.init(r,t),r.enum=t.entries,r.options=Object.values(t.entries);const e=new Set(Object.keys(t.entries));r.extract=(n,i)=>{const s={};for(const a of n)if(e.has(a))s[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new Lc({...t,checks:[],...Yt(i),entries:s})},r.exclude=(n,i)=>{const s={...t.entries};for(const a of n)if(e.has(a))delete s[a];else throw new Error(`Key ${a} not found in enum`);return new Lc({...t,checks:[],...Yt(i),entries:s})}});function Ab(r,t){const e=Array.isArray(r)?Object.fromEntries(r.map(n=>[n,n])):r;return new Lc({type:"enum",entries:e,...Yt(t)})}const Tb=st("ZodTransform",(r,t)=>{S_.init(r,t),We.init(r,t),r._zod.parse=(e,n)=>{if(n.direction==="backward")throw new Ed(r.constructor.name);e.addIssue=s=>{if(typeof s=="string")e.issues.push(Es(s,e.value,t));else{const a=s;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=e.value),a.inst??(a.inst=r),e.issues.push(Es(a))}};const i=t.transform(e.value,e);return i instanceof Promise?i.then(s=>(e.value=s,e)):(e.value=i,e)}});function wb(r){return new Tb({type:"transform",transform:r})}const Zd=st("ZodOptional",(r,t)=>{M_.init(r,t),We.init(r,t),r.unwrap=()=>r._zod.def.innerType});function vh(r){return new Zd({type:"optional",innerType:r})}const Sb=st("ZodNullable",(r,t)=>{C_.init(r,t),We.init(r,t),r.unwrap=()=>r._zod.def.innerType});function Eh(r){return new Sb({type:"nullable",innerType:r})}const Mb=st("ZodDefault",(r,t)=>{I_.init(r,t),We.init(r,t),r.unwrap=()=>r._zod.def.innerType,r.removeDefault=r.unwrap});function Cb(r,t){return new Mb({type:"default",innerType:r,get defaultValue(){return typeof t=="function"?t():wd(t)}})}const Ib=st("ZodPrefault",(r,t)=>{R_.init(r,t),We.init(r,t),r.unwrap=()=>r._zod.def.innerType});function Rb(r,t){return new Ib({type:"prefault",innerType:r,get defaultValue(){return typeof t=="function"?t():wd(t)}})}const Wd=st("ZodNonOptional",(r,t)=>{O_.init(r,t),We.init(r,t),r.unwrap=()=>r._zod.def.innerType});function Ob(r,t){return new Wd({type:"nonoptional",innerType:r,...Yt(t)})}const Nb=st("ZodCatch",(r,t)=>{N_.init(r,t),We.init(r,t),r.unwrap=()=>r._zod.def.innerType,r.removeCatch=r.unwrap});function Lb(r,t){return new Nb({type:"catch",innerType:r,catchValue:typeof t=="function"?t:()=>t})}const kb=st("ZodPipe",(r,t)=>{L_.init(r,t),We.init(r,t),r.in=t.in,r.out=t.out});function Ah(r,t){return new kb({type:"pipe",in:r,out:t})}const Db=st("ZodReadonly",(r,t)=>{k_.init(r,t),We.init(r,t),r.unwrap=()=>r._zod.def.innerType});function Fb(r){return new Db({type:"readonly",innerType:r})}const Pb=st("ZodCustom",(r,t)=>{D_.init(r,t),We.init(r,t)});function zb(r,t={}){return wx(Pb,r,t)}function Bb(r){return Sx(r)}const Ub=Nc({energy:dr().min(0).max(1),valence:dr().min(0).max(1),tempo:dr().positive(),loudness:dr(),danceability:dr().min(0).max(1),speechiness:dr().min(0).max(1),acousticness:dr().min(0).max(1),instrumentalness:dr().min(0).max(1),liveness:dr().min(0).max(1)}),Gb=Nc({id:gh().uuid(),name:gh().min(1),duration:dr().positive(),audioFeatures:Ub,generatedPath:$d(Nc({x:dr(),y:dr(),z:dr(),timestamp:dr().nonnegative()}))}),jb=()=>{const r=me(o=>o.status),t=me(o=>o.trackData),e=me(o=>o.generationProgress),n=me(o=>o.audioFile),i=Rt.useMemo(()=>({status:r,trackData:t,generationProgress:e,audioFile:n}),[r,t,e,n]),s=Rt.useRef(!1),a=Rt.useMemo(()=>{let o=null;if(s.current=!1,i.trackData)try{Array.isArray(i.trackData.path)&&Array.isArray(i.trackData.upVectors)?o=i.trackData:o=Gb.parse(i.trackData)}catch(c){console.error("Track data validation failed:",c),s.current=!0}return{...i,trackData:o,audioFeatures:o==null?void 0:o.audioFeatures}},[i]);return Rt.useEffect(()=>{s.current&&(s.current=!1,me.getState().actions.setError({title:"Validation Error",message:"Invalid track data received from the server."}))},[a.trackData]),a};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Th;(function(r){r.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",r.OUTCOME_OK="OUTCOME_OK",r.OUTCOME_FAILED="OUTCOME_FAILED",r.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Th||(Th={}));var wh;(function(r){r.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",r.PYTHON="PYTHON"})(wh||(wh={}));var Sh;(function(r){r.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",r.STRING="STRING",r.NUMBER="NUMBER",r.INTEGER="INTEGER",r.BOOLEAN="BOOLEAN",r.ARRAY="ARRAY",r.OBJECT="OBJECT",r.NULL="NULL"})(Sh||(Sh={}));var Pi;(function(r){r.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",r.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",r.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",r.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",r.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(Pi||(Pi={}));var Mh;(function(r){r.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",r.SEVERITY="SEVERITY",r.PROBABILITY="PROBABILITY"})(Mh||(Mh={}));var zi;(function(r){r.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE",r.OFF="OFF"})(zi||(zi={}));var Ch;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.MODE_DYNAMIC="MODE_DYNAMIC"})(Ch||(Ch={}));var Ih;(function(r){r.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",r.NO_AUTH="NO_AUTH",r.API_KEY_AUTH="API_KEY_AUTH",r.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",r.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",r.OAUTH="OAUTH",r.OIDC_AUTH="OIDC_AUTH"})(Ih||(Ih={}));var Rh;(function(r){r.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",r.SIMPLE_SEARCH="SIMPLE_SEARCH",r.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Rh||(Rh={}));var Oh;(function(r){r.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",r.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",r.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",r.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",r.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Oh||(Oh={}));var Nh;(function(r){r.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.LANGUAGE="LANGUAGE",r.OTHER="OTHER",r.BLOCKLIST="BLOCKLIST",r.PROHIBITED_CONTENT="PROHIBITED_CONTENT",r.SPII="SPII",r.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",r.IMAGE_SAFETY="IMAGE_SAFETY",r.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(Nh||(Nh={}));var Lh;(function(r){r.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(Lh||(Lh={}));var kh;(function(r){r.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",r.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",r.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",r.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",r.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(kh||(kh={}));var Dh;(function(r){r.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER",r.BLOCKLIST="BLOCKLIST",r.PROHIBITED_CONTENT="PROHIBITED_CONTENT",r.IMAGE_SAFETY="IMAGE_SAFETY"})(Dh||(Dh={}));var Fh;(function(r){r.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",r.ON_DEMAND="ON_DEMAND",r.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Fh||(Fh={}));var Ph;(function(r){r.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",r.TEXT="TEXT",r.IMAGE="IMAGE",r.AUDIO="AUDIO"})(Ph||(Ph={}));var zh;(function(r){r.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",r.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",r.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",r.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(zh||(zh={}));var Bh;(function(r){r.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",r.JOB_STATE_QUEUED="JOB_STATE_QUEUED",r.JOB_STATE_PENDING="JOB_STATE_PENDING",r.JOB_STATE_RUNNING="JOB_STATE_RUNNING",r.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",r.JOB_STATE_FAILED="JOB_STATE_FAILED",r.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",r.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",r.JOB_STATE_PAUSED="JOB_STATE_PAUSED",r.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",r.JOB_STATE_UPDATING="JOB_STATE_UPDATING",r.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Bh||(Bh={}));var Uh;(function(r){r.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",r.TUNING_MODE_FULL="TUNING_MODE_FULL",r.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Uh||(Uh={}));var Gh;(function(r){r.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",r.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",r.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",r.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",r.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",r.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",r.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Gh||(Gh={}));var jh;(function(r){r.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",r.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",r.BALANCED="BALANCED",r.PRIORITIZE_COST="PRIORITIZE_COST"})(jh||(jh={}));var Vh;(function(r){r.UNSPECIFIED="UNSPECIFIED",r.BLOCKING="BLOCKING",r.NON_BLOCKING="NON_BLOCKING"})(Vh||(Vh={}));var $h;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.MODE_DYNAMIC="MODE_DYNAMIC"})($h||($h={}));var Zh;(function(r){r.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",r.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Zh||(Zh={}));var Wh;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.AUTO="AUTO",r.ANY="ANY",r.NONE="NONE",r.VALIDATED="VALIDATED"})(Wh||(Wh={}));var Hh;(function(r){r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(Hh||(Hh={}));var Yh;(function(r){r.DONT_ALLOW="DONT_ALLOW",r.ALLOW_ADULT="ALLOW_ADULT",r.ALLOW_ALL="ALLOW_ALL"})(Yh||(Yh={}));var Xh;(function(r){r.auto="auto",r.en="en",r.ja="ja",r.ko="ko",r.hi="hi",r.zh="zh",r.pt="pt",r.es="es"})(Xh||(Xh={}));var Jh;(function(r){r.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",r.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",r.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",r.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",r.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Jh||(Jh={}));var qh;(function(r){r.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",r.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",r.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",r.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(qh||(qh={}));var Kh;(function(r){r.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",r.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",r.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",r.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Kh||(Kh={}));var Qh;(function(r){r.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",r.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",r.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",r.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",r.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",r.EDIT_MODE_STYLE="EDIT_MODE_STYLE",r.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",r.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Qh||(Qh={}));var tf;(function(r){r.FOREGROUND="FOREGROUND",r.BACKGROUND="BACKGROUND",r.PROMPT="PROMPT",r.SEMANTIC="SEMANTIC",r.INTERACTIVE="INTERACTIVE"})(tf||(tf={}));var ef;(function(r){r.ASSET="ASSET",r.STYLE="STYLE"})(ef||(ef={}));var rf;(function(r){r.OPTIMIZED="OPTIMIZED",r.LOSSLESS="LOSSLESS"})(rf||(rf={}));var nf;(function(r){r.STATE_UNSPECIFIED="STATE_UNSPECIFIED",r.PROCESSING="PROCESSING",r.ACTIVE="ACTIVE",r.FAILED="FAILED"})(nf||(nf={}));var sf;(function(r){r.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",r.UPLOADED="UPLOADED",r.GENERATED="GENERATED"})(sf||(sf={}));var af;(function(r){r.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",r.TEXT="TEXT",r.IMAGE="IMAGE",r.VIDEO="VIDEO",r.AUDIO="AUDIO",r.DOCUMENT="DOCUMENT"})(af||(af={}));var of;(function(r){r.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",r.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",r.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(of||(of={}));var cf;(function(r){r.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",r.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",r.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(cf||(cf={}));var lf;(function(r){r.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",r.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",r.NO_INTERRUPTION="NO_INTERRUPTION"})(lf||(lf={}));var uf;(function(r){r.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",r.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",r.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(uf||(uf={}));var hf;(function(r){r.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",r.SILENT="SILENT",r.WHEN_IDLE="WHEN_IDLE",r.INTERRUPT="INTERRUPT"})(hf||(hf={}));var ff;(function(r){r.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",r.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",r.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",r.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",r.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",r.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",r.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",r.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",r.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",r.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",r.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",r.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",r.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(ff||(ff={}));var df;(function(r){r.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",r.QUALITY="QUALITY",r.DIVERSITY="DIVERSITY",r.VOCALIZATION="VOCALIZATION"})(df||(df={}));var pf;(function(r){r.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",r.PLAY="PLAY",r.PAUSE="PAUSE",r.STOP="STOP",r.RESET_CONTEXT="RESET_CONTEXT"})(pf||(pf={}));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var mf;(function(r){r.PAGED_ITEM_BATCH_JOBS="batchJobs",r.PAGED_ITEM_MODELS="models",r.PAGED_ITEM_TUNING_JOBS="tuningJobs",r.PAGED_ITEM_FILES="files",r.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(mf||(mf={}));function Vb(){const r="AIzaSyC0W595gQfd_V-pDmy2e2wRqoGOFJbhYKI";if(r.trim()==="")throw new Error("VITE_GEMINI_API_KEY is not configured in the .env file.");return r}const za=Object.freeze({get apiKey(){return Vb()},gemini:{modelName:"gemini-2.5-pro",generationConfig:{temperature:.9,topK:1,topP:1,maxOutputTokens:2048},safetySettings:[{category:Pi.HARM_CATEGORY_HARASSMENT,threshold:zi.BLOCK_MEDIUM_AND_ABOVE},{category:Pi.HARM_CATEGORY_HATE_SPEECH,threshold:zi.BLOCK_MEDIUM_AND_ABOVE},{category:Pi.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:zi.BLOCK_MEDIUM_AND_ABOVE},{category:Pi.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:zi.BLOCK_MEDIUM_AND_ABOVE}]},api:{baseUrl:"/api",endpoints:{processAudio:"/generate-blueprint",generateSkybox:"/generate-skybox"}}}),$b=async(r,t,e)=>{const n=`${za.api.baseUrl}${za.api.endpoints.processAudio}`,i=new FormData;if(i.append("audio_file",r),e&&typeof e=="object")try{i.append("options",JSON.stringify(e))}catch{}try{console.debug("[GeminiService] Posting audio to backend",{url:n,fileName:r.name,fileSize:r.size});const s=await fetch(n,{method:"POST",body:i,signal:t});if(!s.ok){let o="Unknown server error";try{const c=await s.json();o=c.detail||c.error||JSON.stringify(c)}catch{}throw new Error(`Backend error: ${s.status} ${s.statusText} - ${o}`)}const a=await s.json();if(!a||!a.blueprint)throw new Error("Backend returned invalid payload");return{blueprint:a.blueprint,features:a.features}}catch(s){console.error("[GeminiService] generateRideBlueprint failed:",s);const a=s instanceof Error?s.message:String(s);throw a.includes("Failed to fetch")||a.includes("NetworkError")||a.includes("TypeError")?new Error(`Failed to contact backend at ${n}. This may indicate the backend is not running, CORS is blocking the request, or a network problem. Original error: ${a}`):s}},Zb=async(r,t)=>{try{const e=`${za.api.baseUrl}${za.api.endpoints.generateSkybox}`,n=t&&t.generationOptions?t.generationOptions:null,i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:r,blueprint:t,options:n})});if(!i.ok){const a=await i.json();throw i.status===501?(console.info("[GeminiService] Skybox generation not supported:",a.detail),new Error("Skybox generation not supported by Gemini API")):new Error(a.detail||"Failed to generate skybox image")}return(await i.json()).imageUrl}catch(e){console.warn("[GeminiService] Skybox generation failed, continuing without custom skybox:",e);const n=e instanceof Error?e.message:String(e);throw new Error(`Skybox generation unavailable: ${n}`)}},kc=r=>{const t=r.component??r.type;return typeof t=="string"?t:void 0},yf=r=>{switch((kc(r)||"").toLowerCase()){case"drop":case"loop":case"barrelRoll":return!0;case"turn":{const e=r;return e.radius!==void 0&&e.radius<100}default:return!1}},Wb=()=>({component:"climb",angle:0,length:30,intensity:10,lightingEffect:"none",environmentChange:"none",audioSyncPoint:ka(0)}),Hb=r=>{var n;console.log("Starting blueprint validation and refinement..."),console.log("[Validator] Blueprint structure:",{hasTrack:!!r.track,trackType:typeof r.track,trackLength:(n=r.track)==null?void 0:n.length,rideName:r.rideName,blueprintKeys:Object.keys(r)});const t=r.track;if(!t||!Array.isArray(t))throw console.error("[Validator] Invalid blueprint.track:",t),new Error("Blueprint is missing a valid track array");if((!r.rideName||typeof r.rideName!="string")&&(r.rideName="Audio Coaster"),(!r.moodDescription||typeof r.moodDescription!="string")&&(r.moodDescription="An immersive audio-driven experience"),(!r.palette||!Array.isArray(r.palette)||r.palette.length<3)&&(r.palette=["#ffffff","#00ffff","#0d0a1f"]),t.length<2)return r;const e=[t[0]];for(let i=1;i<t.length;i++){const s=t[i-1],a=t[i];yf(s)&&yf(a)&&(console.log(`[Validator] Intense transition found between segment ${i-1} (${kc(s)}) and ${i} (${kc(a)}). Inserting easing segment.`),e.push(Wb())),e.push(a)}return console.log(`Blueprint refined. Original segments: ${t.length}, Refined segments: ${e.length}`),{...r,track:e}};/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Hd="180",M1=0,C1=1,I1=2,R1=1,O1=2,N1=3,Dc=0,Yd=1,L1=2,Yb=0,gf=1,k1=2,D1=3,F1=4,P1=5,_f=100,z1=101,B1=102,U1=103,G1=104,j1=200,V1=201,$1=202,Z1=203,xf=204,bf=205,W1=206,H1=207,Y1=208,X1=209,J1=210,q1=211,K1=212,Q1=213,tT=214,eT=0,rT=1,nT=2,vf=3,iT=4,sT=5,aT=6,oT=7,Xb=0,cT=1,lT=2,uT=0,hT=1,fT=2,dT=3,pT=4,mT=5,yT=6,gT=7,Xd=300,Jb=301,_T=302,xT=303,bT=304,vT=306,Ef=1e3,Bi=1001,Af=1002,En=1003,ET=1004,AT=1005,Ba=1006,TT=1007,Jd=1008,$c=1009,qb=1010,Kb=1011,Qb=1012,tv=1013,qd=1014,Zc=1015,ev=1016,rv=1017,nv=1018,wT=1020,iv=35902,sv=35899,av=1021,ov=1022,Kd=1023,Tf=1026,cv=1027,Qd=1028,lv=1029,uv=1030,hv=1031,fv=1033,dv=33776,pv=33777,mv=33778,yv=33779,gv=35840,_v=35841,xv=35842,bv=35843,vv=36196,Ev=37492,Av=37496,Tv=37808,wv=37809,Sv=37810,Mv=37811,Cv=37812,Iv=37813,Rv=37814,Ov=37815,Nv=37816,Lv=37817,kv=37818,Dv=37819,Fv=37820,Pv=37821,zv=36492,Bv=36494,Uv=36495,Gv=36283,jv=36284,Vv=36285,$v=36286,Zv=3200,ST=3201,tp=0,MT=1,ep="",Lr="srgb",wf="srgb-linear",Sf="linear",Jo="srgb",pi=7680,Mf=519,CT=512,IT=513,RT=514,OT=515,NT=516,LT=517,kT=518,DT=519,Cf=35044,FT=35048,PT="300 es",bn=2e3,Ua=2001;class Ts{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return n===void 0?!1:n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){const n=this._listeners;if(n===void 0)return;const i=n[t];if(i!==void 0){const s=i.indexOf(e);s!==-1&&i.splice(s,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const n=e[t.type];if(n!==void 0){t.target=this;const i=n.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,t);t.target=null}}}const ar=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let If=1234567;const gs=Math.PI/180,Ga=180/Math.PI;function Vi(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ar[r&255]+ar[r>>8&255]+ar[r>>16&255]+ar[r>>24&255]+"-"+ar[t&255]+ar[t>>8&255]+"-"+ar[t>>16&15|64]+ar[t>>24&255]+"-"+ar[e&63|128]+ar[e>>8&255]+"-"+ar[e>>16&255]+ar[e>>24&255]+ar[n&255]+ar[n>>8&255]+ar[n>>16&255]+ar[n>>24&255]).toLowerCase()}function re(r,t,e){return Math.max(t,Math.min(e,r))}function Wc(r,t){return(r%t+t)%t}function Wv(r,t,e,n,i){return n+(r-t)*(i-n)/(e-t)}function Hv(r,t,e){return r!==t?(e-r)/(t-r):0}function _s(r,t,e){return(1-e)*r+e*t}function Yv(r,t,e,n){return _s(r,t,1-Math.exp(-e*n))}function Xv(r,t=1){return t-Math.abs(Wc(r,t*2)-t)}function Jv(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function qv(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function Kv(r,t){return r+Math.floor(Math.random()*(t-r+1))}function Qv(r,t){return r+Math.random()*(t-r)}function tE(r){return r*(.5-Math.random())}function eE(r){r!==void 0&&(If=r);let t=If+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function rE(r){return r*gs}function nE(r){return r*Ga}function iE(r){return(r&r-1)===0&&r!==0}function sE(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function aE(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function oE(r,t,e,n,i){const s=Math.cos,a=Math.sin,o=s(e/2),c=a(e/2),l=s((t+n)/2),h=a((t+n)/2),f=s((t-n)/2),d=a((t-n)/2),m=s((n-t)/2),b=a((n-t)/2);switch(i){case"XYX":r.set(o*h,c*f,c*d,o*l);break;case"YZY":r.set(c*d,o*h,c*f,o*l);break;case"ZXZ":r.set(c*f,c*d,o*h,o*l);break;case"XZX":r.set(o*h,c*b,c*m,o*l);break;case"YXY":r.set(c*m,o*h,c*b,o*l);break;case"ZYZ":r.set(c*b,c*m,o*h,o*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Di(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function lr(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const pe={DEG2RAD:gs,RAD2DEG:Ga,generateUUID:Vi,clamp:re,euclideanModulo:Wc,mapLinear:Wv,inverseLerp:Hv,lerp:_s,damp:Yv,pingpong:Xv,smoothstep:Jv,smootherstep:qv,randInt:Kv,randFloat:Qv,randFloatSpread:tE,seededRandom:eE,degToRad:rE,radToDeg:nE,isPowerOfTwo:iE,ceilPowerOfTwo:sE,floorPowerOfTwo:aE,setQuaternionFromProperEuler:oE,normalize:lr,denormalize:Di};class ce{constructor(t=0,e=0){ce.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=re(this.x,t.x,e.x),this.y=re(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=re(this.x,t,e),this.y=re(this.y,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(re(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(re(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),s=this.x-t.x,a=this.y-t.y;return this.x=s*n-a*i+t.x,this.y=s*i+a*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ws{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,s,a,o){let c=n[i+0],l=n[i+1],h=n[i+2],f=n[i+3];const d=s[a+0],m=s[a+1],b=s[a+2],I=s[a+3];if(o===0){t[e+0]=c,t[e+1]=l,t[e+2]=h,t[e+3]=f;return}if(o===1){t[e+0]=d,t[e+1]=m,t[e+2]=b,t[e+3]=I;return}if(f!==I||c!==d||l!==m||h!==b){let B=1-o;const O=c*d+l*m+h*b+f*I,ut=O>=0?1:-1,X=1-O*O;if(X>Number.EPSILON){const q=Math.sqrt(X),At=Math.atan2(q,O*ut);B=Math.sin(B*At)/q,o=Math.sin(o*At)/q}const et=o*ut;if(c=c*B+d*et,l=l*B+m*et,h=h*B+b*et,f=f*B+I*et,B===1-o){const q=1/Math.sqrt(c*c+l*l+h*h+f*f);c*=q,l*=q,h*=q,f*=q}}t[e]=c,t[e+1]=l,t[e+2]=h,t[e+3]=f}static multiplyQuaternionsFlat(t,e,n,i,s,a){const o=n[i],c=n[i+1],l=n[i+2],h=n[i+3],f=s[a],d=s[a+1],m=s[a+2],b=s[a+3];return t[e]=o*b+h*f+c*m-l*d,t[e+1]=c*b+h*d+l*f-o*m,t[e+2]=l*b+h*m+o*d-c*f,t[e+3]=h*b-o*f-c*d-l*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,i=t._y,s=t._z,a=t._order,o=Math.cos,c=Math.sin,l=o(n/2),h=o(i/2),f=o(s/2),d=c(n/2),m=c(i/2),b=c(s/2);switch(a){case"XYZ":this._x=d*h*f+l*m*b,this._y=l*m*f-d*h*b,this._z=l*h*b+d*m*f,this._w=l*h*f-d*m*b;break;case"YXZ":this._x=d*h*f+l*m*b,this._y=l*m*f-d*h*b,this._z=l*h*b-d*m*f,this._w=l*h*f+d*m*b;break;case"ZXY":this._x=d*h*f-l*m*b,this._y=l*m*f+d*h*b,this._z=l*h*b+d*m*f,this._w=l*h*f-d*m*b;break;case"ZYX":this._x=d*h*f-l*m*b,this._y=l*m*f+d*h*b,this._z=l*h*b-d*m*f,this._w=l*h*f+d*m*b;break;case"YZX":this._x=d*h*f+l*m*b,this._y=l*m*f+d*h*b,this._z=l*h*b-d*m*f,this._w=l*h*f-d*m*b;break;case"XZY":this._x=d*h*f-l*m*b,this._y=l*m*f-d*h*b,this._z=l*h*b+d*m*f,this._w=l*h*f+d*m*b;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],s=e[8],a=e[1],o=e[5],c=e[9],l=e[2],h=e[6],f=e[10],d=n+o+f;if(d>0){const m=.5/Math.sqrt(d+1);this._w=.25/m,this._x=(h-c)*m,this._y=(s-l)*m,this._z=(a-i)*m}else if(n>o&&n>f){const m=2*Math.sqrt(1+n-o-f);this._w=(h-c)/m,this._x=.25*m,this._y=(i+a)/m,this._z=(s+l)/m}else if(o>f){const m=2*Math.sqrt(1+o-n-f);this._w=(s-l)/m,this._x=(i+a)/m,this._y=.25*m,this._z=(c+h)/m}else{const m=2*Math.sqrt(1+f-n-o);this._w=(a-i)/m,this._x=(s+l)/m,this._y=(c+h)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-8?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(re(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,s=t._z,a=t._w,o=e._x,c=e._y,l=e._z,h=e._w;return this._x=n*h+a*o+i*l-s*c,this._y=i*h+a*c+s*o-n*l,this._z=s*h+a*l+n*c-i*o,this._w=a*h-n*o-i*c-s*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,i=this._y,s=this._z,a=this._w;let o=a*t._w+n*t._x+i*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=n,this._y=i,this._z=s,this;const c=1-o*o;if(c<=Number.EPSILON){const m=1-e;return this._w=m*a+e*this._w,this._x=m*n+e*this._x,this._y=m*i+e*this._y,this._z=m*s+e*this._z,this.normalize(),this}const l=Math.sqrt(c),h=Math.atan2(l,o),f=Math.sin((1-e)*h)/l,d=Math.sin(e*h)/l;return this._w=a*f+this._w*d,this._x=n*f+this._x*d,this._y=i*f+this._y*d,this._z=s*f+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),s*Math.sin(e),s*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class k{constructor(t=0,e=0,n=0){k.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Rf.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Rf.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6]*i,this.y=s[1]*e+s[4]*n+s[7]*i,this.z=s[2]*e+s[5]*n+s[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,s=t.elements,a=1/(s[3]*e+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*e+s[4]*n+s[8]*i+s[12])*a,this.y=(s[1]*e+s[5]*n+s[9]*i+s[13])*a,this.z=(s[2]*e+s[6]*n+s[10]*i+s[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,s=t.x,a=t.y,o=t.z,c=t.w,l=2*(a*i-o*n),h=2*(o*e-s*i),f=2*(s*n-a*e);return this.x=e+c*l+a*f-o*h,this.y=n+c*h+o*l-s*f,this.z=i+c*f+s*h-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i,this.y=s[1]*e+s[5]*n+s[9]*i,this.z=s[2]*e+s[6]*n+s[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=re(this.x,t.x,e.x),this.y=re(this.y,t.y,e.y),this.z=re(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=re(this.x,t,e),this.y=re(this.y,t,e),this.z=re(this.z,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(re(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,s=t.z,a=e.x,o=e.y,c=e.z;return this.x=i*c-s*o,this.y=s*a-n*c,this.z=n*o-i*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return qo.copy(this).projectOnVector(t),this.sub(qo)}reflect(t){return this.sub(qo.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(re(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const qo=new k,Rf=new ws;class rn{constructor(t,e,n,i,s,a,o,c,l){rn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,i,s,a,o,c,l)}set(t,e,n,i,s,a,o,c,l){const h=this.elements;return h[0]=t,h[1]=i,h[2]=o,h[3]=e,h[4]=s,h[5]=c,h[6]=n,h[7]=a,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,s=this.elements,a=n[0],o=n[3],c=n[6],l=n[1],h=n[4],f=n[7],d=n[2],m=n[5],b=n[8],I=i[0],B=i[3],O=i[6],ut=i[1],X=i[4],et=i[7],q=i[2],At=i[5],Ot=i[8];return s[0]=a*I+o*ut+c*q,s[3]=a*B+o*X+c*At,s[6]=a*O+o*et+c*Ot,s[1]=l*I+h*ut+f*q,s[4]=l*B+h*X+f*At,s[7]=l*O+h*et+f*Ot,s[2]=d*I+m*ut+b*q,s[5]=d*B+m*X+b*At,s[8]=d*O+m*et+b*Ot,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],c=t[6],l=t[7],h=t[8];return e*a*h-e*o*l-n*s*h+n*o*c+i*s*l-i*a*c}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],c=t[6],l=t[7],h=t[8],f=h*a-o*l,d=o*c-h*s,m=l*s-a*c,b=e*f+n*d+i*m;if(b===0)return this.set(0,0,0,0,0,0,0,0,0);const I=1/b;return t[0]=f*I,t[1]=(i*l-h*n)*I,t[2]=(o*n-i*a)*I,t[3]=d*I,t[4]=(h*e-i*c)*I,t[5]=(i*s-o*e)*I,t[6]=m*I,t[7]=(n*c-l*e)*I,t[8]=(a*e-n*s)*I,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,s,a,o){const c=Math.cos(s),l=Math.sin(s);return this.set(n*c,n*l,-n*(c*a+l*o)+a+t,-i*l,i*c,-i*(-l*a+c*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Ko.makeScale(t,e)),this}rotate(t){return this.premultiply(Ko.makeRotation(-t)),this}translate(t,e){return this.premultiply(Ko.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ko=new rn;function cE(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function ja(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function zT(){const r=ja("canvas");return r.style.display="block",r}const Of={};function Nf(r){r in Of||(Of[r]=!0,console.warn(r))}function BT(r,t,e){return new Promise(function(n,i){function s(){switch(r.clientWaitSync(t,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:i();break;case r.TIMEOUT_EXPIRED:setTimeout(s,e);break;default:n()}}setTimeout(s,e)})}const Lf=new rn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),kf=new rn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function lE(){const r={enabled:!0,workingColorSpace:wf,spaces:{},convert:function(i,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Jo&&(i.r=en(i.r),i.g=en(i.g),i.b=en(i.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Jo&&(i.r=ji(i.r),i.g=ji(i.g),i.b=ji(i.b))),i},workingToColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},colorSpaceToWorking:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===ep?Sf:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,a){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,s){return Nf("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(i,s)},toWorkingColorSpace:function(i,s){return Nf("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(i,s)}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],n=[.3127,.329];return r.define({[wf]:{primaries:t,whitePoint:n,transfer:Sf,toXYZ:Lf,fromXYZ:kf,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:Lr},outputColorSpaceConfig:{drawingBufferColorSpace:Lr}},[Lr]:{primaries:t,whitePoint:n,transfer:Jo,toXYZ:Lf,fromXYZ:kf,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:Lr}}}),r}const Ar=lE();function en(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function ji(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let mi;class uE{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let n;if(t instanceof HTMLCanvasElement)n=t;else{mi===void 0&&(mi=ja("canvas")),mi.width=t.width,mi.height=t.height;const i=mi.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),n=mi}return n.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=ja("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),s=i.data;for(let a=0;a<s.length;a++)s[a]=en(s[a]/255)*255;return n.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(en(e[n]/255)*255):e[n]=en(e[n]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let hE=0;class Hc{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:hE++}),this.uuid=Vi(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):e!==null?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?s.push(Qo(i[a].image)):s.push(Qo(i[a]))}else s=Qo(i);n.url=s}return e||(t.images[this.uuid]=n),n}}function Qo(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?uE.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let fE=0;const tc=new k;class ur extends Ts{constructor(t=ur.DEFAULT_IMAGE,e=ur.DEFAULT_MAPPING,n=Bi,i=Bi,s=Ba,a=Jd,o=Kd,c=$c,l=ur.DEFAULT_ANISOTROPY,h=ep){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:fE++}),this.uuid=Vi(),this.name="",this.source=new Hc(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=c,this.offset=new ce(0,0),this.repeat=new ce(1,1),this.center=new ce(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(tc).x}get height(){return this.source.getSize(tc).y}get depth(){return this.source.getSize(tc).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const n=t[e];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${e}' does not exist.`);continue}i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Xd)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ef:t.x=t.x-Math.floor(t.x);break;case Bi:t.x=t.x<0?0:1;break;case Af:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Ef:t.y=t.y-Math.floor(t.y);break;case Bi:t.y=t.y<0?0:1;break;case Af:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}ur.DEFAULT_IMAGE=null;ur.DEFAULT_MAPPING=Xd;ur.DEFAULT_ANISOTROPY=1;class An{constructor(t=0,e=0,n=0,i=1){An.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,s=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*i+a[12]*s,this.y=a[1]*e+a[5]*n+a[9]*i+a[13]*s,this.z=a[2]*e+a[6]*n+a[10]*i+a[14]*s,this.w=a[3]*e+a[7]*n+a[11]*i+a[15]*s,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,s;const c=t.elements,l=c[0],h=c[4],f=c[8],d=c[1],m=c[5],b=c[9],I=c[2],B=c[6],O=c[10];if(Math.abs(h-d)<.01&&Math.abs(f-I)<.01&&Math.abs(b-B)<.01){if(Math.abs(h+d)<.1&&Math.abs(f+I)<.1&&Math.abs(b+B)<.1&&Math.abs(l+m+O-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const X=(l+1)/2,et=(m+1)/2,q=(O+1)/2,At=(h+d)/4,Ot=(f+I)/4,wt=(b+B)/4;return X>et&&X>q?X<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(X),i=At/n,s=Ot/n):et>q?et<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(et),n=At/i,s=wt/i):q<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(q),n=Ot/s,i=wt/s),this.set(n,i,s,e),this}let ut=Math.sqrt((B-b)*(B-b)+(f-I)*(f-I)+(d-h)*(d-h));return Math.abs(ut)<.001&&(ut=1),this.x=(B-b)/ut,this.y=(f-I)/ut,this.z=(d-h)/ut,this.w=Math.acos((l+m+O-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=re(this.x,t.x,e.x),this.y=re(this.y,t.y,e.y),this.z=re(this.z,t.z,e.z),this.w=re(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=re(this.x,t,e),this.y=re(this.y,t,e),this.z=re(this.z,t,e),this.w=re(this.w,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(re(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class dE extends Ts{constructor(t=1,e=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ba,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=n.depth,this.scissor=new An(0,0,t,e),this.scissorTest=!1,this.viewport=new An(0,0,t,e);const i={width:t,height:e,depth:n.depth},s=new ur(i);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(t={}){const e={minFilter:Ba,generateMipmaps:!1,flipY:!1,internalFormat:null};t.mapping!==void 0&&(e.mapping=t.mapping),t.wrapS!==void 0&&(e.wrapS=t.wrapS),t.wrapT!==void 0&&(e.wrapT=t.wrapT),t.wrapR!==void 0&&(e.wrapR=t.wrapR),t.magFilter!==void 0&&(e.magFilter=t.magFilter),t.minFilter!==void 0&&(e.minFilter=t.minFilter),t.format!==void 0&&(e.format=t.format),t.type!==void 0&&(e.type=t.type),t.anisotropy!==void 0&&(e.anisotropy=t.anisotropy),t.colorSpace!==void 0&&(e.colorSpace=t.colorSpace),t.flipY!==void 0&&(e.flipY=t.flipY),t.generateMipmaps!==void 0&&(e.generateMipmaps=t.generateMipmaps),t.internalFormat!==void 0&&(e.internalFormat=t.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(e)}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=n,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const i=Object.assign({},t.textures[e].image);this.textures[e].source=new Hc(i)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class pE extends dE{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class UT extends ur{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=En,this.minFilter=En,this.wrapR=Bi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class GT extends ur{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=En,this.minFilter=En,this.wrapR=Bi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class qn{constructor(t=new k(1/0,1/0,1/0),e=new k(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Rr.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Rr.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Rr.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0){const s=n.getAttribute("position");if(e===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,Rr):Rr.fromBufferAttribute(s,a),Rr.applyMatrix4(t.matrixWorld),this.expandByPoint(Rr);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),aa.copy(t.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),aa.copy(n.boundingBox)),aa.applyMatrix4(t.matrixWorld),this.union(aa)}const i=t.children;for(let s=0,a=i.length;s<a;s++)this.expandByObject(i[s],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Rr),Rr.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ls),oa.subVectors(this.max,ls),yi.subVectors(t.a,ls),gi.subVectors(t.b,ls),_i.subVectors(t.c,ls),pn.subVectors(gi,yi),mn.subVectors(_i,gi),Bn.subVectors(yi,_i);let e=[0,-pn.z,pn.y,0,-mn.z,mn.y,0,-Bn.z,Bn.y,pn.z,0,-pn.x,mn.z,0,-mn.x,Bn.z,0,-Bn.x,-pn.y,pn.x,0,-mn.y,mn.x,0,-Bn.y,Bn.x,0];return!ec(e,yi,gi,_i,oa)||(e=[1,0,0,0,1,0,0,0,1],!ec(e,yi,gi,_i,oa))?!1:(ca.crossVectors(pn,mn),e=[ca.x,ca.y,ca.z],ec(e,yi,gi,_i,oa))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Rr).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Rr).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Jr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Jr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Jr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Jr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Jr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Jr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Jr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Jr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Jr),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const Jr=[new k,new k,new k,new k,new k,new k,new k,new k],Rr=new k,aa=new qn,yi=new k,gi=new k,_i=new k,pn=new k,mn=new k,Bn=new k,ls=new k,oa=new k,ca=new k,Un=new k;function ec(r,t,e,n,i){for(let s=0,a=r.length-3;s<=a;s+=3){Un.fromArray(r,s);const o=i.x*Math.abs(Un.x)+i.y*Math.abs(Un.y)+i.z*Math.abs(Un.z),c=t.dot(Un),l=e.dot(Un),h=n.dot(Un);if(Math.max(-Math.max(c,l,h),Math.min(c,l,h))>o)return!1}return!0}const mE=new qn,us=new k,rc=new k;class Kn{constructor(t=new k,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;e!==void 0?n.copy(e):mE.setFromPoints(t).getCenter(n);let i=0;for(let s=0,a=t.length;s<a;s++)i=Math.max(i,n.distanceToSquared(t[s]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;us.subVectors(t,this.center);const e=us.lengthSq();if(e>this.radius*this.radius){const n=Math.sqrt(e),i=(n-this.radius)*.5;this.center.addScaledVector(us,i/n),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(rc.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(us.copy(t.center).add(rc)),this.expandByPoint(us.copy(t.center).sub(rc))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const qr=new k,nc=new k,la=new k,yn=new k,ic=new k,ua=new k,sc=new k;class Yc{constructor(t=new k,e=new k(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,qr)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=qr.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(qr.copy(this.origin).addScaledVector(this.direction,e),qr.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){nc.copy(t).add(e).multiplyScalar(.5),la.copy(e).sub(t).normalize(),yn.copy(this.origin).sub(nc);const s=t.distanceTo(e)*.5,a=-this.direction.dot(la),o=yn.dot(this.direction),c=-yn.dot(la),l=yn.lengthSq(),h=Math.abs(1-a*a);let f,d,m,b;if(h>0)if(f=a*c-o,d=a*o-c,b=s*h,f>=0)if(d>=-b)if(d<=b){const I=1/h;f*=I,d*=I,m=f*(f+a*d+2*o)+d*(a*f+d+2*c)+l}else d=s,f=Math.max(0,-(a*d+o)),m=-f*f+d*(d+2*c)+l;else d=-s,f=Math.max(0,-(a*d+o)),m=-f*f+d*(d+2*c)+l;else d<=-b?(f=Math.max(0,-(-a*s+o)),d=f>0?-s:Math.min(Math.max(-s,-c),s),m=-f*f+d*(d+2*c)+l):d<=b?(f=0,d=Math.min(Math.max(-s,-c),s),m=d*(d+2*c)+l):(f=Math.max(0,-(a*s+o)),d=f>0?s:Math.min(Math.max(-s,-c),s),m=-f*f+d*(d+2*c)+l);else d=a>0?-s:s,f=Math.max(0,-(a*d+o)),m=-f*f+d*(d+2*c)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,f),i&&i.copy(nc).addScaledVector(la,d),m}intersectSphere(t,e){qr.subVectors(t.center,this.origin);const n=qr.dot(this.direction),i=qr.dot(qr)-n*n,s=t.radius*t.radius;if(i>s)return null;const a=Math.sqrt(s-i),o=n-a,c=n+a;return c<0?null:o<0?this.at(c,e):this.at(o,e)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,s,a,o,c;const l=1/this.direction.x,h=1/this.direction.y,f=1/this.direction.z,d=this.origin;return l>=0?(n=(t.min.x-d.x)*l,i=(t.max.x-d.x)*l):(n=(t.max.x-d.x)*l,i=(t.min.x-d.x)*l),h>=0?(s=(t.min.y-d.y)*h,a=(t.max.y-d.y)*h):(s=(t.max.y-d.y)*h,a=(t.min.y-d.y)*h),n>a||s>i||((s>n||isNaN(n))&&(n=s),(a<i||isNaN(i))&&(i=a),f>=0?(o=(t.min.z-d.z)*f,c=(t.max.z-d.z)*f):(o=(t.max.z-d.z)*f,c=(t.min.z-d.z)*f),n>c||o>i)||((o>n||n!==n)&&(n=o),(c<i||i!==i)&&(i=c),i<0)?null:this.at(n>=0?n:i,e)}intersectsBox(t){return this.intersectBox(t,qr)!==null}intersectTriangle(t,e,n,i,s){ic.subVectors(e,t),ua.subVectors(n,t),sc.crossVectors(ic,ua);let a=this.direction.dot(sc),o;if(a>0){if(i)return null;o=1}else if(a<0)o=-1,a=-a;else return null;yn.subVectors(this.origin,t);const c=o*this.direction.dot(ua.crossVectors(yn,ua));if(c<0)return null;const l=o*this.direction.dot(ic.cross(yn));if(l<0||c+l>a)return null;const h=-o*yn.dot(sc);return h<0?null:this.at(h/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class De{constructor(t,e,n,i,s,a,o,c,l,h,f,d,m,b,I,B){De.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,i,s,a,o,c,l,h,f,d,m,b,I,B)}set(t,e,n,i,s,a,o,c,l,h,f,d,m,b,I,B){const O=this.elements;return O[0]=t,O[4]=e,O[8]=n,O[12]=i,O[1]=s,O[5]=a,O[9]=o,O[13]=c,O[2]=l,O[6]=h,O[10]=f,O[14]=d,O[3]=m,O[7]=b,O[11]=I,O[15]=B,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new De().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/xi.setFromMatrixColumn(t,0).length(),s=1/xi.setFromMatrixColumn(t,1).length(),a=1/xi.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,s=t.z,a=Math.cos(n),o=Math.sin(n),c=Math.cos(i),l=Math.sin(i),h=Math.cos(s),f=Math.sin(s);if(t.order==="XYZ"){const d=a*h,m=a*f,b=o*h,I=o*f;e[0]=c*h,e[4]=-c*f,e[8]=l,e[1]=m+b*l,e[5]=d-I*l,e[9]=-o*c,e[2]=I-d*l,e[6]=b+m*l,e[10]=a*c}else if(t.order==="YXZ"){const d=c*h,m=c*f,b=l*h,I=l*f;e[0]=d+I*o,e[4]=b*o-m,e[8]=a*l,e[1]=a*f,e[5]=a*h,e[9]=-o,e[2]=m*o-b,e[6]=I+d*o,e[10]=a*c}else if(t.order==="ZXY"){const d=c*h,m=c*f,b=l*h,I=l*f;e[0]=d-I*o,e[4]=-a*f,e[8]=b+m*o,e[1]=m+b*o,e[5]=a*h,e[9]=I-d*o,e[2]=-a*l,e[6]=o,e[10]=a*c}else if(t.order==="ZYX"){const d=a*h,m=a*f,b=o*h,I=o*f;e[0]=c*h,e[4]=b*l-m,e[8]=d*l+I,e[1]=c*f,e[5]=I*l+d,e[9]=m*l-b,e[2]=-l,e[6]=o*c,e[10]=a*c}else if(t.order==="YZX"){const d=a*c,m=a*l,b=o*c,I=o*l;e[0]=c*h,e[4]=I-d*f,e[8]=b*f+m,e[1]=f,e[5]=a*h,e[9]=-o*h,e[2]=-l*h,e[6]=m*f+b,e[10]=d-I*f}else if(t.order==="XZY"){const d=a*c,m=a*l,b=o*c,I=o*l;e[0]=c*h,e[4]=-f,e[8]=l*h,e[1]=d*f+I,e[5]=a*h,e[9]=m*f-b,e[2]=b*f-m,e[6]=o*h,e[10]=I*f+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(yE,t,gE)}lookAt(t,e,n){const i=this.elements;return _r.subVectors(t,e),_r.lengthSq()===0&&(_r.z=1),_r.normalize(),gn.crossVectors(n,_r),gn.lengthSq()===0&&(Math.abs(n.z)===1?_r.x+=1e-4:_r.z+=1e-4,_r.normalize(),gn.crossVectors(n,_r)),gn.normalize(),ha.crossVectors(_r,gn),i[0]=gn.x,i[4]=ha.x,i[8]=_r.x,i[1]=gn.y,i[5]=ha.y,i[9]=_r.y,i[2]=gn.z,i[6]=ha.z,i[10]=_r.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,s=this.elements,a=n[0],o=n[4],c=n[8],l=n[12],h=n[1],f=n[5],d=n[9],m=n[13],b=n[2],I=n[6],B=n[10],O=n[14],ut=n[3],X=n[7],et=n[11],q=n[15],At=i[0],Ot=i[4],wt=i[8],Gt=i[12],Jt=i[1],ae=i[5],he=i[9],kt=i[13],Vt=i[2],ne=i[6],xe=i[10],fe=i[14],Te=i[3],le=i[7],Ft=i[11],qt=i[15];return s[0]=a*At+o*Jt+c*Vt+l*Te,s[4]=a*Ot+o*ae+c*ne+l*le,s[8]=a*wt+o*he+c*xe+l*Ft,s[12]=a*Gt+o*kt+c*fe+l*qt,s[1]=h*At+f*Jt+d*Vt+m*Te,s[5]=h*Ot+f*ae+d*ne+m*le,s[9]=h*wt+f*he+d*xe+m*Ft,s[13]=h*Gt+f*kt+d*fe+m*qt,s[2]=b*At+I*Jt+B*Vt+O*Te,s[6]=b*Ot+I*ae+B*ne+O*le,s[10]=b*wt+I*he+B*xe+O*Ft,s[14]=b*Gt+I*kt+B*fe+O*qt,s[3]=ut*At+X*Jt+et*Vt+q*Te,s[7]=ut*Ot+X*ae+et*ne+q*le,s[11]=ut*wt+X*he+et*xe+q*Ft,s[15]=ut*Gt+X*kt+et*fe+q*qt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],s=t[12],a=t[1],o=t[5],c=t[9],l=t[13],h=t[2],f=t[6],d=t[10],m=t[14],b=t[3],I=t[7],B=t[11],O=t[15];return b*(+s*c*f-i*l*f-s*o*d+n*l*d+i*o*m-n*c*m)+I*(+e*c*m-e*l*d+s*a*d-i*a*m+i*l*h-s*c*h)+B*(+e*l*f-e*o*m-s*a*f+n*a*m+s*o*h-n*l*h)+O*(-i*o*h-e*c*f+e*o*d+i*a*f-n*a*d+n*c*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],c=t[6],l=t[7],h=t[8],f=t[9],d=t[10],m=t[11],b=t[12],I=t[13],B=t[14],O=t[15],ut=f*B*l-I*d*l+I*c*m-o*B*m-f*c*O+o*d*O,X=b*d*l-h*B*l-b*c*m+a*B*m+h*c*O-a*d*O,et=h*I*l-b*f*l+b*o*m-a*I*m-h*o*O+a*f*O,q=b*f*c-h*I*c-b*o*d+a*I*d+h*o*B-a*f*B,At=e*ut+n*X+i*et+s*q;if(At===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ot=1/At;return t[0]=ut*Ot,t[1]=(I*d*s-f*B*s-I*i*m+n*B*m+f*i*O-n*d*O)*Ot,t[2]=(o*B*s-I*c*s+I*i*l-n*B*l-o*i*O+n*c*O)*Ot,t[3]=(f*c*s-o*d*s-f*i*l+n*d*l+o*i*m-n*c*m)*Ot,t[4]=X*Ot,t[5]=(h*B*s-b*d*s+b*i*m-e*B*m-h*i*O+e*d*O)*Ot,t[6]=(b*c*s-a*B*s-b*i*l+e*B*l+a*i*O-e*c*O)*Ot,t[7]=(a*d*s-h*c*s+h*i*l-e*d*l-a*i*m+e*c*m)*Ot,t[8]=et*Ot,t[9]=(b*f*s-h*I*s-b*n*m+e*I*m+h*n*O-e*f*O)*Ot,t[10]=(a*I*s-b*o*s+b*n*l-e*I*l-a*n*O+e*o*O)*Ot,t[11]=(h*o*s-a*f*s-h*n*l+e*f*l+a*n*m-e*o*m)*Ot,t[12]=q*Ot,t[13]=(h*I*i-b*f*i+b*n*d-e*I*d-h*n*B+e*f*B)*Ot,t[14]=(b*o*i-a*I*i-b*n*c+e*I*c+a*n*B-e*o*B)*Ot,t[15]=(a*f*i-h*o*i+h*n*c-e*f*c-a*n*d+e*o*d)*Ot,this}scale(t){const e=this.elements,n=t.x,i=t.y,s=t.z;return e[0]*=n,e[4]*=i,e[8]*=s,e[1]*=n,e[5]*=i,e[9]*=s,e[2]*=n,e[6]*=i,e[10]*=s,e[3]*=n,e[7]*=i,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),s=1-n,a=t.x,o=t.y,c=t.z,l=s*a,h=s*o;return this.set(l*a+n,l*o-i*c,l*c+i*o,0,l*o+i*c,h*o+n,h*c-i*a,0,l*c-i*o,h*c+i*a,s*c*c+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,s,a){return this.set(1,n,s,0,t,1,a,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,s=e._x,a=e._y,o=e._z,c=e._w,l=s+s,h=a+a,f=o+o,d=s*l,m=s*h,b=s*f,I=a*h,B=a*f,O=o*f,ut=c*l,X=c*h,et=c*f,q=n.x,At=n.y,Ot=n.z;return i[0]=(1-(I+O))*q,i[1]=(m+et)*q,i[2]=(b-X)*q,i[3]=0,i[4]=(m-et)*At,i[5]=(1-(d+O))*At,i[6]=(B+ut)*At,i[7]=0,i[8]=(b+X)*Ot,i[9]=(B-ut)*Ot,i[10]=(1-(d+I))*Ot,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let s=xi.set(i[0],i[1],i[2]).length();const a=xi.set(i[4],i[5],i[6]).length(),o=xi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),t.x=i[12],t.y=i[13],t.z=i[14],Or.copy(this);const l=1/s,h=1/a,f=1/o;return Or.elements[0]*=l,Or.elements[1]*=l,Or.elements[2]*=l,Or.elements[4]*=h,Or.elements[5]*=h,Or.elements[6]*=h,Or.elements[8]*=f,Or.elements[9]*=f,Or.elements[10]*=f,e.setFromRotationMatrix(Or),n.x=s,n.y=a,n.z=o,this}makePerspective(t,e,n,i,s,a,o=bn,c=!1){const l=this.elements,h=2*s/(e-t),f=2*s/(n-i),d=(e+t)/(e-t),m=(n+i)/(n-i);let b,I;if(c)b=s/(a-s),I=a*s/(a-s);else if(o===bn)b=-(a+s)/(a-s),I=-2*a*s/(a-s);else if(o===Ua)b=-a/(a-s),I=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=h,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=f,l[9]=m,l[13]=0,l[2]=0,l[6]=0,l[10]=b,l[14]=I,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,n,i,s,a,o=bn,c=!1){const l=this.elements,h=2/(e-t),f=2/(n-i),d=-(e+t)/(e-t),m=-(n+i)/(n-i);let b,I;if(c)b=1/(a-s),I=a/(a-s);else if(o===bn)b=-2/(a-s),I=-(a+s)/(a-s);else if(o===Ua)b=-1/(a-s),I=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=h,l[4]=0,l[8]=0,l[12]=d,l[1]=0,l[5]=f,l[9]=0,l[13]=m,l[2]=0,l[6]=0,l[10]=b,l[14]=I,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const xi=new k,Or=new De,yE=new k(0,0,0),gE=new k(1,1,1),gn=new k,ha=new k,_r=new k,Df=new De,Ff=new ws;class Tn{constructor(t=0,e=0,n=0,i=Tn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,s=i[0],a=i[4],o=i[8],c=i[1],l=i[5],h=i[9],f=i[2],d=i[6],m=i[10];switch(e){case"XYZ":this._y=Math.asin(re(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,m),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-re(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,m),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-f,s),this._z=0);break;case"ZXY":this._x=Math.asin(re(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-re(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,m),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(re(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(o,m));break;case"XZY":this._z=Math.asin(-re(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-h,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Df.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Df,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ff.setFromEuler(this),this.setFromQuaternion(Ff,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Tn.DEFAULT_ORDER="XYZ";class _E{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let xE=0;const Pf=new k,bi=new ws,Kr=new De,fa=new k,hs=new k,bE=new k,vE=new ws,zf=new k(1,0,0),Bf=new k(0,1,0),Uf=new k(0,0,1),Gf={type:"added"},EE={type:"removed"},vi={type:"childadded",child:null},ac={type:"childremoved",child:null};class tr extends Ts{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:xE++}),this.uuid=Vi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=tr.DEFAULT_UP.clone();const t=new k,e=new Tn,n=new ws,i=new k(1,1,1);function s(){n.setFromEuler(e,!1)}function a(){e.setFromQuaternion(n,void 0,!1)}e._onChange(s),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new De},normalMatrix:{value:new rn}}),this.matrix=new De,this.matrixWorld=new De,this.matrixAutoUpdate=tr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=tr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new _E,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return bi.setFromAxisAngle(t,e),this.quaternion.multiply(bi),this}rotateOnWorldAxis(t,e){return bi.setFromAxisAngle(t,e),this.quaternion.premultiply(bi),this}rotateX(t){return this.rotateOnAxis(zf,t)}rotateY(t){return this.rotateOnAxis(Bf,t)}rotateZ(t){return this.rotateOnAxis(Uf,t)}translateOnAxis(t,e){return Pf.copy(t).applyQuaternion(this.quaternion),this.position.add(Pf.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(zf,t)}translateY(t){return this.translateOnAxis(Bf,t)}translateZ(t){return this.translateOnAxis(Uf,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Kr.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?fa.copy(t):fa.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),hs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Kr.lookAt(hs,fa,this.up):Kr.lookAt(fa,hs,this.up),this.quaternion.setFromRotationMatrix(Kr),i&&(Kr.extractRotation(i.matrixWorld),bi.setFromRotationMatrix(Kr),this.quaternion.premultiply(bi.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Gf),vi.child=t,this.dispatchEvent(vi),vi.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(EE),ac.child=t,this.dispatchEvent(ac),ac.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Kr.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Kr.multiply(t.parent.matrixWorld)),t.applyMatrix4(Kr),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Gf),vi.child=t,this.dispatchEvent(vi),vi.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const a=this.children[n].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hs,t,bE),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hs,vE,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(t),i.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function s(o,c){return o[c.uuid]===void 0&&(o[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const c=o.shapes;if(Array.isArray(c))for(let l=0,h=c.length;l<h;l++){const f=c[l];s(t.shapes,f)}else s(t.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let c=0,l=this.material.length;c<l;c++)o.push(s(t.materials,this.material[c]));i.material=o}else i.material=s(t.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const c=this.animations[o];i.animations.push(s(t.animations,c))}}if(e){const o=a(t.geometries),c=a(t.materials),l=a(t.textures),h=a(t.images),f=a(t.shapes),d=a(t.skeletons),m=a(t.animations),b=a(t.nodes);o.length>0&&(n.geometries=o),c.length>0&&(n.materials=c),l.length>0&&(n.textures=l),h.length>0&&(n.images=h),f.length>0&&(n.shapes=f),d.length>0&&(n.skeletons=d),m.length>0&&(n.animations=m),b.length>0&&(n.nodes=b)}return n.object=i,n;function a(o){const c=[];for(const l in o){const h=o[l];delete h.metadata,c.push(h)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){const i=t.children[n];this.add(i.clone())}return this}}tr.DEFAULT_UP=new k(0,1,0);tr.DEFAULT_MATRIX_AUTO_UPDATE=!0;tr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Nr=new k,Qr=new k,oc=new k,tn=new k,Ei=new k,Ai=new k,jf=new k,cc=new k,lc=new k,uc=new k,hc=new An,fc=new An,dc=new An;class kr{constructor(t=new k,e=new k,n=new k){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Nr.subVectors(t,e),i.cross(Nr);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(t,e,n,i,s){Nr.subVectors(i,e),Qr.subVectors(n,e),oc.subVectors(t,e);const a=Nr.dot(Nr),o=Nr.dot(Qr),c=Nr.dot(oc),l=Qr.dot(Qr),h=Qr.dot(oc),f=a*l-o*o;if(f===0)return s.set(0,0,0),null;const d=1/f,m=(l*c-o*h)*d,b=(a*h-o*c)*d;return s.set(1-m-b,b,m)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,tn)===null?!1:tn.x>=0&&tn.y>=0&&tn.x+tn.y<=1}static getInterpolation(t,e,n,i,s,a,o,c){return this.getBarycoord(t,e,n,i,tn)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,tn.x),c.addScaledVector(a,tn.y),c.addScaledVector(o,tn.z),c)}static getInterpolatedAttribute(t,e,n,i,s,a){return hc.setScalar(0),fc.setScalar(0),dc.setScalar(0),hc.fromBufferAttribute(t,e),fc.fromBufferAttribute(t,n),dc.fromBufferAttribute(t,i),a.setScalar(0),a.addScaledVector(hc,s.x),a.addScaledVector(fc,s.y),a.addScaledVector(dc,s.z),a}static isFrontFacing(t,e,n,i){return Nr.subVectors(n,e),Qr.subVectors(t,e),Nr.cross(Qr).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Nr.subVectors(this.c,this.b),Qr.subVectors(this.a,this.b),Nr.cross(Qr).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return kr.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return kr.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,i,s){return kr.getInterpolation(t,this.a,this.b,this.c,e,n,i,s)}containsPoint(t){return kr.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return kr.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,s=this.c;let a,o;Ei.subVectors(i,n),Ai.subVectors(s,n),cc.subVectors(t,n);const c=Ei.dot(cc),l=Ai.dot(cc);if(c<=0&&l<=0)return e.copy(n);lc.subVectors(t,i);const h=Ei.dot(lc),f=Ai.dot(lc);if(h>=0&&f<=h)return e.copy(i);const d=c*f-h*l;if(d<=0&&c>=0&&h<=0)return a=c/(c-h),e.copy(n).addScaledVector(Ei,a);uc.subVectors(t,s);const m=Ei.dot(uc),b=Ai.dot(uc);if(b>=0&&m<=b)return e.copy(s);const I=m*l-c*b;if(I<=0&&l>=0&&b<=0)return o=l/(l-b),e.copy(n).addScaledVector(Ai,o);const B=h*b-m*f;if(B<=0&&f-h>=0&&m-b>=0)return jf.subVectors(s,i),o=(f-h)/(f-h+(m-b)),e.copy(i).addScaledVector(jf,o);const O=1/(B+I+d);return a=I*O,o=d*O,e.copy(n).addScaledVector(Ei,a).addScaledVector(Ai,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const rp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_n={h:0,s:0,l:0},da={h:0,s:0,l:0};function pc(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}class jr{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Lr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Ar.colorSpaceToWorking(this,e),this}setRGB(t,e,n,i=Ar.workingColorSpace){return this.r=t,this.g=e,this.b=n,Ar.colorSpaceToWorking(this,i),this}setHSL(t,e,n,i=Ar.workingColorSpace){if(t=Wc(t,1),e=re(e,0,1),n=re(n,0,1),e===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+e):n+e-n*e,a=2*n-s;this.r=pc(a,s,t+1/3),this.g=pc(a,s,t),this.b=pc(a,s,t-1/3)}return Ar.colorSpaceToWorking(this,i),this}setStyle(t,e=Lr){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Lr){const n=rp[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=en(t.r),this.g=en(t.g),this.b=en(t.b),this}copyLinearToSRGB(t){return this.r=ji(t.r),this.g=ji(t.g),this.b=ji(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Lr){return Ar.workingToColorSpace(or.copy(this),t),Math.round(re(or.r*255,0,255))*65536+Math.round(re(or.g*255,0,255))*256+Math.round(re(or.b*255,0,255))}getHexString(t=Lr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Ar.workingColorSpace){Ar.workingToColorSpace(or.copy(this),e);const n=or.r,i=or.g,s=or.b,a=Math.max(n,i,s),o=Math.min(n,i,s);let c,l;const h=(o+a)/2;if(o===a)c=0,l=0;else{const f=a-o;switch(l=h<=.5?f/(a+o):f/(2-a-o),a){case n:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-n)/f+2;break;case s:c=(n-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=h,t}getRGB(t,e=Ar.workingColorSpace){return Ar.workingToColorSpace(or.copy(this),e),t.r=or.r,t.g=or.g,t.b=or.b,t}getStyle(t=Lr){Ar.workingToColorSpace(or.copy(this),t);const e=or.r,n=or.g,i=or.b;return t!==Lr?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,e,n){return this.getHSL(_n),this.setHSL(_n.h+t,_n.s+e,_n.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(_n),t.getHSL(da);const n=_s(_n.h,da.h,e),i=_s(_n.s,da.s,e),s=_s(_n.l,da.l,e);return this.setHSL(n,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,s=t.elements;return this.r=s[0]*e+s[3]*n+s[6]*i,this.g=s[1]*e+s[4]*n+s[7]*i,this.b=s[2]*e+s[5]*n+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const or=new jr;jr.NAMES=rp;let AE=0;class Sn extends Ts{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:AE++}),this.uuid=Vi(),this.name="",this.type="Material",this.blending=gf,this.side=Dc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=xf,this.blendDst=bf,this.blendEquation=_f,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new jr(0,0,0),this.blendAlpha=0,this.depthFunc=vf,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mf,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=pi,this.stencilZFail=pi,this.stencilZPass=pi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const n=t[e];if(n===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==gf&&(n.blending=this.blending),this.side!==Dc&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==xf&&(n.blendSrc=this.blendSrc),this.blendDst!==bf&&(n.blendDst=this.blendDst),this.blendEquation!==_f&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==vf&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Mf&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==pi&&(n.stencilFail=this.stencilFail),this.stencilZFail!==pi&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==pi&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const a=[];for(const o in s){const c=s[o];delete c.metadata,a.push(c)}return a}if(e){const s=i(t.textures),a=i(t.images);s.length>0&&(n.textures=s),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(e!==null){const i=e.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=e[s].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class TE extends Sn{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new jr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tn,this.combine=Xb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Ge=new k,pa=new ce;let wE=0;class Wn{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:wE++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=Cf,this.updateRanges=[],this.gpuType=Zc,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)pa.fromBufferAttribute(this,e),pa.applyMatrix3(t),this.setXY(e,pa.x,pa.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)Ge.fromBufferAttribute(this,e),Ge.applyMatrix3(t),this.setXYZ(e,Ge.x,Ge.y,Ge.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Ge.fromBufferAttribute(this,e),Ge.applyMatrix4(t),this.setXYZ(e,Ge.x,Ge.y,Ge.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Ge.fromBufferAttribute(this,e),Ge.applyNormalMatrix(t),this.setXYZ(e,Ge.x,Ge.y,Ge.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Ge.fromBufferAttribute(this,e),Ge.transformDirection(t),this.setXYZ(e,Ge.x,Ge.y,Ge.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Di(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=lr(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Di(e,this.array)),e}setX(t,e){return this.normalized&&(e=lr(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Di(e,this.array)),e}setY(t,e){return this.normalized&&(e=lr(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Di(e,this.array)),e}setZ(t,e){return this.normalized&&(e=lr(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Di(e,this.array)),e}setW(t,e){return this.normalized&&(e=lr(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=lr(e,this.array),n=lr(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=lr(e,this.array),n=lr(n,this.array),i=lr(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,s){return t*=this.itemSize,this.normalized&&(e=lr(e,this.array),n=lr(n,this.array),i=lr(i,this.array),s=lr(s,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Cf&&(t.usage=this.usage),t}}class SE extends Wn{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class ME extends Wn{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class hr extends Wn{constructor(t,e,n){super(new Float32Array(t),e,n)}}let CE=0;const Er=new De,mc=new tr,Ti=new k,xr=new qn,fs=new qn,Qe=new k;class nn extends Ts{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:CE++}),this.uuid=Vi(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(cE(t)?ME:SE)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new rn().getNormalMatrix(t);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Er.makeRotationFromQuaternion(t),this.applyMatrix4(Er),this}rotateX(t){return Er.makeRotationX(t),this.applyMatrix4(Er),this}rotateY(t){return Er.makeRotationY(t),this.applyMatrix4(Er),this}rotateZ(t){return Er.makeRotationZ(t),this.applyMatrix4(Er),this}translate(t,e,n){return Er.makeTranslation(t,e,n),this.applyMatrix4(Er),this}scale(t,e,n){return Er.makeScale(t,e,n),this.applyMatrix4(Er),this}lookAt(t){return mc.lookAt(t),mc.updateMatrix(),this.applyMatrix4(mc.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ti).negate(),this.translate(Ti.x,Ti.y,Ti.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const n=[];for(let i=0,s=t.length;i<s;i++){const a=t[i];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new hr(n,3))}else{const n=Math.min(t.length,e.count);for(let i=0;i<n;i++){const s=t[i];e.setXYZ(i,s.x,s.y,s.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new qn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new k(-1/0,-1/0,-1/0),new k(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){const s=e[n];xr.setFromBufferAttribute(s),this.morphTargetsRelative?(Qe.addVectors(this.boundingBox.min,xr.min),this.boundingBox.expandByPoint(Qe),Qe.addVectors(this.boundingBox.max,xr.max),this.boundingBox.expandByPoint(Qe)):(this.boundingBox.expandByPoint(xr.min),this.boundingBox.expandByPoint(xr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Kn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new k,1/0);return}if(t){const n=this.boundingSphere.center;if(xr.setFromBufferAttribute(t),e)for(let s=0,a=e.length;s<a;s++){const o=e[s];fs.setFromBufferAttribute(o),this.morphTargetsRelative?(Qe.addVectors(xr.min,fs.min),xr.expandByPoint(Qe),Qe.addVectors(xr.max,fs.max),xr.expandByPoint(Qe)):(xr.expandByPoint(fs.min),xr.expandByPoint(fs.max))}xr.getCenter(n);let i=0;for(let s=0,a=t.count;s<a;s++)Qe.fromBufferAttribute(t,s),i=Math.max(i,n.distanceToSquared(Qe));if(e)for(let s=0,a=e.length;s<a;s++){const o=e[s],c=this.morphTargetsRelative;for(let l=0,h=o.count;l<h;l++)Qe.fromBufferAttribute(o,l),c&&(Ti.fromBufferAttribute(t,l),Qe.add(Ti)),i=Math.max(i,n.distanceToSquared(Qe))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.position,i=e.normal,s=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Wn(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],c=[];for(let wt=0;wt<n.count;wt++)o[wt]=new k,c[wt]=new k;const l=new k,h=new k,f=new k,d=new ce,m=new ce,b=new ce,I=new k,B=new k;function O(wt,Gt,Jt){l.fromBufferAttribute(n,wt),h.fromBufferAttribute(n,Gt),f.fromBufferAttribute(n,Jt),d.fromBufferAttribute(s,wt),m.fromBufferAttribute(s,Gt),b.fromBufferAttribute(s,Jt),h.sub(l),f.sub(l),m.sub(d),b.sub(d);const ae=1/(m.x*b.y-b.x*m.y);isFinite(ae)&&(I.copy(h).multiplyScalar(b.y).addScaledVector(f,-m.y).multiplyScalar(ae),B.copy(f).multiplyScalar(m.x).addScaledVector(h,-b.x).multiplyScalar(ae),o[wt].add(I),o[Gt].add(I),o[Jt].add(I),c[wt].add(B),c[Gt].add(B),c[Jt].add(B))}let ut=this.groups;ut.length===0&&(ut=[{start:0,count:t.count}]);for(let wt=0,Gt=ut.length;wt<Gt;++wt){const Jt=ut[wt],ae=Jt.start,he=Jt.count;for(let kt=ae,Vt=ae+he;kt<Vt;kt+=3)O(t.getX(kt+0),t.getX(kt+1),t.getX(kt+2))}const X=new k,et=new k,q=new k,At=new k;function Ot(wt){q.fromBufferAttribute(i,wt),At.copy(q);const Gt=o[wt];X.copy(Gt),X.sub(q.multiplyScalar(q.dot(Gt))).normalize(),et.crossVectors(At,Gt);const ae=et.dot(c[wt])<0?-1:1;a.setXYZW(wt,X.x,X.y,X.z,ae)}for(let wt=0,Gt=ut.length;wt<Gt;++wt){const Jt=ut[wt],ae=Jt.start,he=Jt.count;for(let kt=ae,Vt=ae+he;kt<Vt;kt+=3)Ot(t.getX(kt+0)),Ot(t.getX(kt+1)),Ot(t.getX(kt+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Wn(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let d=0,m=n.count;d<m;d++)n.setXYZ(d,0,0,0);const i=new k,s=new k,a=new k,o=new k,c=new k,l=new k,h=new k,f=new k;if(t)for(let d=0,m=t.count;d<m;d+=3){const b=t.getX(d+0),I=t.getX(d+1),B=t.getX(d+2);i.fromBufferAttribute(e,b),s.fromBufferAttribute(e,I),a.fromBufferAttribute(e,B),h.subVectors(a,s),f.subVectors(i,s),h.cross(f),o.fromBufferAttribute(n,b),c.fromBufferAttribute(n,I),l.fromBufferAttribute(n,B),o.add(h),c.add(h),l.add(h),n.setXYZ(b,o.x,o.y,o.z),n.setXYZ(I,c.x,c.y,c.z),n.setXYZ(B,l.x,l.y,l.z)}else for(let d=0,m=e.count;d<m;d+=3)i.fromBufferAttribute(e,d+0),s.fromBufferAttribute(e,d+1),a.fromBufferAttribute(e,d+2),h.subVectors(a,s),f.subVectors(i,s),h.cross(f),n.setXYZ(d+0,h.x,h.y,h.z),n.setXYZ(d+1,h.x,h.y,h.z),n.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Qe.fromBufferAttribute(t,e),Qe.normalize(),t.setXYZ(e,Qe.x,Qe.y,Qe.z)}toNonIndexed(){function t(o,c){const l=o.array,h=o.itemSize,f=o.normalized,d=new l.constructor(c.length*h);let m=0,b=0;for(let I=0,B=c.length;I<B;I++){o.isInterleavedBufferAttribute?m=c[I]*o.data.stride+o.offset:m=c[I]*h;for(let O=0;O<h;O++)d[b++]=l[m++]}return new Wn(d,h,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new nn,n=this.index.array,i=this.attributes;for(const o in i){const c=i[o],l=t(c,n);e.setAttribute(o,l)}const s=this.morphAttributes;for(const o in s){const c=[],l=s[o];for(let h=0,f=l.length;h<f;h++){const d=l[h],m=t(d,n);c.push(m)}e.morphAttributes[o]=c}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,c=a.length;o<c;o++){const l=a[o];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(t[l]=c[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const c in n){const l=n[c];t.data.attributes[c]=l.toJSON(t.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],h=[];for(let f=0,d=l.length;f<d;f++){const m=l[f];h.push(m.toJSON(t.data))}h.length>0&&(i[c]=h,s=!0)}s&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere=o.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone());const i=t.attributes;for(const l in i){const h=i[l];this.setAttribute(l,h.clone(e))}const s=t.morphAttributes;for(const l in s){const h=[],f=s[l];for(let d=0,m=f.length;d<m;d++)h.push(f[d].clone(e));this.morphAttributes[l]=h}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,h=a.length;l<h;l++){const f=a[l];this.addGroup(f.start,f.count,f.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Vf=new De,Gn=new Yc,ma=new Kn,$f=new k,ya=new k,ga=new k,_a=new k,yc=new k,xa=new k,Zf=new k,ba=new k;class Xc extends tr{constructor(t=new nn,e=new TE){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(s&&o){xa.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const h=o[c],f=s[c];h!==0&&(yc.fromBufferAttribute(f,t),a?xa.addScaledVector(yc,h):xa.addScaledVector(yc.sub(e),h))}e.add(xa)}return e}raycast(t,e){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),ma.copy(n.boundingSphere),ma.applyMatrix4(s),Gn.copy(t.ray).recast(t.near),!(ma.containsPoint(Gn.origin)===!1&&(Gn.intersectSphere(ma,$f)===null||Gn.origin.distanceToSquared($f)>(t.far-t.near)**2))&&(Vf.copy(s).invert(),Gn.copy(t.ray).applyMatrix4(Vf),!(n.boundingBox!==null&&Gn.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(t,e,Gn)))}_computeIntersections(t,e,n){let i;const s=this.geometry,a=this.material,o=s.index,c=s.attributes.position,l=s.attributes.uv,h=s.attributes.uv1,f=s.attributes.normal,d=s.groups,m=s.drawRange;if(o!==null)if(Array.isArray(a))for(let b=0,I=d.length;b<I;b++){const B=d[b],O=a[B.materialIndex],ut=Math.max(B.start,m.start),X=Math.min(o.count,Math.min(B.start+B.count,m.start+m.count));for(let et=ut,q=X;et<q;et+=3){const At=o.getX(et),Ot=o.getX(et+1),wt=o.getX(et+2);i=va(this,O,t,n,l,h,f,At,Ot,wt),i&&(i.faceIndex=Math.floor(et/3),i.face.materialIndex=B.materialIndex,e.push(i))}}else{const b=Math.max(0,m.start),I=Math.min(o.count,m.start+m.count);for(let B=b,O=I;B<O;B+=3){const ut=o.getX(B),X=o.getX(B+1),et=o.getX(B+2);i=va(this,a,t,n,l,h,f,ut,X,et),i&&(i.faceIndex=Math.floor(B/3),e.push(i))}}else if(c!==void 0)if(Array.isArray(a))for(let b=0,I=d.length;b<I;b++){const B=d[b],O=a[B.materialIndex],ut=Math.max(B.start,m.start),X=Math.min(c.count,Math.min(B.start+B.count,m.start+m.count));for(let et=ut,q=X;et<q;et+=3){const At=et,Ot=et+1,wt=et+2;i=va(this,O,t,n,l,h,f,At,Ot,wt),i&&(i.faceIndex=Math.floor(et/3),i.face.materialIndex=B.materialIndex,e.push(i))}}else{const b=Math.max(0,m.start),I=Math.min(c.count,m.start+m.count);for(let B=b,O=I;B<O;B+=3){const ut=B,X=B+1,et=B+2;i=va(this,a,t,n,l,h,f,ut,X,et),i&&(i.faceIndex=Math.floor(B/3),e.push(i))}}}}function IE(r,t,e,n,i,s,a,o){let c;if(t.side===Yd?c=n.intersectTriangle(a,s,i,!0,o):c=n.intersectTriangle(i,s,a,t.side===Dc,o),c===null)return null;ba.copy(o),ba.applyMatrix4(r.matrixWorld);const l=e.ray.origin.distanceTo(ba);return l<e.near||l>e.far?null:{distance:l,point:ba.clone(),object:r}}function va(r,t,e,n,i,s,a,o,c,l){r.getVertexPosition(o,ya),r.getVertexPosition(c,ga),r.getVertexPosition(l,_a);const h=IE(r,t,e,n,ya,ga,_a,Zf);if(h){const f=new k;kr.getBarycoord(Zf,ya,ga,_a,f),i&&(h.uv=kr.getInterpolatedAttribute(i,o,c,l,f,new ce)),s&&(h.uv1=kr.getInterpolatedAttribute(s,o,c,l,f,new ce)),a&&(h.normal=kr.getInterpolatedAttribute(a,o,c,l,f,new k),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const d={a:o,b:c,c:l,normal:new k,materialIndex:0};kr.getNormal(ya,ga,_a,d.normal),h.face=d,h.barycoord=f}return h}class Jc extends nn{constructor(t=1,e=1,n=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:s,depthSegments:a};const o=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const c=[],l=[],h=[],f=[];let d=0,m=0;b("z","y","x",-1,-1,n,e,t,a,s,0),b("z","y","x",1,-1,n,e,-t,a,s,1),b("x","z","y",1,1,t,n,e,i,a,2),b("x","z","y",1,-1,t,n,-e,i,a,3),b("x","y","z",1,-1,t,e,n,i,s,4),b("x","y","z",-1,-1,t,e,-n,i,s,5),this.setIndex(c),this.setAttribute("position",new hr(l,3)),this.setAttribute("normal",new hr(h,3)),this.setAttribute("uv",new hr(f,2));function b(I,B,O,ut,X,et,q,At,Ot,wt,Gt){const Jt=et/Ot,ae=q/wt,he=et/2,kt=q/2,Vt=At/2,ne=Ot+1,xe=wt+1;let fe=0,Te=0;const le=new k;for(let Ft=0;Ft<xe;Ft++){const qt=Ft*ae-kt;for(let be=0;be<ne;be++){const Fe=be*Jt-he;le[I]=Fe*ut,le[B]=qt*X,le[O]=Vt,l.push(le.x,le.y,le.z),le[I]=0,le[B]=0,le[O]=At>0?1:-1,h.push(le.x,le.y,le.z),f.push(be/Ot),f.push(1-Ft/wt),fe+=1}}for(let Ft=0;Ft<wt;Ft++)for(let qt=0;qt<Ot;qt++){const be=d+qt+ne*Ft,Fe=d+qt+ne*(Ft+1),se=d+(qt+1)+ne*(Ft+1),ye=d+(qt+1)+ne*Ft;c.push(be,Fe,ye),c.push(Fe,se,ye),Te+=6}o.addGroup(m,Te,Gt),m+=Te,d+=fe}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Jc(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Xa(r){const t={};for(const e in r){t[e]={};for(const n in r[e]){const i=r[e][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][n]=null):t[e][n]=i.clone():Array.isArray(i)?t[e][n]=i.slice():t[e][n]=i}}return t}function RE(r){const t={};for(let e=0;e<r.length;e++){const n=Xa(r[e]);for(const i in n)t[i]=n[i]}return t}function OE(r){const t=[];for(let e=0;e<r.length;e++)t.push(r[e].clone());return t}function jT(r){const t=r.getRenderTarget();return t===null?r.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:Ar.workingColorSpace}const VT={clone:Xa,merge:RE};var NE=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,LE=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class kE extends Sn{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=NE,this.fragmentShader=LE,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Xa(t.uniforms),this.uniformsGroups=OE(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?e.uniforms[i]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?e.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?e.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?e.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?e.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?e.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?e.uniforms[i]={type:"m4",value:a.toArray()}:e.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class np extends tr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new De,this.projectionMatrix=new De,this.projectionMatrixInverse=new De,this.coordinateSystem=bn,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const xn=new k,Wf=new ce,Hf=new ce;class $n extends np{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=Ga*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(gs*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Ga*2*Math.atan(Math.tan(gs*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){xn.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(xn.x,xn.y).multiplyScalar(-t/xn.z),xn.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(xn.x,xn.y).multiplyScalar(-t/xn.z)}getViewSize(t,e){return this.getViewBounds(t,Wf,Hf),e.subVectors(Hf,Wf)}setViewOffset(t,e,n,i,s,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(gs*.5*this.fov)/this.zoom,n=2*e,i=this.aspect*n,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,l=a.fullHeight;s+=a.offsetX*i/c,e-=a.offsetY*n/l,i*=a.width/c,n*=a.height/l}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,e,e-n,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const wi=-90,Si=1;class DE extends tr{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new $n(wi,Si,t,e);i.layers=this.layers,this.add(i);const s=new $n(wi,Si,t,e);s.layers=this.layers,this.add(s);const a=new $n(wi,Si,t,e);a.layers=this.layers,this.add(a);const o=new $n(wi,Si,t,e);o.layers=this.layers,this.add(o);const c=new $n(wi,Si,t,e);c.layers=this.layers,this.add(c);const l=new $n(wi,Si,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,s,a,o,c]=e;for(const l of e)this.remove(l);if(t===bn)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(t===Ua)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const l of e)this.add(l),l.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,c,l,h]=this.children,f=t.getRenderTarget(),d=t.getActiveCubeFace(),m=t.getActiveMipmapLevel(),b=t.xr.enabled;t.xr.enabled=!1;const I=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,s),t.setRenderTarget(n,1,i),t.render(e,a),t.setRenderTarget(n,2,i),t.render(e,o),t.setRenderTarget(n,3,i),t.render(e,c),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=I,t.setRenderTarget(n,5,i),t.render(e,h),t.setRenderTarget(f,d,m),t.xr.enabled=b,n.texture.needsPMREMUpdate=!0}}class FE extends ur{constructor(t=[],e=Jb,n,i,s,a,o,c,l,h){super(t,e,n,i,s,a,o,c,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class $T extends pE{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new FE(i),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Jc(5,5,5),s=new kE({name:"CubemapFromEquirect",uniforms:Xa(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Yd,blending:Yb});s.uniforms.tEquirect.value=e;const a=new Xc(i,s),o=e.minFilter;return e.minFilter===Jd&&(e.minFilter=Ba),new DE(1,10,this).update(t,a),e.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,e=!0,n=!0,i=!0){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,n,i);t.setRenderTarget(s)}}class Ea extends tr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const PE={type:"move"};class ZT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ea,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ea,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new k,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new k),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ea,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new k,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new k),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let i=null,s=null,a=null;const o=this._targetRay,c=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){a=!0;for(const I of t.hand.values()){const B=e.getJointPose(I,n),O=this._getHandJoint(l,I);B!==null&&(O.matrix.fromArray(B.transform.matrix),O.matrix.decompose(O.position,O.rotation,O.scale),O.matrixWorldNeedsUpdate=!0,O.jointRadius=B.radius),O.visible=B!==null}const h=l.joints["index-finger-tip"],f=l.joints["thumb-tip"],d=h.position.distanceTo(f.position),m=.02,b=.005;l.inputState.pinching&&d>m+b?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&d<=m-b&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else c!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));o!==null&&(i=e.getPose(t.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(PE)))}return o!==null&&(o.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=a!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const n=new Ea;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class ip{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new jr(t),this.near=e,this.far=n}clone(){return new ip(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class WT extends tr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Tn,this.environmentIntensity=1,this.environmentRotation=new Tn,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class zE extends ur{constructor(t=null,e=1,n=1,i,s,a,o,c,l=En,h=En,f,d){super(null,a,o,c,l,h,i,s,f,d),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Yf extends Wn{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Mi=new De,Xf=new De,Aa=[],Jf=new qn,BE=new De,ds=new Xc,ps=new Kn;class HT extends Xc{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Yf(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,BE)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new qn),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Mi),Jf.copy(t.boundingBox).applyMatrix4(Mi),this.boundingBox.union(Jf)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Kn),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Mi),ps.copy(t.boundingSphere).applyMatrix4(Mi),this.boundingSphere.union(ps)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const n=e.morphTargetInfluences,i=this.morphTexture.source.data.data,s=n.length+1,a=t*s+1;for(let o=0;o<n.length;o++)n[o]=i[a+o]}raycast(t,e){const n=this.matrixWorld,i=this.count;if(ds.geometry=this.geometry,ds.material=this.material,ds.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ps.copy(this.boundingSphere),ps.applyMatrix4(n),t.ray.intersectsSphere(ps)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,Mi),Xf.multiplyMatrices(n,Mi),ds.matrixWorld=Xf,ds.raycast(t,Aa);for(let a=0,o=Aa.length;a<o;a++){const c=Aa[a];c.instanceId=s,c.object=this,e.push(c)}Aa.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new Yf(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const n=e.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new zE(new Float32Array(i*this.count),i,this.count,Qd,Zc));const s=this.morphTexture.source.data.data;let a=0;for(let l=0;l<n.length;l++)a+=n[l];const o=this.geometry.morphTargetsRelative?1:1-a,c=i*t;s[c]=o,s.set(n,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const gc=new k,UE=new k,GE=new rn;class Ci{constructor(t=new k(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=gc.subVectors(n,e).cross(UE.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(gc),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:e.copy(t.start).addScaledVector(n,s)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||GE.getNormalMatrix(t),i=this.coplanarPoint(gc).applyMatrix4(t),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const jn=new Kn,jE=new ce(.5,.5),Ta=new k;class VE{constructor(t=new Ci,e=new Ci,n=new Ci,i=new Ci,s=new Ci,a=new Ci){this.planes=[t,e,n,i,s,a]}set(t,e,n,i,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(s),o[5].copy(a),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=bn,n=!1){const i=this.planes,s=t.elements,a=s[0],o=s[1],c=s[2],l=s[3],h=s[4],f=s[5],d=s[6],m=s[7],b=s[8],I=s[9],B=s[10],O=s[11],ut=s[12],X=s[13],et=s[14],q=s[15];if(i[0].setComponents(l-a,m-h,O-b,q-ut).normalize(),i[1].setComponents(l+a,m+h,O+b,q+ut).normalize(),i[2].setComponents(l+o,m+f,O+I,q+X).normalize(),i[3].setComponents(l-o,m-f,O-I,q-X).normalize(),n)i[4].setComponents(c,d,B,et).normalize(),i[5].setComponents(l-c,m-d,O-B,q-et).normalize();else if(i[4].setComponents(l-c,m-d,O-B,q-et).normalize(),e===bn)i[5].setComponents(l+c,m+d,O+B,q+et).normalize();else if(e===Ua)i[5].setComponents(c,d,B,et).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),jn.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),jn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(jn)}intersectsSprite(t){jn.center.set(0,0,0);const e=jE.distanceTo(t.center);return jn.radius=.7071067811865476+e,jn.applyMatrix4(t.matrixWorld),this.intersectsSphere(jn)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(Ta.x=i.normal.x>0?t.max.x:t.min.x,Ta.y=i.normal.y>0?t.max.y:t.min.y,Ta.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Ta)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class $E extends Sn{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new jr(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Va=new k,$a=new k,qf=new De,ms=new Yc,wa=new Kn,_c=new k,Kf=new k;class ZE extends tr{constructor(t=new nn,e=new $E){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,n=[0];for(let i=1,s=e.count;i<s;i++)Va.fromBufferAttribute(e,i-1),$a.fromBufferAttribute(e,i),n[i]=n[i-1],n[i]+=Va.distanceTo($a);t.setAttribute("lineDistance",new hr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,s=t.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),wa.copy(n.boundingSphere),wa.applyMatrix4(i),wa.radius+=s,t.ray.intersectsSphere(wa)===!1)return;qf.copy(i).invert(),ms.copy(t.ray).applyMatrix4(qf);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=o*o,l=this.isLineSegments?2:1,h=n.index,d=n.attributes.position;if(h!==null){const m=Math.max(0,a.start),b=Math.min(h.count,a.start+a.count);for(let I=m,B=b-1;I<B;I+=l){const O=h.getX(I),ut=h.getX(I+1),X=Sa(this,t,ms,c,O,ut,I);X&&e.push(X)}if(this.isLineLoop){const I=h.getX(b-1),B=h.getX(m),O=Sa(this,t,ms,c,I,B,b-1);O&&e.push(O)}}else{const m=Math.max(0,a.start),b=Math.min(d.count,a.start+a.count);for(let I=m,B=b-1;I<B;I+=l){const O=Sa(this,t,ms,c,I,I+1,I);O&&e.push(O)}if(this.isLineLoop){const I=Sa(this,t,ms,c,b-1,m,b-1);I&&e.push(I)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function Sa(r,t,e,n,i,s,a){const o=r.geometry.attributes.position;if(Va.fromBufferAttribute(o,i),$a.fromBufferAttribute(o,s),e.distanceSqToSegment(Va,$a,_c,Kf)>n)return;_c.applyMatrix4(r.matrixWorld);const l=t.ray.origin.distanceTo(_c);if(!(l<t.near||l>t.far))return{distance:l,point:Kf.clone().applyMatrix4(r.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:r}}const Qf=new k,td=new k;class YT extends ZE{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,n=[];for(let i=0,s=e.count;i<s;i+=2)Qf.fromBufferAttribute(e,i),td.fromBufferAttribute(e,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+Qf.distanceTo(td);t.setAttribute("lineDistance",new hr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class WE extends Sn{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new jr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const ed=new De,Fc=new Yc,Ma=new Kn,Ca=new k;class XT extends tr{constructor(t=new nn,e=new WE){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,s=t.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Ma.copy(n.boundingSphere),Ma.applyMatrix4(i),Ma.radius+=s,t.ray.intersectsSphere(Ma)===!1)return;ed.copy(i).invert(),Fc.copy(t.ray).applyMatrix4(ed);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=o*o,l=n.index,f=n.attributes.position;if(l!==null){const d=Math.max(0,a.start),m=Math.min(l.count,a.start+a.count);for(let b=d,I=m;b<I;b++){const B=l.getX(b);Ca.fromBufferAttribute(f,B),rd(Ca,B,c,i,t,e,this)}}else{const d=Math.max(0,a.start),m=Math.min(f.count,a.start+a.count);for(let b=d,I=m;b<I;b++)Ca.fromBufferAttribute(f,b),rd(Ca,b,c,i,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function rd(r,t,e,n,i,s,a){const o=Fc.distanceSqToPoint(r);if(o<e){const c=new k;Fc.closestPointToPoint(r,c),c.applyMatrix4(n);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:c,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class JT extends ur{constructor(t,e,n=qd,i,s,a,o=En,c=En,l,h=Tf,f=1){if(h!==Tf&&h!==cv)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const d={width:t,height:e,depth:f};super(d,i,s,a,o,c,h,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Hc(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}class qT extends ur{constructor(t=null){super(),this.sourceTexture=t,this.isExternalTexture=!0}copy(t){return super.copy(t),this.sourceTexture=t.sourceTexture,this}}class sn{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),s=0;e.push(0);for(let a=1;a<=t;a++)n=this.getPoint(a/t),s+=n.distanceTo(i),e.push(s),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e=null){const n=this.getLengths();let i=0;const s=n.length;let a;e?a=e:a=t*n[s-1];let o=0,c=s-1,l;for(;o<=c;)if(i=Math.floor(o+(c-o)/2),l=n[i]-a,l<0)o=i+1;else if(l>0)c=i-1;else{c=i;break}if(i=c,n[i]===a)return i/(s-1);const h=n[i],d=n[i+1]-h,m=(a-h)/d;return(i+m)/(s-1)}getTangent(t,e){let i=t-1e-4,s=t+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),o=this.getPoint(s),c=e||(a.isVector2?new ce:new k);return c.copy(o).sub(a).normalize(),c}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e=!1){const n=new k,i=[],s=[],a=[],o=new k,c=new De;for(let m=0;m<=t;m++){const b=m/t;i[m]=this.getTangentAt(b,new k)}s[0]=new k,a[0]=new k;let l=Number.MAX_VALUE;const h=Math.abs(i[0].x),f=Math.abs(i[0].y),d=Math.abs(i[0].z);h<=l&&(l=h,n.set(1,0,0)),f<=l&&(l=f,n.set(0,1,0)),d<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],o),a[0].crossVectors(i[0],s[0]);for(let m=1;m<=t;m++){if(s[m]=s[m-1].clone(),a[m]=a[m-1].clone(),o.crossVectors(i[m-1],i[m]),o.length()>Number.EPSILON){o.normalize();const b=Math.acos(re(i[m-1].dot(i[m]),-1,1));s[m].applyMatrix4(c.makeRotationAxis(o,b))}a[m].crossVectors(i[m],s[m])}if(e===!0){let m=Math.acos(re(s[0].dot(s[t]),-1,1));m/=t,i[0].dot(o.crossVectors(s[0],s[t]))>0&&(m=-m);for(let b=1;b<=t;b++)s[b].applyMatrix4(c.makeRotationAxis(i[b],m*b)),a[b].crossVectors(i[b],s[b])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class sp extends sn{constructor(t=0,e=0,n=1,i=1,s=0,a=Math.PI*2,o=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=c}getPoint(t,e=new ce){const n=e,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const o=this.aStartAngle+t*s;let c=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),f=Math.sin(this.aRotation),d=c-this.aX,m=l-this.aY;c=d*h-m*f+this.aX,l=d*f+m*h+this.aY}return n.set(c,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class HE extends sp{constructor(t,e,n,i,s,a){super(t,e,n,n,i,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function qc(){let r=0,t=0,e=0,n=0;function i(s,a,o,c){r=s,t=o,e=-3*s+3*a-2*o-c,n=2*s-2*a+o+c}return{initCatmullRom:function(s,a,o,c,l){i(a,o,l*(o-s),l*(c-a))},initNonuniformCatmullRom:function(s,a,o,c,l,h,f){let d=(a-s)/l-(o-s)/(l+h)+(o-a)/h,m=(o-a)/h-(c-a)/(h+f)+(c-o)/f;d*=h,m*=h,i(a,o,d,m)},calc:function(s){const a=s*s,o=a*s;return r+t*s+e*a+n*o}}}const Ia=new k,xc=new qc,bc=new qc,vc=new qc;class YE extends sn{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new k){const n=e,i=this.points,s=i.length,a=(s-(this.closed?0:1))*t;let o=Math.floor(a),c=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:c===0&&o===s-1&&(o=s-2,c=1);let l,h;this.closed||o>0?l=i[(o-1)%s]:(Ia.subVectors(i[0],i[1]).add(i[0]),l=Ia);const f=i[o%s],d=i[(o+1)%s];if(this.closed||o+2<s?h=i[(o+2)%s]:(Ia.subVectors(i[s-1],i[s-2]).add(i[s-1]),h=Ia),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let b=Math.pow(l.distanceToSquared(f),m),I=Math.pow(f.distanceToSquared(d),m),B=Math.pow(d.distanceToSquared(h),m);I<1e-4&&(I=1),b<1e-4&&(b=I),B<1e-4&&(B=I),xc.initNonuniformCatmullRom(l.x,f.x,d.x,h.x,b,I,B),bc.initNonuniformCatmullRom(l.y,f.y,d.y,h.y,b,I,B),vc.initNonuniformCatmullRom(l.z,f.z,d.z,h.z,b,I,B)}else this.curveType==="catmullrom"&&(xc.initCatmullRom(l.x,f.x,d.x,h.x,this.tension),bc.initCatmullRom(l.y,f.y,d.y,h.y,this.tension),vc.initCatmullRom(l.z,f.z,d.z,h.z,this.tension));return n.set(xc.calc(c),bc.calc(c),vc.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(new k().fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function nd(r,t,e,n,i){const s=(n-t)*.5,a=(i-e)*.5,o=r*r,c=r*o;return(2*e-2*n+s+a)*c+(-3*e+3*n-2*s-a)*o+s*r+e}function XE(r,t){const e=1-r;return e*e*t}function JE(r,t){return 2*(1-r)*r*t}function qE(r,t){return r*r*t}function xs(r,t,e,n){return XE(r,t)+JE(r,e)+qE(r,n)}function KE(r,t){const e=1-r;return e*e*e*t}function QE(r,t){const e=1-r;return 3*e*e*r*t}function tA(r,t){return 3*(1-r)*r*r*t}function eA(r,t){return r*r*r*t}function bs(r,t,e,n,i){return KE(r,t)+QE(r,e)+tA(r,n)+eA(r,i)}class rA extends sn{constructor(t=new ce,e=new ce,n=new ce,i=new ce){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new ce){const n=e,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return n.set(bs(t,i.x,s.x,a.x,o.x),bs(t,i.y,s.y,a.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class nA extends sn{constructor(t=new k,e=new k,n=new k,i=new k){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new k){const n=e,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return n.set(bs(t,i.x,s.x,a.x,o.x),bs(t,i.y,s.y,a.y,o.y),bs(t,i.z,s.z,a.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class iA extends sn{constructor(t=new ce,e=new ce){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new ce){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new ce){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class sA extends sn{constructor(t=new k,e=new k){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new k){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new k){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class aA extends sn{constructor(t=new ce,e=new ce,n=new ce){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new ce){const n=e,i=this.v0,s=this.v1,a=this.v2;return n.set(xs(t,i.x,s.x,a.x),xs(t,i.y,s.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Kc extends sn{constructor(t=new k,e=new k,n=new k){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new k){const n=e,i=this.v0,s=this.v1,a=this.v2;return n.set(xs(t,i.x,s.x,a.x),xs(t,i.y,s.y,a.y),xs(t,i.z,s.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class oA extends sn{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new ce){const n=e,i=this.points,s=(i.length-1)*t,a=Math.floor(s),o=s-a,c=i[a===0?a:a-1],l=i[a],h=i[a>i.length-2?i.length-1:a+1],f=i[a>i.length-3?i.length-1:a+2];return n.set(nd(o,c.x,l.x,h.x,f.x),nd(o,c.y,l.y,h.y,f.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(new ce().fromArray(i))}return this}}var cA=Object.freeze({__proto__:null,ArcCurve:HE,CatmullRomCurve3:YE,CubicBezierCurve:rA,CubicBezierCurve3:nA,EllipseCurve:sp,LineCurve:iA,LineCurve3:sA,QuadraticBezierCurve:aA,QuadraticBezierCurve3:Kc,SplineCurve:oA});class ap extends nn{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const s=t/2,a=e/2,o=Math.floor(n),c=Math.floor(i),l=o+1,h=c+1,f=t/o,d=e/c,m=[],b=[],I=[],B=[];for(let O=0;O<h;O++){const ut=O*d-a;for(let X=0;X<l;X++){const et=X*f-s;b.push(et,-ut,0),I.push(0,0,1),B.push(X/o),B.push(1-O/c)}}for(let O=0;O<c;O++)for(let ut=0;ut<o;ut++){const X=ut+l*O,et=ut+l*(O+1),q=ut+1+l*(O+1),At=ut+1+l*O;m.push(X,et,At),m.push(et,q,At)}this.setIndex(m),this.setAttribute("position",new hr(b,3)),this.setAttribute("normal",new hr(I,3)),this.setAttribute("uv",new hr(B,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ap(t.width,t.height,t.widthSegments,t.heightSegments)}}class op extends nn{constructor(t=1,e=32,n=16,i=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:s,thetaStart:a,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const c=Math.min(a+o,Math.PI);let l=0;const h=[],f=new k,d=new k,m=[],b=[],I=[],B=[];for(let O=0;O<=n;O++){const ut=[],X=O/n;let et=0;O===0&&a===0?et=.5/e:O===n&&c===Math.PI&&(et=-.5/e);for(let q=0;q<=e;q++){const At=q/e;f.x=-t*Math.cos(i+At*s)*Math.sin(a+X*o),f.y=t*Math.cos(a+X*o),f.z=t*Math.sin(i+At*s)*Math.sin(a+X*o),b.push(f.x,f.y,f.z),d.copy(f).normalize(),I.push(d.x,d.y,d.z),B.push(At+et,1-X),ut.push(l++)}h.push(ut)}for(let O=0;O<n;O++)for(let ut=0;ut<e;ut++){const X=h[O][ut+1],et=h[O][ut],q=h[O+1][ut],At=h[O+1][ut+1];(O!==0||a>0)&&m.push(X,et,At),(O!==n-1||c<Math.PI)&&m.push(et,q,At)}this.setIndex(m),this.setAttribute("position",new hr(b,3)),this.setAttribute("normal",new hr(I,3)),this.setAttribute("uv",new hr(B,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new op(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class cp extends nn{constructor(t=new Kc(new k(-1,-1,0),new k(-1,1,0),new k(1,1,0)),e=64,n=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:s};const a=t.computeFrenetFrames(e,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new k,c=new k,l=new ce;let h=new k;const f=[],d=[],m=[],b=[];I(),this.setIndex(b),this.setAttribute("position",new hr(f,3)),this.setAttribute("normal",new hr(d,3)),this.setAttribute("uv",new hr(m,2));function I(){for(let X=0;X<e;X++)B(X);B(s===!1?e:0),ut(),O()}function B(X){h=t.getPointAt(X/e,h);const et=a.normals[X],q=a.binormals[X];for(let At=0;At<=i;At++){const Ot=At/i*Math.PI*2,wt=Math.sin(Ot),Gt=-Math.cos(Ot);c.x=Gt*et.x+wt*q.x,c.y=Gt*et.y+wt*q.y,c.z=Gt*et.z+wt*q.z,c.normalize(),d.push(c.x,c.y,c.z),o.x=h.x+n*c.x,o.y=h.y+n*c.y,o.z=h.z+n*c.z,f.push(o.x,o.y,o.z)}}function O(){for(let X=1;X<=e;X++)for(let et=1;et<=i;et++){const q=(i+1)*(X-1)+(et-1),At=(i+1)*X+(et-1),Ot=(i+1)*X+et,wt=(i+1)*(X-1)+et;b.push(q,At,wt),b.push(At,Ot,wt)}}function ut(){for(let X=0;X<=e;X++)for(let et=0;et<=i;et++)l.x=X/e,l.y=et/i,m.push(l.x,l.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new cp(new cA[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class KT extends Sn{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new jr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tp,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tn,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class QT extends Sn{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tp,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class tw extends Sn{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Zv,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class ew extends Sn{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const Ec={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(this.files[r]=t)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class lA{constructor(t,e,n){const i=this;let s=!1,a=0,o=0,c;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.abortController=new AbortController,this.itemStart=function(h){o++,s===!1&&i.onStart!==void 0&&i.onStart(h,a,o),s=!0},this.itemEnd=function(h){a++,i.onProgress!==void 0&&i.onProgress(h,a,o),a===o&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return c?c(h):h},this.setURLModifier=function(h){return c=h,this},this.addHandler=function(h,f){return l.push(h,f),this},this.removeHandler=function(h){const f=l.indexOf(h);return f!==-1&&l.splice(f,2),this},this.getHandler=function(h){for(let f=0,d=l.length;f<d;f+=2){const m=l[f],b=l[f+1];if(m.global&&(m.lastIndex=0),m.test(h))return b}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const uA=new lA;class Qc{constructor(t){this.manager=t!==void 0?t:uA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(i,s){n.load(t,i,e,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}Qc.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ii=new WeakMap;class hA extends Qc{constructor(t){super(t)}load(t,e,n,i){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Ec.get(`image:${t}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(t),setTimeout(function(){e&&e(a),s.manager.itemEnd(t)},0);else{let f=Ii.get(a);f===void 0&&(f=[],Ii.set(a,f)),f.push({onLoad:e,onError:i})}return a}const o=ja("img");function c(){h(),e&&e(this);const f=Ii.get(this)||[];for(let d=0;d<f.length;d++){const m=f[d];m.onLoad&&m.onLoad(this)}Ii.delete(this),s.manager.itemEnd(t)}function l(f){h(),i&&i(f),Ec.remove(`image:${t}`);const d=Ii.get(this)||[];for(let m=0;m<d.length;m++){const b=d[m];b.onError&&b.onError(f)}Ii.delete(this),s.manager.itemError(t),s.manager.itemEnd(t)}function h(){o.removeEventListener("load",c,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",c,!1),o.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Ec.add(`image:${t}`,o),s.manager.itemStart(t),o.src=t,o}}class rw extends Qc{constructor(t){super(t)}load(t,e,n,i){const s=new ur,a=new hA(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){s.image=o,s.needsUpdate=!0,e!==void 0&&e(s)},n,i),s}}class lp extends tr{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new jr(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}const Ac=new De,id=new k,sd=new k;class fA{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ce(512,512),this.mapType=$c,this.map=null,this.mapPass=null,this.matrix=new De,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new VE,this._frameExtents=new ce(1,1),this._viewportCount=1,this._viewports=[new An(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;id.setFromMatrixPosition(t.matrixWorld),e.position.copy(id),sd.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(sd),e.updateMatrixWorld(),Ac.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ac,e.coordinateSystem,e.reversedDepth),e.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Ac)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class dA extends np{constructor(t=-1,e=1,n=1,i=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-t,a=n+t,o=i+e,c=i-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,a=s+l*this.view.width,o-=h*this.view.offsetY,c=o-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,c,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class pA extends fA{constructor(){super(new dA(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class nw extends lp{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(tr.DEFAULT_UP),this.updateMatrix(),this.target=new tr,this.shadow=new pA}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class iw extends lp{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class sw extends $n{constructor(t=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class aw{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}class up{constructor(t){this.value=t}clone(){return new up(this.value.clone===void 0?this.value:this.value.clone())}}const ad=new k,Ra=new k,Ri=new k,Oi=new k,Tc=new k,mA=new k,yA=new k;class ow{constructor(t=new k,e=new k){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){ad.subVectors(t,this.start),Ra.subVectors(this.end,this.start);const n=Ra.dot(Ra);let s=Ra.dot(ad)/n;return e&&(s=re(s,0,1)),s}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(t,e=mA,n=yA){const i=10000000000000001e-32;let s,a;const o=this.start,c=t.start,l=this.end,h=t.end;Ri.subVectors(l,o),Oi.subVectors(h,c),Tc.subVectors(o,c);const f=Ri.dot(Ri),d=Oi.dot(Oi),m=Oi.dot(Tc);if(f<=i&&d<=i)return e.copy(o),n.copy(c),e.sub(n),e.dot(e);if(f<=i)s=0,a=m/d,a=re(a,0,1);else{const b=Ri.dot(Tc);if(d<=i)a=0,s=re(-b/f,0,1);else{const I=Ri.dot(Oi),B=f*d-I*I;B!==0?s=re((I*m-b*d)/B,0,1):s=0,a=(I*s+m)/d,a<0?(a=0,s=re(-b/f,0,1)):a>1&&(a=1,s=re((I-b)/f,0,1))}}return e.copy(o).add(Ri.multiplyScalar(s)),n.copy(c).add(Oi.multiplyScalar(a)),e.sub(n),e.dot(e)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}function cw(r,t,e,n){const i=gA(n);switch(e){case av:return r*t;case Qd:return r*t/i.components*i.byteLength;case lv:return r*t/i.components*i.byteLength;case uv:return r*t*2/i.components*i.byteLength;case hv:return r*t*2/i.components*i.byteLength;case ov:return r*t*3/i.components*i.byteLength;case Kd:return r*t*4/i.components*i.byteLength;case fv:return r*t*4/i.components*i.byteLength;case dv:case pv:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*8;case mv:case yv:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case _v:case bv:return Math.max(r,16)*Math.max(t,8)/4;case gv:case xv:return Math.max(r,8)*Math.max(t,8)/2;case vv:case Ev:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*8;case Av:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case Tv:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case wv:return Math.floor((r+4)/5)*Math.floor((t+3)/4)*16;case Sv:return Math.floor((r+4)/5)*Math.floor((t+4)/5)*16;case Mv:return Math.floor((r+5)/6)*Math.floor((t+4)/5)*16;case Cv:return Math.floor((r+5)/6)*Math.floor((t+5)/6)*16;case Iv:return Math.floor((r+7)/8)*Math.floor((t+4)/5)*16;case Rv:return Math.floor((r+7)/8)*Math.floor((t+5)/6)*16;case Ov:return Math.floor((r+7)/8)*Math.floor((t+7)/8)*16;case Nv:return Math.floor((r+9)/10)*Math.floor((t+4)/5)*16;case Lv:return Math.floor((r+9)/10)*Math.floor((t+5)/6)*16;case kv:return Math.floor((r+9)/10)*Math.floor((t+7)/8)*16;case Dv:return Math.floor((r+9)/10)*Math.floor((t+9)/10)*16;case Fv:return Math.floor((r+11)/12)*Math.floor((t+9)/10)*16;case Pv:return Math.floor((r+11)/12)*Math.floor((t+11)/12)*16;case zv:case Bv:case Uv:return Math.ceil(r/4)*Math.ceil(t/4)*16;case Gv:case jv:return Math.ceil(r/4)*Math.ceil(t/4)*8;case Vv:case $v:return Math.ceil(r/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${e} format.`)}function gA(r){switch(r){case $c:case qb:return{byteLength:1,components:1};case Qb:case Kb:case ev:return{byteLength:2,components:1};case rv:case nv:return{byteLength:2,components:4};case qd:case tv:case Zc:return{byteLength:4,components:1};case iv:case sv:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Hd}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Hd);const Oa={CAMERA_BASE_FOV:75,CAMERA_MAX_FOV_BOOST:25,CAMERA_SPEED_FOV_FACTOR:5,INITIAL_TRACK_SEGMENT_LENGTH:50,INITIAL_TRACK_SEGMENT_SPACING:2.5,TRACK_SEGMENT_RESOLUTION:100,PARTICLE_COUNT:1e4,PARTICLE_SPAWN_COUNT:200,PARTICLE_BASE_SIZE:.5,CAMERA_NEAR:.1,CAMERA_FAR:2e3,FOG_NEAR:100,FOG_FAR:1e3,AMBIENT_LIGHT_INTENSITY:.4,DIRECTIONAL_LIGHT_INTENSITY:.8,BACKLIGHT_INTENSITY:.3,MAX_DPR:2,FPS_METER_INTERVAL:1e3,GHOST_RIBBON_RADIUS:2,BASS_GLOW_MIN:.1,BASS_GLOW_MAX:1.5,LERP_FACTOR:.15,TRACK_DEFAULT_OPACITY:.9,TRACK_INSIDE_OPACITY:.7,TRACK_OPACITY_LERP_SPEED:2,PLACE_TRACK_UNDER_CAMERA:!1,TRACK_UNDER_CAMERA_VERTICAL_OFFSET:-5,TRACK_RADIUS:.5,PERFORMANCE_CHECK_INTERVAL:5e3,TARGET_FPS:60,LOW_QUALITY_DEBOUNCE_MS:3e3},_A=2.5,lw={DEFAULT_BACKGROUND_TOP_COLOR:"#0a0a1a",DEFAULT_BACKGROUND_BOTTOM_COLOR:"#000000",DEFAULT_FOG_COLOR:"#000000"};class xA{validate(t){if(t.length<2)return!0;for(let e=1;e<t.length;e++)if(e>1){const n=new k().subVectors(t[e-1],t[e-2]).normalize(),i=new k().subVectors(t[e],t[e-1]).normalize();n.dot(i)<.5&&console.warn(`Sharp turn detected at point ${e}`)}return!0}}function Ui(r,t,e=1){const n=t.energy??0,i=t.spectralCentroid??0,s=t.harmonic??0,a=performance.now()*.001;for(let o=0;o<r.length;o++){const c=o/r.length,l=Math.sin(a*2+c*Math.PI*2)*n*.5*e,h=Math.sin(a*1.3+c*Math.PI)*s*.3*e,f=Math.cos(a*1.7+c*Math.PI*2)*(i/8e3)*.2*e;r[o].x+=l+h,r[o].y+=f}}class ys{generate(t,e,n,i){const s=[],a=[],c=Math.max(10,t.length),l=e.clone().add(n.clone().multiplyScalar(c));for(let h=1;h<=100;h++){const f=h/100;s.push(new k().lerpVectors(e,l,f)),a.push(i.clone())}return{points:s,upVectors:a}}}class Ni{generate(t,e,n,i){const s=[],a=[],c=pe.degToRad(pe.clamp(t.angle??15,-90,90)),l=Math.max(10,t.length??50)*1.25,h=n.clone();h.y=0,h.normalize();const f=e.clone().add(h.multiplyScalar(Math.cos(c)*l)).add(new k(0,Math.sin(c)*l,0));for(let d=1;d<=100;d++){const m=d/100;s.push(new k().lerpVectors(e,f,m)),a.push(i.clone())}return{points:s,upVectors:a}}}class Li{generate(t,e,n,i){const s=[],a=[],c=t.height??-50,l=Math.max(10,t.length),h=e.clone().add(n.clone().multiplyScalar(l*.5)).add(new k(0,c*.25,0)),f=e.clone().add(n.clone().multiplyScalar(l)).add(new k(0,c,0)),m=new Kc(e,h,f).getPoints(100);s.push(...m);for(let b=0;b<m.length;b++)a.push(i.clone());return{points:s,upVectors:a}}}class Na{generate(t,e,n,i){const s=[],a=[],c=Math.max(10,t.radius??80),l=pe.degToRad(pe.clamp(t.angle??90,-360,360)),h=t.direction==="left"?1:-1;pe.degToRad(t.banking??0);const f=new k(0,1,0),d=n.clone().cross(f).multiplyScalar(c*h),m=e.clone().add(d),b=e.clone().sub(m);for(let I=1;I<=100;I++){const B=I/100,O=b.clone().applyAxisAngle(f,l*B*-h);s.push(m.clone().add(O)),a.push(i.clone())}return{points:s,upVectors:a}}}class wc{generate(t,e,n,i,s){const a=[],o=[],l=Math.max(10,t.radius??50),h=Math.max(l*1.5,t.length?Math.max(20,Number(t.length)):l*Math.PI*.75),f=e.clone().add(n.clone().multiplyScalar(l));for(let d=1;d<=100;d++){const m=d/100,b=m*Math.PI*2,I=i.clone().multiplyScalar(Math.sin(b)*l),B=n.clone().multiplyScalar(-Math.cos(b)*l+m*h),O=f.clone().add(I).add(B);a.push(O),o.push(i.clone())}return s&&Ui(a,s),{points:a,upVectors:o}}}class ki{generate(t,e,n,i,s){const a=[],o=[],l=Math.max(1,Math.round(t.rotations??1)),h=Math.max(10,t.length??150),f=e.clone().add(n.clone().multiplyScalar(h));for(let d=1;d<=100;d++){const m=d/100,b=m*Math.PI*2*l;a.push(new k().lerpVectors(e,f,m)),o.push(i.clone().applyAxisAngle(n,b))}return s&&Ui(a,s),{points:a,upVectors:o}}}class uw{constructor(){Br(this,"segmentGenerators");Br(this,"validator");this.segmentGenerators=new Map,this.validator=new xA,this.segmentGenerators.set("straight",new ys),this.segmentGenerators.set("gentle_curve",new Na),this.segmentGenerators.set("banking_turn",new Na),this.segmentGenerators.set("gentle_hill",new Ni),this.segmentGenerators.set("steep_climb",new Ni),this.segmentGenerators.set("launch_hill",new Ni),this.segmentGenerators.set("airtime_hill",new Ni),this.segmentGenerators.set("bunny_hop",new Ni),this.segmentGenerators.set("gentle_drop",new Li),this.segmentGenerators.set("steep_drop",new Li),this.segmentGenerators.set("vertical_drop",new Li),this.segmentGenerators.set("spiral_drop",new Li),this.segmentGenerators.set("curved_drop",new Li),this.segmentGenerators.set("vertical_loop",new wc),this.segmentGenerators.set("horizontal_loop",new wc),this.segmentGenerators.set("corkscrew",new ki),this.segmentGenerators.set("cobra_roll",new ki),this.segmentGenerators.set("barrel_roll",new ki),this.segmentGenerators.set("heartline_roll",new ki),this.segmentGenerators.set("double_down",new Li),this.segmentGenerators.set("double_up",new Ni),this.segmentGenerators.set("s_curve",new Na),this.segmentGenerators.set("helix",new Na),this.segmentGenerators.set("twisted_element",new ki),this.segmentGenerators.set("launch_section",new ys),this.segmentGenerators.set("brake_run",new ys),this.segmentGenerators.set("speed_boost",new ys),this.segmentGenerators.set("zero_g_roll",new ki),this.segmentGenerators.set("pretzel_knot",new wc),this.segmentGenerators.set("flying_element",new ys)}compose(t,e){const n=[],i=[];let s=new k(0,5,0),a=new k(0,0,-1),o=new k(0,1,0);for(let d=0;d<10;d++)n.push(s.clone()),i.push(o.clone()),s.add(a);let c=[];const l=[];for(const d of t.track){const m=this.segmentGenerators.get(d.component);if(m){const b=n.length;let{points:I,upVectors:B}=m.generate(d,s,a,o);c.length>0&&(I=this.blendSegments(c,I)),n.push(...I),i.push(...B),I.length>0&&(s=I[I.length-1],I.length>1&&a.subVectors(I[I.length-1],I[I.length-2]).normalize(),o=B[B.length-1],c=I),l.push({start:b,end:n.length-1})}}this.validator.validate(n);const h=Math.max(n.length-1,1),f=l.map(d=>{const m=d.end/h;return Number.isFinite(m)?pe.clamp(m,0,1):0});return{path:n,upVectors:i,railColor:t.palette[0]||"#ffffff",glowColor:t.palette[1]||"#00ffff",skyColor1:t.palette[2]||"#0d0a1f",skyColor2:"#000000",segmentDetails:t.track,segmentProgress:f,rideName:t.rideName,moodDescription:t.moodDescription,frameAnalyses:e.frameAnalyses,audioFeatures:e,events:[],synesthetic:null}}blendSegments(t,e){if(t.length===0||e.length===0)return e;const n=5,i=t[t.length-1];e[0];for(let s=1;s<=n&&!(s>=e.length);s++){const a=s/(n+1);e[s].lerpVectors(i,e[s],a)}return e}}const bA=r=>{if(typeof r!="string")return"unknown";const t=r.trim().toLowerCase();return t==="climb"||t.startsWith("climb")?"climb":t==="drop"||t.startsWith("drop")?"drop":t==="turn"||t.startsWith("turn")?"turn":t==="loop"||t.includes("loop")?"loop":t==="barrelroll"||t==="barrel_roll"||t==="barrel roll"||t==="roll"||t.includes("roll")?"barrelRoll":"unknown"},Tr=(r,t)=>Number.isFinite(r)?pe.clamp(r,0,1):pe.clamp(t,0,1),vA=r=>{if(!r||typeof r!="object")return null;const t=r;let e=null;if(t.geometry&&typeof t.geometry=="object"){const s=t.geometry,a=typeof s.breathingDriver=="string"?s.breathingDriver.toString().toLowerCase():void 0;e={wireframeDensity:Number.isFinite(s.wireframeDensity)?Tr(s.wireframeDensity,.55):void 0,impossiblePhysics:typeof s.impossiblePhysics=="object"&&s.impossiblePhysics!==null?{enabled:typeof s.impossiblePhysics.enabled=="boolean"?s.impossiblePhysics.enabled:!1,intensity:Number.isFinite(s.impossiblePhysics.intensity)?Tr(s.impossiblePhysics.intensity,.5):void 0,frequency:Number.isFinite(s.impossiblePhysics.frequency)?Math.max(.1,s.impossiblePhysics.frequency):void 0}:void 0,organicBreathing:Number.isFinite(s.organicBreathing)?Tr(s.organicBreathing,.4):void 0,breathingDriver:a==="energy"||a==="spectralflux"||a==="spectralcentroid"?a==="spectralflux"?"spectralFlux":a==="spectralcentroid"?"spectralCentroid":"energy":void 0}}let n=null;if(t.particles&&typeof t.particles=="object"){const s=t.particles;n={connectionDensity:Number.isFinite(s.connectionDensity)?Tr(s.connectionDensity,.45):void 0,resonanceThreshold:Number.isFinite(s.resonanceThreshold)?Tr(s.resonanceThreshold,.4):void 0,lifespanSeconds:Number.isFinite(s.lifespanSeconds)?Math.max(0,s.lifespanSeconds):void 0,persistence:Number.isFinite(s.persistence)?Tr(s.persistence,.5):void 0}}let i=null;if(t.atmosphere&&typeof t.atmosphere=="object"){const s=t.atmosphere;i={skyMood:typeof s.skyMood=="string"?s.skyMood:void 0,turbulenceBias:Number.isFinite(s.turbulenceBias)?s.turbulenceBias:void 0,passionIntensity:Number.isFinite(s.passionIntensity)?Math.max(0,s.passionIntensity):void 0,tint:typeof s.tint=="string"?s.tint:void 0}}return!e&&!n&&!i?null:{geometry:e,particles:n,atmosphere:i}},od=r=>{if(r.length<2)return 0;let t=0;for(let e=1;e<r.length;e++)t+=r[e].distanceTo(r[e-1]);return t},cd=18,ld=24,ud=12,hd=16,EA=.55,AA=.4,fd=Math.PI/4,TA=(r,t,e)=>{const i=[],s=[],a=[],o=[],c=[],l=vA(r.synesthetic),h=(l==null?void 0:l.geometry)??null;let f=new k(0,5,0),d=new k(0,0,-1),m=new k(0,1,0);const b=(kt,Vt)=>{if(!kt||kt.length===0)return null;const ne=i.length;return i.push(...kt),s.push(...Vt),f=kt[kt.length-1],kt.length>1&&d.subVectors(kt[kt.length-1],kt[kt.length-2]).normalize(),m=Vt[Vt.length-1],{start:ne,end:i.length-1}},I=[],B=[],O=Math.max(1,Math.floor(Number(Oa.INITIAL_TRACK_SEGMENT_LENGTH)||0));let ut=Number(Oa.INITIAL_TRACK_SEGMENT_SPACING)*1.25;(!isFinite(ut)||ut<0)&&(ut=_A);for(let kt=0;kt<O;kt++)I.push(f.clone().add(d.clone().multiplyScalar(kt*ut))),B.push(m.clone());const X=b(I,B);X&&o.push(X),c.push({index:-1,component:"initial",computedLength:od(I),sampleCount:I.length,source:{spacing:ut,samples:O}}),a.push({intensity:0,lightingEffect:"none",environmentChange:"none",audioSyncPoint:ka(0)}),r.track.forEach((kt,Vt)=>{const ne=[],xe=[],fe=Math.max(1,Math.floor(Oa.TRACK_SEGMENT_RESOLUTION)),Te=kt.component??kt.type,le=bA(Te),Ft={},qt=me.getState().breathingIntensity??1;switch(le){case"climb":case"drop":{const se=kt,ye=se.angle??(le==="climb"?15:-40),Se=pe.degToRad(pe.clamp(ye,-90,90));Ft.length=se.length,Ft.angle=ye;const er=se.length??150,He=Math.max(10,er)*1.25,Ve=d.clone();Ve.y=0,Ve.normalize();const rr=f.clone().add(Ve.multiplyScalar(Math.cos(Se)*He)).add(new k(0,Math.sin(Se)*He,0));for(let Ye=1;Ye<=fe;Ye++){const cr=Ye/fe;ne.push(new k().lerpVectors(f,rr,cr)),xe.push(m.clone())}t&&Ui(ne,t,qt);break}case"turn":{const se=kt,ye=se.radius??80,Se=Math.max(10,ye)*1.25,er=se.angle??90,He=pe.degToRad(pe.clamp(er,-360,360));Ft.radius=se.radius,Ft.angle=er,Ft.direction=se.direction,Ft.length=kt.length;const Ve=se.direction==="left"?1:-1,rr=new k(0,1,0),Ye=d.clone().cross(rr).multiplyScalar(Se*Ve),cr=f.clone().add(Ye),ir=f.clone().sub(cr);for(let Xe=1;Xe<=fe;Xe++){const an=Xe/fe,on=ir.clone().applyAxisAngle(rr,He*an*-Ve);ne.push(cr.clone().add(on)),xe.push(m.clone())}t&&Ui(ne,t,qt);break}case"loop":{const se=kt,ye=se.radius??50,Se=Math.max(10,ye)*1.25,er=Math.max(Se*1.5,se.length?Math.max(20,Number(se.length))*1.25:Se*Math.PI*.75);Ft.radius=se.radius,Ft.length=se.length;const He=f.clone().add(d.clone().multiplyScalar(Se));for(let Ve=1;Ve<=fe;Ve++){const rr=Ve/fe,Ye=rr*Math.PI*2,cr=m.clone().multiplyScalar(Math.sin(Ye)*Se),ir=d.clone().multiplyScalar(-Math.cos(Ye)*Se+rr*er),Xe=He.clone().add(cr).add(ir);ne.push(Xe),xe.push(m.clone())}t&&Ui(ne,t,qt);break}case"barrelRoll":{const se=kt,ye=se.rotations??1,Se=Math.max(1,Math.round(ye));Ft.length=se.length,Ft.rotations=ye;const er=se.length??150,He=Math.max(10,er)*1.25,Ve=f.clone().add(d.clone().multiplyScalar(He));for(let rr=1;rr<=fe;rr++){const Ye=rr/fe,cr=Ye*Math.PI*2*Se;ne.push(new k().lerpVectors(f,Ve,Ye)),xe.push(m.clone().applyAxisAngle(d,cr))}t&&Ui(ne,t,qt);break}case"unknown":{console.warn("[TrackBuilder] Unsupported segment component, using straight fallback",{index:Vt,component:Te});const se=Math.max(10,kt.length??80)*1.25;Ft.length=kt.length;for(let ye=1;ye<=fe;ye++){const Se=ye/fe;ne.push(f.clone().add(d.clone().multiplyScalar(Se*se))),xe.push(m.clone())}break}}const be=od(ne),Fe=b(ne,xe);Fe?o.push(Fe):o.length>0?o.push(o[o.length-1]):o.push({start:0,end:i.length>0?i.length-1:0}),c.push({index:Vt,component:le,computedLength:be,sampleCount:ne.length,source:Ft}),a.push({intensity:kt.intensity??0,lightingEffect:kt.lightingEffect,environmentChange:kt.environmentChange,audioSyncPoint:kt.audioSyncPoint})}),i.length>2&&wA(i,s,t,h);const et=Math.max(i.length-1,1),q=o.map(kt=>{const Vt=kt.end/et;return Number.isFinite(Vt)?pe.clamp(Vt,0,1):0});let At=0,Ot=Number.POSITIVE_INFINITY,wt=Number.POSITIVE_INFINITY,Gt=Number.POSITIVE_INFINITY,Jt=Number.NEGATIVE_INFINITY,ae=Number.NEGATIVE_INFINITY,he=Number.NEGATIVE_INFINITY;for(let kt=0;kt<i.length;kt++){const Vt=i[kt];kt>0&&(At+=Vt.distanceTo(i[kt-1])),Vt.x<Ot&&(Ot=Vt.x),Vt.y<wt&&(wt=Vt.y),Vt.z<Gt&&(Gt=Vt.z),Vt.x>Jt&&(Jt=Vt.x),Vt.y>ae&&(ae=Vt.y),Vt.z>he&&(he=Vt.z)}return console.log("[TrackBuilder] Generated track geometry",{pointCount:i.length,segmentCount:r.track.length,segmentProgress:q,metrics:{totalApproxLength:Number(At.toFixed(1)),bounds:{x:[Number(Ot.toFixed(2)),Number(Jt.toFixed(2))],y:[Number(wt.toFixed(2)),Number(ae.toFixed(2))],z:[Number(Gt.toFixed(2)),Number(he.toFixed(2))],span:{x:Number((Jt-Ot).toFixed(2)),y:Number((ae-wt).toFixed(2)),z:Number((he-Gt).toFixed(2))}},perSegment:c}}),{path:i,upVectors:s,railColor:r.palette[0]||"#ffffff",glowColor:r.palette[1]||"#00ffff",skyColor1:r.palette[2]||"#0d0a1f",skyColor2:Oa.DEFAULT_SKY_COLOR_2,segmentDetails:a,segmentProgress:q,rideName:r.rideName,moodDescription:r.moodDescription,frameAnalyses:t&&t.frameAnalyses||[],audioFeatures:t||{duration:ka(0),bpm:120,energy:0,spectralCentroid:0,spectralFlux:0,frameAnalyses:[]},events:Array.isArray(r.events)?r.events:[],synesthetic:l}},wA=(r,t,e,n)=>{var fe,Te,le;if(!e){dd(r,t,n);return}const i=e.frameAnalyses||[];if(!i.length){dd(r,t,n);return}const s=r.map(Ft=>Ft.clone()),a=t.map(Ft=>Ft.clone()),o=Tr(n==null?void 0:n.wireframeDensity,.55),c=Tr(n==null?void 0:n.organicBreathing,.4),l=!!((fe=n==null?void 0:n.impossiblePhysics)!=null&&fe.enabled),h=Tr((Te=n==null?void 0:n.impossiblePhysics)==null?void 0:Te.intensity,.5),f=((le=n==null?void 0:n.impossiblePhysics)==null?void 0:le.frequency)??1,d=(n==null?void 0:n.breathingDriver)??"energy",b=(Number.isFinite(e.bpm)?Math.max(30,e.bpm||120):120)/60*.5,I=28+o*45,B=24+c*36,O=new k(0,1,0),ut=new k,X=new k,et=new k,q=new k,At=new k,Ot=new k;new k;let wt=0,Gt=0,Jt=0;const ae=i.length,he=i.reduce((Ft,qt)=>Math.max(Ft,qt.energy),0)||1,kt=i.reduce((Ft,qt)=>Math.max(Ft,qt.spectralFlux),0)||1,Vt=i.reduce((Ft,qt)=>Math.max(Ft,qt.spectralCentroid),0)||1,ne=(Ft,qt)=>{if(ae===1)return i[0][qt];const be=pe.clamp(Ft,0,1)*(ae-1),Fe=Math.floor(be),se=Math.min(ae-1,Fe+1),ye=be-Fe,Se=i[Fe][qt],er=i[se][qt];return pe.lerp(Se,er,ye)},xe=pe.clamp(EA+c*.15,.35,.72);for(let Ft=1;Ft<r.length-1;Ft++){const qt=Ft/(r.length-1),be=pe.smoothstep(qt,.05,.95),Fe=ne(qt,"energy")/he*be,se=ne(qt,"spectralFlux")/kt*be,ye=ne(qt,"spectralCentroid")/Vt*be,Se=d==="spectralFlux"?se:d==="spectralCentroid"?ye:Fe,er=s[Ft-1],He=s[Ft],Ve=s[Ft+1];if(ut.copy(er),X.copy(Ve),et.copy(Ve).sub(er),et.lengthSq()<1e-6)continue;et.normalize(),q.crossVectors(et,O),q.lengthSq()<1e-6?q.set(1,0,0):q.normalize();const rr=2.6+o*3.2,Ye=Math.sin(qt*Math.PI*rr+se*(5+o*3.2)),cr=Math.cos(qt*Math.PI*(2.4+o*.8)+ye*(3.5+o*2.4));let ir=Ye*se*(8+o*6),Xe=cr*Fe*(10+c*6.5);const an=Ye*.22*se+ye*.14,on=Math.sin(qt*Math.PI*1.1)*I*be,$i=Math.cos(qt*Math.PI*.7+se*1.8)*B*be;if(ir+=on,Xe+=$i*.75,c>.001){const Vr=qt*Math.PI*2*b,Mn=Math.sin(Vr+Se*Math.PI*1.5)*c*(7.5+o*4)*be,Pt=Math.cos(Vr*.65+se*2)*c*ye*(5+o*3.2)*be;Xe+=Mn,ir+=Pt}if(l){const Vr=Math.sin(qt*Math.PI*(3.6*f+o*3)+Fe*5)*se,$r=Math.cos(qt*Math.PI*2.6*f+ye*3.6)*Fe;Xe+=Vr*2.4*h,ir+=$r*2.1*h}ir=pe.clamp(ir,-cd,cd),Xe=pe.clamp(Xe,-ld,ld),wt=pe.lerp(wt,ir,.08),Gt=pe.lerp(Gt,Xe,.09),Jt=pe.lerp(Jt,an,.14),Ot.copy(He).addScaledVector(q,wt).addScaledVector(O,Gt),r[Ft].lerpVectors(He,Ot,xe);const nr=pe.clamp(Jt,-fd,fd);At.copy(O).applyAxisAngle(et,nr).normalize(),t[Ft].copy(a[Ft]).lerp(At,xe*.6).normalize()}},dd=(r,t,e)=>{var q,At,Ot;if(r.length<3)return;const n=r.map(wt=>wt.clone()),i=t.map(wt=>wt.clone()),s=new k(0,1,0),a=new k,o=new k,c=new k,l=new k,h=new k;let f=0,d=0;const m=Tr(e==null?void 0:e.wireframeDensity,.45),b=Tr(e==null?void 0:e.organicBreathing,.35),I=!!((q=e==null?void 0:e.impossiblePhysics)!=null&&q.enabled),B=Tr((At=e==null?void 0:e.impossiblePhysics)==null?void 0:At.intensity,.5),O=((Ot=e==null?void 0:e.impossiblePhysics)==null?void 0:Ot.frequency)??1,ut=22+m*34,X=18+b*28,et=pe.clamp(AA+b*.2,.25,.55);for(let wt=1;wt<r.length-1;wt++){const Gt=wt/(r.length-1),Jt=pe.smoothstep(Gt,.05,.95),ae=Math.sin(Gt*Math.PI*(1.8+m*1.4))*Jt,he=Math.cos(Gt*Math.PI*1.4)*b*Jt,kt=Math.sin(Gt*Math.PI*.85)*ut*Jt,Vt=Math.cos(Gt*Math.PI*.7)*X*Jt,ne=ae+he*.55,xe=n[wt-1],fe=n[wt],Te=n[wt+1];if(a.copy(xe),o.copy(Te),c.copy(Te).sub(xe),c.lengthSq()<1e-6)continue;c.normalize(),l.crossVectors(c,s),l.lengthSq()<1e-6?l.set(1,0,0):l.normalize();let le=ne*(5.5+m*3.4)+kt,Ft=ne*(7.5+b*3.6)+Vt*.7;I&&(le+=Math.cos(Gt*Math.PI*3.4*O)*2*Jt*B,Ft+=Math.sin(Gt*Math.PI*3.8*O)*2.2*Jt*B),le=pe.clamp(le,-ud,ud),Ft=pe.clamp(Ft,-hd,hd),f=pe.lerp(f,le,.12),d=pe.lerp(d,Ft,.12),h.copy(fe).addScaledVector(l,f).addScaledVector(s,d),r[wt].lerpVectors(fe,h,et),t[wt].copy(i[wt]).lerp(s,et*.5).normalize()}};var pd={};function SA(r,t){if(!t)throw new Error(`Missing required environment variable: ${r}. Please check your .env file.`);return t}function MA(r,t,e=!1){return t?t.toLowerCase()==="true":e}function vn(r){try{if(typeof process<"u"&&pd){const t=pd[r];if(typeof t<"u"&&t!==null&&t!=="")return String(t)}}catch{}try{const t=globalThis.__import_meta_env__;if(t&&typeof t[r]<"u"&&t[r]!==null&&t[r]!=="")return String(t[r])}catch{}}const CA={development:{NODE_ENV:"development",VITE_BACKEND_URL:"http://localhost:8000",VITE_DEV_PORT:"5173",VITE_PROD_URL:"http://localhost:5173",VITE_DEBUG:"true"},production:{NODE_ENV:"production",VITE_BACKEND_URL:vn("VITE_BACKEND_URL")||"https://your-production-backend.com",VITE_DEV_PORT:"5173",VITE_PROD_URL:vn("VITE_PROD_URL")||"https://your-production-frontend.com",VITE_DEBUG:"false"},test:{NODE_ENV:"test",VITE_BACKEND_URL:"http://localhost:8000",VITE_DEV_PORT:"5173",VITE_PROD_URL:"http://localhost:5173",VITE_DEBUG:"false"}};function IA(){const t=vn("NODE_ENV")||vn("MODE")||"development";return["development","production","test"].includes(t)?t:(console.warn(`Unknown environment "${t}", defaulting to development`),"development")}function RA(){const r=IA(),t=CA[r];return{NODE_ENV:r,VITE_BACKEND_URL:SA("VITE_BACKEND_URL",vn("VITE_BACKEND_URL")||t.VITE_BACKEND_URL),VITE_DEV_PORT:vn("VITE_DEV_PORT")||t.VITE_DEV_PORT,VITE_PROD_URL:vn("VITE_PROD_URL")||t.VITE_PROD_URL,VITE_DEBUG:vn("VITE_DEBUG")||t.VITE_DEBUG}}const Ur=RA(),hp=()=>Ur.NODE_ENV==="development",fp=()=>MA("VITE_DEBUG",Ur.VITE_DEBUG,!1);hp()&&fp()&&console.log("[Environment Config]",{environment:Ur.NODE_ENV,backendUrl:Ur.VITE_BACKEND_URL,devPort:Ur.VITE_DEV_PORT,prodUrl:Ur.VITE_PROD_URL,debug:Ur.VITE_DEBUG});const OA=async(r,t)=>{var f;const{setStatus:e,setTrackData:n,setError:i}=me.getState().actions,s=t==null?void 0:t.signal;console.log("[Workflow] Starting audio processing workflow",{fileName:r.name,fileSize:r.size,fileType:r.type,hasExternalSignal:!!s,externalSignalAborted:s==null?void 0:s.aborted});const a=()=>{if(s!=null&&s.aborted)throw console.log("[Workflow] External signal aborted, throwing AbortError"),new DOMException("Aborted","AbortError")},o=new AbortController,c=setTimeout(()=>{console.log("[Workflow] Timeout fired, aborting controller"),o.abort(),i({title:"Processing Timeout",message:"The audio analysis is taking longer than expected. Please try a different file or check the server status."})},6e4),l=()=>{console.log("[Workflow] External signal aborted, cleaning up"),clearTimeout(c),o.signal.aborted||o.abort()},h=()=>{console.log("[Workflow] Internal controller aborted, cleaning up"),clearTimeout(c)};s==null||s.addEventListener("abort",l),o.signal.addEventListener("abort",h);try{a();const{setWorkflowProgress:d,setGenerationProgress:m}=me.getState().actions;d(10),m(0),e(ue.Generating,"Translating sound into structure..."),a(),console.log("[Workflow] Calling generateRideBlueprint with file:",r.name);try{const At=(globalThis==null?void 0:globalThis.BACKEND_URL)||(Ur==null?void 0:Ur.VITE_BACKEND_URL)||"unknown";console.debug("[Workflow] Backend URL (effective):",At)}catch{}const{blueprint:b,features:I}=await $b(r,o.signal,t==null?void 0:t.generationOptions);console.log("[Workflow] Successfully received blueprint and audio features"),console.log("[Workflow] Blueprint data:",{hasBlueprintProp:!!b,blueprintType:typeof b,hasTrack:!!(b!=null&&b.track),trackLength:(f=b==null?void 0:b.track)==null?void 0:f.length,blueprintKeys:b?Object.keys(b):[]}),clearTimeout(c),console.log("[Workflow] Timeout cleared successfully"),a(),d(60),m(50),e(ue.Generating,"Refining for physical plausibility..."),a(),console.log("[Workflow] Refining blueprint...");const B=Hb(b);let O=null;const ut=2500,X=8e3;try{const{setSkyboxUrl:At}=me.getState().actions;try{At(null)}catch{}const Ot=B.moodDescription||B.rideName||"A surreal and cinematic sky",wt={...B,generationOptions:(t==null?void 0:t.generationOptions)??me.getState().generationOptions};try{O=Zb(Ot,wt).then(Gt=>{try{At(Gt)}catch{}return Gt}).catch(Gt=>(console.info("[Workflow] Early skybox generation failed, continuing without custom skybox:",Gt instanceof Error?Gt.message:String(Gt)),null))}catch(Gt){console.info("[Workflow] Failed to start early skybox generation",Gt),O=null}if(O)try{await Promise.race([O,new Promise(Jt=>setTimeout(()=>Jt(null),ut))])&&console.log("[Workflow] Skybox finished during build fast-path")}catch{}}catch(At){console.info("[Workflow] Skybox pre-generation step encountered an error, continuing",At),O=null}try{console.log("[Workflow] Refined segment components",B.track.map((At,Ot)=>({index:Ot,component:At.component})))}catch{}a(),d(85),m(75),e(ue.Generating,"Constructing ephemeral cathedral..."),a(),console.log("[Workflow] Building track data...");const{setBlueprint:et,setAudioFeatures:q}=me.getState().actions;et(B),q(I),a(),d(100),console.log("[Workflow] Building track data object and storing in app state");try{const At=TA(B,I);a();const{setTrackData:Ot}=me.getState().actions;Ot(At),console.log("[Workflow] Track data set in store (points:",At.path.length,"segments:",At.segmentDetails.length,")")}catch(At){console.warn("[Workflow] Failed to build track data, aborting Ready transition",At),i({title:"Track Build Failed",message:"Could not construct track geometry from blueprint."});return}try{if(O){const{setSkyboxUrl:At}=me.getState().actions;(async()=>{try{console.log("[Workflow] Background-waiting up to",X,"ms for skybox");const Ot=await Promise.race([O,new Promise(wt=>setTimeout(()=>wt(null),X))]);if(Ot){console.log("[Workflow] Skybox generation completed (background)");try{At(Ot)}catch{}}else console.log("[Workflow] Skybox did not finish within background max wait, continuing without it")}catch(Ot){console.info("[Workflow] Background skybox waiter failed, continuing",Ot)}})()}}catch(At){console.info("[Workflow] Skybox background scheduling failed, continuing",At)}console.log("[Workflow] Setting status to Ready"),e(ue.Ready)}catch(d){if(d instanceof DOMException&&d.name==="AbortError"){console.log("Audio processing was aborted.");return}const m=d instanceof Error?d.message:typeof d=="string"?d:"An unknown error occurred during processing.";console.error("Error in audio processing workflow:",m),i({title:"Could Not Process Audio",message:`An error occurred while processing '${r.name}'. ${m}`})}},NA=()=>{const r=me(e=>e.audioFile),t=me(e=>e.generationOptions);Rt.useEffect(()=>{if(!r)return;const e=new AbortController;return OA(r,{generationOptions:t,signal:e.signal}),()=>{console.log("Cancelling previous audio processing workflow."),e.abort()}},[r,t])},Gr={shaders:new Map,lygiaResolver:null,webglContext:null,audioContext:null};let md=!1;const yd=[];async function LA(){const t=["/shaders/velFrag.resolved.glsl","/shaders/posFrag.resolved.glsl","/shaders/baseVelFrag.glsl","/shaders/basePosFrag.glsl"].map(async e=>{try{const n=await fetch(e);if(n.ok){const i=await n.text();Gr.shaders.set(e,i),console.log(`[Preloader] Cached shader: ${e}`)}}catch(n){console.debug(`[Preloader] Could not preload ${e}`,n)}});await Promise.allSettled(t)}async function kA(){try{try{const n=await import(window.location.origin+"/lygia/resolve.esm.js");if(Gr.lygiaResolver=n&&(n.default||n.resolveLygia||n.resolve)?n.default||n.resolveLygia||n.resolve:null,Gr.lygiaResolver){console.log("[Preloader] Cached LYGIA resolver (local)");return}}catch{}const t=await import("https://lygia.xyz/resolve.esm.js");Gr.lygiaResolver=t&&(t.default||t.resolveLygia||t.resolve)?t.default||t.resolveLygia||t.resolve:null,Gr.lygiaResolver&&console.log("[Preloader] Cached LYGIA resolver (CDN)")}catch(r){console.debug("[Preloader] Could not preload LYGIA resolver",r)}}function DA(){try{const r=document.createElement("canvas");r.width=1,r.height=1;const t=r.getContext("webgl2",{alpha:!0,antialias:!0,premultipliedAlpha:!1})||r.getContext("webgl",{alpha:!0,antialias:!0,premultipliedAlpha:!1});t&&(Gr.webglContext=t,t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.getExtension&&(t.getExtension("EXT_color_buffer_float"),t.getExtension("OES_texture_float_linear")),console.log("[Preloader] WebGL context initialized"))}catch(r){console.debug("[Preloader] Could not preload WebGL context",r)}}function FA(){try{const r=window.AudioContext||window.webkitAudioContext;r&&(Gr.audioContext=new r,Gr.audioContext.suspend(),console.log("[Preloader] AudioContext initialized (suspended)"))}catch(r){console.debug("[Preloader] Could not preload AudioContext",r)}}function PA(){md||(md=!0,console.log("[Preloader] Starting resource preload..."),yd.push(LA(),kA()),DA(),FA(),Promise.allSettled(yd).then(()=>{console.log("[Preloader] All preload operations completed")}))}function hw(r){return Gr.shaders.get(r)||null}function fw(){return Gr.lygiaResolver}const zA=()=>{Rt.useEffect(()=>{PA()},[]),NA()},BA=(r,t)=>({timestamp:ka(r),energy:t.energy,spectralCentroid:t.spectralCentroid,spectralFlux:t.spectralFlux,bass:t.bass,mid:t.mid,high:t.high,sampleRate:typeof t.sampleRate=="number"?t.sampleRate:44100,channelCount:typeof t.channelCount=="number"?t.channelCount:1,frame:t.frame}),tl=()=>{try{return typeof globalThis.AudioWorkletNode<"u"}catch{return!1}},UA=()=>`
  class SimpleAnalyzerProcessor extends AudioWorkletProcessor {
    constructor() {
      super();
      this._prevMagnitudes = null;
      this.port.onmessage = (ev) => {};
      // Beat detection state
      this._lastBeatTime = 0;
      this._beatHistory = [];
      this._bpm = 0;
    }

    _fft(re, im) {
      const n = re.length;
      const levels = Math.floor(Math.log2(n));
      for (let i = 0; i < n; i++) {
        let j = 0;
        for (let k = 0; k < levels; k++) j = (j << 1) | ((i >> k) & 1);
        if (j > i) { const tr = re[i]; re[i] = re[j]; re[j] = tr; const ti = im[i]; im[i] = im[j]; im[j] = ti; }
      }
      for (let size = 2; size <= n; size <<= 1) {
        const half = size >> 1;
        const theta = -2 * Math.PI / size;
        const wMulRe = Math.cos(theta);
        const wMulIm = Math.sin(theta);
        for (let i = 0; i < n; i += size) {
          let wr = 1.0, wi = 0.0;
          for (let j = 0; j < half; j++) {
            const idx1 = i + j; const idx2 = i + j + half;
            const tr = wr * re[idx2] - wi * im[idx2];
            const ti = wr * im[idx2] + wi * re[idx2];
            re[idx2] = re[idx1] - tr; im[idx2] = im[idx1] - ti;
            re[idx1] = re[idx1] + tr; im[idx1] = im[idx1] + ti;
            const newWr = wr * wMulRe - wi * wMulIm;
            const newWi = wr * wMulIm + wi * wMulRe;
            wr = newWr; wi = newWi;
          }
        }
      }
    }

    process(inputs, outputs) {
      try {
        const input = inputs[0];
        const output = outputs[0];
        if (!input || !input[0]) return true;
  const frame = input[0]; const N = frame.length;
        let energy = 0; for (let i = 0; i < N; i++) energy += frame[i]*frame[i]; energy = energy / N;
        const re = new Float32Array(N); const im = new Float32Array(N);
        for (let i = 0; i < N; i++) { re[i] = frame[i]; im[i] = 0.0; }
        this._fft(re, im);
        const half = N >> 1; const mags = new Float32Array(half);
        for (let k = 0; k < half; k++) { const r = re[k]; const i2 = im[k]; mags[k] = Math.hypot(r, i2); }
        let num = 0, den = 0; for (let k = 0; k < mags.length; k++) { num += k * mags[k]; den += mags[k]; }
        const spectralCentroid = den > 0 ? num / den : 0;
        let flux = 0; if (this._prevMagnitudes) { const L = Math.min(this._prevMagnitudes.length, mags.length); for (let k = 0; k < L; k++) { const d = mags[k] - this._prevMagnitudes[k]; flux += d > 0 ? d : 0; } }
        const bassRange = Math.floor(mags.length * 0.15); const midRange = Math.floor(mags.length * 0.6);
        let bass = 0, mid = 0, high = 0; for (let k = 0; k < mags.length; k++) { if (k < bassRange) bass += mags[k]; else if (k < midRange) mid += mags[k]; else high += mags[k]; }
        const total = bass + mid + high || 1; bass /= total; mid /= total; high /= total;
        this._prevMagnitudes = mags;

        // Beat detection
        const beatThreshold = 0.15 + bass * 0.1;
        let isBeat = false;
        if (bass > beatThreshold && (currentTime - this._lastBeatTime) > 0.3) {
          isBeat = true;
          this._lastBeatTime = currentTime;

          // BPM calculation
          if (this._beatHistory.length >= 20) {
            this._beatHistory.shift();
          }
          this._beatHistory.push(currentTime);
          if (this._beatHistory.length > 1) {
            const intervals = [];
            for (let i = 1; i < this._beatHistory.length; i++) {
              intervals.push(this._beatHistory[i] - this._beatHistory[i-1]);
            }
            const averageInterval = intervals.reduce((a, b) => a + b) / intervals.length;
            const calculatedBpm = 60 / averageInterval;
            if (calculatedBpm > 60 && calculatedBpm < 200) {
              this._bpm = calculatedBpm;
            }
          }
        }

        const frameCopy = frame.slice();
        this.port.postMessage(
          {
            type: 'analysis',
            timestamp: currentTime,
            energy: energy,
            spectralCentroid: spectralCentroid,
            spectralFlux: flux,
            bass: bass,
            mid: mid,
            high: high,
            isBeat: isBeat,
            bpm: this._bpm,
            frame: frameCopy,
            sampleRate: sampleRate,
            channelCount: input.length,
          },
          [frameCopy.buffer]
        );
        if (output) {
          const channelCount = Math.min(output.length, input.length);
          for (let ch = 0; ch < channelCount; ch++) {
            output[ch].set(input[ch]);
          }
        }
      } catch (e) {}
      return true;
    }
  }
  registerProcessor('simple-analyzer-processor', SimpleAnalyzerProcessor);
`,GA=async r=>{if(!tl())return Promise.resolve();const t="/worklets/analyzer-processor.js";try{await r.audioWorklet.addModule(t);return}catch(s){console.info("[audioWorklet] static module load failed, falling back to inline blob",s&&s.message?s.message:s)}const e=`
  ${UA()}
  `,n=new Blob([e],{type:"application/javascript"}),i=URL.createObjectURL(n);try{await r.audioWorklet.addModule(i)}finally{try{URL.revokeObjectURL(i)}catch{}}},gd=r=>{try{return tl()?new AudioWorkletNode(r,"simple-analyzer-processor"):null}catch(t){return console.warn("[audioWorklet] createWorkletNode failed",t),null}},dp=async r=>{if(!tl())return null;try{if(await GA(r),typeof gd=="function")return gd(r);try{return new AudioWorkletNode(r,"simple-analyzer-processor")}catch(t){return console.warn("[audioProcessor] direct AudioWorkletNode creation failed",t),null}}catch(t){return console.warn("[audioProcessor] createWorkletAnalyzerForContext failed",t),null}};class jA{constructor(){Br(this,"audioContext",null);Br(this,"workletNode",null);Br(this,"sourceNode",null);Br(this,"isDisposing",!1);Br(this,"isDisposed",!1)}async initialize(t){if(this.isDisposing||this.isDisposed)throw new Error("Cannot initialize a disposed or disposing audio processor.");this.audioContext&&await this.dispose();const e=new(window.AudioContext||window.webkitAudioContext);this.audioContext=e;try{e.state==="suspended"&&await e.resume();const n=e.createMediaElementSource(t);this.sourceNode=n;const i=await dp(e);this.workletNode=i,i?(n.connect(i),i.connect(e.destination)):n.connect(e.destination)}catch(n){throw console.error("[LiveAudioProcessor] Initialization failed:",n),await this.dispose(),n}}async dispose(){if(this.isDisposing||this.isDisposed)return;this.isDisposing=!0;const t=[],e=(n,i)=>{if(n)try{n.disconnect()}catch(s){const a=new Error(`Error disconnecting ${i} node: ${s instanceof Error?s.message:String(s)}`);console.warn(`[LiveAudioProcessor] ${a.message}`),t.push(a)}};if(e(this.workletNode,"worklet"),this.workletNode=null,e(this.sourceNode,"source"),this.sourceNode=null,this.audioContext&&this.audioContext.state!=="closed")try{await this.audioContext.close()}catch(n){const i=new Error(`Error closing AudioContext: ${n instanceof Error?n.message:String(n)}`);console.warn(`[LiveAudioProcessor] ${i.message}`),t.push(i)}if(this.audioContext=null,this.isDisposing=!1,this.isDisposed=!0,t.length>0){const n=t.map(i=>i.message).join("; ");throw new Error(`Cleanup failed with multiple errors: ${n}`)}}}const VA=()=>null,$A=({status:r,audioFile:t,audioSource:e,audioContext:n})=>{const i=Rt.useRef(null),s=Rt.useRef(null),a=Rt.useRef(null);return Rt.useEffect(()=>{console.log("[useAudioAnalysis] Effect triggered",{status:r,hasAudioFile:!!t,hasAudioSource:!!e});const o=()=>{s.current&&(cancelAnimationFrame(s.current),s.current=null),i.current&&(console.log("[useAudioAnalysis] Cleaning up audio element"),i.current.pause(),i.current.src.startsWith("blob:")&&URL.revokeObjectURL(i.current.src),i.current=null),a.current&&(console.log("[useAudioAnalysis] Disposing LiveAudioProcessor"),a.current.dispose(),a.current=null)};if(r!==ue.Riding||!t&&!e){o();return}if(e&&!n){console.error("[useAudioAnalysis] audioSource provided without audioContext. This is not supported."),o();return}let c=null;t&&(console.log("[useAudioAnalysis] Setting up audio for riding from file"),c=new Audio(URL.createObjectURL(t)),c.loop=!1,c.preload="auto",c.addEventListener("loadeddata",()=>console.log("[useAudioAnalysis] Audio loaded",{duration:c==null?void 0:c.duration})),c.addEventListener("playing",()=>console.log("[useAudioAnalysis] Audio is playing")),c.addEventListener("pause",()=>console.log("[useAudioAnalysis] Audio paused")),c.addEventListener("error",O=>console.error("[useAudioAnalysis] Audio error",O)),i.current=c);const l=[],h=[],f=2.5,d=3;let m=-1/0,b=0;const I=O=>{const ut=ky(O.timestamp),X=Math.max(0,Math.min(1,O.energy));if(O.isBeat)try{window.dispatchEvent(new CustomEvent("audiorailrider:beat",{detail:{timestamp:ut,energy:X}}))}catch{}if(O.bpm&&O.bpm!==b){b=O.bpm;try{window.dispatchEvent(new CustomEvent("audiorailrider:tempo",{detail:{tempo:b}}))}catch{}}if(h.length>=4&&l.length>=4){const et=Math.abs(O.spectralFlux-h[h.length-2]),q=Math.abs(O.spectralCentroid-l[l.length-2]),At=h.reduce((kt,Vt)=>kt+Vt,0)/h.length,Ot=l.reduce((kt,Vt)=>kt+Vt,0)/l.length,wt=Math.sqrt(h.reduce((kt,Vt)=>{const ne=Vt-At;return kt+ne*ne},0)/Math.max(1,h.length-1)),Gt=Math.sqrt(l.reduce((kt,Vt)=>{const ne=Vt-Ot;return kt+ne*ne},0)/Math.max(1,l.length-1)),Jt=wt>0?et/wt:0,ae=Gt>0?q/Gt:0,he=Jt*.6+ae*.4;if(he>f&&ut-m>d){m=ut;try{window.dispatchEvent(new CustomEvent("audiorailrider:structure",{detail:{timestamp:ut,structuralScore:he}}))}catch{}}}};return(async()=>{try{let O=null;if(e&&n)O=e;else if(c){const X=new jA;a.current=X,await X.initialize(c)}if(O&&n){const X=await dp(n);X?(O.connect(X),X.connect(n.destination)):O.connect(n.destination)}const ut=()=>{const X=VA();if(X){const et=BA(X.timestamp,X);I(et);try{const q=new CustomEvent("audiorailrider:frame",{detail:et});window.dispatchEvent(q)}catch{}}s.current=requestAnimationFrame(ut)};ut()}catch(O){console.warn("[useAudioAnalysis] Audio processing setup failed, playing audio directly.",O)}c&&(console.log("[useAudioAnalysis] Starting audio playback"),c.play().then(()=>console.log("[useAudioAnalysis] Audio playing successfully")).catch(O=>console.error("[useAudioAnalysis] Audio playback failed:",O)))})(),o},[r,t,e,n]),{audioRef:i}},Sc=({stage:r,progress:t})=>{const e={analyzing:{title:"Analyzing Audio",description:"Extracting musical features from your track...",icon:""},generating:{title:"Generating Blueprint",description:"AI is designing your roller coaster...",icon:""},building:{title:"Building Track",description:"Creating the 3D visualization...",icon:""},loading:{title:"Loading Scene",description:"Preparing your ride...",icon:""}},{title:n,description:i,icon:s}=e[r];return S.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/90 z-50",children:S.jsxs("div",{className:"text-center max-w-md px-8",children:[S.jsx("div",{className:"text-6xl mb-6 animate-bounce",children:s}),S.jsx("h2",{className:"text-3xl font-bold mb-3 text-white",children:n}),S.jsx("p",{className:"text-gray-400 mb-8",children:i}),t!==void 0&&S.jsx("div",{className:"w-full bg-gray-800 rounded-full h-3 overflow-hidden mb-4",children:S.jsx("div",{className:"h-full bg-gradient-to-r from-purple-600 to-pink-600 transition-all duration-300 ease-out",style:{width:`${t}%`}})}),S.jsxs("div",{className:"flex justify-center space-x-2",children:[S.jsx("div",{className:"w-3 h-3 bg-purple-600 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),S.jsx("div",{className:"w-3 h-3 bg-purple-600 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),S.jsx("div",{className:"w-3 h-3 bg-purple-600 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]})})};var La={exports:{}},ZA=La.exports,_d;function WA(){return _d||(_d=1,(function(r,t){(function(e,n){r.exports=n()})(ZA,(function(){var e=function(u){return u instanceof Uint8Array||u instanceof Uint16Array||u instanceof Uint32Array||u instanceof Int8Array||u instanceof Int16Array||u instanceof Int32Array||u instanceof Float32Array||u instanceof Float64Array||u instanceof Uint8ClampedArray},n=function(u,g){for(var A=Object.keys(g),G=0;G<A.length;++G)u[A[G]]=g[A[G]];return u},i=`
`;function s(u){return typeof atob<"u"?atob(u):"base64:"+u}function a(u){var g=new Error("(regl) "+u);throw console.error(g),g}function o(u,g){u||a(g)}function c(u){return u?": "+u:""}function l(u,g,A){u in g||a("unknown parameter ("+u+")"+c(A)+". possible values: "+Object.keys(g).join())}function h(u,g){e(u)||a("invalid parameter type"+c(g)+". must be a typed array")}function f(u,g){switch(g){case"number":return typeof u=="number";case"object":return typeof u=="object";case"string":return typeof u=="string";case"boolean":return typeof u=="boolean";case"function":return typeof u=="function";case"undefined":return typeof u>"u";case"symbol":return typeof u=="symbol"}}function d(u,g,A){f(u,g)||a("invalid parameter type"+c(A)+". expected "+g+", got "+typeof u)}function m(u,g){u>=0&&(u|0)===u||a("invalid parameter type, ("+u+")"+c(g)+". must be a nonnegative integer")}function b(u,g,A){g.indexOf(u)<0&&a("invalid value"+c(A)+". must be one of: "+g)}var I=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function B(u){Object.keys(u).forEach(function(g){I.indexOf(g)<0&&a('invalid regl constructor argument "'+g+'". must be one of '+I)})}function O(u,g){for(u=u+"";u.length<g;)u=" "+u;return u}function ut(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function X(u,g){this.number=u,this.line=g,this.errors=[]}function et(u,g,A){this.file=u,this.line=g,this.message=A}function q(){var u=new Error,g=(u.stack||u).toString(),A=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(g);if(A)return A[1];var G=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(g);return G?G[1]:"unknown"}function At(){var u=new Error,g=(u.stack||u).toString(),A=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(g);if(A)return A[1];var G=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(g);return G?G[1]:"unknown"}function Ot(u,g){var A=u.split(`
`),G=1,W=0,U={unknown:new ut,0:new ut};U.unknown.name=U[0].name=g||q(),U.unknown.lines.push(new X(0,""));for(var $=0;$<A.length;++$){var Q=A[$],K=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Q);if(K)switch(K[1]){case"line":var at=/(\d+)(\s+\d+)?/.exec(K[2]);at&&(G=at[1]|0,at[2]&&(W=at[2]|0,W in U||(U[W]=new ut)));break;case"define":var ct=/SHADER_NAME(_B64)?\s+(.*)$/.exec(K[2]);ct&&(U[W].name=ct[1]?s(ct[2]):ct[2]);break}U[W].lines.push(new X(G++,Q))}return Object.keys(U).forEach(function(ot){var dt=U[ot];dt.lines.forEach(function(tt){dt.index[tt.number]=tt})}),U}function wt(u){var g=[];return u.split(`
`).forEach(function(A){if(!(A.length<5)){var G=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(A);G?g.push(new et(G[1]|0,G[2]|0,G[3].trim())):A.length>0&&g.push(new et("unknown",0,A))}}),g}function Gt(u,g){g.forEach(function(A){var G=u[A.file];if(G){var W=G.index[A.line];if(W){W.errors.push(A),G.hasErrors=!0;return}}u.unknown.hasErrors=!0,u.unknown.lines[0].errors.push(A)})}function Jt(u,g,A,G,W){if(!u.getShaderParameter(g,u.COMPILE_STATUS)){var U=u.getShaderInfoLog(g),$=G===u.FRAGMENT_SHADER?"fragment":"vertex";fe(A,"string",$+" shader source must be a string",W);var Q=Ot(A,W),K=wt(U);Gt(Q,K),Object.keys(Q).forEach(function(at){var ct=Q[at];if(!ct.hasErrors)return;var ot=[""],dt=[""];function tt(it,L){ot.push(it),dt.push(L||"")}tt("file number "+at+": "+ct.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),ct.lines.forEach(function(it){if(it.errors.length>0){tt(O(it.number,4)+"|  ","background-color:yellow; font-weight:bold"),tt(it.line+i,"color:red; background-color:yellow; font-weight:bold");var L=0;it.errors.forEach(function(V){var nt=V.message,Et=/^\s*'(.*)'\s*:\s*(.*)$/.exec(nt);if(Et){var J=Et[1];switch(nt=Et[2],J){case"assign":J="=";break}L=Math.max(it.line.indexOf(J,L),0)}else L=0;tt(O("| ",6)),tt(O("^^^",L+3)+i,"font-weight:bold"),tt(O("| ",6)),tt(nt+i,"font-weight:bold")}),tt(O("| ",6)+i)}else tt(O(it.number,4)+"|  "),tt(it.line+i,"color:red")}),typeof document<"u"&&!window.chrome?(dt[0]=ot.join("%c"),console.log.apply(console,dt)):console.log(ot.join(""))}),o.raise("Error compiling "+$+" shader, "+Q[0].name)}}function ae(u,g,A,G,W){if(!u.getProgramParameter(g,u.LINK_STATUS)){var U=u.getProgramInfoLog(g),$=Ot(A,W),Q=Ot(G,W),K='Error linking program with vertex shader, "'+Q[0].name+'", and fragment shader "'+$[0].name+'"';typeof document<"u"?console.log("%c"+K+i+"%c"+U,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(K+i+U),o.raise(K)}}function he(u){u._commandRef=q()}function kt(u,g,A,G){he(u);function W(K){return K?G.id(K):0}u._fragId=W(u.static.frag),u._vertId=W(u.static.vert);function U(K,at){Object.keys(at).forEach(function(ct){K[G.id(ct)]=!0})}var $=u._uniformSet={};U($,g.static),U($,g.dynamic);var Q=u._attributeSet={};U(Q,A.static),U(Q,A.dynamic),u._hasCount="count"in u.static||"count"in u.dynamic||"elements"in u.static||"elements"in u.dynamic}function Vt(u,g){var A=At();a(u+" in command "+(g||q())+(A==="unknown"?"":" called from "+A))}function ne(u,g,A){u||Vt(g,A||q())}function xe(u,g,A,G){u in g||Vt("unknown parameter ("+u+")"+c(A)+". possible values: "+Object.keys(g).join(),G||q())}function fe(u,g,A,G){f(u,g)||Vt("invalid parameter type"+c(A)+". expected "+g+", got "+typeof u,G||q())}function Te(u){u()}function le(u,g,A){u.texture?b(u.texture._texture.internalformat,g,"unsupported texture format for attachment"):b(u.renderbuffer._renderbuffer.format,A,"unsupported renderbuffer format for attachment")}var Ft=33071,qt=9728,be=9984,Fe=9985,se=9986,ye=9987,Se=5120,er=5121,He=5122,Ve=5123,rr=5124,Ye=5125,cr=5126,ir=32819,Xe=32820,an=33635,on=34042,$i=36193,nr={};nr[Se]=nr[er]=1,nr[He]=nr[Ve]=nr[$i]=nr[an]=nr[ir]=nr[Xe]=2,nr[rr]=nr[Ye]=nr[cr]=nr[on]=4;function Vr(u,g){return u===Xe||u===ir||u===an?2:u===on?4:nr[u]*g}function $r(u){return!(u&u-1)&&!!u}function Mn(u,g,A){var G,W=g.width,U=g.height,$=g.channels;o(W>0&&W<=A.maxTextureSize&&U>0&&U<=A.maxTextureSize,"invalid texture shape"),(u.wrapS!==Ft||u.wrapT!==Ft)&&o($r(W)&&$r(U),"incompatible wrap mode for texture, both width and height must be power of 2"),g.mipmask===1?W!==1&&U!==1&&o(u.minFilter!==be&&u.minFilter!==se&&u.minFilter!==Fe&&u.minFilter!==ye,"min filter requires mipmap"):(o($r(W)&&$r(U),"texture must be a square power of 2 to support mipmapping"),o(g.mipmask===(W<<1)-1,"missing or incomplete mipmap data")),g.type===cr&&(A.extensions.indexOf("oes_texture_float_linear")<0&&o(u.minFilter===qt&&u.magFilter===qt,"filter not supported, must enable oes_texture_float_linear"),o(!u.genMipmaps,"mipmap generation not supported with float textures"));var Q=g.images;for(G=0;G<16;++G)if(Q[G]){var K=W>>G,at=U>>G;o(g.mipmask&1<<G,"missing mipmap data");var ct=Q[G];if(o(ct.width===K&&ct.height===at,"invalid shape for mip images"),o(ct.format===g.format&&ct.internalformat===g.internalformat&&ct.type===g.type,"incompatible type for mip image"),!ct.compressed)if(ct.data){var ot=Math.ceil(Vr(ct.type,$)*K/ct.unpackAlignment)*ct.unpackAlignment;o(ct.data.byteLength===ot*at,"invalid data for image, buffer size is inconsistent with image format")}else ct.element||ct.copy}else u.genMipmaps||o((g.mipmask&1<<G)===0,"extra mipmap data");g.compressed&&o(!u.genMipmaps,"mipmap generation for compressed images not supported")}function Pt(u,g,A,G){var W=u.width,U=u.height,$=u.channels;o(W>0&&W<=G.maxTextureSize&&U>0&&U<=G.maxTextureSize,"invalid texture shape"),o(W===U,"cube map must be square"),o(g.wrapS===Ft&&g.wrapT===Ft,"wrap mode not supported by cube map");for(var Q=0;Q<A.length;++Q){var K=A[Q];o(K.width===W&&K.height===U,"inconsistent cube map face shape"),g.genMipmaps&&(o(!K.compressed,"can not generate mipmap for compressed textures"),o(K.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var at=K.images,ct=0;ct<16;++ct){var ot=at[ct];if(ot){var dt=W>>ct,tt=U>>ct;o(K.mipmask&1<<ct,"missing mipmap data"),o(ot.width===dt&&ot.height===tt,"invalid shape for mip images"),o(ot.format===u.format&&ot.internalformat===u.internalformat&&ot.type===u.type,"incompatible type for mip image"),ot.compressed||(ot.data?o(ot.data.byteLength===dt*tt*Math.max(Vr(ot.type,$),ot.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ot.element||ot.copy)}}}}var p=n(o,{optional:Te,raise:a,commandRaise:Vt,command:ne,parameter:l,commandParameter:xe,constructor:B,type:d,commandType:fe,isTypedArray:h,nni:m,oneOf:b,shaderError:Jt,linkError:ae,callSite:At,saveCommandRef:he,saveDrawInfo:kt,framebufferFormat:le,guessCommand:q,texture2D:Mn,textureCube:Pt}),$t=0,Zt=0,Oe=5,ge=6;function Sr(u,g){this.id=$t++,this.type=u,this.data=g}function el(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Zi(u){if(u.length===0)return[];var g=u.charAt(0),A=u.charAt(u.length-1);if(u.length>1&&g===A&&(g==='"'||g==="'"))return['"'+el(u.substr(1,u.length-2))+'"'];var G=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(u);if(G)return Zi(u.substr(0,G.index)).concat(Zi(G[1])).concat(Zi(u.substr(G.index+G[0].length)));var W=u.split(".");if(W.length===1)return['"'+el(u)+'"'];for(var U=[],$=0;$<W.length;++$)U=U.concat(Zi(W[$]));return U}function rl(u){return"["+Zi(u).join("][")+"]"}function mp(u,g){return new Sr(u,rl(g+""))}function yp(u){return typeof u=="function"&&!u._reglType||u instanceof Sr}function nl(u,g){if(typeof u=="function")return new Sr(Zt,u);if(typeof u=="number"||typeof u=="boolean")return new Sr(Oe,u);if(Array.isArray(u))return new Sr(ge,u.map(function(A,G){return nl(A,g+"["+G+"]")}));if(u instanceof Sr)return u;p(!1,"invalid option type in uniform "+g)}var mr={DynamicVariable:Sr,define:mp,isDynamic:yp,unbox:nl,accessor:rl},Ja={next:typeof requestAnimationFrame=="function"?function(u){return requestAnimationFrame(u)}:function(u){return setTimeout(u,16)},cancel:typeof cancelAnimationFrame=="function"?function(u){return cancelAnimationFrame(u)}:clearTimeout},il=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function gp(){var u={"":0},g=[""];return{id:function(A){var G=u[A];return G||(G=u[A]=g.length,g.push(A),G)},str:function(A){return g[A]}}}function _p(u,g,A){var G=document.createElement("canvas");n(G.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),u.appendChild(G),u===document.body&&(G.style.position="absolute",n(u.style,{margin:0,padding:0}));function W(){var Q=window.innerWidth,K=window.innerHeight;if(u!==document.body){var at=G.getBoundingClientRect();Q=at.right-at.left,K=at.bottom-at.top}G.width=A*Q,G.height=A*K}var U;u!==document.body&&typeof ResizeObserver=="function"?(U=new ResizeObserver(function(){setTimeout(W)}),U.observe(u)):window.addEventListener("resize",W,!1);function $(){U?U.disconnect():window.removeEventListener("resize",W),u.removeChild(G)}return W(),{canvas:G,onDestroy:$}}function xp(u,g){function A(G){try{return u.getContext(G,g)}catch{return null}}return A("webgl")||A("experimental-webgl")||A("webgl-experimental")}function bp(u){return typeof u.nodeName=="string"&&typeof u.appendChild=="function"&&typeof u.getBoundingClientRect=="function"}function vp(u){return typeof u.drawArrays=="function"||typeof u.drawElements=="function"}function sl(u){return typeof u=="string"?u.split():(p(Array.isArray(u),"invalid extension array"),u)}function al(u){return typeof u=="string"?(p(typeof document<"u","not supported outside of DOM"),document.querySelector(u)):u}function Ep(u){var g=u||{},A,G,W,U,$={},Q=[],K=[],at=typeof window>"u"?1:window.devicePixelRatio,ct=!1,ot=function(it){it&&p.raise(it)},dt=function(){};if(typeof g=="string"?(p(typeof document<"u","selector queries only supported in DOM environments"),A=document.querySelector(g),p(A,"invalid query string for element")):typeof g=="object"?bp(g)?A=g:vp(g)?(U=g,W=U.canvas):(p.constructor(g),"gl"in g?U=g.gl:"canvas"in g?W=al(g.canvas):"container"in g&&(G=al(g.container)),"attributes"in g&&($=g.attributes,p.type($,"object","invalid context attributes")),"extensions"in g&&(Q=sl(g.extensions)),"optionalExtensions"in g&&(K=sl(g.optionalExtensions)),"onDone"in g&&(p.type(g.onDone,"function","invalid or missing onDone callback"),ot=g.onDone),"profile"in g&&(ct=!!g.profile),"pixelRatio"in g&&(at=+g.pixelRatio,p(at>0,"invalid pixel ratio"))):p.raise("invalid arguments to regl"),A&&(A.nodeName.toLowerCase()==="canvas"?W=A:G=A),!U){if(!W){p(typeof document<"u","must manually specify webgl context outside of DOM environments");var tt=_p(G||document.body,ot,at);if(!tt)return null;W=tt.canvas,dt=tt.onDestroy}$.premultipliedAlpha===void 0&&($.premultipliedAlpha=!0),U=xp(W,$)}return U?{gl:U,canvas:W,container:G,extensions:Q,optionalExtensions:K,pixelRatio:at,profile:ct,onDone:ot,onDestroy:dt}:(dt(),ot("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ap(u,g){var A={};function G($){p.type($,"string","extension name must be string");var Q=$.toLowerCase(),K;try{K=A[Q]=u.getExtension(Q)}catch{}return!!K}for(var W=0;W<g.extensions.length;++W){var U=g.extensions[W];if(!G(U))return g.onDestroy(),g.onDone('"'+U+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return g.optionalExtensions.forEach(G),{extensions:A,restore:function(){Object.keys(A).forEach(function($){if(A[$]&&!G($))throw new Error("(regl): error restoring extension "+$)})}}}function yr(u,g){for(var A=Array(u),G=0;G<u;++G)A[G]=g(G);return A}var Tp=5120,wp=5121,Sp=5122,Mp=5123,Cp=5124,Ip=5125,Rp=5126;function Op(u){for(var g=16;g<=1<<28;g*=16)if(u<=g)return g;return 0}function ol(u){var g,A;return g=(u>65535)<<4,u>>>=g,A=(u>255)<<3,u>>>=A,g|=A,A=(u>15)<<2,u>>>=A,g|=A,A=(u>3)<<1,u>>>=A,g|=A,g|u>>1}function cl(){var u=yr(8,function(){return[]});function g(U){var $=Op(U),Q=u[ol($)>>2];return Q.length>0?Q.pop():new ArrayBuffer($)}function A(U){u[ol(U.byteLength)>>2].push(U)}function G(U,$){var Q=null;switch(U){case Tp:Q=new Int8Array(g($),0,$);break;case wp:Q=new Uint8Array(g($),0,$);break;case Sp:Q=new Int16Array(g(2*$),0,$);break;case Mp:Q=new Uint16Array(g(2*$),0,$);break;case Cp:Q=new Int32Array(g(4*$),0,$);break;case Ip:Q=new Uint32Array(g(4*$),0,$);break;case Rp:Q=new Float32Array(g(4*$),0,$);break;default:return null}return Q.length!==$?Q.subarray(0,$):Q}function W(U){A(U.buffer)}return{alloc:g,free:A,allocType:G,freeType:W}}var Ne=cl();Ne.zero=cl();var Np=3408,Lp=3410,kp=3411,Dp=3412,Fp=3413,Pp=3414,zp=3415,Bp=33901,Up=33902,Gp=3379,jp=3386,Vp=34921,$p=36347,Zp=36348,Wp=35661,Hp=35660,Yp=34930,Xp=36349,Jp=34076,qp=34024,Kp=7936,Qp=7937,tm=7938,em=35724,rm=34047,nm=36063,im=34852,Ss=3553,ll=34067,sm=34069,am=33984,Wi=6408,qa=5126,ul=5121,Ka=36160,om=36053,cm=36064,lm=16384,um=function(u,g){var A=1;g.ext_texture_filter_anisotropic&&(A=u.getParameter(rm));var G=1,W=1;g.webgl_draw_buffers&&(G=u.getParameter(im),W=u.getParameter(nm));var U=!!g.oes_texture_float;if(U){var $=u.createTexture();u.bindTexture(Ss,$),u.texImage2D(Ss,0,Wi,1,1,0,Wi,qa,null);var Q=u.createFramebuffer();if(u.bindFramebuffer(Ka,Q),u.framebufferTexture2D(Ka,cm,Ss,$,0),u.bindTexture(Ss,null),u.checkFramebufferStatus(Ka)!==om)U=!1;else{u.viewport(0,0,1,1),u.clearColor(1,0,0,1),u.clear(lm);var K=Ne.allocType(qa,4);u.readPixels(0,0,1,1,Wi,qa,K),u.getError()?U=!1:(u.deleteFramebuffer(Q),u.deleteTexture($),U=K[0]===1),Ne.freeType(K)}}var at=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),ct=!0;if(!at){var ot=u.createTexture(),dt=Ne.allocType(ul,36);u.activeTexture(am),u.bindTexture(ll,ot),u.texImage2D(sm,0,Wi,3,3,0,Wi,ul,dt),Ne.freeType(dt),u.bindTexture(ll,null),u.deleteTexture(ot),ct=!u.getError()}return{colorBits:[u.getParameter(Lp),u.getParameter(kp),u.getParameter(Dp),u.getParameter(Fp)],depthBits:u.getParameter(Pp),stencilBits:u.getParameter(zp),subpixelBits:u.getParameter(Np),extensions:Object.keys(g).filter(function(tt){return!!g[tt]}),maxAnisotropic:A,maxDrawbuffers:G,maxColorAttachments:W,pointSizeDims:u.getParameter(Bp),lineWidthDims:u.getParameter(Up),maxViewportDims:u.getParameter(jp),maxCombinedTextureUnits:u.getParameter(Wp),maxCubeMapSize:u.getParameter(Jp),maxRenderbufferSize:u.getParameter(qp),maxTextureUnits:u.getParameter(Yp),maxTextureSize:u.getParameter(Gp),maxAttributes:u.getParameter(Vp),maxVertexUniforms:u.getParameter($p),maxVertexTextureUnits:u.getParameter(Hp),maxVaryingVectors:u.getParameter(Zp),maxFragmentUniforms:u.getParameter(Xp),glsl:u.getParameter(em),renderer:u.getParameter(Qp),vendor:u.getParameter(Kp),version:u.getParameter(tm),readFloat:U,npotTextureCube:ct}};function Mr(u){return!!u&&typeof u=="object"&&Array.isArray(u.shape)&&Array.isArray(u.stride)&&typeof u.offset=="number"&&u.shape.length===u.stride.length&&(Array.isArray(u.data)||e(u.data))}var gr=function(u){return Object.keys(u).map(function(g){return u[g]})},Ms={shape:pm,flatten:dm};function hm(u,g,A){for(var G=0;G<g;++G)A[G]=u[G]}function fm(u,g,A,G){for(var W=0,U=0;U<g;++U)for(var $=u[U],Q=0;Q<A;++Q)G[W++]=$[Q]}function hl(u,g,A,G,W,U){for(var $=U,Q=0;Q<g;++Q)for(var K=u[Q],at=0;at<A;++at)for(var ct=K[at],ot=0;ot<G;++ot)W[$++]=ct[ot]}function fl(u,g,A,G,W){for(var U=1,$=A+1;$<g.length;++$)U*=g[$];var Q=g[A];if(g.length-A===4){var K=g[A+1],at=g[A+2],ct=g[A+3];for($=0;$<Q;++$)hl(u[$],K,at,ct,G,W),W+=U}else for($=0;$<Q;++$)fl(u[$],g,A+1,G,W),W+=U}function dm(u,g,A,G){var W=1;if(g.length)for(var U=0;U<g.length;++U)W*=g[U];else W=0;var $=G||Ne.allocType(A,W);switch(g.length){case 0:break;case 1:hm(u,g[0],$);break;case 2:fm(u,g[0],g[1],$);break;case 3:hl(u,g[0],g[1],g[2],$,0);break;default:fl(u,g,0,$,0)}return $}function pm(u){for(var g=[],A=u;A.length;A=A[0])g.push(A.length);return g}var Qa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},mm=5120,ym=5122,gm=5124,_m=5121,xm=5123,bm=5125,vm=5126,Em=5126,Cn={int8:mm,int16:ym,int32:gm,uint8:_m,uint16:xm,uint32:bm,float:vm,float32:Em},Am=35048,Tm=35040,Cs={dynamic:Am,stream:Tm,static:35044},to=Ms.flatten,dl=Ms.shape,pl=35044,wm=35040,eo=5121,ro=5126,cn=[];cn[5120]=1,cn[5122]=2,cn[5124]=4,cn[5121]=1,cn[5123]=2,cn[5125]=4,cn[5126]=4;function Is(u){return Qa[Object.prototype.toString.call(u)]|0}function ml(u,g){for(var A=0;A<g.length;++A)u[A]=g[A]}function yl(u,g,A,G,W,U,$){for(var Q=0,K=0;K<A;++K)for(var at=0;at<G;++at)u[Q++]=g[W*K+U*at+$]}function Sm(u,g,A,G){var W=0,U={};function $(L){this.id=W++,this.buffer=u.createBuffer(),this.type=L,this.usage=pl,this.byteLength=0,this.dimension=1,this.dtype=eo,this.persistentData=null,A.profile&&(this.stats={size:0})}$.prototype.bind=function(){u.bindBuffer(this.type,this.buffer)},$.prototype.destroy=function(){dt(this)};var Q=[];function K(L,V){var nt=Q.pop();return nt||(nt=new $(L)),nt.bind(),ot(nt,V,wm,0,1,!1),nt}function at(L){Q.push(L)}function ct(L,V,nt){L.byteLength=V.byteLength,u.bufferData(L.type,V,nt)}function ot(L,V,nt,Et,J,bt){var gt;if(L.usage=nt,Array.isArray(V)){if(L.dtype=Et||ro,V.length>0){var Dt;if(Array.isArray(V[0])){gt=dl(V);for(var H=1,Z=1;Z<gt.length;++Z)H*=gt[Z];L.dimension=H,Dt=to(V,gt,L.dtype),ct(L,Dt,nt),bt?L.persistentData=Dt:Ne.freeType(Dt)}else if(typeof V[0]=="number"){L.dimension=J;var Mt=Ne.allocType(L.dtype,V.length);ml(Mt,V),ct(L,Mt,nt),bt?L.persistentData=Mt:Ne.freeType(Mt)}else e(V[0])?(L.dimension=V[0].length,L.dtype=Et||Is(V[0])||ro,Dt=to(V,[V.length,V[0].length],L.dtype),ct(L,Dt,nt),bt?L.persistentData=Dt:Ne.freeType(Dt)):p.raise("invalid buffer data")}}else if(e(V))L.dtype=Et||Is(V),L.dimension=J,ct(L,V,nt),bt&&(L.persistentData=new Uint8Array(new Uint8Array(V.buffer)));else if(Mr(V)){gt=V.shape;var pt=V.stride,rt=V.offset,mt=0,yt=0,Ht=0,jt=0;gt.length===1?(mt=gt[0],yt=1,Ht=pt[0],jt=0):gt.length===2?(mt=gt[0],yt=gt[1],Ht=pt[0],jt=pt[1]):p.raise("invalid shape"),L.dtype=Et||Is(V.data)||ro,L.dimension=yt;var _t=Ne.allocType(L.dtype,mt*yt);yl(_t,V.data,mt,yt,Ht,jt,rt),ct(L,_t,nt),bt?L.persistentData=_t:Ne.freeType(_t)}else V instanceof ArrayBuffer?(L.dtype=eo,L.dimension=J,ct(L,V,nt),bt&&(L.persistentData=new Uint8Array(new Uint8Array(V)))):p.raise("invalid buffer data")}function dt(L){g.bufferCount--,G(L);var V=L.buffer;p(V,"buffer must not be deleted already"),u.deleteBuffer(V),L.buffer=null,delete U[L.id]}function tt(L,V,nt,Et){g.bufferCount++;var J=new $(V);U[J.id]=J;function bt(H){var Z=pl,Mt=null,pt=0,rt=0,mt=1;return Array.isArray(H)||e(H)||Mr(H)||H instanceof ArrayBuffer?Mt=H:typeof H=="number"?pt=H|0:H&&(p.type(H,"object","buffer arguments must be an object, a number or an array"),"data"in H&&(p(Mt===null||Array.isArray(Mt)||e(Mt)||Mr(Mt),"invalid data for buffer"),Mt=H.data),"usage"in H&&(p.parameter(H.usage,Cs,"invalid buffer usage"),Z=Cs[H.usage]),"type"in H&&(p.parameter(H.type,Cn,"invalid buffer type"),rt=Cn[H.type]),"dimension"in H&&(p.type(H.dimension,"number","invalid dimension"),mt=H.dimension|0),"length"in H&&(p.nni(pt,"buffer length must be a nonnegative integer"),pt=H.length|0)),J.bind(),Mt?ot(J,Mt,Z,rt,mt,Et):(pt&&u.bufferData(J.type,pt,Z),J.dtype=rt||eo,J.usage=Z,J.dimension=mt,J.byteLength=pt),A.profile&&(J.stats.size=J.byteLength*cn[J.dtype]),bt}function gt(H,Z){p(Z+H.byteLength<=J.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+H.byteLength+" starting from offset "+Z+" to a buffer of size "+J.byteLength),u.bufferSubData(J.type,Z,H)}function Dt(H,Z){var Mt=(Z||0)|0,pt;if(J.bind(),e(H)||H instanceof ArrayBuffer)gt(H,Mt);else if(Array.isArray(H)){if(H.length>0)if(typeof H[0]=="number"){var rt=Ne.allocType(J.dtype,H.length);ml(rt,H),gt(rt,Mt),Ne.freeType(rt)}else if(Array.isArray(H[0])||e(H[0])){pt=dl(H);var mt=to(H,pt,J.dtype);gt(mt,Mt),Ne.freeType(mt)}else p.raise("invalid buffer data")}else if(Mr(H)){pt=H.shape;var yt=H.stride,Ht=0,jt=0,_t=0,vt=0;pt.length===1?(Ht=pt[0],jt=1,_t=yt[0],vt=0):pt.length===2?(Ht=pt[0],jt=pt[1],_t=yt[0],vt=yt[1]):p.raise("invalid shape");var Bt=Array.isArray(H.data)?J.dtype:Is(H.data),Wt=Ne.allocType(Bt,Ht*jt);yl(Wt,H.data,Ht,jt,_t,vt,H.offset),gt(Wt,Mt),Ne.freeType(Wt)}else p.raise("invalid data for buffer subdata");return bt}return nt||bt(L),bt._reglType="buffer",bt._buffer=J,bt.subdata=Dt,A.profile&&(bt.stats=J.stats),bt.destroy=function(){dt(J)},bt}function it(){gr(U).forEach(function(L){L.buffer=u.createBuffer(),u.bindBuffer(L.type,L.buffer),u.bufferData(L.type,L.persistentData||L.byteLength,L.usage)})}return A.profile&&(g.getTotalBufferSize=function(){var L=0;return Object.keys(U).forEach(function(V){L+=U[V].stats.size}),L}),{create:tt,createStream:K,destroyStream:at,clear:function(){gr(U).forEach(dt),Q.forEach(dt)},getBuffer:function(L){return L&&L._buffer instanceof $?L._buffer:null},restore:it,_initBuffer:ot}}var Mm=0,Cm=0,Im=1,Rm=1,Om=4,Nm=4,ln={points:Mm,point:Cm,lines:Im,line:Rm,triangles:Om,triangle:Nm,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Lm=0,km=1,Hi=4,Dm=5120,Qn=5121,gl=5122,ti=5123,_l=5124,In=5125,no=34963,Fm=35040,Pm=35044;function zm(u,g,A,G){var W={},U=0,$={uint8:Qn,uint16:ti};g.oes_element_index_uint&&($.uint32=In);function Q(it){this.id=U++,W[this.id]=this,this.buffer=it,this.primType=Hi,this.vertCount=0,this.type=0}Q.prototype.bind=function(){this.buffer.bind()};var K=[];function at(it){var L=K.pop();return L||(L=new Q(A.create(null,no,!0,!1)._buffer)),ot(L,it,Fm,-1,-1,0,0),L}function ct(it){K.push(it)}function ot(it,L,V,nt,Et,J,bt){it.buffer.bind();var gt;if(L){var Dt=bt;!bt&&(!e(L)||Mr(L)&&!e(L.data))&&(Dt=g.oes_element_index_uint?In:ti),A._initBuffer(it.buffer,L,V,Dt,3)}else u.bufferData(no,J,V),it.buffer.dtype=gt||Qn,it.buffer.usage=V,it.buffer.dimension=3,it.buffer.byteLength=J;if(gt=bt,!bt){switch(it.buffer.dtype){case Qn:case Dm:gt=Qn;break;case ti:case gl:gt=ti;break;case In:case _l:gt=In;break;default:p.raise("unsupported type for element array")}it.buffer.dtype=gt}it.type=gt,p(gt!==In||!!g.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var H=Et;H<0&&(H=it.buffer.byteLength,gt===ti?H>>=1:gt===In&&(H>>=2)),it.vertCount=H;var Z=nt;if(nt<0){Z=Hi;var Mt=it.buffer.dimension;Mt===1&&(Z=Lm),Mt===2&&(Z=km),Mt===3&&(Z=Hi)}it.primType=Z}function dt(it){G.elementsCount--,p(it.buffer!==null,"must not double destroy elements"),delete W[it.id],it.buffer.destroy(),it.buffer=null}function tt(it,L){var V=A.create(null,no,!0),nt=new Q(V._buffer);G.elementsCount++;function Et(J){if(!J)V(),nt.primType=Hi,nt.vertCount=0,nt.type=Qn;else if(typeof J=="number")V(J),nt.primType=Hi,nt.vertCount=J|0,nt.type=Qn;else{var bt=null,gt=Pm,Dt=-1,H=-1,Z=0,Mt=0;Array.isArray(J)||e(J)||Mr(J)?bt=J:(p.type(J,"object","invalid arguments for elements"),"data"in J&&(bt=J.data,p(Array.isArray(bt)||e(bt)||Mr(bt),"invalid data for element buffer")),"usage"in J&&(p.parameter(J.usage,Cs,"invalid element buffer usage"),gt=Cs[J.usage]),"primitive"in J&&(p.parameter(J.primitive,ln,"invalid element buffer primitive"),Dt=ln[J.primitive]),"count"in J&&(p(typeof J.count=="number"&&J.count>=0,"invalid vertex count for elements"),H=J.count|0),"type"in J&&(p.parameter(J.type,$,"invalid buffer type"),Mt=$[J.type]),"length"in J?Z=J.length|0:(Z=H,Mt===ti||Mt===gl?Z*=2:(Mt===In||Mt===_l)&&(Z*=4))),ot(nt,bt,gt,Dt,H,Z,Mt)}return Et}return Et(it),Et._reglType="elements",Et._elements=nt,Et.subdata=function(J,bt){return V.subdata(J,bt),Et},Et.destroy=function(){dt(nt)},Et}return{create:tt,createStream:at,destroyStream:ct,getElements:function(it){return typeof it=="function"&&it._elements instanceof Q?it._elements:null},clear:function(){gr(W).forEach(dt)}}}var xl=new Float32Array(1),Bm=new Uint32Array(xl.buffer),Um=5123;function bl(u){for(var g=Ne.allocType(Um,u.length),A=0;A<u.length;++A)if(isNaN(u[A]))g[A]=65535;else if(u[A]===1/0)g[A]=31744;else if(u[A]===-1/0)g[A]=64512;else{xl[0]=u[A];var G=Bm[0],W=G>>>31<<15,U=(G<<1>>>24)-127,$=G>>13&1023;if(U<-24)g[A]=W;else if(U<-14){var Q=-14-U;g[A]=W+($+1024>>Q)}else U>15?g[A]=W+31744:g[A]=W+(U+15<<10)+$}return g}function Me(u){return Array.isArray(u)||e(u)}var vl=function(u){return!(u&u-1)&&!!u},Gm=34467,Dr=3553,io=34067,Rs=34069,Rn=6408,so=6406,Os=6407,Yi=6409,Ns=6410,El=32854,ao=32855,Al=36194,jm=32819,Vm=32820,$m=33635,Zm=34042,oo=6402,Ls=34041,co=35904,lo=35906,ei=36193,uo=33776,ho=33777,fo=33778,po=33779,Tl=35986,wl=35987,Sl=34798,Ml=35840,Cl=35841,Il=35842,Rl=35843,Ol=36196,ri=5121,mo=5123,yo=5125,Xi=5126,Wm=10242,Hm=10243,Ym=10497,go=33071,Xm=33648,Jm=10240,qm=10241,_o=9728,Km=9729,xo=9984,Nl=9985,Ll=9986,bo=9987,Qm=33170,ks=4352,t0=4353,e0=4354,r0=34046,n0=3317,i0=37440,s0=37441,a0=37443,kl=37444,Ji=33984,o0=[xo,Ll,Nl,bo],Ds=[0,Yi,Ns,Os,Rn],br={};br[Yi]=br[so]=br[oo]=1,br[Ls]=br[Ns]=2,br[Os]=br[co]=3,br[Rn]=br[lo]=4;function ni(u){return"[object "+u+"]"}var Dl=ni("HTMLCanvasElement"),Fl=ni("OffscreenCanvas"),Pl=ni("CanvasRenderingContext2D"),zl=ni("ImageBitmap"),Bl=ni("HTMLImageElement"),Ul=ni("HTMLVideoElement"),c0=Object.keys(Qa).concat([Dl,Fl,Pl,zl,Bl,Ul]),ii=[];ii[ri]=1,ii[Xi]=4,ii[ei]=2,ii[mo]=2,ii[yo]=4;var Je=[];Je[El]=2,Je[ao]=2,Je[Al]=2,Je[Ls]=4,Je[uo]=.5,Je[ho]=.5,Je[fo]=1,Je[po]=1,Je[Tl]=.5,Je[wl]=1,Je[Sl]=1,Je[Ml]=.5,Je[Cl]=.25,Je[Il]=.5,Je[Rl]=.25,Je[Ol]=.5;function Gl(u){return Array.isArray(u)&&(u.length===0||typeof u[0]=="number")}function jl(u){if(!Array.isArray(u))return!1;var g=u.length;return!(g===0||!Me(u[0]))}function On(u){return Object.prototype.toString.call(u)}function Vl(u){return On(u)===Dl}function $l(u){return On(u)===Fl}function l0(u){return On(u)===Pl}function u0(u){return On(u)===zl}function h0(u){return On(u)===Bl}function f0(u){return On(u)===Ul}function vo(u){if(!u)return!1;var g=On(u);return c0.indexOf(g)>=0?!0:Gl(u)||jl(u)||Mr(u)}function Zl(u){return Qa[Object.prototype.toString.call(u)]|0}function d0(u,g){var A=g.length;switch(u.type){case ri:case mo:case yo:case Xi:var G=Ne.allocType(u.type,A);G.set(g),u.data=G;break;case ei:u.data=bl(g);break;default:p.raise("unsupported texture type, must specify a typed array")}}function Wl(u,g){return Ne.allocType(u.type===ei?Xi:u.type,g)}function Hl(u,g){u.type===ei?(u.data=bl(g),Ne.freeType(g)):u.data=g}function p0(u,g,A,G,W,U){for(var $=u.width,Q=u.height,K=u.channels,at=$*Q*K,ct=Wl(u,at),ot=0,dt=0;dt<Q;++dt)for(var tt=0;tt<$;++tt)for(var it=0;it<K;++it)ct[ot++]=g[A*tt+G*dt+W*it+U];Hl(u,ct)}function Fs(u,g,A,G,W,U){var $;if(typeof Je[u]<"u"?$=Je[u]:$=br[u]*ii[g],U&&($*=6),W){for(var Q=0,K=A;K>=1;)Q+=$*K*K,K/=2;return Q}else return $*A*G}function m0(u,g,A,G,W,U,$){var Q={"don't care":ks,"dont care":ks,nice:e0,fast:t0},K={repeat:Ym,clamp:go,mirror:Xm},at={nearest:_o,linear:Km},ct=n({mipmap:bo,"nearest mipmap nearest":xo,"linear mipmap nearest":Nl,"nearest mipmap linear":Ll,"linear mipmap linear":bo},at),ot={none:0,browser:kl},dt={uint8:ri,rgba4:jm,rgb565:$m,"rgb5 a1":Vm},tt={alpha:so,luminance:Yi,"luminance alpha":Ns,rgb:Os,rgba:Rn,rgba4:El,"rgb5 a1":ao,rgb565:Al},it={};g.ext_srgb&&(tt.srgb=co,tt.srgba=lo),g.oes_texture_float&&(dt.float32=dt.float=Xi),g.oes_texture_half_float&&(dt.float16=dt["half float"]=ei),g.webgl_depth_texture&&(n(tt,{depth:oo,"depth stencil":Ls}),n(dt,{uint16:mo,uint32:yo,"depth stencil":Zm})),g.webgl_compressed_texture_s3tc&&n(it,{"rgb s3tc dxt1":uo,"rgba s3tc dxt1":ho,"rgba s3tc dxt3":fo,"rgba s3tc dxt5":po}),g.webgl_compressed_texture_atc&&n(it,{"rgb atc":Tl,"rgba atc explicit alpha":wl,"rgba atc interpolated alpha":Sl}),g.webgl_compressed_texture_pvrtc&&n(it,{"rgb pvrtc 4bppv1":Ml,"rgb pvrtc 2bppv1":Cl,"rgba pvrtc 4bppv1":Il,"rgba pvrtc 2bppv1":Rl}),g.webgl_compressed_texture_etc1&&(it["rgb etc1"]=Ol);var L=Array.prototype.slice.call(u.getParameter(Gm));Object.keys(it).forEach(function(E){var j=it[E];L.indexOf(j)>=0&&(tt[E]=j)});var V=Object.keys(tt);A.textureFormats=V;var nt=[];Object.keys(tt).forEach(function(E){var j=tt[E];nt[j]=E});var Et=[];Object.keys(dt).forEach(function(E){var j=dt[E];Et[j]=E});var J=[];Object.keys(at).forEach(function(E){var j=at[E];J[j]=E});var bt=[];Object.keys(ct).forEach(function(E){var j=ct[E];bt[j]=E});var gt=[];Object.keys(K).forEach(function(E){var j=K[E];gt[j]=E});var Dt=V.reduce(function(E,j){var z=tt[j];return z===Yi||z===so||z===Yi||z===Ns||z===oo||z===Ls||g.ext_srgb&&(z===co||z===lo)?E[z]=z:z===ao||j.indexOf("rgba")>=0?E[z]=Rn:E[z]=Os,E},{});function H(){this.internalformat=Rn,this.format=Rn,this.type=ri,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=kl,this.width=0,this.height=0,this.channels=0}function Z(E,j){E.internalformat=j.internalformat,E.format=j.format,E.type=j.type,E.compressed=j.compressed,E.premultiplyAlpha=j.premultiplyAlpha,E.flipY=j.flipY,E.unpackAlignment=j.unpackAlignment,E.colorSpace=j.colorSpace,E.width=j.width,E.height=j.height,E.channels=j.channels}function Mt(E,j){if(!(typeof j!="object"||!j)){if("premultiplyAlpha"in j&&(p.type(j.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),E.premultiplyAlpha=j.premultiplyAlpha),"flipY"in j&&(p.type(j.flipY,"boolean","invalid texture flip"),E.flipY=j.flipY),"alignment"in j&&(p.oneOf(j.alignment,[1,2,4,8],"invalid texture unpack alignment"),E.unpackAlignment=j.alignment),"colorSpace"in j&&(p.parameter(j.colorSpace,ot,"invalid colorSpace"),E.colorSpace=ot[j.colorSpace]),"type"in j){var z=j.type;p(g.oes_texture_float||!(z==="float"||z==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),p(g.oes_texture_half_float||!(z==="half float"||z==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),p(g.webgl_depth_texture||!(z==="uint16"||z==="uint32"||z==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),p.parameter(z,dt,"invalid texture type"),E.type=dt[z]}var St=E.width,Kt=E.height,x=E.channels,y=!1;"shape"in j?(p(Array.isArray(j.shape)&&j.shape.length>=2,"shape must be an array"),St=j.shape[0],Kt=j.shape[1],j.shape.length===3&&(x=j.shape[2],p(x>0&&x<=4,"invalid number of channels"),y=!0),p(St>=0&&St<=A.maxTextureSize,"invalid width"),p(Kt>=0&&Kt<=A.maxTextureSize,"invalid height")):("radius"in j&&(St=Kt=j.radius,p(St>=0&&St<=A.maxTextureSize,"invalid radius")),"width"in j&&(St=j.width,p(St>=0&&St<=A.maxTextureSize,"invalid width")),"height"in j&&(Kt=j.height,p(Kt>=0&&Kt<=A.maxTextureSize,"invalid height")),"channels"in j&&(x=j.channels,p(x>0&&x<=4,"invalid number of channels"),y=!0)),E.width=St|0,E.height=Kt|0,E.channels=x|0;var w=!1;if("format"in j){var N=j.format;p(g.webgl_depth_texture||!(N==="depth"||N==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),p.parameter(N,tt,"invalid texture format");var F=E.internalformat=tt[N];E.format=Dt[F],N in dt&&("type"in j||(E.type=dt[N])),N in it&&(E.compressed=!0),w=!0}!y&&w?E.channels=br[E.format]:y&&!w?E.channels!==Ds[E.format]&&(E.format=E.internalformat=Ds[E.channels]):w&&y&&p(E.channels===br[E.format],"number of channels inconsistent with specified format")}}function pt(E){u.pixelStorei(i0,E.flipY),u.pixelStorei(s0,E.premultiplyAlpha),u.pixelStorei(a0,E.colorSpace),u.pixelStorei(n0,E.unpackAlignment)}function rt(){H.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function mt(E,j){var z=null;if(vo(j)?z=j:j&&(p.type(j,"object","invalid pixel data type"),Mt(E,j),"x"in j&&(E.xOffset=j.x|0),"y"in j&&(E.yOffset=j.y|0),vo(j.data)&&(z=j.data)),p(!E.compressed||z instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),j.copy){p(!z,"can not specify copy and data field for the same texture");var St=W.viewportWidth,Kt=W.viewportHeight;E.width=E.width||St-E.xOffset,E.height=E.height||Kt-E.yOffset,E.needsCopy=!0,p(E.xOffset>=0&&E.xOffset<St&&E.yOffset>=0&&E.yOffset<Kt&&E.width>0&&E.width<=St&&E.height>0&&E.height<=Kt,"copy texture read out of bounds")}else if(!z)E.width=E.width||1,E.height=E.height||1,E.channels=E.channels||4;else if(e(z))E.channels=E.channels||4,E.data=z,!("type"in j)&&E.type===ri&&(E.type=Zl(z));else if(Gl(z))E.channels=E.channels||4,d0(E,z),E.alignment=1,E.needsFree=!0;else if(Mr(z)){var x=z.data;!Array.isArray(x)&&E.type===ri&&(E.type=Zl(x));var y=z.shape,w=z.stride,N,F,C,M,R,_;y.length===3?(C=y[2],_=w[2]):(p(y.length===2,"invalid ndarray pixel data, must be 2 or 3D"),C=1,_=1),N=y[0],F=y[1],M=w[0],R=w[1],E.alignment=1,E.width=N,E.height=F,E.channels=C,E.format=E.internalformat=Ds[C],E.needsFree=!0,p0(E,x,M,R,_,z.offset)}else if(Vl(z)||$l(z)||l0(z))Vl(z)||$l(z)?E.element=z:E.element=z.canvas,E.width=E.element.width,E.height=E.element.height,E.channels=4;else if(u0(z))E.element=z,E.width=z.width,E.height=z.height,E.channels=4;else if(h0(z))E.element=z,E.width=z.naturalWidth,E.height=z.naturalHeight,E.channels=4;else if(f0(z))E.element=z,E.width=z.videoWidth,E.height=z.videoHeight,E.channels=4;else if(jl(z)){var T=E.width||z[0].length,v=E.height||z.length,D=E.channels;Me(z[0][0])?D=D||z[0][0].length:D=D||1;for(var P=Ms.shape(z),Y=1,ht=0;ht<P.length;++ht)Y*=P[ht];var ft=Wl(E,Y);Ms.flatten(z,P,"",ft),Hl(E,ft),E.alignment=1,E.width=T,E.height=v,E.channels=D,E.format=E.internalformat=Ds[D],E.needsFree=!0}E.type===Xi?p(A.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):E.type===ei&&p(A.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function yt(E,j,z){var St=E.element,Kt=E.data,x=E.internalformat,y=E.format,w=E.type,N=E.width,F=E.height;pt(E),St?u.texImage2D(j,z,y,y,w,St):E.compressed?u.compressedTexImage2D(j,z,x,N,F,0,Kt):E.needsCopy?(G(),u.copyTexImage2D(j,z,y,E.xOffset,E.yOffset,N,F,0)):u.texImage2D(j,z,y,N,F,0,y,w,Kt||null)}function Ht(E,j,z,St,Kt){var x=E.element,y=E.data,w=E.internalformat,N=E.format,F=E.type,C=E.width,M=E.height;pt(E),x?u.texSubImage2D(j,Kt,z,St,N,F,x):E.compressed?u.compressedTexSubImage2D(j,Kt,z,St,w,C,M,y):E.needsCopy?(G(),u.copyTexSubImage2D(j,Kt,z,St,E.xOffset,E.yOffset,C,M)):u.texSubImage2D(j,Kt,z,St,C,M,N,F,y)}var jt=[];function _t(){return jt.pop()||new rt}function vt(E){E.needsFree&&Ne.freeType(E.data),rt.call(E),jt.push(E)}function Bt(){H.call(this),this.genMipmaps=!1,this.mipmapHint=ks,this.mipmask=0,this.images=Array(16)}function Wt(E,j,z){var St=E.images[0]=_t();E.mipmask=1,St.width=E.width=j,St.height=E.height=z,St.channels=E.channels=4}function Qt(E,j){var z=null;if(vo(j))z=E.images[0]=_t(),Z(z,E),mt(z,j),E.mipmask=1;else if(Mt(E,j),Array.isArray(j.mipmap))for(var St=j.mipmap,Kt=0;Kt<St.length;++Kt)z=E.images[Kt]=_t(),Z(z,E),z.width>>=Kt,z.height>>=Kt,mt(z,St[Kt]),E.mipmask|=1<<Kt;else z=E.images[0]=_t(),Z(z,E),mt(z,j),E.mipmask=1;Z(E,E.images[0]),E.compressed&&(E.internalformat===uo||E.internalformat===ho||E.internalformat===fo||E.internalformat===po)&&p(E.width%4===0&&E.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ve(E,j){for(var z=E.images,St=0;St<z.length;++St){if(!z[St])return;yt(z[St],j,St)}}var Ae=[];function ee(){var E=Ae.pop()||new Bt;H.call(E),E.mipmask=0;for(var j=0;j<16;++j)E.images[j]=null;return E}function Pe(E){for(var j=E.images,z=0;z<j.length;++z)j[z]&&vt(j[z]),j[z]=null;Ae.push(E)}function _e(){this.minFilter=_o,this.magFilter=_o,this.wrapS=go,this.wrapT=go,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ks}function ke(E,j){if("min"in j){var z=j.min;p.parameter(z,ct),E.minFilter=ct[z],o0.indexOf(E.minFilter)>=0&&!("faces"in j)&&(E.genMipmaps=!0)}if("mag"in j){var St=j.mag;p.parameter(St,at),E.magFilter=at[St]}var Kt=E.wrapS,x=E.wrapT;if("wrap"in j){var y=j.wrap;typeof y=="string"?(p.parameter(y,K),Kt=x=K[y]):Array.isArray(y)&&(p.parameter(y[0],K),p.parameter(y[1],K),Kt=K[y[0]],x=K[y[1]])}else{if("wrapS"in j){var w=j.wrapS;p.parameter(w,K),Kt=K[w]}if("wrapT"in j){var N=j.wrapT;p.parameter(N,K),x=K[N]}}if(E.wrapS=Kt,E.wrapT=x,"anisotropic"in j){var F=j.anisotropic;p(typeof F=="number"&&F>=1&&F<=A.maxAnisotropic,"aniso samples must be between 1 and "),E.anisotropic=j.anisotropic}if("mipmap"in j){var C=!1;switch(typeof j.mipmap){case"string":p.parameter(j.mipmap,Q,"invalid mipmap hint"),E.mipmapHint=Q[j.mipmap],E.genMipmaps=!0,C=!0;break;case"boolean":C=E.genMipmaps=j.mipmap;break;case"object":p(Array.isArray(j.mipmap),"invalid mipmap type"),E.genMipmaps=!1,C=!0;break;default:p.raise("invalid mipmap type")}C&&!("min"in j)&&(E.minFilter=xo)}}function ze(E,j){u.texParameteri(j,qm,E.minFilter),u.texParameteri(j,Jm,E.magFilter),u.texParameteri(j,Wm,E.wrapS),u.texParameteri(j,Hm,E.wrapT),g.ext_texture_filter_anisotropic&&u.texParameteri(j,r0,E.anisotropic),E.genMipmaps&&(u.hint(Qm,E.mipmapHint),u.generateMipmap(j))}var Be=0,$e={},qe=A.maxTextureUnits,Ce=Array(qe).map(function(){return null});function Xt(E){H.call(this),this.mipmask=0,this.internalformat=Rn,this.id=Be++,this.refCount=1,this.target=E,this.texture=u.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new _e,$.profile&&(this.stats={size:0})}function Ke(E){u.activeTexture(Ji),u.bindTexture(E.target,E.texture)}function oe(){var E=Ce[0];E?u.bindTexture(E.target,E.texture):u.bindTexture(Dr,null)}function zt(E){var j=E.texture;p(j,"must not double destroy texture");var z=E.unit,St=E.target;z>=0&&(u.activeTexture(Ji+z),u.bindTexture(St,null),Ce[z]=null),u.deleteTexture(j),E.texture=null,E.params=null,E.pixels=null,E.refCount=0,delete $e[E.id],U.textureCount--}n(Xt.prototype,{bind:function(){var E=this;E.bindCount+=1;var j=E.unit;if(j<0){for(var z=0;z<qe;++z){var St=Ce[z];if(St){if(St.bindCount>0)continue;St.unit=-1}Ce[z]=E,j=z;break}j>=qe&&p.raise("insufficient number of texture units"),$.profile&&U.maxTextureUnits<j+1&&(U.maxTextureUnits=j+1),E.unit=j,u.activeTexture(Ji+j),u.bindTexture(E.target,E.texture)}return j},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&zt(this)}});function te(E,j){var z=new Xt(Dr);$e[z.id]=z,U.textureCount++;function St(y,w){var N=z.texInfo;_e.call(N);var F=ee();return typeof y=="number"?typeof w=="number"?Wt(F,y|0,w|0):Wt(F,y|0,y|0):y?(p.type(y,"object","invalid arguments to regl.texture"),ke(N,y),Qt(F,y)):Wt(F,1,1),N.genMipmaps&&(F.mipmask=(F.width<<1)-1),z.mipmask=F.mipmask,Z(z,F),p.texture2D(N,F,A),z.internalformat=F.internalformat,St.width=F.width,St.height=F.height,Ke(z),ve(F,Dr),ze(N,Dr),oe(),Pe(F),$.profile&&(z.stats.size=Fs(z.internalformat,z.type,F.width,F.height,N.genMipmaps,!1)),St.format=nt[z.internalformat],St.type=Et[z.type],St.mag=J[N.magFilter],St.min=bt[N.minFilter],St.wrapS=gt[N.wrapS],St.wrapT=gt[N.wrapT],St}function Kt(y,w,N,F){p(!!y,"must specify image data");var C=w|0,M=N|0,R=F|0,_=_t();return Z(_,z),_.width=0,_.height=0,mt(_,y),_.width=_.width||(z.width>>R)-C,_.height=_.height||(z.height>>R)-M,p(z.type===_.type&&z.format===_.format&&z.internalformat===_.internalformat,"incompatible format for texture.subimage"),p(C>=0&&M>=0&&C+_.width<=z.width&&M+_.height<=z.height,"texture.subimage write out of bounds"),p(z.mipmask&1<<R,"missing mipmap data"),p(_.data||_.element||_.needsCopy,"missing image data"),Ke(z),Ht(_,Dr,C,M,R),oe(),vt(_),St}function x(y,w){var N=y|0,F=w|0||N;if(N===z.width&&F===z.height)return St;St.width=z.width=N,St.height=z.height=F,Ke(z);for(var C=0;z.mipmask>>C;++C){var M=N>>C,R=F>>C;if(!M||!R)break;u.texImage2D(Dr,C,z.format,M,R,0,z.format,z.type,null)}return oe(),$.profile&&(z.stats.size=Fs(z.internalformat,z.type,N,F,!1,!1)),St}return St(E,j),St.subimage=Kt,St.resize=x,St._reglType="texture2d",St._texture=z,$.profile&&(St.stats=z.stats),St.destroy=function(){z.decRef()},St}function ie(E,j,z,St,Kt,x){var y=new Xt(io);$e[y.id]=y,U.cubeCount++;var w=new Array(6);function N(M,R,_,T,v,D){var P,Y=y.texInfo;for(_e.call(Y),P=0;P<6;++P)w[P]=ee();if(typeof M=="number"||!M){var ht=M|0||1;for(P=0;P<6;++P)Wt(w[P],ht,ht)}else if(typeof M=="object")if(R)Qt(w[0],M),Qt(w[1],R),Qt(w[2],_),Qt(w[3],T),Qt(w[4],v),Qt(w[5],D);else if(ke(Y,M),Mt(y,M),"faces"in M){var ft=M.faces;for(p(Array.isArray(ft)&&ft.length===6,"cube faces must be a length 6 array"),P=0;P<6;++P)p(typeof ft[P]=="object"&&!!ft[P],"invalid input for cube map face"),Z(w[P],y),Qt(w[P],ft[P])}else for(P=0;P<6;++P)Qt(w[P],M);else p.raise("invalid arguments to cube map");for(Z(y,w[0]),p.optional(function(){A.npotTextureCube||p(vl(y.width)&&vl(y.height),"your browser does not support non power or two texture dimensions")}),Y.genMipmaps?y.mipmask=(w[0].width<<1)-1:y.mipmask=w[0].mipmask,p.textureCube(y,Y,w,A),y.internalformat=w[0].internalformat,N.width=w[0].width,N.height=w[0].height,Ke(y),P=0;P<6;++P)ve(w[P],Rs+P);for(ze(Y,io),oe(),$.profile&&(y.stats.size=Fs(y.internalformat,y.type,N.width,N.height,Y.genMipmaps,!0)),N.format=nt[y.internalformat],N.type=Et[y.type],N.mag=J[Y.magFilter],N.min=bt[Y.minFilter],N.wrapS=gt[Y.wrapS],N.wrapT=gt[Y.wrapT],P=0;P<6;++P)Pe(w[P]);return N}function F(M,R,_,T,v){p(!!R,"must specify image data"),p(typeof M=="number"&&M===(M|0)&&M>=0&&M<6,"invalid face");var D=_|0,P=T|0,Y=v|0,ht=_t();return Z(ht,y),ht.width=0,ht.height=0,mt(ht,R),ht.width=ht.width||(y.width>>Y)-D,ht.height=ht.height||(y.height>>Y)-P,p(y.type===ht.type&&y.format===ht.format&&y.internalformat===ht.internalformat,"incompatible format for texture.subimage"),p(D>=0&&P>=0&&D+ht.width<=y.width&&P+ht.height<=y.height,"texture.subimage write out of bounds"),p(y.mipmask&1<<Y,"missing mipmap data"),p(ht.data||ht.element||ht.needsCopy,"missing image data"),Ke(y),Ht(ht,Rs+M,D,P,Y),oe(),vt(ht),N}function C(M){var R=M|0;if(R!==y.width){N.width=y.width=R,N.height=y.height=R,Ke(y);for(var _=0;_<6;++_)for(var T=0;y.mipmask>>T;++T)u.texImage2D(Rs+_,T,y.format,R>>T,R>>T,0,y.format,y.type,null);return oe(),$.profile&&(y.stats.size=Fs(y.internalformat,y.type,N.width,N.height,!1,!0)),N}}return N(E,j,z,St,Kt,x),N.subimage=F,N.resize=C,N._reglType="textureCube",N._texture=y,$.profile&&(N.stats=y.stats),N.destroy=function(){y.decRef()},N}function Ie(){for(var E=0;E<qe;++E)u.activeTexture(Ji+E),u.bindTexture(Dr,null),Ce[E]=null;gr($e).forEach(zt),U.cubeCount=0,U.textureCount=0}$.profile&&(U.getTotalTextureSize=function(){var E=0;return Object.keys($e).forEach(function(j){E+=$e[j].stats.size}),E});function Pr(){for(var E=0;E<qe;++E){var j=Ce[E];j&&(j.bindCount=0,j.unit=-1,Ce[E]=null)}gr($e).forEach(function(z){z.texture=u.createTexture(),u.bindTexture(z.target,z.texture);for(var St=0;St<32;++St)if((z.mipmask&1<<St)!==0)if(z.target===Dr)u.texImage2D(Dr,St,z.internalformat,z.width>>St,z.height>>St,0,z.internalformat,z.type,null);else for(var Kt=0;Kt<6;++Kt)u.texImage2D(Rs+Kt,St,z.internalformat,z.width>>St,z.height>>St,0,z.internalformat,z.type,null);ze(z.texInfo,z.target)})}function zn(){for(var E=0;E<qe;++E){var j=Ce[E];j&&(j.bindCount=0,j.unit=-1,Ce[E]=null),u.activeTexture(Ji+E),u.bindTexture(Dr,null),u.bindTexture(io,null)}}return{create2D:te,createCube:ie,clear:Ie,getTexture:function(E){return null},restore:Pr,refresh:zn}}var un=36161,Ps=32854,Yl=32855,Xl=36194,Jl=33189,ql=36168,Kl=34041,Ql=35907,tu=34836,eu=34842,ru=34843,Cr=[];Cr[Ps]=2,Cr[Yl]=2,Cr[Xl]=2,Cr[Jl]=2,Cr[ql]=1,Cr[Kl]=4,Cr[Ql]=4,Cr[tu]=16,Cr[eu]=8,Cr[ru]=6;function nu(u,g,A){return Cr[u]*g*A}var y0=function(u,g,A,G,W){var U={rgba4:Ps,rgb565:Xl,"rgb5 a1":Yl,depth:Jl,stencil:ql,"depth stencil":Kl};g.ext_srgb&&(U.srgba=Ql),g.ext_color_buffer_half_float&&(U.rgba16f=eu,U.rgb16f=ru),g.webgl_color_buffer_float&&(U.rgba32f=tu);var $=[];Object.keys(U).forEach(function(tt){var it=U[tt];$[it]=tt});var Q=0,K={};function at(tt){this.id=Q++,this.refCount=1,this.renderbuffer=tt,this.format=Ps,this.width=0,this.height=0,W.profile&&(this.stats={size:0})}at.prototype.decRef=function(){--this.refCount<=0&&ct(this)};function ct(tt){var it=tt.renderbuffer;p(it,"must not double destroy renderbuffer"),u.bindRenderbuffer(un,null),u.deleteRenderbuffer(it),tt.renderbuffer=null,tt.refCount=0,delete K[tt.id],G.renderbufferCount--}function ot(tt,it){var L=new at(u.createRenderbuffer());K[L.id]=L,G.renderbufferCount++;function V(Et,J){var bt=0,gt=0,Dt=Ps;if(typeof Et=="object"&&Et){var H=Et;if("shape"in H){var Z=H.shape;p(Array.isArray(Z)&&Z.length>=2,"invalid renderbuffer shape"),bt=Z[0]|0,gt=Z[1]|0}else"radius"in H&&(bt=gt=H.radius|0),"width"in H&&(bt=H.width|0),"height"in H&&(gt=H.height|0);"format"in H&&(p.parameter(H.format,U,"invalid renderbuffer format"),Dt=U[H.format])}else typeof Et=="number"?(bt=Et|0,typeof J=="number"?gt=J|0:gt=bt):Et?p.raise("invalid arguments to renderbuffer constructor"):bt=gt=1;if(p(bt>0&&gt>0&&bt<=A.maxRenderbufferSize&&gt<=A.maxRenderbufferSize,"invalid renderbuffer size"),!(bt===L.width&&gt===L.height&&Dt===L.format))return V.width=L.width=bt,V.height=L.height=gt,L.format=Dt,u.bindRenderbuffer(un,L.renderbuffer),u.renderbufferStorage(un,Dt,bt,gt),p(u.getError()===0,"invalid render buffer format"),W.profile&&(L.stats.size=nu(L.format,L.width,L.height)),V.format=$[L.format],V}function nt(Et,J){var bt=Et|0,gt=J|0||bt;return bt===L.width&&gt===L.height||(p(bt>0&&gt>0&&bt<=A.maxRenderbufferSize&&gt<=A.maxRenderbufferSize,"invalid renderbuffer size"),V.width=L.width=bt,V.height=L.height=gt,u.bindRenderbuffer(un,L.renderbuffer),u.renderbufferStorage(un,L.format,bt,gt),p(u.getError()===0,"invalid render buffer format"),W.profile&&(L.stats.size=nu(L.format,L.width,L.height))),V}return V(tt,it),V.resize=nt,V._reglType="renderbuffer",V._renderbuffer=L,W.profile&&(V.stats=L.stats),V.destroy=function(){L.decRef()},V}W.profile&&(G.getTotalRenderbufferSize=function(){var tt=0;return Object.keys(K).forEach(function(it){tt+=K[it].stats.size}),tt});function dt(){gr(K).forEach(function(tt){tt.renderbuffer=u.createRenderbuffer(),u.bindRenderbuffer(un,tt.renderbuffer),u.renderbufferStorage(un,tt.format,tt.width,tt.height)}),u.bindRenderbuffer(un,null)}return{create:ot,clear:function(){gr(K).forEach(ct)},restore:dt}},Zr=36160,Eo=36161,Nn=3553,zs=34069,iu=36064,su=36096,au=36128,ou=33306,cu=36053,g0=36054,_0=36055,x0=36057,b0=36061,v0=36193,E0=5121,A0=5126,lu=6407,uu=6408,T0=6402,w0=[lu,uu],Ao=[];Ao[uu]=4,Ao[lu]=3;var Bs=[];Bs[E0]=1,Bs[A0]=4,Bs[v0]=2;var S0=32854,M0=32855,C0=36194,I0=33189,R0=36168,hu=34041,O0=35907,N0=34836,L0=34842,k0=34843,D0=[S0,M0,C0,O0,L0,k0,N0],si={};si[cu]="complete",si[g0]="incomplete attachment",si[x0]="incomplete dimensions",si[_0]="incomplete, missing attachment",si[b0]="unsupported";function F0(u,g,A,G,W,U){var $={cur:null,next:null,dirty:!1,setFBO:null},Q=["rgba"],K=["rgba4","rgb565","rgb5 a1"];g.ext_srgb&&K.push("srgba"),g.ext_color_buffer_half_float&&K.push("rgba16f","rgb16f"),g.webgl_color_buffer_float&&K.push("rgba32f");var at=["uint8"];g.oes_texture_half_float&&at.push("half float","float16"),g.oes_texture_float&&at.push("float","float32");function ct(rt,mt,yt){this.target=rt,this.texture=mt,this.renderbuffer=yt;var Ht=0,jt=0;mt?(Ht=mt.width,jt=mt.height):yt&&(Ht=yt.width,jt=yt.height),this.width=Ht,this.height=jt}function ot(rt){rt&&(rt.texture&&rt.texture._texture.decRef(),rt.renderbuffer&&rt.renderbuffer._renderbuffer.decRef())}function dt(rt,mt,yt){if(rt)if(rt.texture){var Ht=rt.texture._texture,jt=Math.max(1,Ht.width),_t=Math.max(1,Ht.height);p(jt===mt&&_t===yt,"inconsistent width/height for supplied texture"),Ht.refCount+=1}else{var vt=rt.renderbuffer._renderbuffer;p(vt.width===mt&&vt.height===yt,"inconsistent width/height for renderbuffer"),vt.refCount+=1}}function tt(rt,mt){mt&&(mt.texture?u.framebufferTexture2D(Zr,rt,mt.target,mt.texture._texture.texture,0):u.framebufferRenderbuffer(Zr,rt,Eo,mt.renderbuffer._renderbuffer.renderbuffer))}function it(rt){var mt=Nn,yt=null,Ht=null,jt=rt;typeof rt=="object"&&(jt=rt.data,"target"in rt&&(mt=rt.target|0)),p.type(jt,"function","invalid attachment data");var _t=jt._reglType;return _t==="texture2d"?(yt=jt,p(mt===Nn)):_t==="textureCube"?(yt=jt,p(mt>=zs&&mt<zs+6,"invalid cube map target")):_t==="renderbuffer"?(Ht=jt,mt=Eo):p.raise("invalid regl object for attachment"),new ct(mt,yt,Ht)}function L(rt,mt,yt,Ht,jt){if(yt){var _t=G.create2D({width:rt,height:mt,format:Ht,type:jt});return _t._texture.refCount=0,new ct(Nn,_t,null)}else{var vt=W.create({width:rt,height:mt,format:Ht});return vt._renderbuffer.refCount=0,new ct(Eo,null,vt)}}function V(rt){return rt&&(rt.texture||rt.renderbuffer)}function nt(rt,mt,yt){rt&&(rt.texture?rt.texture.resize(mt,yt):rt.renderbuffer&&rt.renderbuffer.resize(mt,yt),rt.width=mt,rt.height=yt)}var Et=0,J={};function bt(){this.id=Et++,J[this.id]=this,this.framebuffer=u.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function gt(rt){rt.colorAttachments.forEach(ot),ot(rt.depthAttachment),ot(rt.stencilAttachment),ot(rt.depthStencilAttachment)}function Dt(rt){var mt=rt.framebuffer;p(mt,"must not double destroy framebuffer"),u.deleteFramebuffer(mt),rt.framebuffer=null,U.framebufferCount--,delete J[rt.id]}function H(rt){var mt;u.bindFramebuffer(Zr,rt.framebuffer);var yt=rt.colorAttachments;for(mt=0;mt<yt.length;++mt)tt(iu+mt,yt[mt]);for(mt=yt.length;mt<A.maxColorAttachments;++mt)u.framebufferTexture2D(Zr,iu+mt,Nn,null,0);u.framebufferTexture2D(Zr,ou,Nn,null,0),u.framebufferTexture2D(Zr,su,Nn,null,0),u.framebufferTexture2D(Zr,au,Nn,null,0),tt(su,rt.depthAttachment),tt(au,rt.stencilAttachment),tt(ou,rt.depthStencilAttachment);var Ht=u.checkFramebufferStatus(Zr);!u.isContextLost()&&Ht!==cu&&p.raise("framebuffer configuration not supported, status = "+si[Ht]),u.bindFramebuffer(Zr,$.next?$.next.framebuffer:null),$.cur=$.next,u.getError()}function Z(rt,mt){var yt=new bt;U.framebufferCount++;function Ht(_t,vt){var Bt;p($.next!==yt,"can not update framebuffer which is currently in use");var Wt=0,Qt=0,ve=!0,Ae=!0,ee=null,Pe=!0,_e="rgba",ke="uint8",ze=1,Be=null,$e=null,qe=null,Ce=!1;if(typeof _t=="number")Wt=_t|0,Qt=vt|0||Wt;else if(!_t)Wt=Qt=1;else{p.type(_t,"object","invalid arguments for framebuffer");var Xt=_t;if("shape"in Xt){var Ke=Xt.shape;p(Array.isArray(Ke)&&Ke.length>=2,"invalid shape for framebuffer"),Wt=Ke[0],Qt=Ke[1]}else"radius"in Xt&&(Wt=Qt=Xt.radius),"width"in Xt&&(Wt=Xt.width),"height"in Xt&&(Qt=Xt.height);("color"in Xt||"colors"in Xt)&&(ee=Xt.color||Xt.colors,Array.isArray(ee)&&p(ee.length===1||g.webgl_draw_buffers,"multiple render targets not supported")),ee||("colorCount"in Xt&&(ze=Xt.colorCount|0,p(ze>0,"invalid color buffer count")),"colorTexture"in Xt&&(Pe=!!Xt.colorTexture,_e="rgba4"),"colorType"in Xt&&(ke=Xt.colorType,Pe?(p(g.oes_texture_float||!(ke==="float"||ke==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),p(g.oes_texture_half_float||!(ke==="half float"||ke==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ke==="half float"||ke==="float16"?(p(g.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_e="rgba16f"):(ke==="float"||ke==="float32")&&(p(g.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_e="rgba32f"),p.oneOf(ke,at,"invalid color type")),"colorFormat"in Xt&&(_e=Xt.colorFormat,Q.indexOf(_e)>=0?Pe=!0:K.indexOf(_e)>=0?Pe=!1:p.optional(function(){Pe?p.oneOf(Xt.colorFormat,Q,"invalid color format for texture"):p.oneOf(Xt.colorFormat,K,"invalid color format for renderbuffer")}))),("depthTexture"in Xt||"depthStencilTexture"in Xt)&&(Ce=!!(Xt.depthTexture||Xt.depthStencilTexture),p(!Ce||g.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Xt&&(typeof Xt.depth=="boolean"?ve=Xt.depth:(Be=Xt.depth,Ae=!1)),"stencil"in Xt&&(typeof Xt.stencil=="boolean"?Ae=Xt.stencil:($e=Xt.stencil,ve=!1)),"depthStencil"in Xt&&(typeof Xt.depthStencil=="boolean"?ve=Ae=Xt.depthStencil:(qe=Xt.depthStencil,ve=!1,Ae=!1))}var oe=null,zt=null,te=null,ie=null;if(Array.isArray(ee))oe=ee.map(it);else if(ee)oe=[it(ee)];else for(oe=new Array(ze),Bt=0;Bt<ze;++Bt)oe[Bt]=L(Wt,Qt,Pe,_e,ke);p(g.webgl_draw_buffers||oe.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),p(oe.length<=A.maxColorAttachments,"too many color attachments, not supported"),Wt=Wt||oe[0].width,Qt=Qt||oe[0].height,Be?zt=it(Be):ve&&!Ae&&(zt=L(Wt,Qt,Ce,"depth","uint32")),$e?te=it($e):Ae&&!ve&&(te=L(Wt,Qt,!1,"stencil","uint8")),qe?ie=it(qe):!Be&&!$e&&Ae&&ve&&(ie=L(Wt,Qt,Ce,"depth stencil","depth stencil")),p(!!Be+!!$e+!!qe<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ie=null;for(Bt=0;Bt<oe.length;++Bt)if(dt(oe[Bt],Wt,Qt),p(!oe[Bt]||oe[Bt].texture&&w0.indexOf(oe[Bt].texture._texture.format)>=0||oe[Bt].renderbuffer&&D0.indexOf(oe[Bt].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Bt+" is invalid"),oe[Bt]&&oe[Bt].texture){var Pr=Ao[oe[Bt].texture._texture.format]*Bs[oe[Bt].texture._texture.type];Ie===null?Ie=Pr:p(Ie===Pr,"all color attachments much have the same number of bits per pixel.")}return dt(zt,Wt,Qt),p(!zt||zt.texture&&zt.texture._texture.format===T0||zt.renderbuffer&&zt.renderbuffer._renderbuffer.format===I0,"invalid depth attachment for framebuffer object"),dt(te,Wt,Qt),p(!te||te.renderbuffer&&te.renderbuffer._renderbuffer.format===R0,"invalid stencil attachment for framebuffer object"),dt(ie,Wt,Qt),p(!ie||ie.texture&&ie.texture._texture.format===hu||ie.renderbuffer&&ie.renderbuffer._renderbuffer.format===hu,"invalid depth-stencil attachment for framebuffer object"),gt(yt),yt.width=Wt,yt.height=Qt,yt.colorAttachments=oe,yt.depthAttachment=zt,yt.stencilAttachment=te,yt.depthStencilAttachment=ie,Ht.color=oe.map(V),Ht.depth=V(zt),Ht.stencil=V(te),Ht.depthStencil=V(ie),Ht.width=yt.width,Ht.height=yt.height,H(yt),Ht}function jt(_t,vt){p($.next!==yt,"can not resize a framebuffer which is currently in use");var Bt=Math.max(_t|0,1),Wt=Math.max(vt|0||Bt,1);if(Bt===yt.width&&Wt===yt.height)return Ht;for(var Qt=yt.colorAttachments,ve=0;ve<Qt.length;++ve)nt(Qt[ve],Bt,Wt);return nt(yt.depthAttachment,Bt,Wt),nt(yt.stencilAttachment,Bt,Wt),nt(yt.depthStencilAttachment,Bt,Wt),yt.width=Ht.width=Bt,yt.height=Ht.height=Wt,H(yt),Ht}return Ht(rt,mt),n(Ht,{resize:jt,_reglType:"framebuffer",_framebuffer:yt,destroy:function(){Dt(yt),gt(yt)},use:function(_t){$.setFBO({framebuffer:Ht},_t)}})}function Mt(rt){var mt=Array(6);function yt(jt){var _t;p(mt.indexOf($.next)<0,"can not update framebuffer which is currently in use");var vt={color:null},Bt=0,Wt=null,Qt="rgba",ve="uint8",Ae=1;if(typeof jt=="number")Bt=jt|0;else if(!jt)Bt=1;else{p.type(jt,"object","invalid arguments for framebuffer");var ee=jt;if("shape"in ee){var Pe=ee.shape;p(Array.isArray(Pe)&&Pe.length>=2,"invalid shape for framebuffer"),p(Pe[0]===Pe[1],"cube framebuffer must be square"),Bt=Pe[0]}else"radius"in ee&&(Bt=ee.radius|0),"width"in ee?(Bt=ee.width|0,"height"in ee&&p(ee.height===Bt,"must be square")):"height"in ee&&(Bt=ee.height|0);("color"in ee||"colors"in ee)&&(Wt=ee.color||ee.colors,Array.isArray(Wt)&&p(Wt.length===1||g.webgl_draw_buffers,"multiple render targets not supported")),Wt||("colorCount"in ee&&(Ae=ee.colorCount|0,p(Ae>0,"invalid color buffer count")),"colorType"in ee&&(p.oneOf(ee.colorType,at,"invalid color type"),ve=ee.colorType),"colorFormat"in ee&&(Qt=ee.colorFormat,p.oneOf(ee.colorFormat,Q,"invalid color format for texture"))),"depth"in ee&&(vt.depth=ee.depth),"stencil"in ee&&(vt.stencil=ee.stencil),"depthStencil"in ee&&(vt.depthStencil=ee.depthStencil)}var _e;if(Wt)if(Array.isArray(Wt))for(_e=[],_t=0;_t<Wt.length;++_t)_e[_t]=Wt[_t];else _e=[Wt];else{_e=Array(Ae);var ke={radius:Bt,format:Qt,type:ve};for(_t=0;_t<Ae;++_t)_e[_t]=G.createCube(ke)}for(vt.color=Array(_e.length),_t=0;_t<_e.length;++_t){var ze=_e[_t];p(typeof ze=="function"&&ze._reglType==="textureCube","invalid cube map"),Bt=Bt||ze.width,p(ze.width===Bt&&ze.height===Bt,"invalid cube map shape"),vt.color[_t]={target:zs,data:_e[_t]}}for(_t=0;_t<6;++_t){for(var Be=0;Be<_e.length;++Be)vt.color[Be].target=zs+_t;_t>0&&(vt.depth=mt[0].depth,vt.stencil=mt[0].stencil,vt.depthStencil=mt[0].depthStencil),mt[_t]?mt[_t](vt):mt[_t]=Z(vt)}return n(yt,{width:Bt,height:Bt,color:_e})}function Ht(jt){var _t,vt=jt|0;if(p(vt>0&&vt<=A.maxCubeMapSize,"invalid radius for cube fbo"),vt===yt.width)return yt;var Bt=yt.color;for(_t=0;_t<Bt.length;++_t)Bt[_t].resize(vt);for(_t=0;_t<6;++_t)mt[_t].resize(vt);return yt.width=yt.height=vt,yt}return yt(rt),n(yt,{faces:mt,resize:Ht,_reglType:"framebufferCube",destroy:function(){mt.forEach(function(jt){jt.destroy()})}})}function pt(){$.cur=null,$.next=null,$.dirty=!0,gr(J).forEach(function(rt){rt.framebuffer=u.createFramebuffer(),H(rt)})}return n($,{getFramebuffer:function(rt){if(typeof rt=="function"&&rt._reglType==="framebuffer"){var mt=rt._framebuffer;if(mt instanceof bt)return mt}return null},create:Z,createCube:Mt,clear:function(){gr(J).forEach(Dt)},restore:pt})}var P0=5126,fu=34962,Us=34963,du=["attributes","elements","offset","count","primitive","instances"];function To(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=P0,this.offset=0,this.stride=0,this.divisor=0}function z0(u,g,A,G,W,U,$){for(var Q=A.maxAttributes,K=new Array(Q),at=0;at<Q;++at)K[at]=new To;var ct=0,ot={},dt={Record:To,scope:{},state:K,currentVAO:null,targetVAO:null,restore:it()?gt:function(){},createVAO:Dt,getVAO:V,destroyBuffer:tt,setVAO:it()?nt:Et,clear:it()?J:function(){}};function tt(H){for(var Z=0;Z<K.length;++Z){var Mt=K[Z];Mt.buffer===H&&(u.disableVertexAttribArray(Z),Mt.buffer=null)}}function it(){return g.oes_vertex_array_object}function L(){return g.angle_instanced_arrays}function V(H){return typeof H=="function"&&H._vao?H._vao:null}function nt(H){if(H!==dt.currentVAO){var Z=it();H?Z.bindVertexArrayOES(H.vao):Z.bindVertexArrayOES(null),dt.currentVAO=H}}function Et(H){if(H!==dt.currentVAO){if(H)H.bindAttrs();else{for(var Z=L(),Mt=0;Mt<K.length;++Mt){var pt=K[Mt];pt.buffer?(u.enableVertexAttribArray(Mt),pt.buffer.bind(),u.vertexAttribPointer(Mt,pt.size,pt.type,pt.normalized,pt.stride,pt.offfset),Z&&pt.divisor&&Z.vertexAttribDivisorANGLE(Mt,pt.divisor)):(u.disableVertexAttribArray(Mt),u.vertexAttrib4f(Mt,pt.x,pt.y,pt.z,pt.w))}$.elements?u.bindBuffer(Us,$.elements.buffer.buffer):u.bindBuffer(Us,null)}dt.currentVAO=H}}function J(){gr(ot).forEach(function(H){H.destroy()})}function bt(){this.id=++ct,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var H=it();H?this.vao=H.createVertexArrayOES():this.vao=null,ot[this.id]=this,this.buffers=[]}bt.prototype.bindAttrs=function(){for(var H=L(),Z=this.attributes,Mt=0;Mt<Z.length;++Mt){var pt=Z[Mt];pt.buffer?(u.enableVertexAttribArray(Mt),u.bindBuffer(fu,pt.buffer.buffer),u.vertexAttribPointer(Mt,pt.size,pt.type,pt.normalized,pt.stride,pt.offset),H&&pt.divisor&&H.vertexAttribDivisorANGLE(Mt,pt.divisor)):(u.disableVertexAttribArray(Mt),u.vertexAttrib4f(Mt,pt.x,pt.y,pt.z,pt.w))}for(var rt=Z.length;rt<Q;++rt)u.disableVertexAttribArray(rt);var mt=U.getElements(this.elements);mt?u.bindBuffer(Us,mt.buffer.buffer):u.bindBuffer(Us,null)},bt.prototype.refresh=function(){var H=it();H&&(H.bindVertexArrayOES(this.vao),this.bindAttrs(),dt.currentVAO=null,H.bindVertexArrayOES(null))},bt.prototype.destroy=function(){if(this.vao){var H=it();this===dt.currentVAO&&(dt.currentVAO=null,H.bindVertexArrayOES(null)),H.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),ot[this.id]&&(delete ot[this.id],G.vaoCount-=1)};function gt(){var H=it();H&&gr(ot).forEach(function(Z){Z.refresh()})}function Dt(H){var Z=new bt;G.vaoCount+=1;function Mt(pt){var rt;if(Array.isArray(pt))rt=pt,Z.elements&&Z.ownsElements&&Z.elements.destroy(),Z.elements=null,Z.ownsElements=!1,Z.offset=0,Z.count=0,Z.instances=-1,Z.primitive=4;else{if(p(typeof pt=="object","invalid arguments for create vao"),p("attributes"in pt,"must specify attributes for vao"),pt.elements){var mt=pt.elements;Z.ownsElements?typeof mt=="function"&&mt._reglType==="elements"?(Z.elements.destroy(),Z.ownsElements=!1):(Z.elements(mt),Z.ownsElements=!1):U.getElements(pt.elements)?(Z.elements=pt.elements,Z.ownsElements=!1):(Z.elements=U.create(pt.elements),Z.ownsElements=!0)}else Z.elements=null,Z.ownsElements=!1;rt=pt.attributes,Z.offset=0,Z.count=-1,Z.instances=-1,Z.primitive=4,Z.elements&&(Z.count=Z.elements._elements.vertCount,Z.primitive=Z.elements._elements.primType),"offset"in pt&&(Z.offset=pt.offset|0),"count"in pt&&(Z.count=pt.count|0),"instances"in pt&&(Z.instances=pt.instances|0),"primitive"in pt&&(p(pt.primitive in ln,"bad primitive type: "+pt.primitive),Z.primitive=ln[pt.primitive]),p.optional(()=>{for(var ve=Object.keys(pt),Ae=0;Ae<ve.length;++Ae)p(du.indexOf(ve[Ae])>=0,'invalid option for vao: "'+ve[Ae]+'" valid options are '+du)}),p(Array.isArray(rt),"attributes must be an array")}p(rt.length<Q,"too many attributes"),p(rt.length>0,"must specify at least one attribute");var yt={},Ht=Z.attributes;Ht.length=rt.length;for(var jt=0;jt<rt.length;++jt){var _t=rt[jt],vt=Ht[jt]=new To,Bt=_t.data||_t;if(Array.isArray(Bt)||e(Bt)||Mr(Bt)){var Wt;Z.buffers[jt]&&(Wt=Z.buffers[jt],e(Bt)&&Wt._buffer.byteLength>=Bt.byteLength?Wt.subdata(Bt):(Wt.destroy(),Z.buffers[jt]=null)),Z.buffers[jt]||(Wt=Z.buffers[jt]=W.create(_t,fu,!1,!0)),vt.buffer=W.getBuffer(Wt),vt.size=vt.buffer.dimension|0,vt.normalized=!1,vt.type=vt.buffer.dtype,vt.offset=0,vt.stride=0,vt.divisor=0,vt.state=1,yt[jt]=1}else W.getBuffer(_t)?(vt.buffer=W.getBuffer(_t),vt.size=vt.buffer.dimension|0,vt.normalized=!1,vt.type=vt.buffer.dtype,vt.offset=0,vt.stride=0,vt.divisor=0,vt.state=1):W.getBuffer(_t.buffer)?(vt.buffer=W.getBuffer(_t.buffer),vt.size=(+_t.size||vt.buffer.dimension)|0,vt.normalized=!!_t.normalized||!1,"type"in _t?(p.parameter(_t.type,Cn,"invalid buffer type"),vt.type=Cn[_t.type]):vt.type=vt.buffer.dtype,vt.offset=(_t.offset||0)|0,vt.stride=(_t.stride||0)|0,vt.divisor=(_t.divisor||0)|0,vt.state=1,p(vt.size>=1&&vt.size<=4,"size must be between 1 and 4"),p(vt.offset>=0,"invalid offset"),p(vt.stride>=0&&vt.stride<=255,"stride must be between 0 and 255"),p(vt.divisor>=0,"divisor must be positive"),p(!vt.divisor||!!g.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in _t?(p(jt>0,"first attribute must not be a constant"),vt.x=+_t.x||0,vt.y=+_t.y||0,vt.z=+_t.z||0,vt.w=+_t.w||0,vt.state=2):p(!1,"invalid attribute spec for location "+jt)}for(var Qt=0;Qt<Z.buffers.length;++Qt)!yt[Qt]&&Z.buffers[Qt]&&(Z.buffers[Qt].destroy(),Z.buffers[Qt]=null);return Z.refresh(),Mt}return Mt.destroy=function(){for(var pt=0;pt<Z.buffers.length;++pt)Z.buffers[pt]&&Z.buffers[pt].destroy();Z.buffers.length=0,Z.ownsElements&&(Z.elements.destroy(),Z.elements=null,Z.ownsElements=!1),Z.destroy()},Mt._vao=Z,Mt._reglType="vao",Mt(H)}return dt}var pu=35632,B0=35633,U0=35718,G0=35721;function j0(u,g,A,G){var W={},U={};function $(L,V,nt,Et){this.name=L,this.id=V,this.location=nt,this.info=Et}function Q(L,V){for(var nt=0;nt<L.length;++nt)if(L[nt].id===V.id){L[nt].location=V.location;return}L.push(V)}function K(L,V,nt){var Et=L===pu?W:U,J=Et[V];if(!J){var bt=g.str(V);J=u.createShader(L),u.shaderSource(J,bt),u.compileShader(J),p.shaderError(u,J,bt,L,nt),Et[V]=J}return J}var at={},ct=[],ot=0;function dt(L,V){this.id=ot++,this.fragId=L,this.vertId=V,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,G.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function tt(L,V,nt){var Et,J,bt=K(pu,L.fragId),gt=K(B0,L.vertId),Dt=L.program=u.createProgram();if(u.attachShader(Dt,bt),u.attachShader(Dt,gt),nt)for(Et=0;Et<nt.length;++Et){var H=nt[Et];u.bindAttribLocation(Dt,H[0],H[1])}u.linkProgram(Dt),p.linkError(u,Dt,g.str(L.fragId),g.str(L.vertId),V);var Z=u.getProgramParameter(Dt,U0);G.profile&&(L.stats.uniformsCount=Z);var Mt=L.uniforms;for(Et=0;Et<Z;++Et)if(J=u.getActiveUniform(Dt,Et),J)if(J.size>1)for(var pt=0;pt<J.size;++pt){var rt=J.name.replace("[0]","["+pt+"]");Q(Mt,new $(rt,g.id(rt),u.getUniformLocation(Dt,rt),J))}else Q(Mt,new $(J.name,g.id(J.name),u.getUniformLocation(Dt,J.name),J));var mt=u.getProgramParameter(Dt,G0);G.profile&&(L.stats.attributesCount=mt);var yt=L.attributes;for(Et=0;Et<mt;++Et)J=u.getActiveAttrib(Dt,Et),J&&Q(yt,new $(J.name,g.id(J.name),u.getAttribLocation(Dt,J.name),J))}G.profile&&(A.getMaxUniformsCount=function(){var L=0;return ct.forEach(function(V){V.stats.uniformsCount>L&&(L=V.stats.uniformsCount)}),L},A.getMaxAttributesCount=function(){var L=0;return ct.forEach(function(V){V.stats.attributesCount>L&&(L=V.stats.attributesCount)}),L});function it(){W={},U={};for(var L=0;L<ct.length;++L)tt(ct[L],null,ct[L].attributes.map(function(V){return[V.location,V.name]}))}return{clear:function(){var L=u.deleteShader.bind(u);gr(W).forEach(L),W={},gr(U).forEach(L),U={},ct.forEach(function(V){u.deleteProgram(V.program)}),ct.length=0,at={},A.shaderCount=0},program:function(L,V,nt,Et){p.command(L>=0,"missing vertex shader",nt),p.command(V>=0,"missing fragment shader",nt);var J=at[V];J||(J=at[V]={});var bt=J[L];if(bt&&(bt.refCount++,!Et))return bt;var gt=new dt(V,L);return A.shaderCount++,tt(gt,nt,Et),bt||(J[L]=gt),ct.push(gt),n(gt,{destroy:function(){if(gt.refCount--,gt.refCount<=0){u.deleteProgram(gt.program);var Dt=ct.indexOf(gt);ct.splice(Dt,1),A.shaderCount--}J[gt.vertId].refCount<=0&&(u.deleteShader(U[gt.vertId]),delete U[gt.vertId],delete at[gt.fragId][gt.vertId]),Object.keys(at[gt.fragId]).length||(u.deleteShader(W[gt.fragId]),delete W[gt.fragId],delete at[gt.fragId])}})},restore:it,shader:K,frag:-1,vert:-1}}var V0=6408,qi=5121,$0=3333,Gs=5126;function Z0(u,g,A,G,W,U,$){function Q(ct){var ot;g.next===null?(p(W.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ot=qi):(p(g.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ot=g.next.colorAttachments[0].texture._texture.type,p.optional(function(){U.oes_texture_float?(p(ot===qi||ot===Gs,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ot===Gs&&p($.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):p(ot===qi,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var dt=0,tt=0,it=G.framebufferWidth,L=G.framebufferHeight,V=null;e(ct)?V=ct:ct&&(p.type(ct,"object","invalid arguments to regl.read()"),dt=ct.x|0,tt=ct.y|0,p(dt>=0&&dt<G.framebufferWidth,"invalid x offset for regl.read"),p(tt>=0&&tt<G.framebufferHeight,"invalid y offset for regl.read"),it=(ct.width||G.framebufferWidth-dt)|0,L=(ct.height||G.framebufferHeight-tt)|0,V=ct.data||null),V&&(ot===qi?p(V instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ot===Gs&&p(V instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),p(it>0&&it+dt<=G.framebufferWidth,"invalid width for read pixels"),p(L>0&&L+tt<=G.framebufferHeight,"invalid height for read pixels"),A();var nt=it*L*4;return V||(ot===qi?V=new Uint8Array(nt):ot===Gs&&(V=V||new Float32Array(nt))),p.isTypedArray(V,"data buffer for regl.read() must be a typedarray"),p(V.byteLength>=nt,"data buffer for regl.read() too small"),u.pixelStorei($0,4),u.readPixels(dt,tt,it,L,V0,ot,V),V}function K(ct){var ot;return g.setFBO({framebuffer:ct.framebuffer},function(){ot=Q(ct)}),ot}function at(ct){return!ct||!("framebuffer"in ct)?Q(ct):K(ct)}return at}function ai(u){return Array.prototype.slice.call(u)}function oi(u){return ai(u).join("")}function W0(){var u=0,g=[],A=[];function G(ot){for(var dt=0;dt<A.length;++dt)if(A[dt]===ot)return g[dt];var tt="g"+u++;return g.push(tt),A.push(ot),tt}function W(){var ot=[];function dt(){ot.push.apply(ot,ai(arguments))}var tt=[];function it(){var L="v"+u++;return tt.push(L),arguments.length>0&&(ot.push(L,"="),ot.push.apply(ot,ai(arguments)),ot.push(";")),L}return n(dt,{def:it,toString:function(){return oi([tt.length>0?"var "+tt.join(",")+";":"",oi(ot)])}})}function U(){var ot=W(),dt=W(),tt=ot.toString,it=dt.toString;function L(V,nt){dt(V,nt,"=",ot.def(V,nt),";")}return n(function(){ot.apply(ot,ai(arguments))},{def:ot.def,entry:ot,exit:dt,save:L,set:function(V,nt,Et){L(V,nt),ot(V,nt,"=",Et,";")},toString:function(){return tt()+it()}})}function $(){var ot=oi(arguments),dt=U(),tt=U(),it=dt.toString,L=tt.toString;return n(dt,{then:function(){return dt.apply(dt,ai(arguments)),this},else:function(){return tt.apply(tt,ai(arguments)),this},toString:function(){var V=L();return V&&(V="else{"+V+"}"),oi(["if(",ot,"){",it(),"}",V])}})}var Q=W(),K={};function at(ot,dt){var tt=[];function it(){var J="a"+tt.length;return tt.push(J),J}dt=dt||0;for(var L=0;L<dt;++L)it();var V=U(),nt=V.toString,Et=K[ot]=n(V,{arg:it,toString:function(){return oi(["function(",tt.join(),"){",nt(),"}"])}});return Et}function ct(){var ot=['"use strict";',Q,"return {"];Object.keys(K).forEach(function(it){ot.push('"',it,'":',K[it].toString(),",")}),ot.push("}");var dt=oi(ot).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),tt=Function.apply(null,g.concat(dt));return tt.apply(null,A)}return{global:Q,link:G,block:W,proc:at,scope:U,cond:$,compile:ct}}var ci="xyzw".split(""),mu=5121,li=1,wo=2,So=0,Mo=1,Co=2,Io=3,js=4,yu=5,gu=6,_u="dither",xu="blend.enable",bu="blend.color",Ro="blend.equation",Oo="blend.func",vu="depth.enable",Eu="depth.func",Au="depth.range",Tu="depth.mask",No="colorMask",wu="cull.enable",Su="cull.face",Lo="frontFace",ko="lineWidth",Mu="polygonOffset.enable",Do="polygonOffset.offset",Cu="sample.alpha",Iu="sample.enable",Fo="sample.coverage",Ru="stencil.enable",Ou="stencil.mask",Po="stencil.func",zo="stencil.opFront",Ki="stencil.opBack",Nu="scissor.enable",Vs="scissor.box",Wr="viewport",Qi="profile",Ln="framebuffer",ts="vert",es="frag",kn="elements",Dn="primitive",Fn="count",$s="offset",Zs="instances",rs="vao",Bo="Width",Uo="Height",ui=Ln+Bo,hi=Ln+Uo,H0=Wr+Bo,Y0=Wr+Uo,Lu="drawingBuffer",ku=Lu+Bo,Du=Lu+Uo,X0=[Oo,Ro,Po,zo,Ki,Fo,Wr,Vs,Do],fi=34962,Go=34963,J0=35632,q0=35633,Fu=3553,K0=34067,Q0=2884,ty=3042,ey=3024,ry=2960,ny=2929,iy=3089,sy=32823,ay=32926,oy=32928,jo=5126,Ws=35664,Hs=35665,Ys=35666,Vo=5124,Xs=35667,Js=35668,qs=35669,$o=35670,Ks=35671,Qs=35672,ta=35673,ns=35674,is=35675,ss=35676,as=35678,os=35680,Zo=4,cs=1028,Pn=1029,Pu=2304,Wo=2305,cy=32775,ly=32776,uy=519,hn=7680,zu=0,Bu=1,Uu=32774,hy=513,Gu=36160,fy=36064,Fr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ju=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],di={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},fn={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Vu={frag:J0,vert:q0},Ho={cw:Pu,ccw:Wo};function ea(u){return Array.isArray(u)||e(u)||Mr(u)}function $u(u){return u.sort(function(g,A){return g===Wr?-1:A===Wr?1:g<A?-1:1})}function Ue(u,g,A,G){this.thisDep=u,this.contextDep=g,this.propDep=A,this.append=G}function dn(u){return u&&!(u.thisDep||u.contextDep||u.propDep)}function Le(u){return new Ue(!1,!1,!1,u)}function fr(u,g){var A=u.type;if(A===So){var G=u.data.length;return new Ue(!0,G>=1,G>=2,g)}else if(A===js){var W=u.data;return new Ue(W.thisDep,W.contextDep,W.propDep,g)}else{if(A===yu)return new Ue(!1,!1,!1,g);if(A===gu){for(var U=!1,$=!1,Q=!1,K=0;K<u.data.length;++K){var at=u.data[K];if(at.type===Mo)Q=!0;else if(at.type===Co)$=!0;else if(at.type===Io)U=!0;else if(at.type===So){U=!0;var ct=at.data;ct>=1&&($=!0),ct>=2&&(Q=!0)}else at.type===js&&(U=U||at.data.thisDep,$=$||at.data.contextDep,Q=Q||at.data.propDep)}return new Ue(U,$,Q,g)}else return new Ue(A===Io,A===Co,A===Mo,g)}}var Zu=new Ue(!1,!1,!1,function(){});function dy(u,g,A,G,W,U,$,Q,K,at,ct,ot,dt,tt,it){var L=at.Record,V={add:32774,subtract:32778,"reverse subtract":32779};A.ext_blend_minmax&&(V.min=cy,V.max=ly);var nt=A.angle_instanced_arrays,Et=A.webgl_draw_buffers,J=A.oes_vertex_array_object,bt={dirty:!0,profile:it.profile},gt={},Dt=[],H={},Z={};function Mt(x){return x.replace(".","_")}function pt(x,y,w){var N=Mt(x);Dt.push(x),gt[N]=bt[N]=!!w,H[N]=y}function rt(x,y,w){var N=Mt(x);Dt.push(x),Array.isArray(w)?(bt[N]=w.slice(),gt[N]=w.slice()):bt[N]=gt[N]=w,Z[N]=y}pt(_u,ey),pt(xu,ty),rt(bu,"blendColor",[0,0,0,0]),rt(Ro,"blendEquationSeparate",[Uu,Uu]),rt(Oo,"blendFuncSeparate",[Bu,zu,Bu,zu]),pt(vu,ny,!0),rt(Eu,"depthFunc",hy),rt(Au,"depthRange",[0,1]),rt(Tu,"depthMask",!0),rt(No,No,[!0,!0,!0,!0]),pt(wu,Q0),rt(Su,"cullFace",Pn),rt(Lo,Lo,Wo),rt(ko,ko,1),pt(Mu,sy),rt(Do,"polygonOffset",[0,0]),pt(Cu,ay),pt(Iu,oy),rt(Fo,"sampleCoverage",[1,!1]),pt(Ru,ry),rt(Ou,"stencilMask",-1),rt(Po,"stencilFunc",[uy,0,-1]),rt(zo,"stencilOpSeparate",[cs,hn,hn,hn]),rt(Ki,"stencilOpSeparate",[Pn,hn,hn,hn]),pt(Nu,iy),rt(Vs,"scissor",[0,0,u.drawingBufferWidth,u.drawingBufferHeight]),rt(Wr,Wr,[0,0,u.drawingBufferWidth,u.drawingBufferHeight]);var mt={gl:u,context:dt,strings:g,next:gt,current:bt,draw:ot,elements:U,buffer:W,shader:ct,attributes:at.state,vao:at,uniforms:K,framebuffer:Q,extensions:A,timer:tt,isBufferArgs:ea},yt={primTypes:ln,compareFuncs:di,blendFuncs:Fr,blendEquations:V,stencilOps:fn,glTypes:Cn,orientationType:Ho};p.optional(function(){mt.isArrayLike=Me}),Et&&(yt.backBuffer=[Pn],yt.drawBuffer=yr(G.maxDrawbuffers,function(x){return x===0?[0]:yr(x,function(y){return fy+y})}));var Ht=0;function jt(){var x=W0(),y=x.link,w=x.global;x.id=Ht++,x.batchId="0";var N=y(mt),F=x.shared={props:"a0"};Object.keys(mt).forEach(function(T){F[T]=w.def(N,".",T)}),p.optional(function(){x.CHECK=y(p),x.commandStr=p.guessCommand(),x.command=y(x.commandStr),x.assert=function(T,v,D){T("if(!(",v,"))",this.CHECK,".commandRaise(",y(D),",",this.command,");")},yt.invalidBlendCombinations=ju});var C=x.next={},M=x.current={};Object.keys(Z).forEach(function(T){Array.isArray(bt[T])&&(C[T]=w.def(F.next,".",T),M[T]=w.def(F.current,".",T))});var R=x.constants={};Object.keys(yt).forEach(function(T){R[T]=w.def(JSON.stringify(yt[T]))}),x.invoke=function(T,v){switch(v.type){case So:var D=["this",F.context,F.props,x.batchId];return T.def(y(v.data),".call(",D.slice(0,Math.max(v.data.length+1,4)),")");case Mo:return T.def(F.props,v.data);case Co:return T.def(F.context,v.data);case Io:return T.def("this",v.data);case js:return v.data.append(x,T),v.data.ref;case yu:return v.data.toString();case gu:return v.data.map(function(P){return x.invoke(T,P)})}},x.attribCache={};var _={};return x.scopeAttrib=function(T){var v=g.id(T);if(v in _)return _[v];var D=at.scope[v];D||(D=at.scope[v]=new L);var P=_[v]=y(D);return P},x}function _t(x){var y=x.static,w=x.dynamic,N;if(Qi in y){var F=!!y[Qi];N=Le(function(M,R){return F}),N.enable=F}else if(Qi in w){var C=w[Qi];N=fr(C,function(M,R){return M.invoke(R,C)})}return N}function vt(x,y){var w=x.static,N=x.dynamic;if(Ln in w){var F=w[Ln];return F?(F=Q.getFramebuffer(F),p.command(F,"invalid framebuffer object"),Le(function(M,R){var _=M.link(F),T=M.shared;R.set(T.framebuffer,".next",_);var v=T.context;return R.set(v,"."+ui,_+".width"),R.set(v,"."+hi,_+".height"),_})):Le(function(M,R){var _=M.shared;R.set(_.framebuffer,".next","null");var T=_.context;return R.set(T,"."+ui,T+"."+ku),R.set(T,"."+hi,T+"."+Du),"null"})}else if(Ln in N){var C=N[Ln];return fr(C,function(M,R){var _=M.invoke(R,C),T=M.shared,v=T.framebuffer,D=R.def(v,".getFramebuffer(",_,")");p.optional(function(){M.assert(R,"!"+_+"||"+D,"invalid framebuffer object")}),R.set(v,".next",D);var P=T.context;return R.set(P,"."+ui,D+"?"+D+".width:"+P+"."+ku),R.set(P,"."+hi,D+"?"+D+".height:"+P+"."+Du),D})}else return null}function Bt(x,y,w){var N=x.static,F=x.dynamic;function C(_){if(_ in N){var T=N[_];p.commandType(T,"object","invalid "+_,w.commandStr);var v=!0,D=T.x|0,P=T.y|0,Y,ht;return"width"in T?(Y=T.width|0,p.command(Y>=0,"invalid "+_,w.commandStr)):v=!1,"height"in T?(ht=T.height|0,p.command(ht>=0,"invalid "+_,w.commandStr)):v=!1,new Ue(!v&&y&&y.thisDep,!v&&y&&y.contextDep,!v&&y&&y.propDep,function(lt,Nt){var Tt=lt.shared.context,Ct=Y;"width"in T||(Ct=Nt.def(Tt,".",ui,"-",D));var It=ht;return"height"in T||(It=Nt.def(Tt,".",hi,"-",P)),[D,P,Ct,It]})}else if(_ in F){var ft=F[_],xt=fr(ft,function(lt,Nt){var Tt=lt.invoke(Nt,ft);p.optional(function(){lt.assert(Nt,Tt+"&&typeof "+Tt+'==="object"',"invalid "+_)});var Ct=lt.shared.context,It=Nt.def(Tt,".x|0"),Lt=Nt.def(Tt,".y|0"),Ut=Nt.def('"width" in ',Tt,"?",Tt,".width|0:","(",Ct,".",ui,"-",It,")"),de=Nt.def('"height" in ',Tt,"?",Tt,".height|0:","(",Ct,".",hi,"-",Lt,")");return p.optional(function(){lt.assert(Nt,Ut+">=0&&"+de+">=0","invalid "+_)}),[It,Lt,Ut,de]});return y&&(xt.thisDep=xt.thisDep||y.thisDep,xt.contextDep=xt.contextDep||y.contextDep,xt.propDep=xt.propDep||y.propDep),xt}else return y?new Ue(y.thisDep,y.contextDep,y.propDep,function(lt,Nt){var Tt=lt.shared.context;return[0,0,Nt.def(Tt,".",ui),Nt.def(Tt,".",hi)]}):null}var M=C(Wr);if(M){var R=M;M=new Ue(M.thisDep,M.contextDep,M.propDep,function(_,T){var v=R.append(_,T),D=_.shared.context;return T.set(D,"."+H0,v[2]),T.set(D,"."+Y0,v[3]),v})}return{viewport:M,scissor_box:C(Vs)}}function Wt(x,y){var w=x.static,N=typeof w[es]=="string"&&typeof w[ts]=="string";if(N){if(Object.keys(y.dynamic).length>0)return null;var F=y.static,C=Object.keys(F);if(C.length>0&&typeof F[C[0]]=="number"){for(var M=[],R=0;R<C.length;++R)p(typeof F[C[R]]=="number","must specify all vertex attribute locations when using vaos"),M.push([F[C[R]]|0,C[R]]);return M}}return null}function Qt(x,y,w){var N=x.static,F=x.dynamic;function C(v){if(v in N){var D=g.id(N[v]);p.optional(function(){ct.shader(Vu[v],D,p.guessCommand())});var P=Le(function(){return D});return P.id=D,P}else if(v in F){var Y=F[v];return fr(Y,function(ht,ft){var xt=ht.invoke(ft,Y),lt=ft.def(ht.shared.strings,".id(",xt,")");return p.optional(function(){ft(ht.shared.shader,".shader(",Vu[v],",",lt,",",ht.command,");")}),lt})}return null}var M=C(es),R=C(ts),_=null,T;return dn(M)&&dn(R)?(_=ct.program(R.id,M.id,null,w),T=Le(function(v,D){return v.link(_)})):T=new Ue(M&&M.thisDep||R&&R.thisDep,M&&M.contextDep||R&&R.contextDep,M&&M.propDep||R&&R.propDep,function(v,D){var P=v.shared.shader,Y;M?Y=M.append(v,D):Y=D.def(P,".",es);var ht;R?ht=R.append(v,D):ht=D.def(P,".",ts);var ft=P+".program("+ht+","+Y;return p.optional(function(){ft+=","+v.command}),D.def(ft+")")}),{frag:M,vert:R,progVar:T,program:_}}function ve(x,y){var w=x.static,N=x.dynamic,F={},C=!1;function M(){if(rs in w){var Nt=w[rs];return Nt!==null&&at.getVAO(Nt)===null&&(Nt=at.createVAO(Nt)),C=!0,F.vao=Nt,Le(function(Ct){var It=at.getVAO(Nt);return It?Ct.link(It):"null"})}else if(rs in N){C=!0;var Tt=N[rs];return fr(Tt,function(Ct,It){var Lt=Ct.invoke(It,Tt);return It.def(Ct.shared.vao+".getVAO("+Lt+")")})}return null}var R=M(),_=!1;function T(){if(kn in w){var Nt=w[kn];if(F.elements=Nt,ea(Nt)){var Tt=F.elements=U.create(Nt,!0);Nt=U.getElements(Tt),_=!0}else Nt&&(Nt=U.getElements(Nt),_=!0,p.command(Nt,"invalid elements",y.commandStr));var Ct=Le(function(Lt,Ut){if(Nt){var de=Lt.link(Nt);return Lt.ELEMENTS=de,de}return Lt.ELEMENTS=null,null});return Ct.value=Nt,Ct}else if(kn in N){_=!0;var It=N[kn];return fr(It,function(Lt,Ut){var de=Lt.shared,Ze=de.isBufferArgs,Hr=de.elements,Yr=Lt.invoke(Ut,It),Xr=Ut.def("null"),sr=Ut.def(Ze,"(",Yr,")"),zr=Lt.cond(sr).then(Xr,"=",Hr,".createStream(",Yr,");").else(Xr,"=",Hr,".getElements(",Yr,");");return p.optional(function(){Lt.assert(zr.else,"!"+Yr+"||"+Xr,"invalid elements")}),Ut.entry(zr),Ut.exit(Lt.cond(sr).then(Hr,".destroyStream(",Xr,");")),Lt.ELEMENTS=Xr,Xr})}else if(C)return new Ue(R.thisDep,R.contextDep,R.propDep,function(Lt,Ut){return Ut.def(Lt.shared.vao+".currentVAO?"+Lt.shared.elements+".getElements("+Lt.shared.vao+".currentVAO.elements):null")});return null}var v=T();function D(){if(Dn in w){var Nt=w[Dn];return F.primitive=Nt,p.commandParameter(Nt,ln,"invalid primitve",y.commandStr),Le(function(Ct,It){return ln[Nt]})}else if(Dn in N){var Tt=N[Dn];return fr(Tt,function(Ct,It){var Lt=Ct.constants.primTypes,Ut=Ct.invoke(It,Tt);return p.optional(function(){Ct.assert(It,Ut+" in "+Lt,"invalid primitive, must be one of "+Object.keys(ln))}),It.def(Lt,"[",Ut,"]")})}else{if(_)return dn(v)?v.value?Le(function(Ct,It){return It.def(Ct.ELEMENTS,".primType")}):Le(function(){return Zo}):new Ue(v.thisDep,v.contextDep,v.propDep,function(Ct,It){var Lt=Ct.ELEMENTS;return It.def(Lt,"?",Lt,".primType:",Zo)});if(C)return new Ue(R.thisDep,R.contextDep,R.propDep,function(Ct,It){return It.def(Ct.shared.vao+".currentVAO?"+Ct.shared.vao+".currentVAO.primitive:"+Zo)})}return null}function P(Nt,Tt){if(Nt in w){var Ct=w[Nt]|0;return Tt?F.offset=Ct:F.instances=Ct,p.command(!Tt||Ct>=0,"invalid "+Nt,y.commandStr),Le(function(Lt,Ut){return Tt&&(Lt.OFFSET=Ct),Ct})}else if(Nt in N){var It=N[Nt];return fr(It,function(Lt,Ut){var de=Lt.invoke(Ut,It);return Tt&&(Lt.OFFSET=de,p.optional(function(){Lt.assert(Ut,de+">=0","invalid "+Nt)})),de})}else if(Tt){if(_)return Le(function(Lt,Ut){return Lt.OFFSET=0,0});if(C)return new Ue(R.thisDep,R.contextDep,R.propDep,function(Lt,Ut){return Ut.def(Lt.shared.vao+".currentVAO?"+Lt.shared.vao+".currentVAO.offset:0")})}else if(C)return new Ue(R.thisDep,R.contextDep,R.propDep,function(Lt,Ut){return Ut.def(Lt.shared.vao+".currentVAO?"+Lt.shared.vao+".currentVAO.instances:-1")});return null}var Y=P($s,!0);function ht(){if(Fn in w){var Nt=w[Fn]|0;return F.count=Nt,p.command(typeof Nt=="number"&&Nt>=0,"invalid vertex count",y.commandStr),Le(function(){return Nt})}else if(Fn in N){var Tt=N[Fn];return fr(Tt,function(Ut,de){var Ze=Ut.invoke(de,Tt);return p.optional(function(){Ut.assert(de,"typeof "+Ze+'==="number"&&'+Ze+">=0&&"+Ze+"===("+Ze+"|0)","invalid vertex count")}),Ze})}else if(_)if(dn(v)){if(v)return Y?new Ue(Y.thisDep,Y.contextDep,Y.propDep,function(Ut,de){var Ze=de.def(Ut.ELEMENTS,".vertCount-",Ut.OFFSET);return p.optional(function(){Ut.assert(de,Ze+">=0","invalid vertex offset/element buffer too small")}),Ze}):Le(function(Ut,de){return de.def(Ut.ELEMENTS,".vertCount")});var Ct=Le(function(){return-1});return p.optional(function(){Ct.MISSING=!0}),Ct}else{var It=new Ue(v.thisDep||Y.thisDep,v.contextDep||Y.contextDep,v.propDep||Y.propDep,function(Ut,de){var Ze=Ut.ELEMENTS;return Ut.OFFSET?de.def(Ze,"?",Ze,".vertCount-",Ut.OFFSET,":-1"):de.def(Ze,"?",Ze,".vertCount:-1")});return p.optional(function(){It.DYNAMIC=!0}),It}else if(C){var Lt=new Ue(R.thisDep,R.contextDep,R.propDep,function(Ut,de){return de.def(Ut.shared.vao,".currentVAO?",Ut.shared.vao,".currentVAO.count:-1")});return Lt}return null}var ft=D(),xt=ht(),lt=P(Zs,!1);return{elements:v,primitive:ft,count:xt,instances:lt,offset:Y,vao:R,vaoActive:C,elementsActive:_,static:F}}function Ae(x,y){var w=x.static,N=x.dynamic,F={};return Dt.forEach(function(C){var M=Mt(C);function R(_,T){if(C in w){var v=_(w[C]);F[M]=Le(function(){return v})}else if(C in N){var D=N[C];F[M]=fr(D,function(P,Y){return T(P,Y,P.invoke(Y,D))})}}switch(C){case wu:case xu:case _u:case Ru:case vu:case Nu:case Mu:case Cu:case Iu:case Tu:return R(function(_){return p.commandType(_,"boolean",C,y.commandStr),_},function(_,T,v){return p.optional(function(){_.assert(T,"typeof "+v+'==="boolean"',"invalid flag "+C,_.commandStr)}),v});case Eu:return R(function(_){return p.commandParameter(_,di,"invalid "+C,y.commandStr),di[_]},function(_,T,v){var D=_.constants.compareFuncs;return p.optional(function(){_.assert(T,v+" in "+D,"invalid "+C+", must be one of "+Object.keys(di))}),T.def(D,"[",v,"]")});case Au:return R(function(_){return p.command(Me(_)&&_.length===2&&typeof _[0]=="number"&&typeof _[1]=="number"&&_[0]<=_[1],"depth range is 2d array",y.commandStr),_},function(_,T,v){p.optional(function(){_.assert(T,_.shared.isArrayLike+"("+v+")&&"+v+".length===2&&typeof "+v+'[0]==="number"&&typeof '+v+'[1]==="number"&&'+v+"[0]<="+v+"[1]","depth range must be a 2d array")});var D=T.def("+",v,"[0]"),P=T.def("+",v,"[1]");return[D,P]});case Oo:return R(function(_){p.commandType(_,"object","blend.func",y.commandStr);var T="srcRGB"in _?_.srcRGB:_.src,v="srcAlpha"in _?_.srcAlpha:_.src,D="dstRGB"in _?_.dstRGB:_.dst,P="dstAlpha"in _?_.dstAlpha:_.dst;return p.commandParameter(T,Fr,M+".srcRGB",y.commandStr),p.commandParameter(v,Fr,M+".srcAlpha",y.commandStr),p.commandParameter(D,Fr,M+".dstRGB",y.commandStr),p.commandParameter(P,Fr,M+".dstAlpha",y.commandStr),p.command(ju.indexOf(T+", "+D)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+T+", "+D+")",y.commandStr),[Fr[T],Fr[D],Fr[v],Fr[P]]},function(_,T,v){var D=_.constants.blendFuncs;p.optional(function(){_.assert(T,v+"&&typeof "+v+'==="object"',"invalid blend func, must be an object")});function P(Tt,Ct){var It=T.def('"',Tt,Ct,'" in ',v,"?",v,".",Tt,Ct,":",v,".",Tt);return p.optional(function(){_.assert(T,It+" in "+D,"invalid "+C+"."+Tt+Ct+", must be one of "+Object.keys(Fr))}),It}var Y=P("src","RGB"),ht=P("dst","RGB");p.optional(function(){var Tt=_.constants.invalidBlendCombinations;_.assert(T,Tt+".indexOf("+Y+'+", "+'+ht+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var ft=T.def(D,"[",Y,"]"),xt=T.def(D,"[",P("src","Alpha"),"]"),lt=T.def(D,"[",ht,"]"),Nt=T.def(D,"[",P("dst","Alpha"),"]");return[ft,lt,xt,Nt]});case Ro:return R(function(_){if(typeof _=="string")return p.commandParameter(_,V,"invalid "+C,y.commandStr),[V[_],V[_]];if(typeof _=="object")return p.commandParameter(_.rgb,V,C+".rgb",y.commandStr),p.commandParameter(_.alpha,V,C+".alpha",y.commandStr),[V[_.rgb],V[_.alpha]];p.commandRaise("invalid blend.equation",y.commandStr)},function(_,T,v){var D=_.constants.blendEquations,P=T.def(),Y=T.def(),ht=_.cond("typeof ",v,'==="string"');return p.optional(function(){function ft(xt,lt,Nt){_.assert(xt,Nt+" in "+D,"invalid "+lt+", must be one of "+Object.keys(V))}ft(ht.then,C,v),_.assert(ht.else,v+"&&typeof "+v+'==="object"',"invalid "+C),ft(ht.else,C+".rgb",v+".rgb"),ft(ht.else,C+".alpha",v+".alpha")}),ht.then(P,"=",Y,"=",D,"[",v,"];"),ht.else(P,"=",D,"[",v,".rgb];",Y,"=",D,"[",v,".alpha];"),T(ht),[P,Y]});case bu:return R(function(_){return p.command(Me(_)&&_.length===4,"blend.color must be a 4d array",y.commandStr),yr(4,function(T){return+_[T]})},function(_,T,v){return p.optional(function(){_.assert(T,_.shared.isArrayLike+"("+v+")&&"+v+".length===4","blend.color must be a 4d array")}),yr(4,function(D){return T.def("+",v,"[",D,"]")})});case Ou:return R(function(_){return p.commandType(_,"number",M,y.commandStr),_|0},function(_,T,v){return p.optional(function(){_.assert(T,"typeof "+v+'==="number"',"invalid stencil.mask")}),T.def(v,"|0")});case Po:return R(function(_){p.commandType(_,"object",M,y.commandStr);var T=_.cmp||"keep",v=_.ref||0,D="mask"in _?_.mask:-1;return p.commandParameter(T,di,C+".cmp",y.commandStr),p.commandType(v,"number",C+".ref",y.commandStr),p.commandType(D,"number",C+".mask",y.commandStr),[di[T],v,D]},function(_,T,v){var D=_.constants.compareFuncs;p.optional(function(){function ft(){_.assert(T,Array.prototype.join.call(arguments,""),"invalid stencil.func")}ft(v+"&&typeof ",v,'==="object"'),ft('!("cmp" in ',v,")||(",v,".cmp in ",D,")")});var P=T.def('"cmp" in ',v,"?",D,"[",v,".cmp]",":",hn),Y=T.def(v,".ref|0"),ht=T.def('"mask" in ',v,"?",v,".mask|0:-1");return[P,Y,ht]});case zo:case Ki:return R(function(_){p.commandType(_,"object",M,y.commandStr);var T=_.fail||"keep",v=_.zfail||"keep",D=_.zpass||"keep";return p.commandParameter(T,fn,C+".fail",y.commandStr),p.commandParameter(v,fn,C+".zfail",y.commandStr),p.commandParameter(D,fn,C+".zpass",y.commandStr),[C===Ki?Pn:cs,fn[T],fn[v],fn[D]]},function(_,T,v){var D=_.constants.stencilOps;p.optional(function(){_.assert(T,v+"&&typeof "+v+'==="object"',"invalid "+C)});function P(Y){return p.optional(function(){_.assert(T,'!("'+Y+'" in '+v+")||("+v+"."+Y+" in "+D+")","invalid "+C+"."+Y+", must be one of "+Object.keys(fn))}),T.def('"',Y,'" in ',v,"?",D,"[",v,".",Y,"]:",hn)}return[C===Ki?Pn:cs,P("fail"),P("zfail"),P("zpass")]});case Do:return R(function(_){p.commandType(_,"object",M,y.commandStr);var T=_.factor|0,v=_.units|0;return p.commandType(T,"number",M+".factor",y.commandStr),p.commandType(v,"number",M+".units",y.commandStr),[T,v]},function(_,T,v){p.optional(function(){_.assert(T,v+"&&typeof "+v+'==="object"',"invalid "+C)});var D=T.def(v,".factor|0"),P=T.def(v,".units|0");return[D,P]});case Su:return R(function(_){var T=0;return _==="front"?T=cs:_==="back"&&(T=Pn),p.command(!!T,M,y.commandStr),T},function(_,T,v){return p.optional(function(){_.assert(T,v+'==="front"||'+v+'==="back"',"invalid cull.face")}),T.def(v,'==="front"?',cs,":",Pn)});case ko:return R(function(_){return p.command(typeof _=="number"&&_>=G.lineWidthDims[0]&&_<=G.lineWidthDims[1],"invalid line width, must be a positive number between "+G.lineWidthDims[0]+" and "+G.lineWidthDims[1],y.commandStr),_},function(_,T,v){return p.optional(function(){_.assert(T,"typeof "+v+'==="number"&&'+v+">="+G.lineWidthDims[0]+"&&"+v+"<="+G.lineWidthDims[1],"invalid line width")}),v});case Lo:return R(function(_){return p.commandParameter(_,Ho,M,y.commandStr),Ho[_]},function(_,T,v){return p.optional(function(){_.assert(T,v+'==="cw"||'+v+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),T.def(v+'==="cw"?'+Pu+":"+Wo)});case No:return R(function(_){return p.command(Me(_)&&_.length===4,"color.mask must be length 4 array",y.commandStr),_.map(function(T){return!!T})},function(_,T,v){return p.optional(function(){_.assert(T,_.shared.isArrayLike+"("+v+")&&"+v+".length===4","invalid color.mask")}),yr(4,function(D){return"!!"+v+"["+D+"]"})});case Fo:return R(function(_){p.command(typeof _=="object"&&_,M,y.commandStr);var T="value"in _?_.value:1,v=!!_.invert;return p.command(typeof T=="number"&&T>=0&&T<=1,"sample.coverage.value must be a number between 0 and 1",y.commandStr),[T,v]},function(_,T,v){p.optional(function(){_.assert(T,v+"&&typeof "+v+'==="object"',"invalid sample.coverage")});var D=T.def('"value" in ',v,"?+",v,".value:1"),P=T.def("!!",v,".invert");return[D,P]})}}),F}function ee(x,y){var w=x.static,N=x.dynamic,F={};return Object.keys(w).forEach(function(C){var M=w[C],R;if(typeof M=="number"||typeof M=="boolean")R=Le(function(){return M});else if(typeof M=="function"){var _=M._reglType;_==="texture2d"||_==="textureCube"?R=Le(function(T){return T.link(M)}):_==="framebuffer"||_==="framebufferCube"?(p.command(M.color.length>0,'missing color attachment for framebuffer sent to uniform "'+C+'"',y.commandStr),R=Le(function(T){return T.link(M.color[0])})):p.commandRaise('invalid data for uniform "'+C+'"',y.commandStr)}else Me(M)?R=Le(function(T){var v=T.global.def("[",yr(M.length,function(D){return p.command(typeof M[D]=="number"||typeof M[D]=="boolean","invalid uniform "+C,T.commandStr),M[D]}),"]");return v}):p.commandRaise('invalid or missing data for uniform "'+C+'"',y.commandStr);R.value=M,F[C]=R}),Object.keys(N).forEach(function(C){var M=N[C];F[C]=fr(M,function(R,_){return R.invoke(_,M)})}),F}function Pe(x,y){var w=x.static,N=x.dynamic,F={};return Object.keys(w).forEach(function(C){var M=w[C],R=g.id(C),_=new L;if(ea(M))_.state=li,_.buffer=W.getBuffer(W.create(M,fi,!1,!0)),_.type=0;else{var T=W.getBuffer(M);if(T)_.state=li,_.buffer=T,_.type=0;else if(p.command(typeof M=="object"&&M,"invalid data for attribute "+C,y.commandStr),"constant"in M){var v=M.constant;_.buffer="null",_.state=wo,typeof v=="number"?_.x=v:(p.command(Me(v)&&v.length>0&&v.length<=4,"invalid constant for attribute "+C,y.commandStr),ci.forEach(function(lt,Nt){Nt<v.length&&(_[lt]=v[Nt])}))}else{ea(M.buffer)?T=W.getBuffer(W.create(M.buffer,fi,!1,!0)):T=W.getBuffer(M.buffer),p.command(!!T,'missing buffer for attribute "'+C+'"',y.commandStr);var D=M.offset|0;p.command(D>=0,'invalid offset for attribute "'+C+'"',y.commandStr);var P=M.stride|0;p.command(P>=0&&P<256,'invalid stride for attribute "'+C+'", must be integer betweeen [0, 255]',y.commandStr);var Y=M.size|0;p.command(!("size"in M)||Y>0&&Y<=4,'invalid size for attribute "'+C+'", must be 1,2,3,4',y.commandStr);var ht=!!M.normalized,ft=0;"type"in M&&(p.commandParameter(M.type,Cn,"invalid type for attribute "+C,y.commandStr),ft=Cn[M.type]);var xt=M.divisor|0;p.optional(function(){"divisor"in M&&(p.command(xt===0||nt,'cannot specify divisor for attribute "'+C+'", instancing not supported',y.commandStr),p.command(xt>=0,'invalid divisor for attribute "'+C+'"',y.commandStr));var lt=y.commandStr,Nt=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(M).forEach(function(Tt){p.command(Nt.indexOf(Tt)>=0,'unknown parameter "'+Tt+'" for attribute pointer "'+C+'" (valid parameters are '+Nt+")",lt)})}),_.buffer=T,_.state=li,_.size=Y,_.normalized=ht,_.type=ft||T.dtype,_.offset=D,_.stride=P,_.divisor=xt}}F[C]=Le(function(lt,Nt){var Tt=lt.attribCache;if(R in Tt)return Tt[R];var Ct={isStream:!1};return Object.keys(_).forEach(function(It){Ct[It]=_[It]}),_.buffer&&(Ct.buffer=lt.link(_.buffer),Ct.type=Ct.type||Ct.buffer+".dtype"),Tt[R]=Ct,Ct})}),Object.keys(N).forEach(function(C){var M=N[C];function R(_,T){var v=_.invoke(T,M),D=_.shared,P=_.constants,Y=D.isBufferArgs,ht=D.buffer;p.optional(function(){_.assert(T,v+"&&(typeof "+v+'==="object"||typeof '+v+'==="function")&&('+Y+"("+v+")||"+ht+".getBuffer("+v+")||"+ht+".getBuffer("+v+".buffer)||"+Y+"("+v+'.buffer)||("constant" in '+v+"&&(typeof "+v+'.constant==="number"||'+D.isArrayLike+"("+v+".constant))))",'invalid dynamic attribute "'+C+'"')});var ft={isStream:T.def(!1)},xt=new L;xt.state=li,Object.keys(xt).forEach(function(Ct){ft[Ct]=T.def(""+xt[Ct])});var lt=ft.buffer,Nt=ft.type;T("if(",Y,"(",v,")){",ft.isStream,"=true;",lt,"=",ht,".createStream(",fi,",",v,");",Nt,"=",lt,".dtype;","}else{",lt,"=",ht,".getBuffer(",v,");","if(",lt,"){",Nt,"=",lt,".dtype;",'}else if("constant" in ',v,"){",ft.state,"=",wo,";","if(typeof "+v+'.constant === "number"){',ft[ci[0]],"=",v,".constant;",ci.slice(1).map(function(Ct){return ft[Ct]}).join("="),"=0;","}else{",ci.map(function(Ct,It){return ft[Ct]+"="+v+".constant.length>"+It+"?"+v+".constant["+It+"]:0;"}).join(""),"}}else{","if(",Y,"(",v,".buffer)){",lt,"=",ht,".createStream(",fi,",",v,".buffer);","}else{",lt,"=",ht,".getBuffer(",v,".buffer);","}",Nt,'="type" in ',v,"?",P.glTypes,"[",v,".type]:",lt,".dtype;",ft.normalized,"=!!",v,".normalized;");function Tt(Ct){T(ft[Ct],"=",v,".",Ct,"|0;")}return Tt("size"),Tt("offset"),Tt("stride"),Tt("divisor"),T("}}"),T.exit("if(",ft.isStream,"){",ht,".destroyStream(",lt,");","}"),ft}F[C]=fr(M,R)}),F}function _e(x){var y=x.static,w=x.dynamic,N={};return Object.keys(y).forEach(function(F){var C=y[F];N[F]=Le(function(M,R){return typeof C=="number"||typeof C=="boolean"?""+C:M.link(C)})}),Object.keys(w).forEach(function(F){var C=w[F];N[F]=fr(C,function(M,R){return M.invoke(R,C)})}),N}function ke(x,y,w,N,F){var C=x.static,M=x.dynamic;p.optional(function(){var Tt=[Ln,ts,es,kn,Dn,$s,Fn,Zs,Qi,rs].concat(Dt);function Ct(It){Object.keys(It).forEach(function(Lt){p.command(Tt.indexOf(Lt)>=0,'unknown parameter "'+Lt+'"',F.commandStr)})}Ct(C),Ct(M)});var R=Wt(x,y),_=vt(x),T=Bt(x,_,F),v=ve(x,F),D=Ae(x,F),P=Qt(x,F,R);function Y(Tt){var Ct=T[Tt];Ct&&(D[Tt]=Ct)}Y(Wr),Y(Mt(Vs));var ht=Object.keys(D).length>0,ft={framebuffer:_,draw:v,shader:P,state:D,dirty:ht,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(ft.profile=_t(x),ft.uniforms=ee(w,F),ft.drawVAO=ft.scopeVAO=v.vao,!ft.drawVAO&&P.program&&!R&&A.angle_instanced_arrays&&v.static.elements){var xt=!0,lt=P.program.attributes.map(function(Tt){var Ct=y.static[Tt];return xt=xt&&!!Ct,Ct});if(xt&&lt.length>0){var Nt=at.getVAO(at.createVAO({attributes:lt,elements:v.static.elements}));ft.drawVAO=new Ue(null,null,null,function(Tt,Ct){return Tt.link(Nt)}),ft.useVAO=!0}}return R?ft.useVAO=!0:ft.attributes=Pe(y,F),ft.context=_e(N),ft}function ze(x,y,w){var N=x.shared,F=N.context,C=x.scope();Object.keys(w).forEach(function(M){y.save(F,"."+M);var R=w[M],_=R.append(x,y);Array.isArray(_)?C(F,".",M,"=[",_.join(),"];"):C(F,".",M,"=",_,";")}),y(C)}function Be(x,y,w,N){var F=x.shared,C=F.gl,M=F.framebuffer,R;Et&&(R=y.def(F.extensions,".webgl_draw_buffers"));var _=x.constants,T=_.drawBuffer,v=_.backBuffer,D;w?D=w.append(x,y):D=y.def(M,".next"),N||y("if(",D,"!==",M,".cur){"),y("if(",D,"){",C,".bindFramebuffer(",Gu,",",D,".framebuffer);"),Et&&y(R,".drawBuffersWEBGL(",T,"[",D,".colorAttachments.length]);"),y("}else{",C,".bindFramebuffer(",Gu,",null);"),Et&&y(R,".drawBuffersWEBGL(",v,");"),y("}",M,".cur=",D,";"),N||y("}")}function $e(x,y,w){var N=x.shared,F=N.gl,C=x.current,M=x.next,R=N.current,_=N.next,T=x.cond(R,".dirty");Dt.forEach(function(v){var D=Mt(v);if(!(D in w.state)){var P,Y;if(D in M){P=M[D],Y=C[D];var ht=yr(bt[D].length,function(xt){return T.def(P,"[",xt,"]")});T(x.cond(ht.map(function(xt,lt){return xt+"!=="+Y+"["+lt+"]"}).join("||")).then(F,".",Z[D],"(",ht,");",ht.map(function(xt,lt){return Y+"["+lt+"]="+xt}).join(";"),";"))}else{P=T.def(_,".",D);var ft=x.cond(P,"!==",R,".",D);T(ft),D in H?ft(x.cond(P).then(F,".enable(",H[D],");").else(F,".disable(",H[D],");"),R,".",D,"=",P,";"):ft(F,".",Z[D],"(",P,");",R,".",D,"=",P,";")}}}),Object.keys(w.state).length===0&&T(R,".dirty=false;"),y(T)}function qe(x,y,w,N){var F=x.shared,C=x.current,M=F.current,R=F.gl;$u(Object.keys(w)).forEach(function(_){var T=w[_];if(!(N&&!N(T))){var v=T.append(x,y);if(H[_]){var D=H[_];dn(T)?v?y(R,".enable(",D,");"):y(R,".disable(",D,");"):y(x.cond(v).then(R,".enable(",D,");").else(R,".disable(",D,");")),y(M,".",_,"=",v,";")}else if(Me(v)){var P=C[_];y(R,".",Z[_],"(",v,");",v.map(function(Y,ht){return P+"["+ht+"]="+Y}).join(";"),";")}else y(R,".",Z[_],"(",v,");",M,".",_,"=",v,";")}})}function Ce(x,y){nt&&(x.instancing=y.def(x.shared.extensions,".angle_instanced_arrays"))}function Xt(x,y,w,N,F){var C=x.shared,M=x.stats,R=C.current,_=C.timer,T=w.profile;function v(){return typeof performance>"u"?"Date.now()":"performance.now()"}var D,P;function Y(Tt){D=y.def(),Tt(D,"=",v(),";"),typeof F=="string"?Tt(M,".count+=",F,";"):Tt(M,".count++;"),tt&&(N?(P=y.def(),Tt(P,"=",_,".getNumPendingQueries();")):Tt(_,".beginQuery(",M,");"))}function ht(Tt){Tt(M,".cpuTime+=",v(),"-",D,";"),tt&&(N?Tt(_,".pushScopeStats(",P,",",_,".getNumPendingQueries(),",M,");"):Tt(_,".endQuery();"))}function ft(Tt){var Ct=y.def(R,".profile");y(R,".profile=",Tt,";"),y.exit(R,".profile=",Ct,";")}var xt;if(T){if(dn(T)){T.enable?(Y(y),ht(y.exit),ft("true")):ft("false");return}xt=T.append(x,y),ft(xt)}else xt=y.def(R,".profile");var lt=x.block();Y(lt),y("if(",xt,"){",lt,"}");var Nt=x.block();ht(Nt),y.exit("if(",xt,"){",Nt,"}")}function Ke(x,y,w,N,F){var C=x.shared;function M(_){switch(_){case Ws:case Xs:case Ks:return 2;case Hs:case Js:case Qs:return 3;case Ys:case qs:case ta:return 4;default:return 1}}function R(_,T,v){var D=C.gl,P=y.def(_,".location"),Y=y.def(C.attributes,"[",P,"]"),ht=v.state,ft=v.buffer,xt=[v.x,v.y,v.z,v.w],lt=["buffer","normalized","offset","stride"];function Nt(){y("if(!",Y,".buffer){",D,".enableVertexAttribArray(",P,");}");var Ct=v.type,It;if(v.size?It=y.def(v.size,"||",T):It=T,y("if(",Y,".type!==",Ct,"||",Y,".size!==",It,"||",lt.map(function(Ut){return Y+"."+Ut+"!=="+v[Ut]}).join("||"),"){",D,".bindBuffer(",fi,",",ft,".buffer);",D,".vertexAttribPointer(",[P,It,Ct,v.normalized,v.stride,v.offset],");",Y,".type=",Ct,";",Y,".size=",It,";",lt.map(function(Ut){return Y+"."+Ut+"="+v[Ut]+";"}).join(""),"}"),nt){var Lt=v.divisor;y("if(",Y,".divisor!==",Lt,"){",x.instancing,".vertexAttribDivisorANGLE(",[P,Lt],");",Y,".divisor=",Lt,";}")}}function Tt(){y("if(",Y,".buffer){",D,".disableVertexAttribArray(",P,");",Y,".buffer=null;","}if(",ci.map(function(Ct,It){return Y+"."+Ct+"!=="+xt[It]}).join("||"),"){",D,".vertexAttrib4f(",P,",",xt,");",ci.map(function(Ct,It){return Y+"."+Ct+"="+xt[It]+";"}).join(""),"}")}ht===li?Nt():ht===wo?Tt():(y("if(",ht,"===",li,"){"),Nt(),y("}else{"),Tt(),y("}"))}N.forEach(function(_){var T=_.name,v=w.attributes[T],D;if(v){if(!F(v))return;D=v.append(x,y)}else{if(!F(Zu))return;var P=x.scopeAttrib(T);p.optional(function(){x.assert(y,P+".state","missing attribute "+T)}),D={},Object.keys(new L).forEach(function(Y){D[Y]=y.def(P,".",Y)})}R(x.link(_),M(_.info.type),D)})}function oe(x,y,w,N,F,C){for(var M=x.shared,R=M.gl,_,T=0;T<N.length;++T){var v=N[T],D=v.name,P=v.info.type,Y=w.uniforms[D],ht=x.link(v),ft=ht+".location",xt;if(Y){if(!F(Y))continue;if(dn(Y)){var lt=Y.value;if(p.command(lt!==null&&typeof lt<"u",'missing uniform "'+D+'"',x.commandStr),P===as||P===os){p.command(typeof lt=="function"&&(P===as&&(lt._reglType==="texture2d"||lt._reglType==="framebuffer")||P===os&&(lt._reglType==="textureCube"||lt._reglType==="framebufferCube")),"invalid texture for uniform "+D,x.commandStr);var Nt=x.link(lt._texture||lt.color[0]._texture);y(R,".uniform1i(",ft,",",Nt+".bind());"),y.exit(Nt,".unbind();")}else if(P===ns||P===is||P===ss){p.optional(function(){p.command(Me(lt),"invalid matrix for uniform "+D,x.commandStr),p.command(P===ns&&lt.length===4||P===is&&lt.length===9||P===ss&&lt.length===16,"invalid length for matrix uniform "+D,x.commandStr)});var Tt=x.global.def("new Float32Array(["+Array.prototype.slice.call(lt)+"])"),Ct=2;P===is?Ct=3:P===ss&&(Ct=4),y(R,".uniformMatrix",Ct,"fv(",ft,",false,",Tt,");")}else{switch(P){case jo:p.commandType(lt,"number","uniform "+D,x.commandStr),_="1f";break;case Ws:p.command(Me(lt)&&lt.length===2,"uniform "+D,x.commandStr),_="2f";break;case Hs:p.command(Me(lt)&&lt.length===3,"uniform "+D,x.commandStr),_="3f";break;case Ys:p.command(Me(lt)&&lt.length===4,"uniform "+D,x.commandStr),_="4f";break;case $o:p.commandType(lt,"boolean","uniform "+D,x.commandStr),_="1i";break;case Vo:p.commandType(lt,"number","uniform "+D,x.commandStr),_="1i";break;case Ks:p.command(Me(lt)&&lt.length===2,"uniform "+D,x.commandStr),_="2i";break;case Xs:p.command(Me(lt)&&lt.length===2,"uniform "+D,x.commandStr),_="2i";break;case Qs:p.command(Me(lt)&&lt.length===3,"uniform "+D,x.commandStr),_="3i";break;case Js:p.command(Me(lt)&&lt.length===3,"uniform "+D,x.commandStr),_="3i";break;case ta:p.command(Me(lt)&&lt.length===4,"uniform "+D,x.commandStr),_="4i";break;case qs:p.command(Me(lt)&&lt.length===4,"uniform "+D,x.commandStr),_="4i";break}y(R,".uniform",_,"(",ft,",",Me(lt)?Array.prototype.slice.call(lt):lt,");")}continue}else xt=Y.append(x,y)}else{if(!F(Zu))continue;xt=y.def(M.uniforms,"[",g.id(D),"]")}P===as?(p(!Array.isArray(xt),"must specify a scalar prop for textures"),y("if(",xt,"&&",xt,'._reglType==="framebuffer"){',xt,"=",xt,".color[0];","}")):P===os&&(p(!Array.isArray(xt),"must specify a scalar prop for cube maps"),y("if(",xt,"&&",xt,'._reglType==="framebufferCube"){',xt,"=",xt,".color[0];","}")),p.optional(function(){function sr(Ir,Ku){x.assert(y,Ir,'bad data or missing for uniform "'+D+'".  '+Ku)}function zr(Ir){p(!Array.isArray(xt),"must not specify an array type for uniform"),sr("typeof "+xt+'==="'+Ir+'"',"invalid type, expected "+Ir)}function vr(Ir,Ku){Array.isArray(xt)?p(xt.length===Ir,"must have length "+Ir):sr(M.isArrayLike+"("+xt+")&&"+xt+".length==="+Ir,"invalid vector, should have length "+Ir,x.commandStr)}function qu(Ir){p(!Array.isArray(xt),"must not specify a value type"),sr("typeof "+xt+'==="function"&&'+xt+'._reglType==="texture'+(Ir===Fu?"2d":"Cube")+'"',"invalid texture type",x.commandStr)}switch(P){case Vo:zr("number");break;case Xs:vr(2);break;case Js:vr(3);break;case qs:vr(4);break;case jo:zr("number");break;case Ws:vr(2);break;case Hs:vr(3);break;case Ys:vr(4);break;case $o:zr("boolean");break;case Ks:vr(2);break;case Qs:vr(3);break;case ta:vr(4);break;case ns:vr(4);break;case is:vr(9);break;case ss:vr(16);break;case as:qu(Fu);break;case os:qu(K0);break}});var It=1;switch(P){case as:case os:var Lt=y.def(xt,"._texture");y(R,".uniform1i(",ft,",",Lt,".bind());"),y.exit(Lt,".unbind();");continue;case Vo:case $o:_="1i";break;case Xs:case Ks:_="2i",It=2;break;case Js:case Qs:_="3i",It=3;break;case qs:case ta:_="4i",It=4;break;case jo:_="1f";break;case Ws:_="2f",It=2;break;case Hs:_="3f",It=3;break;case Ys:_="4f",It=4;break;case ns:_="Matrix2fv";break;case is:_="Matrix3fv";break;case ss:_="Matrix4fv";break}if(_.charAt(0)==="M"){y(R,".uniform",_,"(",ft,",");var Ut=Math.pow(P-ns+2,2),de=x.global.def("new Float32Array(",Ut,")");Array.isArray(xt)?y("false,(",yr(Ut,function(sr){return de+"["+sr+"]="+xt[sr]}),",",de,")"):y("false,(Array.isArray(",xt,")||",xt," instanceof Float32Array)?",xt,":(",yr(Ut,function(sr){return de+"["+sr+"]="+xt+"["+sr+"]"}),",",de,")"),y(");")}else if(It>1){for(var Ze=[],Hr=[],Yr=0;Yr<It;++Yr)Array.isArray(xt)?Hr.push(xt[Yr]):Hr.push(y.def(xt+"["+Yr+"]")),C&&Ze.push(y.def());C&&y("if(!",x.batchId,"||",Ze.map(function(sr,zr){return sr+"!=="+Hr[zr]}).join("||"),"){",Ze.map(function(sr,zr){return sr+"="+Hr[zr]+";"}).join("")),y(R,".uniform",_,"(",ft,",",Hr.join(","),");"),C&&y("}")}else{if(p(!Array.isArray(xt),"uniform value must not be an array"),C){var Xr=y.def();y("if(!",x.batchId,"||",Xr,"!==",xt,"){",Xr,"=",xt,";")}y(R,".uniform",_,"(",ft,",",xt,");"),C&&y("}")}}}function zt(x,y,w,N){var F=x.shared,C=F.gl,M=F.draw,R=N.draw;function _(){var It=R.elements,Lt,Ut=y;return It?((It.contextDep&&N.contextDynamic||It.propDep)&&(Ut=w),Lt=It.append(x,Ut),R.elementsActive&&Ut("if("+Lt+")"+C+".bindBuffer("+Go+","+Lt+".buffer.buffer);")):(Lt=Ut.def(),Ut(Lt,"=",M,".",kn,";","if(",Lt,"){",C,".bindBuffer(",Go,",",Lt,".buffer.buffer);}","else if(",F.vao,".currentVAO){",Lt,"=",x.shared.elements+".getElements("+F.vao,".currentVAO.elements);",J?"":"if("+Lt+")"+C+".bindBuffer("+Go+","+Lt+".buffer.buffer);","}")),Lt}function T(){var It=R.count,Lt,Ut=y;return It?((It.contextDep&&N.contextDynamic||It.propDep)&&(Ut=w),Lt=It.append(x,Ut),p.optional(function(){It.MISSING&&x.assert(y,"false","missing vertex count"),It.DYNAMIC&&x.assert(Ut,Lt+">=0","missing vertex count")})):(Lt=Ut.def(M,".",Fn),p.optional(function(){x.assert(Ut,Lt+">=0","missing vertex count")})),Lt}var v=_();function D(It){var Lt=R[It];return Lt?Lt.contextDep&&N.contextDynamic||Lt.propDep?Lt.append(x,w):Lt.append(x,y):y.def(M,".",It)}var P=D(Dn),Y=D($s),ht=T();if(typeof ht=="number"){if(ht===0)return}else w("if(",ht,"){"),w.exit("}");var ft,xt;nt&&(ft=D(Zs),xt=x.instancing);var lt=v+".type",Nt=R.elements&&dn(R.elements)&&!R.vaoActive;function Tt(){function It(){w(xt,".drawElementsInstancedANGLE(",[P,ht,lt,Y+"<<(("+lt+"-"+mu+")>>1)",ft],");")}function Lt(){w(xt,".drawArraysInstancedANGLE(",[P,Y,ht,ft],");")}v&&v!=="null"?Nt?It():(w("if(",v,"){"),It(),w("}else{"),Lt(),w("}")):Lt()}function Ct(){function It(){w(C+".drawElements("+[P,ht,lt,Y+"<<(("+lt+"-"+mu+")>>1)"]+");")}function Lt(){w(C+".drawArrays("+[P,Y,ht]+");")}v&&v!=="null"?Nt?It():(w("if(",v,"){"),It(),w("}else{"),Lt(),w("}")):Lt()}nt&&(typeof ft!="number"||ft>=0)?typeof ft=="string"?(w("if(",ft,">0){"),Tt(),w("}else if(",ft,"<0){"),Ct(),w("}")):Tt():Ct()}function te(x,y,w,N,F){var C=jt(),M=C.proc("body",F);return p.optional(function(){C.commandStr=y.commandStr,C.command=C.link(y.commandStr)}),nt&&(C.instancing=M.def(C.shared.extensions,".angle_instanced_arrays")),x(C,M,w,N),C.compile().body}function ie(x,y,w,N){Ce(x,y),w.useVAO?w.drawVAO?y(x.shared.vao,".setVAO(",w.drawVAO.append(x,y),");"):y(x.shared.vao,".setVAO(",x.shared.vao,".targetVAO);"):(y(x.shared.vao,".setVAO(null);"),Ke(x,y,w,N.attributes,function(){return!0})),oe(x,y,w,N.uniforms,function(){return!0},!1),zt(x,y,y,w)}function Ie(x,y){var w=x.proc("draw",1);Ce(x,w),ze(x,w,y.context),Be(x,w,y.framebuffer),$e(x,w,y),qe(x,w,y.state),Xt(x,w,y,!1,!0);var N=y.shader.progVar.append(x,w);if(w(x.shared.gl,".useProgram(",N,".program);"),y.shader.program)ie(x,w,y,y.shader.program);else{w(x.shared.vao,".setVAO(null);");var F=x.global.def("{}"),C=w.def(N,".id"),M=w.def(F,"[",C,"]");w(x.cond(M).then(M,".call(this,a0);").else(M,"=",F,"[",C,"]=",x.link(function(R){return te(ie,x,y,R,1)}),"(",N,");",M,".call(this,a0);"))}Object.keys(y.state).length>0&&w(x.shared.current,".dirty=true;"),x.shared.vao&&w(x.shared.vao,".setVAO(null);")}function Pr(x,y,w,N){x.batchId="a1",Ce(x,y);function F(){return!0}Ke(x,y,w,N.attributes,F),oe(x,y,w,N.uniforms,F,!1),zt(x,y,y,w)}function zn(x,y,w,N){Ce(x,y);var F=w.contextDep,C=y.def(),M="a0",R="a1",_=y.def();x.shared.props=_,x.batchId=C;var T=x.scope(),v=x.scope();y(T.entry,"for(",C,"=0;",C,"<",R,";++",C,"){",_,"=",M,"[",C,"];",v,"}",T.exit);function D(lt){return lt.contextDep&&F||lt.propDep}function P(lt){return!D(lt)}if(w.needsContext&&ze(x,v,w.context),w.needsFramebuffer&&Be(x,v,w.framebuffer),qe(x,v,w.state,D),w.profile&&D(w.profile)&&Xt(x,v,w,!1,!0),N)w.useVAO?w.drawVAO?D(w.drawVAO)?v(x.shared.vao,".setVAO(",w.drawVAO.append(x,v),");"):T(x.shared.vao,".setVAO(",w.drawVAO.append(x,T),");"):T(x.shared.vao,".setVAO(",x.shared.vao,".targetVAO);"):(T(x.shared.vao,".setVAO(null);"),Ke(x,T,w,N.attributes,P),Ke(x,v,w,N.attributes,D)),oe(x,T,w,N.uniforms,P,!1),oe(x,v,w,N.uniforms,D,!0),zt(x,T,v,w);else{var Y=x.global.def("{}"),ht=w.shader.progVar.append(x,v),ft=v.def(ht,".id"),xt=v.def(Y,"[",ft,"]");v(x.shared.gl,".useProgram(",ht,".program);","if(!",xt,"){",xt,"=",Y,"[",ft,"]=",x.link(function(lt){return te(Pr,x,w,lt,2)}),"(",ht,");}",xt,".call(this,a0[",C,"],",C,");")}}function E(x,y){var w=x.proc("batch",2);x.batchId="0",Ce(x,w);var N=!1,F=!0;Object.keys(y.context).forEach(function(Y){N=N||y.context[Y].propDep}),N||(ze(x,w,y.context),F=!1);var C=y.framebuffer,M=!1;C?(C.propDep?N=M=!0:C.contextDep&&N&&(M=!0),M||Be(x,w,C)):Be(x,w,null),y.state.viewport&&y.state.viewport.propDep&&(N=!0);function R(Y){return Y.contextDep&&N||Y.propDep}$e(x,w,y),qe(x,w,y.state,function(Y){return!R(Y)}),(!y.profile||!R(y.profile))&&Xt(x,w,y,!1,"a1"),y.contextDep=N,y.needsContext=F,y.needsFramebuffer=M;var _=y.shader.progVar;if(_.contextDep&&N||_.propDep)zn(x,w,y,null);else{var T=_.append(x,w);if(w(x.shared.gl,".useProgram(",T,".program);"),y.shader.program)zn(x,w,y,y.shader.program);else{w(x.shared.vao,".setVAO(null);");var v=x.global.def("{}"),D=w.def(T,".id"),P=w.def(v,"[",D,"]");w(x.cond(P).then(P,".call(this,a0,a1);").else(P,"=",v,"[",D,"]=",x.link(function(Y){return te(zn,x,y,Y,2)}),"(",T,");",P,".call(this,a0,a1);"))}}Object.keys(y.state).length>0&&w(x.shared.current,".dirty=true;"),x.shared.vao&&w(x.shared.vao,".setVAO(null);")}function j(x,y){var w=x.proc("scope",3);x.batchId="a2";var N=x.shared,F=N.current;ze(x,w,y.context),y.framebuffer&&y.framebuffer.append(x,w),$u(Object.keys(y.state)).forEach(function(M){var R=y.state[M],_=R.append(x,w);Me(_)?_.forEach(function(T,v){w.set(x.next[M],"["+v+"]",T)}):w.set(N.next,"."+M,_)}),Xt(x,w,y,!0,!0),[kn,$s,Fn,Zs,Dn].forEach(function(M){var R=y.draw[M];R&&w.set(N.draw,"."+M,""+R.append(x,w))}),Object.keys(y.uniforms).forEach(function(M){var R=y.uniforms[M].append(x,w);Array.isArray(R)&&(R="["+R.join()+"]"),w.set(N.uniforms,"["+g.id(M)+"]",R)}),Object.keys(y.attributes).forEach(function(M){var R=y.attributes[M].append(x,w),_=x.scopeAttrib(M);Object.keys(new L).forEach(function(T){w.set(_,"."+T,R[T])})}),y.scopeVAO&&w.set(N.vao,".targetVAO",y.scopeVAO.append(x,w));function C(M){var R=y.shader[M];R&&w.set(N.shader,"."+M,R.append(x,w))}C(ts),C(es),Object.keys(y.state).length>0&&(w(F,".dirty=true;"),w.exit(F,".dirty=true;")),w("a1(",x.shared.context,",a0,",x.batchId,");")}function z(x){if(!(typeof x!="object"||Me(x))){for(var y=Object.keys(x),w=0;w<y.length;++w)if(mr.isDynamic(x[y[w]]))return!0;return!1}}function St(x,y,w){var N=y.static[w];if(!N||!z(N))return;var F=x.global,C=Object.keys(N),M=!1,R=!1,_=!1,T=x.global.def("{}");C.forEach(function(D){var P=N[D];if(mr.isDynamic(P)){typeof P=="function"&&(P=N[D]=mr.unbox(P));var Y=fr(P,null);M=M||Y.thisDep,_=_||Y.propDep,R=R||Y.contextDep}else{switch(F(T,".",D,"="),typeof P){case"number":F(P);break;case"string":F('"',P,'"');break;case"object":Array.isArray(P)&&F("[",P.join(),"]");break;default:F(x.link(P));break}F(";")}});function v(D,P){C.forEach(function(Y){var ht=N[Y];if(mr.isDynamic(ht)){var ft=D.invoke(P,ht);P(T,".",Y,"=",ft,";")}})}y.dynamic[w]=new mr.DynamicVariable(js,{thisDep:M,contextDep:R,propDep:_,ref:T,append:v}),delete y.static[w]}function Kt(x,y,w,N,F){var C=jt();C.stats=C.link(F),Object.keys(y.static).forEach(function(R){St(C,y,R)}),X0.forEach(function(R){St(C,x,R)});var M=ke(x,y,w,N,C);return Ie(C,M),j(C,M),E(C,M),n(C.compile(),{destroy:function(){M.shader.program.destroy()}})}return{next:gt,current:bt,procs:(function(){var x=jt(),y=x.proc("poll"),w=x.proc("refresh"),N=x.block();y(N),w(N);var F=x.shared,C=F.gl,M=F.next,R=F.current;N(R,".dirty=false;"),Be(x,y),Be(x,w,null,!0);var _;nt&&(_=x.link(nt)),A.oes_vertex_array_object&&w(x.link(A.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var T=0;T<G.maxAttributes;++T){var v=w.def(F.attributes,"[",T,"]"),D=x.cond(v,".buffer");D.then(C,".enableVertexAttribArray(",T,");",C,".bindBuffer(",fi,",",v,".buffer.buffer);",C,".vertexAttribPointer(",T,",",v,".size,",v,".type,",v,".normalized,",v,".stride,",v,".offset);").else(C,".disableVertexAttribArray(",T,");",C,".vertexAttrib4f(",T,",",v,".x,",v,".y,",v,".z,",v,".w);",v,".buffer=null;"),w(D),nt&&w(_,".vertexAttribDivisorANGLE(",T,",",v,".divisor);")}return w(x.shared.vao,".currentVAO=null;",x.shared.vao,".setVAO(",x.shared.vao,".targetVAO);"),Object.keys(H).forEach(function(P){var Y=H[P],ht=N.def(M,".",P),ft=x.block();ft("if(",ht,"){",C,".enable(",Y,")}else{",C,".disable(",Y,")}",R,".",P,"=",ht,";"),w(ft),y("if(",ht,"!==",R,".",P,"){",ft,"}")}),Object.keys(Z).forEach(function(P){var Y=Z[P],ht=bt[P],ft,xt,lt=x.block();if(lt(C,".",Y,"("),Me(ht)){var Nt=ht.length;ft=x.global.def(M,".",P),xt=x.global.def(R,".",P),lt(yr(Nt,function(Tt){return ft+"["+Tt+"]"}),");",yr(Nt,function(Tt){return xt+"["+Tt+"]="+ft+"["+Tt+"];"}).join("")),y("if(",yr(Nt,function(Tt){return ft+"["+Tt+"]!=="+xt+"["+Tt+"]"}).join("||"),"){",lt,"}")}else ft=N.def(M,".",P),xt=N.def(R,".",P),lt(ft,");",R,".",P,"=",ft,";"),y("if(",ft,"!==",xt,"){",lt,"}");w(lt)}),x.compile()})(),compile:Kt}}function py(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var my=34918,yy=34919,Wu=35007,gy=function(u,g){if(!g.ext_disjoint_timer_query)return null;var A=[];function G(){return A.pop()||g.ext_disjoint_timer_query.createQueryEXT()}function W(nt){A.push(nt)}var U=[];function $(nt){var Et=G();g.ext_disjoint_timer_query.beginQueryEXT(Wu,Et),U.push(Et),tt(U.length-1,U.length,nt)}function Q(){g.ext_disjoint_timer_query.endQueryEXT(Wu)}function K(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var at=[];function ct(){return at.pop()||new K}function ot(nt){at.push(nt)}var dt=[];function tt(nt,Et,J){var bt=ct();bt.startQueryIndex=nt,bt.endQueryIndex=Et,bt.sum=0,bt.stats=J,dt.push(bt)}var it=[],L=[];function V(){var nt,Et,J=U.length;if(J!==0){L.length=Math.max(L.length,J+1),it.length=Math.max(it.length,J+1),it[0]=0,L[0]=0;var bt=0;for(nt=0,Et=0;Et<U.length;++Et){var gt=U[Et];g.ext_disjoint_timer_query.getQueryObjectEXT(gt,yy)?(bt+=g.ext_disjoint_timer_query.getQueryObjectEXT(gt,my),W(gt)):U[nt++]=gt,it[Et+1]=bt,L[Et+1]=nt}for(U.length=nt,nt=0,Et=0;Et<dt.length;++Et){var Dt=dt[Et],H=Dt.startQueryIndex,Z=Dt.endQueryIndex;Dt.sum+=it[Z]-it[H];var Mt=L[H],pt=L[Z];pt===Mt?(Dt.stats.gpuTime+=Dt.sum/1e6,ot(Dt)):(Dt.startQueryIndex=Mt,Dt.endQueryIndex=pt,dt[nt++]=Dt)}dt.length=nt}}return{beginQuery:$,endQuery:Q,pushScopeStats:tt,update:V,getNumPendingQueries:function(){return U.length},clear:function(){A.push.apply(A,U);for(var nt=0;nt<A.length;nt++)g.ext_disjoint_timer_query.deleteQueryEXT(A[nt]);U.length=0,A.length=0},restore:function(){U.length=0,A.length=0}}},_y=16384,xy=256,by=1024,vy=34962,Hu="webglcontextlost",Yu="webglcontextrestored",Xu=1,Ey=2,Ay=3;function Ju(u,g){for(var A=0;A<u.length;++A)if(u[A]===g)return A;return-1}function Ty(u){var g=Ep(u);if(!g)return null;var A=g.gl,G=A.getContextAttributes(),W=A.isContextLost(),U=Ap(A,g);if(!U)return null;var $=gp(),Q=py(),K=U.extensions,at=gy(A,K),ct=il(),ot=A.drawingBufferWidth,dt=A.drawingBufferHeight,tt={tick:0,time:0,viewportWidth:ot,viewportHeight:dt,framebufferWidth:ot,framebufferHeight:dt,drawingBufferWidth:ot,drawingBufferHeight:dt,pixelRatio:g.pixelRatio},it={},L={elements:null,primitive:4,count:-1,offset:0,instances:-1},V=um(A,K),nt=Sm(A,Q,g,bt),Et=zm(A,K,nt,Q),J=z0(A,K,V,Q,nt,Et,L);function bt(zt){return J.destroyBuffer(zt)}var gt=j0(A,$,Q,g),Dt=m0(A,K,V,function(){Mt.procs.poll()},tt,Q,g),H=y0(A,K,V,Q,g),Z=F0(A,K,V,Dt,H,Q),Mt=dy(A,$,K,V,nt,Et,Dt,Z,it,J,gt,L,tt,at,g),pt=Z0(A,Z,Mt.procs.poll,tt,G,K,V),rt=Mt.next,mt=A.canvas,yt=[],Ht=[],jt=[],_t=[g.onDestroy],vt=null;function Bt(){if(yt.length===0){at&&at.update(),vt=null;return}vt=Ja.next(Bt),qe();for(var zt=yt.length-1;zt>=0;--zt){var te=yt[zt];te&&te(tt,null,0)}A.flush(),at&&at.update()}function Wt(){!vt&&yt.length>0&&(vt=Ja.next(Bt))}function Qt(){vt&&(Ja.cancel(Bt),vt=null)}function ve(zt){zt.preventDefault(),W=!0,Qt(),Ht.forEach(function(te){te()})}function Ae(zt){A.getError(),W=!1,U.restore(),gt.restore(),nt.restore(),Dt.restore(),H.restore(),Z.restore(),J.restore(),at&&at.restore(),Mt.procs.refresh(),Wt(),jt.forEach(function(te){te()})}mt&&(mt.addEventListener(Hu,ve,!1),mt.addEventListener(Yu,Ae,!1));function ee(){yt.length=0,Qt(),mt&&(mt.removeEventListener(Hu,ve),mt.removeEventListener(Yu,Ae)),gt.clear(),Z.clear(),H.clear(),J.clear(),Dt.clear(),Et.clear(),nt.clear(),at&&at.clear(),_t.forEach(function(zt){zt()})}function Pe(zt){p(!!zt,"invalid args to regl({...})"),p.type(zt,"object","invalid args to regl({...})");function te(F){var C=n({},F);delete C.uniforms,delete C.attributes,delete C.context,delete C.vao,"stencil"in C&&C.stencil.op&&(C.stencil.opBack=C.stencil.opFront=C.stencil.op,delete C.stencil.op);function M(R){if(R in C){var _=C[R];delete C[R],Object.keys(_).forEach(function(T){C[R+"."+T]=_[T]})}}return M("blend"),M("depth"),M("cull"),M("stencil"),M("polygonOffset"),M("scissor"),M("sample"),"vao"in F&&(C.vao=F.vao),C}function ie(F,C){var M={},R={};return Object.keys(F).forEach(function(_){var T=F[_];if(mr.isDynamic(T)){R[_]=mr.unbox(T,_);return}else if(C&&Array.isArray(T)){for(var v=0;v<T.length;++v)if(mr.isDynamic(T[v])){R[_]=mr.unbox(T,_);return}}M[_]=T}),{dynamic:R,static:M}}var Ie=ie(zt.context||{},!0),Pr=ie(zt.uniforms||{},!0),zn=ie(zt.attributes||{},!1),E=ie(te(zt),!1),j={gpuTime:0,cpuTime:0,count:0},z=Mt.compile(E,zn,Pr,Ie,j),St=z.draw,Kt=z.batch,x=z.scope,y=[];function w(F){for(;y.length<F;)y.push(null);return y}function N(F,C){var M;if(W&&p.raise("context lost"),typeof F=="function")return x.call(this,null,F,0);if(typeof C=="function")if(typeof F=="number")for(M=0;M<F;++M)x.call(this,null,C,M);else if(Array.isArray(F))for(M=0;M<F.length;++M)x.call(this,F[M],C,M);else return x.call(this,F,C,0);else if(typeof F=="number"){if(F>0)return Kt.call(this,w(F|0),F|0)}else if(Array.isArray(F)){if(F.length)return Kt.call(this,F,F.length)}else return St.call(this,F)}return n(N,{stats:j,destroy:function(){z.destroy()}})}var _e=Z.setFBO=Pe({framebuffer:mr.define.call(null,Xu,"framebuffer")});function ke(zt,te){var ie=0;Mt.procs.poll();var Ie=te.color;Ie&&(A.clearColor(+Ie[0]||0,+Ie[1]||0,+Ie[2]||0,+Ie[3]||0),ie|=_y),"depth"in te&&(A.clearDepth(+te.depth),ie|=xy),"stencil"in te&&(A.clearStencil(te.stencil|0),ie|=by),p(!!ie,"called regl.clear with no buffer specified"),A.clear(ie)}function ze(zt){if(p(typeof zt=="object"&&zt,"regl.clear() takes an object as input"),"framebuffer"in zt)if(zt.framebuffer&&zt.framebuffer_reglType==="framebufferCube")for(var te=0;te<6;++te)_e(n({framebuffer:zt.framebuffer.faces[te]},zt),ke);else _e(zt,ke);else ke(null,zt)}function Be(zt){p.type(zt,"function","regl.frame() callback must be a function"),yt.push(zt);function te(){var ie=Ju(yt,zt);p(ie>=0,"cannot cancel a frame twice");function Ie(){var Pr=Ju(yt,Ie);yt[Pr]=yt[yt.length-1],yt.length-=1,yt.length<=0&&Qt()}yt[ie]=Ie}return Wt(),{cancel:te}}function $e(){var zt=rt.viewport,te=rt.scissor_box;zt[0]=zt[1]=te[0]=te[1]=0,tt.viewportWidth=tt.framebufferWidth=tt.drawingBufferWidth=zt[2]=te[2]=A.drawingBufferWidth,tt.viewportHeight=tt.framebufferHeight=tt.drawingBufferHeight=zt[3]=te[3]=A.drawingBufferHeight}function qe(){tt.tick+=1,tt.time=Xt(),$e(),Mt.procs.poll()}function Ce(){Dt.refresh(),$e(),Mt.procs.refresh(),at&&at.update()}function Xt(){return(il()-ct)/1e3}Ce();function Ke(zt,te){p.type(te,"function","listener callback must be a function");var ie;switch(zt){case"frame":return Be(te);case"lost":ie=Ht;break;case"restore":ie=jt;break;case"destroy":ie=_t;break;default:p.raise("invalid event, must be one of frame,lost,restore,destroy")}return ie.push(te),{cancel:function(){for(var Ie=0;Ie<ie.length;++Ie)if(ie[Ie]===te){ie[Ie]=ie[ie.length-1],ie.pop();return}}}}var oe=n(Pe,{clear:ze,prop:mr.define.bind(null,Xu),context:mr.define.bind(null,Ey),this:mr.define.bind(null,Ay),draw:Pe({}),buffer:function(zt){return nt.create(zt,vy,!1,!1)},elements:function(zt){return Et.create(zt,!1)},texture:Dt.create2D,cube:Dt.createCube,renderbuffer:H.create,framebuffer:Z.create,framebufferCube:Z.createCube,vao:J.createVAO,attributes:G,frame:Be,on:Ke,limits:V,hasExtension:function(zt){return V.extensions.indexOf(zt.toLowerCase())>=0},read:pt,destroy:ee,_gl:A,_refresh:Ce,poll:function(){qe(),at&&at.update()},now:Xt,stats:Q});return g.onDone(null,oe),oe}return Ty}))})(La)),La.exports}var HA=WA();const YA=My(HA),XA=({audioFeatures:r})=>{const t=Rt.useRef(null),e=Rt.useRef(null),n=Rt.useRef(null),i=Rt.useRef(null),[s,a]=Rt.useState(0),o=Rt.useRef(s);Rt.useEffect(()=>{if(t.current){const l=YA(t.current);e.current=l;const h=l.buffer({usage:"dynamic"});i.current=h,n.current=l({vert:`
          precision mediump float;
          attribute vec2 position;
          void main() {
            // Position is already in clip space coordinates
            gl_Position = vec4(position, 0, 1);
          }`,frag:`
          precision mediump float;
          uniform vec4 color;
          void main() {
            gl_FragColor = color;
          }`,attributes:{position:h},uniforms:{color:[0,.8,.8,.7]},count:l.prop("count"),primitive:"line strip"});const f=l.frame(()=>{var m;l.clear({color:[0,0,0,0],depth:1});const d=o.current;d>0&&((m=n.current)==null||m.call(n,{count:d}))});return()=>{f.cancel(),l.destroy()}}},[]),Rt.useEffect(()=>{if(r!=null&&r.frameAnalyses&&r.frameAnalyses.length>0){const l=r.frameAnalyses,h=r.duration,f=l.flatMap(d=>{const m=d.timestamp/h*2-1,b=(d.energy*2-1)*.5;return[m,b]});if(i.current){i.current(f);const d=f.length/2;o.current=d,a(d)}}else a(0)},[r]);const c={position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:30};return Rt.useEffect(()=>{const l=()=>{t.current&&(t.current.width=t.current.clientWidth,t.current.height=t.current.clientHeight)};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),S.jsx("canvas",{ref:t,style:c})},JA=(r,t)=>{if(!r&&!t)return!1;const e=(r||"").toLowerCase(),n=(t||"").toLowerCase();return!!(e.includes("swiftshader")||n==="google inc. (google)")},qA=()=>{const[r,t]=Rt.useState(!1),[e,n]=Rt.useState(null),[i,s]=Rt.useState(null);return Rt.useEffect(()=>{try{const a=document.createElement("canvas"),o=a.getContext("webgl")||a.getContext("experimental-webgl");if(!o)return;const c=o.getExtension("WEBGL_debug_renderer_info");if(c){const l=o.getParameter(c.UNMASKED_RENDERER_WEBGL),h=o.getParameter(c.UNMASKED_VENDOR_WEBGL);n(l),s(h),JA(l,h)&&t(!0)}}catch{}},[]),r?S.jsx("div",{role:"status",className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-yellow-900/90 border border-yellow-700 text-yellow-100 px-4 py-3 rounded-md shadow-lg",children:S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsxs("div",{className:"flex-1 text-sm",children:["VisualEffects is running on a software renderer (",e||"unknown","). Performance may be reduced. For best visuals enable hardware acceleration or run with a GPU-enabled browser."]}),S.jsx("button",{"aria-label":"dismiss",onClick:()=>t(!1),className:"ml-3 px-3 py-1 bg-yellow-800/60 rounded",children:"Dismiss"})]})}):null},xd=Rt.memo(r=>S.jsx("svg",{...r,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"})})),KA=Rt.memo(r=>S.jsx("svg",{...r,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})})),QA=Rt.memo(r=>S.jsx("svg",{...r,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z"})})),t1=r=>S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...r,children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})}),e1=Rt.memo(r=>S.jsx("svg",{...r,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 0 0 6-6V7.5a6 6 0 0 0-12 0v5.25a6 6 0 0 0 6 6ZM12 18.75a3 3 0 0 1-3-3V7.5a3 3 0 0 1 6 0v5.25a3 3 0 0 1-3 3Z"})})),pp=()=>{const r=me(n=>n.breathingIntensity),t=me(n=>n.actions.setBreathingIntensity),e=me(n=>n.status);return e==="riding"||e==="ready"||e==="analyzing"||e==="generating"?null:S.jsxs("div",{className:"mt-6 flex flex-col items-center",children:[S.jsx("label",{htmlFor:"breathing-intensity-slider",className:"text-xs text-white mb-1",children:"Breathing Intensity"}),S.jsx("input",{id:"breathing-intensity-slider",type:"range",min:0,max:2,step:.01,value:r,onChange:n=>t(Number(n.target.value)),className:"w-48 accent-pink-500"}),S.jsx("span",{className:"text-xs text-white mt-1",children:r.toFixed(2)})]})},r1=["classic","extreme","flowing","technical","experimental"],n1=["fantasy","cyberpunk","aurora","desert","space","underwater","noir"],i1=["photorealistic","stylized","painterly","lowpoly","retro"],s1=["low","medium","high"],a1=["fog","fireworks","starshow","lightBurst","sparkRing","confetti"],o1=()=>{const r=me(i=>i.generationOptions),t=me(i=>i.actions.setGenerationOptions),e=(i,s)=>{t({...r,[i]:s})},n=(i,s)=>{const a=(r==null?void 0:r.preferredEventPresets)||[],o=i.target.checked?Array.from(new Set([...a,s])):a.filter(c=>c!==s);t({...r,preferredEventPresets:o})};return S.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-3 max-w-xl mx-auto text-left",children:[S.jsxs("div",{children:[S.jsx("label",{className:"block text-xs text-gray-400",children:"Track Style"}),S.jsxs("select",{value:(r==null?void 0:r.trackStyle)||"",onChange:i=>e("trackStyle",i.target.value||void 0),className:"mt-1 w-full bg-gray-800/60 border border-gray-700 rounded-md p-2 text-sm text-gray-200",children:[S.jsx("option",{value:"",children:"(auto)"}),r1.map(i=>S.jsx("option",{value:i,children:i},i))]})]}),S.jsxs("div",{children:[S.jsx("label",{className:"block text-xs text-gray-400",children:"World Theme"}),S.jsxs("select",{value:(r==null?void 0:r.worldTheme)||"",onChange:i=>e("worldTheme",i.target.value||void 0),className:"mt-1 w-full bg-gray-800/60 border border-gray-700 rounded-md p-2 text-sm text-gray-200",children:[S.jsx("option",{value:"",children:"(auto)"}),n1.map(i=>S.jsx("option",{value:i,children:i},i))]})]}),S.jsxs("div",{children:[S.jsx("label",{className:"block text-xs text-gray-400",children:"Visual Style"}),S.jsxs("select",{value:(r==null?void 0:r.visualStyle)||"",onChange:i=>e("visualStyle",i.target.value||void 0),className:"mt-1 w-full bg-gray-800/60 border border-gray-700 rounded-md p-2 text-sm text-gray-200",children:[S.jsx("option",{value:"",children:"(auto)"}),i1.map(i=>S.jsx("option",{value:i,children:i},i))]})]}),S.jsxs("div",{children:[S.jsx("label",{className:"block text-xs text-gray-400",children:"Detail Level"}),S.jsxs("select",{value:(r==null?void 0:r.detailLevel)||"",onChange:i=>e("detailLevel",i.target.value||void 0),className:"mt-1 w-full bg-gray-800/60 border border-gray-700 rounded-md p-2 text-sm text-gray-200",children:[S.jsx("option",{value:"",children:"(auto)"}),s1.map(i=>S.jsx("option",{value:i,children:i},i))]})]}),S.jsxs("div",{className:"md:col-span-2",children:[S.jsx("label",{className:"block text-xs text-gray-400",children:"Event Presets"}),S.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:a1.map(i=>{const s=((r==null?void 0:r.preferredEventPresets)||[]).includes(i);return S.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-gray-300 bg-gray-800/40 px-3 py-1 rounded-md cursor-pointer",children:[S.jsx("input",{type:"checkbox",checked:s,onChange:a=>n(a,i)}),S.jsx("span",{className:"capitalize",children:i})]},i)})})]})]})},c1=r=>{const[t,e]=Rt.useState(!0),[n,i]=Rt.useState(!1),[s,a]=Rt.useState(null),o=Rt.useRef(null),c=Rt.useCallback(async()=>{if(r)try{const f=await navigator.mediaDevices.getUserMedia({audio:!0});o.current=f;const d=r.createMediaStreamSource(f);a(d),i(!0),e(!1)}catch(f){console.error("Error accessing microphone:",f)}},[r]),l=Rt.useCallback(()=>{o.current&&(o.current.getTracks().forEach(f=>f.stop()),o.current=null),s&&(s.disconnect(),a(null)),i(!1),e(!0)},[s]),h=Rt.useCallback(()=>{o.current&&(o.current.getAudioTracks().forEach(f=>{f.enabled=!f.enabled}),e(f=>!f))},[]);return{isMuted:t,isMicOn:n,startMicrophone:c,stopMicrophone:l,toggleMute:h,mediaStreamSource:s}},l1=({audioContext:r})=>{const{setAudioSource:t,setStatus:e}=me(c=>c.actions),{isMicOn:n,startMicrophone:i,stopMicrophone:s,mediaStreamSource:a}=c1(r);Rt.useEffect(()=>{t(a)},[a,t]);const o=()=>{n?(s(),e(ue.Idle)):(i(),e(ue.Ready))};return S.jsxs("button",{onClick:o,className:`mt-4 inline-flex items-center gap-3 px-8 py-4 bg-gray-800/50 border border-gray-600 rounded-lg cursor-pointer hover:bg-gray-700/70 transition-all duration-300 transform hover:scale-105 ${n?"border-green-400 text-green-400":"hover:border-cyan-400"}`,children:[S.jsx(e1,{className:"w-6 h-6"}),S.jsx("span",{children:n?"Stop Microphone":"Use Microphone"})]})},u1=({audioContext:r})=>{const t=me(f=>f.actions),e=Rt.useRef(null),[n,i]=Rt.useState(!1),[s,a]=Rt.useState(!1);Rt.useEffect(()=>{e.current&&(e.current.value="")},[]);const o=Rt.useCallback(async f=>{i(!0);const d=new Set(["audio/mpeg","audio/wav","audio/x-wav","audio/mp3"]),m=20*1024*1024;if(!d.has(f.type)&&!f.name.match(/\.(mp3|wav)$/i)){t.setError({title:"Unsupported file type",message:`File type: ${f.type}. Please upload an MP3 or WAV file.`}),i(!1),e.current&&(e.current.value="");return}if(f.size>m){const b=(f.size/1048576).toFixed(1);t.setError({title:"File too large",message:`File size: ${b}MB. Please upload a file smaller than 20MB.`}),i(!1),e.current&&(e.current.value="");return}try{const b=await f.slice(0,12).arrayBuffer(),I=new Uint8Array(b),B=I[0]===255&&(I[1]&224)===224,O=String.fromCharCode(...I.slice(0,4))==="RIFF";if(!B&&!O){t.setError({title:"Invalid audio file",message:"The file does not appear to be a valid audio file."}),i(!1),e.current&&(e.current.value="");return}}catch(b){console.warn("Could not verify file header:",b)}await t.setAudioFileAsync(f),i(!1)},[t]),c=Rt.useCallback(f=>{var m;const d=(m=f.target.files)==null?void 0:m[0];d&&o(d)},[o]),l=Rt.useCallback(f=>{f.preventDefault(),f.stopPropagation(),f.type==="dragenter"||f.type==="dragover"?a(!0):f.type==="dragleave"&&a(!1)},[]),h=Rt.useCallback(f=>{var m;f.preventDefault(),f.stopPropagation(),a(!1);const d=(m=f.dataTransfer.files)==null?void 0:m[0];d&&o(d)},[o]);return S.jsxs("div",{className:"text-center animate-fade-in",onDragEnter:l,onDragLeave:l,onDragOver:l,onDrop:h,children:[S.jsx("h1",{className:"text-5xl md:text-7xl font-thin tracking-widest uppercase bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-400 to-cyan-400",children:"AudioRail Rider"}),S.jsx("p",{className:"mt-4 max-w-2xl mx-auto text-gray-400",children:"Translate music into a navigable space. Inhabit the soul of a song."}),S.jsxs("div",{className:`mt-8 relative transition-all duration-200 ${s?"scale-105":""}`,children:[S.jsx("label",{htmlFor:"audio-upload",className:`inline-flex items-center gap-3 px-8 py-4 bg-gray-800/50 border rounded-lg cursor-pointer transition-all duration-300 transform hover:scale-105 ${s?"border-cyan-400 bg-cyan-900/30 shadow-lg shadow-cyan-500/50":n?"border-yellow-400 bg-yellow-900/20":"border-gray-600 hover:bg-gray-700/70 hover:border-cyan-400"}`,children:n?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"w-6 h-6 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin"}),S.jsx("span",{children:"Validating..."})]}):s?S.jsxs(S.Fragment,{children:[S.jsx(xd,{className:"w-6 h-6 text-cyan-400"}),S.jsx("span",{className:"text-cyan-400",children:"Drop your audio file here"})]}):S.jsxs(S.Fragment,{children:[S.jsx(xd,{className:"w-6 h-6"}),S.jsx("span",{children:"Offer a ghost... (MP3, WAV, max 20MB)"})]})}),S.jsx("input",{ref:e,id:"audio-upload",type:"file",accept:"audio/mp3,audio/wav,audio/mpeg,audio/x-wav,.mp3,.wav",className:"hidden",onChange:c,disabled:n})]}),S.jsxs("div",{className:"my-6 flex items-center justify-center",children:[S.jsx("div",{className:"w-1/4 border-t border-gray-600"}),S.jsx("p",{className:"mx-4 text-gray-500",children:"OR"}),S.jsx("div",{className:"w-1/4 border-t border-gray-600"})]}),S.jsx(l1,{audioContext:r}),S.jsx("p",{className:"text-xs text-gray-600 mt-4",children:"For the best experience, use a track with dynamic range."}),S.jsx(o1,{}),S.jsx(pp,{}),S.jsxs("div",{className:"mt-8 text-sm text-gray-500",children:["Powered by ",S.jsx("span",{className:"font-semibold text-gray-400",children:"Gemini"})," & ",S.jsx("span",{className:"font-semibold text-gray-400",children:"Three.js"})]})]})},h1=()=>{const{audioFile:r}=me(e=>e),{startRide:t}=me(e=>e.actions);return S.jsxs("div",{className:"text-center flex flex-col items-center animate-fade-in",children:[S.jsx(QA,{className:"w-16 h-16 text-cyan-300"}),S.jsx("h2",{className:"text-4xl font-bold mt-4 bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-400 to-cyan-400",children:"The Dreamscape is Ready"}),S.jsxs("p",{className:"mt-2 text-gray-300",children:['Your ride through "',r==null?void 0:r.name,'" has been constructed.']}),S.jsxs("button",{onClick:()=>{console.log("[App] Begin the Ride button clicked"),t()},className:"mt-8 inline-flex items-center gap-3 px-12 py-5 bg-cyan-500/80 text-white font-bold rounded-full shadow-lg shadow-cyan-500/20 hover:bg-cyan-400 transition-all duration-300 transform hover:scale-110",children:[S.jsx(KA,{className:"w-8 h-8"}),S.jsx("span",{children:"Begin the Ride"})]}),S.jsx("div",{className:"mt-8",children:S.jsx(pp,{})})]})},f1=()=>{const r=me(n=>n.audioFile),{startRideAgain:t,resetApp:e}=me(n=>n.actions);return S.jsxs("div",{className:"text-center animate-fade-in",children:[S.jsx("h2",{className:"text-4xl font-bold",children:"Ride Complete"}),S.jsxs("p",{className:"mt-2 text-gray-300",children:['You have journeyed through "',(r==null?void 0:r.name)||"your audio",'".']}),S.jsxs("div",{className:"mt-8 flex justify-center gap-4",children:[S.jsx("button",{onClick:t,className:"px-6 py-2 bg-cyan-500 hover:bg-cyan-600 rounded-md transition-colors",children:"Ride Again"}),S.jsx("button",{onClick:e,className:"px-6 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors",children:"Upload New Song"})]})]})},bd=()=>{const r=me(e=>e.error),t=me(e=>e.actions.resetApp);return r?S.jsxs("div",{className:"text-center animate-fade-in bg-red-900/20 border border-red-500/50 rounded-lg p-8 max-w-lg shadow-xl",children:[S.jsx(t1,{className:"w-16 h-16 text-red-400 mx-auto"}),S.jsx("h2",{className:"mt-4 text-3xl font-bold text-red-300",children:r.title}),S.jsx("p",{className:"mt-2 text-red-200",children:r.message}),S.jsx("button",{onClick:t,className:"mt-6 px-8 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-md transition-colors transform hover:scale-105",children:"Try Again"})]}):null},d1=({error:r})=>S.jsx("div",{className:"w-full h-full flex items-center justify-center bg-red-900/50 p-4",children:S.jsxs("div",{className:"text-center",children:[S.jsx("h2",{className:"text-2xl font-bold text-red-100",children:"3D Canvas Error"}),S.jsx("p",{className:"mt-2 text-red-200",children:"The 3D visualization encountered a critical error."}),r&&S.jsx("pre",{className:"mt-4 text-xs text-left bg-black/50 p-2 rounded",children:r.message}),S.jsx("p",{className:"mt-4 text-sm text-red-300",children:"Please try refreshing the page. If the problem persists, the track data may be corrupted."})]})}),p1=()=>S.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center text-white z-50",children:S.jsx("p",{children:"The waveform visualizer could not be loaded."})}),m1=Zn.lazy(()=>Cy(()=>import("./ThreeCanvas-CIejxQTT.js"),__vite__mapDeps([0,1,2,3]))),y1=Zn.memo(({status:r,trackData:t,audioFeatures:e,generationProgress:n,audioContext:i})=>{const s={[ue.Idle]:()=>S.jsx(u1,{audioContext:i}),[ue.Ready]:h1,[ue.Finished]:f1,[ue.Error]:bd},a=h=>h in s?s[h]:bd,o=Rt.useMemo(()=>a(r),[r,i]),c=Rt.useMemo(()=>(r===ue.Riding||r===ue.Ready)&&t,[r,t]),l=()=>null;return S.jsxs(S.Fragment,{children:[S.jsx(l,{}),r===ue.Analyzing&&S.jsx(Sc,{stage:"analyzing"}),r===ue.Generating&&S.jsx(Sc,{stage:"generating",progress:n}),S.jsxs("div",{className:"relative z-20 p-4",children:[S.jsx(qA,{}),o?S.jsx(o,{}):S.jsxs("div",{className:"text-white text-center",children:[S.jsx("h2",{className:"text-xl mb-4",children:"Unknown State"}),S.jsxs("p",{children:["App status: ",r]}),S.jsx("p",{children:"Something went wrong. Please refresh the page."})]})]}),c&&S.jsxs(Ic,{fallback:d1,children:[S.jsx(Rt.Suspense,{fallback:S.jsx(Sc,{stage:"loading"}),children:S.jsx(m1,{})}),r===ue.Ready&&S.jsx(Ic,{fallback:p1,children:S.jsx(XA,{audioFeatures:e||null})})]})]})}),g1=({curlStrength:r,noiseScale:t,noiseSpeed:e,onCurlStrengthChange:n,onNoiseScaleChange:i,onNoiseSpeedChange:s,onReset:a,onLog:o})=>S.jsxs("div",{className:"mb-3",children:[S.jsx("h4",{className:"font-medium text-gray-100 mb-1",children:"Curl Noise"}),S.jsxs("div",{className:"mb-2",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Curl Strength: ",r.toFixed(2)]}),S.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:r,onChange:c=>n(Number(c.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"mb-2",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Noise Scale: ",t.toFixed(2)]}),S.jsx("input",{type:"range",min:"0.1",max:"8",step:"0.1",value:t,onChange:c=>i(Number(c.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"mb-3",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Noise Speed: ",e.toFixed(2)]}),S.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:e,onChange:c=>s(Number(c.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"flex gap-2",children:[S.jsx("button",{onClick:a,className:"flex-1 px-3 py-1 bg-gray-800 border border-gray-600 rounded",children:"Reset"}),S.jsx("button",{onClick:o,className:"px-3 py-1 bg-cyan-600 rounded",children:"Log"})]})]}),_1=({placeUnderCamera:r,verticalOffset:t,trackRadius:e,trackDefaultOpacity:n,trackInsideOpacity:i,trackOpacityLerpSpeed:s,outlineMode:a,outlineOpacity:o,glowOpacity:c,forceInside:l,onPlaceUnderCameraChange:h,onVerticalOffsetChange:f,onTrackRadiusChange:d,onTrackDefaultOpacityChange:m,onTrackInsideOpacityChange:b,onTrackOpacityLerpSpeedChange:I,onOutlineModeChange:B,onOutlineOpacityChange:O,onGlowOpacityChange:ut,onForceInsideToggle:X,onRebuildTrack:et})=>S.jsxs("div",{className:"mt-4",children:[S.jsx("h4",{className:"font-medium text-gray-100 mb-1",children:"Track Settings"}),S.jsx("div",{className:"mb-2 text-xs text-gray-300",children:S.jsxs("label",{className:"inline-flex items-center gap-2",children:[S.jsx("input",{type:"checkbox",checked:r,onChange:q=>h(q.target.checked)}),"Place track under camera"]})}),S.jsxs("div",{className:"mb-2",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Vertical Offset: ",t.toFixed(2)]}),S.jsx("input",{type:"range",min:"0",max:"3",step:"0.01",value:t,onChange:q=>f(Number(q.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"mb-2",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Track Radius: ",e.toFixed(2)]}),S.jsx("input",{type:"range",min:"0.05",max:"2",step:"0.01",value:e,onChange:q=>d(Number(q.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"mb-2",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Default Opacity: ",n.toFixed(2)]}),S.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:n,onChange:q=>m(Number(q.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"mb-2",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Inside Opacity: ",i.toFixed(2)]}),S.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:i,onChange:q=>b(Number(q.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"mb-3",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Opacity Lerp Speed: ",s.toFixed(2)]}),S.jsx("input",{type:"range",min:"0.1",max:"12",step:"0.1",value:s,onChange:q=>I(Number(q.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"flex gap-2 mb-3",children:[S.jsx("button",{onClick:X,className:"px-3 py-1 bg-orange-600 rounded",children:l?"Release Inside":"Force Inside"}),S.jsx("button",{onClick:et,className:"px-3 py-1 bg-blue-600 rounded",children:"Rebuild Track"})]}),S.jsx("div",{className:"mb-3 text-xs text-gray-300",children:S.jsxs("label",{className:"inline-flex items-center gap-2",children:[S.jsx("input",{type:"checkbox",checked:a,onChange:q=>B(q.target.checked)}),"Outline Mode (minimal wireframe + glow)"]})}),S.jsxs("div",{className:"mb-2",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Outline Opacity: ",o.toFixed(2)]}),S.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:o,onChange:q=>O(Number(q.target.value)),className:"w-full"})]}),S.jsxs("div",{className:"mb-3",children:[S.jsxs("label",{className:"block text-xs text-gray-300",children:["Glow Opacity: ",c.toFixed(2)]}),S.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:c,onChange:q=>ut(Number(q.target.value)),className:"w-full"})]})]}),x1=({uniformsManifest:r,uniformValues:t,onUniformChange:e})=>S.jsxs("div",{className:"mt-3",children:[S.jsx("h4",{className:"font-medium text-gray-100 mb-1",children:"Shader Uniforms"}),S.jsx("div",{className:"space-y-2 max-h-48 overflow-auto pr-2",children:Object.entries(r).map(([n,i])=>S.jsxs("div",{className:"mb-2",children:[S.jsx("div",{className:"text-xs text-gray-400",children:n}),i.map(s=>S.jsxs("div",{className:"mt-1",children:[S.jsx("label",{className:"block text-xs text-gray-300",children:s.name}),s.control==="range"&&S.jsx("input",{"data-uniform":`$${s.name}`,type:"range",min:s.min??0,max:s.max??1,step:s.step??.01,value:t[s.name]??s.min??0,onChange:a=>e(s.name,Number(a.target.value)),className:"w-full"}),s.control==="number"&&S.jsx("input",{"data-uniform":`$${s.name}`,type:"number",min:s.min??0,max:s.max??16,step:s.step??1,value:t[s.name]??s.min??0,onChange:a=>e(s.name,Number(a.target.value)),className:"w-full"}),s.control==="checkbox"&&S.jsx("input",{"data-uniform":`$${s.name}`,type:"checkbox",checked:!!t[s.name],onChange:a=>e(s.name,a.target.checked)}),s.control==="color"&&S.jsx("input",{"data-uniform":`$${s.name}`,type:"color",value:t[s.name]??"#000000",onChange:a=>e(s.name,a.target.value)}),s.control==="select"&&s.options&&S.jsx("select",{"data-uniform":`$${s.name}`,value:t[s.name]??s.options[0],onChange:a=>e(s.name,a.target.value),className:"w-full",children:s.options.map(a=>S.jsx("option",{value:a,children:a},a))})]},s.name))]},n))})]}),b1=({presets:r,onSavePreset:t,onExportPreset:e,onSharePreset:n,onImportPreset:i,onLoadPreset:s})=>S.jsxs("div",{className:"mt-3",children:[S.jsx("h4",{className:"font-medium text-gray-100 mb-1",children:"Presets"}),S.jsxs("div",{className:"mt-2 flex gap-2",children:[S.jsx("input",{id:"presetName",placeholder:"Preset name",className:"flex-1 px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm"}),S.jsx("button",{onClick:()=>{const a=document.getElementById("presetName");a&&a.value&&t(a.value)},className:"px-3 py-1 bg-blue-600 rounded",children:"Save"})]}),S.jsxs("div",{className:"mt-2 flex gap-2",children:[S.jsx("button",{onClick:()=>{const a=r[r.length-1];a&&e(a.data)},className:"px-2 py-1 bg-gray-800 rounded",children:"Export Last"}),S.jsx("button",{onClick:()=>{if(r.length===0){console.warn("No presets to share");return}const a=r[r.length-1];n(a.data)},className:"px-2 py-1 bg-cyan-600 rounded",children:"Share URL"}),S.jsxs("label",{className:"px-2 py-1 bg-emerald-600 rounded cursor-pointer",children:["Import",S.jsx("input",{id:"presetFile",type:"file",accept:"application/json",className:"hidden",onChange:a=>i(a.target.files?a.target.files[0]:null)})]})]}),r.length>0&&S.jsxs("div",{className:"mt-2",children:[S.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Presets"}),S.jsx("div",{className:"space-y-1",children:r.map((a,o)=>S.jsxs("div",{className:"flex gap-2 items-center",children:[S.jsx("div",{className:"text-sm flex-1",children:a.name}),S.jsx("button",{onClick:()=>s(a.data),className:"px-2 py-1 bg-gray-800 rounded",children:"Load"}),S.jsx("button",{onClick:()=>e(a.data),className:"px-2 py-1 bg-blue-600 rounded",children:"Export"}),S.jsx("button",{onClick:()=>n(a.data),className:"px-2 py-1 bg-cyan-600 rounded",children:"Share"})]},o))})]})]}),Vn={curlStrength:.12,noiseScale:2,noiseSpeed:.12},Mc="audiorailrider:dev:curlParams",Cc="audiorailrider:dev:visible",v1=()=>{if(!hp()||!fp())return null;const t=(()=>{try{const Pt=localStorage.getItem(Mc);if(Pt)return JSON.parse(Pt)}catch{}return Vn})(),[e,n]=Rt.useState(t.curlStrength??Vn.curlStrength),[i,s]=Rt.useState(t.noiseScale??Vn.noiseScale),[a,o]=Rt.useState(t.noiseSpeed??Vn.noiseSpeed),[c,l]=Rt.useState(()=>{try{return localStorage.getItem(Cc)==="1"}catch{return!0}}),[h,f]=Rt.useState(null),[d,m]=Rt.useState({}),[b,I]=Rt.useState({}),{addToast:B}=(()=>{try{return Iy()}catch{return{addToast:p=>{}}}})(),O="audiorailrider:dev:presets",ut="audiorailrider:dev:trackSettings",X={placeUnderCamera:!0,verticalOffset:.55,defaultOpacity:.92,insideOpacity:.28,opacityLerpSpeed:6,trackRadius:.35,outlineMode:!1,outlineOpacity:.18,glowOpacity:.08},q=(()=>{try{const Pt=localStorage.getItem(ut);if(Pt)return JSON.parse(Pt)}catch{}return X})(),[At,Ot]=Rt.useState(q.placeUnderCamera??X.placeUnderCamera),[wt,Gt]=Rt.useState(q.verticalOffset??X.verticalOffset),[Jt,ae]=Rt.useState(q.defaultOpacity??X.defaultOpacity),[he,kt]=Rt.useState(q.insideOpacity??X.insideOpacity),[Vt,ne]=Rt.useState(q.opacityLerpSpeed??X.opacityLerpSpeed),[xe,fe]=Rt.useState(q.trackRadius??X.trackRadius),[Te,le]=Rt.useState(q.outlineMode??X.outlineMode),[Ft,qt]=Rt.useState(q.outlineOpacity??X.outlineOpacity),[be,Fe]=Rt.useState(q.glowOpacity??X.glowOpacity),[se,ye]=Rt.useState(!1),[Se,er]=Rt.useState(()=>{try{return JSON.parse(localStorage.getItem(O)||"[]")}catch{return[]}});Rt.useEffect(()=>{(()=>{window.dispatchEvent(new CustomEvent("audiorailrider:dev:setCurlParams",{detail:{curlStrength:e,noiseScale:i,noiseSpeed:a}}))})();const p=$t=>{if($t.ctrlKey&&$t.shiftKey&&$t.key.toLowerCase()==="d"&&l(Zt=>{const Oe=!Zt;try{localStorage.setItem(Cc,Oe?"1":"0")}catch{}return Oe}),$t.key==="Escape"){l(!1);try{localStorage.setItem(Cc,"0")}catch{}}};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[]),Rt.useEffect(()=>{const Pt={placeUnderCamera:At,verticalOffset:wt,defaultOpacity:Jt,insideOpacity:he,opacityLerpSpeed:Vt,trackRadius:xe,outlineMode:Te,outlineOpacity:Ft,glowOpacity:be};try{localStorage.setItem(ut,JSON.stringify(Pt))}catch{}window.dispatchEvent(new CustomEvent("audiorailrider:dev:setTrackSettings",{detail:Pt}))},[At,wt,Jt,he,Vt,xe,Te,Ft,be]),Rt.useEffect(()=>{window.dispatchEvent(new CustomEvent("audiorailrider:dev:forceTrackInside",{detail:{force:se}}))},[se]),Rt.useEffect(()=>{const Pt={curlStrength:e,noiseScale:i,noiseSpeed:a};try{localStorage.setItem(Mc,JSON.stringify(Pt))}catch{}window.dispatchEvent(new CustomEvent("audiorailrider:dev:setCurlParams",{detail:Pt}))},[e,i,a]);let He=window.__audiorailrider_uniforms_manifest_promise||null;He||(He=(async()=>{try{const Pt=await fetch("/shaders/shader-uniforms.json");return Pt.ok?await Pt.json():null}catch{return null}})(),window.__audiorailrider_uniforms_manifest_promise=He),Rt.useEffect(()=>{let Pt=!0;return(async()=>{const p=await He;if(!Pt||!p)return;f(p);const $t={};for(const Oe of Object.keys(p))for(const ge of p[Oe])$t[ge.name]=ge;I($t);const Zt={};for(const Oe of Object.keys(p))for(const ge of p[Oe])ge.default!==void 0?Zt[ge.name]=ge.default:ge.control==="checkbox"?Zt[ge.name]=!!ge.default:ge.min!==void 0?Zt[ge.name]=ge.min:Zt[ge.name]=typeof ge.default<"u"?ge.default:0;m(Zt)})(),()=>{Pt=!1}},[]);const Ve=()=>{n(Vn.curlStrength),s(Vn.noiseScale),o(Vn.noiseSpeed);try{localStorage.removeItem(Mc)}catch{}},rr=(Pt,p)=>{m($t=>({...$t,[Pt]:p})),window.dispatchEvent(new CustomEvent("audiorailrider:dev:applyUniform",{detail:{name:Pt,value:p}}))},Ye=Pt=>{try{return btoa(unescape(encodeURIComponent(JSON.stringify(Pt)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch{return""}},cr=Pt=>{try{for(Pt=Pt.replace(/-/g,"+").replace(/_/g,"/");Pt.length%4;)Pt+="=";return JSON.parse(decodeURIComponent(escape(atob(Pt))))}catch{return null}},ir=(Pt,p)=>{const $t=b[Pt];return $t&&typeof p=="number"&&typeof $t.min=="number"&&typeof $t.max=="number"?Math.min($t.max,Math.max($t.min,p)):p},Xe=(Pt,p)=>{const $t=b[Pt];if(!$t)return p;if($t.control==="checkbox")return!!p;if($t.control==="select"&&Array.isArray($t.options))return $t.options.includes(p)?p:$t.options[0];if($t.control==="color")return typeof p=="string"&&/^#([0-9A-Fa-f]{6}|[0-9A-Fa-f]{3})$/.test(p)?p:$t.default??"#000000";if(($t.control==="range"||$t.control==="number")&&(typeof p=="number"||typeof p=="string"&&!isNaN(Number(p)))){const Zt=typeof p=="number"?p:Number(p);return typeof $t.min=="number"&&typeof $t.max=="number"?Math.min($t.max,Math.max($t.min,Zt)):Zt}return p},an=(Pt,p="preset.json")=>{const $t=new Blob([JSON.stringify(Pt,null,2)],{type:"application/json"}),Zt=URL.createObjectURL($t),Oe=document.createElement("a");Oe.href=Zt,Oe.download=p,document.body.appendChild(Oe),Oe.click(),Oe.remove(),URL.revokeObjectURL(Zt)},on=async Pt=>{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(Pt),!0}catch{}try{return document.execCommand("copy"),!0}catch{return!1}},$i=Pt=>{const p={};for(const Zt of Object.keys(d))p[Zt]=d[Zt];p.curlStrength=e,p.noiseScale=i,p.noiseSpeed=a,p.placeUnderCamera=At,p.verticalOffset=wt,p.trackDefaultOpacity=Jt,p.trackInsideOpacity=he,p.trackOpacityLerpSpeed=Vt,p.trackRadius=xe,p.outlineMode=Te,p.outlineOpacity=Ft,p.glowOpacity=be;const $t=[...Se,{name:Pt,data:p}];er($t);try{localStorage.setItem(O,JSON.stringify($t))}catch{}},nr=Pt=>{an(Pt,`audiorailrider-preset-${Date.now()}.json`)},Vr=Pt=>{const p=Ye(Pt),$t=`${location.origin}${location.pathname}?preset=${p}`;on($t).then(Zt=>{Zt?B("Preset URL copied to clipboard","success"):B("Copy failed; showing URL","info")})},$r=async Pt=>{if(Pt)try{const p=await Pt.text(),$t=JSON.parse(p);let Zt=$t;$t&&$t.data&&typeof $t.data=="object"&&(Zt=$t.data);const Oe={};for(const ge of Object.keys(Zt)){const Sr=Xe(ge,Zt[ge]);Oe[ge]=ir(ge,Sr)}Mn(Oe),B("Preset imported and applied","success")}catch(p){console.error("Failed to import preset",p)}};Rt.useEffect(()=>{try{const p=new URLSearchParams(location.search).get("preset");if(p){const $t=cr(p);if($t){const Zt=$t.data&&typeof $t.data=="object"?$t.data:$t,Oe={};for(const ge of Object.keys(Zt)){const Sr=Xe(ge,Zt[ge]);Oe[ge]=ir(ge,Sr)}Mn(Oe)}}}catch{}},[]);const Mn=Pt=>{for(const p of Object.keys(Pt)){const $t=Pt[p],Zt=typeof $t=="string"&&!isNaN(Number($t))?Number($t):$t;p==="curlStrength"&&typeof Zt=="number"&&n(Zt),p==="noiseScale"&&typeof Zt=="number"&&s(Zt),p==="noiseSpeed"&&typeof Zt=="number"&&o(Zt),p==="placeUnderCamera"&&typeof Zt=="boolean"&&Ot(Zt),p==="verticalOffset"&&typeof Zt=="number"&&Gt(Zt),p==="trackDefaultOpacity"&&typeof Zt=="number"&&ae(Zt),p==="trackInsideOpacity"&&typeof Zt=="number"&&kt(Zt),p==="trackOpacityLerpSpeed"&&typeof Zt=="number"&&ne(Zt),p==="trackRadius"&&typeof Zt=="number"&&fe(Zt),p==="outlineMode"&&typeof Zt=="boolean"&&le(Zt),p==="outlineOpacity"&&typeof Zt=="number"&&qt(Zt),p==="glowOpacity"&&typeof Zt=="number"&&Fe(Zt),m(Oe=>({...Oe,[p]:Zt})),window.dispatchEvent(new CustomEvent("audiorailrider:dev:applyUniform",{detail:{name:p,value:Zt}}))}};return c?S.jsxs("div",{className:"fixed right-4 top-4 z-50 w-72 p-3 bg-gray-900/80 border border-gray-700 rounded-lg text-sm text-gray-200 backdrop-blur-md",children:[S.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Dev Panel"}),S.jsx(g1,{curlStrength:e,noiseScale:i,noiseSpeed:a,onCurlStrengthChange:n,onNoiseScaleChange:s,onNoiseSpeedChange:o,onReset:Ve,onLog:()=>window.dispatchEvent(new CustomEvent("audiorailrider:dev:dump",{detail:{curlStrength:e,noiseScale:i,noiseSpeed:a}}))}),S.jsx(_1,{placeUnderCamera:At,verticalOffset:wt,trackRadius:xe,trackDefaultOpacity:Jt,trackInsideOpacity:he,trackOpacityLerpSpeed:Vt,outlineMode:Te,outlineOpacity:Ft,glowOpacity:be,forceInside:se,onPlaceUnderCameraChange:Ot,onVerticalOffsetChange:Gt,onTrackRadiusChange:fe,onTrackDefaultOpacityChange:ae,onTrackInsideOpacityChange:kt,onTrackOpacityLerpSpeedChange:ne,onOutlineModeChange:le,onOutlineOpacityChange:qt,onGlowOpacityChange:Fe,onForceInsideToggle:()=>ye(Pt=>!Pt),onRebuildTrack:()=>window.dispatchEvent(new CustomEvent("audiorailrider:dev:rebuildTrack"))}),h&&S.jsxs(S.Fragment,{children:[S.jsx(x1,{uniformsManifest:h,uniformValues:d,onUniformChange:rr}),S.jsx(b1,{presets:Se,onSavePreset:$i,onExportPreset:nr,onSharePreset:Vr,onImportPreset:$r,onLoadPreset:Mn})]})]}):null},E1=Zn.memo(function(){const[t,e]=Rt.useState(!1),[n,i]=Rt.useState(null),[s,a]=Rt.useState(null),[o,c]=Rt.useState(!1),[l,h]=Rt.useState(!1),[f,d]=Rt.useState(!1);zA();const m=jb(),b=me(O=>O.audioSource),I=Rt.useCallback(async()=>{try{const O=window.AudioContext||window.webkitAudioContext;if(!O)throw new Error("AudioContext not supported in this browser");const ut=new O;return ut.state==="suspended"&&c(!0),i(ut),a(null),ut}catch(O){const ut=`Failed to initialize audio: ${O instanceof Error?O.message:"Unknown error"}`;return a(ut),console.error("AudioContext initialization failed:",O),null}},[]),B=Rt.useCallback(async()=>{if(n&&n.state==="suspended")try{await n.resume(),c(!1)}catch{a("Failed to resume audio context")}else await I()},[n,I]);return Rt.useEffect(()=>{e(!0)},[]),Rt.useEffect(()=>(I(),()=>{n&&n.state!=="closed"&&n.close()}),[I]),Rt.useEffect(()=>{const O=new Image;O.onload=()=>h(!0),O.onerror=()=>d(!0),O.src="/stardust.png"},[]),$A({status:m.status,audioFile:m.audioFile,audioSource:b,audioContext:n}),t?o?S.jsx("main",{className:"relative w-full h-screen bg-black flex items-center justify-center",children:S.jsxs("div",{className:"text-white text-center",children:[S.jsx("h1",{className:"text-2xl mb-4",children:"Audio Context is suspended"}),S.jsx("p",{className:"mb-4",children:"Browser requires user interaction to start audio."}),S.jsx("button",{onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Click to start"})]})}):s?S.jsx("main",{className:"relative w-full h-screen bg-black flex items-center justify-center",children:S.jsxs("div",{className:"text-white text-center",children:[S.jsx("h1",{className:"text-2xl mb-4",children:"Audio Error"}),S.jsx("p",{className:"mb-4",children:s})]})}):S.jsxs("main",{className:"relative w-full h-screen bg-black overflow-hidden flex items-center justify-center",children:[S.jsx("div",{className:`absolute inset-0 z-0 ${l?"bg-[url('/stardust.png')] opacity-20":f?"bg-gradient-to-b from-gray-900 to-black":"bg-black"}`}),!l&&!f&&S.jsx("div",{className:"absolute inset-0 z-0 bg-black animate-pulse"}),S.jsx(y1,{...m,audioContext:n}),S.jsx(v1,{})]}):S.jsx("main",{className:"relative w-full h-screen bg-black flex items-center justify-center",children:S.jsx("div",{className:"text-white",children:"Initializing AudioRailRider..."})})}),A1=()=>S.jsx(Ic,{fallback:vd,children:S.jsx(E1,{})}),dw=Object.freeze(Object.defineProperty({__proto__:null,default:A1},Symbol.toStringTag,{value:"Module"}));export{Af as $,sw as A,Yd as B,jr as C,L1 as D,Ts as E,VE as F,X1 as G,ev as H,bf as I,Z1 as J,W1 as K,Jd as L,De as M,uT as N,tT as O,$n as P,Y1 as Q,Hd as R,Lr as S,J1 as T,$c as U,k as V,bn as W,xf as X,$1 as Y,V1 as Z,j1 as _,An as a,Rv as a$,Bi as a0,Ef as a1,TT as a2,Ba as a3,AT as a4,ET as a5,En as a6,LT as a7,NT as a8,kT as a9,tv as aA,Zc as aB,av as aC,ov as aD,Qd as aE,lv as aF,uv as aG,hv as aH,fv as aI,dv as aJ,pv as aK,mv as aL,yv as aM,Jo as aN,gv as aO,_v as aP,xv as aQ,bv as aR,vv as aS,Ev as aT,Av as aU,Tv as aV,wv as aW,Sv as aX,Mv as aY,Cv as aZ,Iv as a_,RT as aa,OT as ab,IT as ac,DT as ad,CT as ae,Ci as af,rn as ag,tw as ah,ST as ai,ew as aj,kE as ak,nn as al,Wn as am,Xc as an,R1 as ao,Yb as ap,N1 as aq,Qb as ar,rv as as,nv as at,qT as au,ap as av,iv as aw,sv as ax,qb as ay,Kb as az,pE as b,ur as b$,Ov as b0,Nv as b1,Lv as b2,kv as b3,Dv as b4,Fv as b5,Pv as b6,zv as b7,Bv as b8,Uv as b9,tp as bA,MT as bB,jT as bC,Jc as bD,Xa as bE,Tn as bF,cw as bG,Sf as bH,Jb as bI,_T as bJ,dA as bK,TE as bL,ME as bM,SE as bN,cE as bO,PT as bP,_E as bQ,O1 as bR,mT as bS,gT as bT,yT as bU,pT as bV,dT as bW,fT as bX,hT as bY,FE as bZ,GT as b_,Gv as ba,jv as bb,Vv as bc,$v as bd,oT as be,aT as bf,sT as bg,iT as bh,nT as bi,rT as bj,eT as bk,M1 as bl,C1 as bm,I1 as bn,gf as bo,P1 as bp,F1 as bq,D1 as br,k1 as bs,xT as bt,bT as bu,$T as bv,UT as bw,VT as bx,RE as by,vT as bz,zT as c,ja as c0,lT as c1,cT as c2,Xb as c3,U1 as c4,G1 as c5,QT as c6,Zv as c7,WT as c8,up as c9,XT as cA,WE as cB,KT as cC,ky as cD,ue as cE,aw as cF,$A as cG,dw as cH,Sn as ca,zE as cb,pe as cc,Oa as cd,lw as ce,ip as cf,iw as cg,nw as ch,rw as ci,me as cj,uw as ck,YE as cl,ow as cm,kr as cn,Kn as co,qn as cp,cp as cq,tr as cr,$E as cs,YT as ct,hw as cu,fw as cv,op as cw,HT as cx,FT as cy,Yf as cz,Ar as d,Dc as e,wf as f,ce as g,ZT as h,Kd as i,cv as j,Tf as k,wT as l,qd as m,JT as n,Ga as o,BT as p,ep as q,vf as r,B1 as s,z1 as t,_f as u,Q1 as v,Nf as w,K1 as x,q1 as y,H1 as z};
